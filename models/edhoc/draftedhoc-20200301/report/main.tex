\pdfoutput=1
\documentclass[runningheads]{llncs}
\usepackage{amsmath,amssymb,amsfonts}
%\usepackage{stmaryrd}       % Semantic brackets \llbracket and \rrbracket
%\usepackage{mathpartir}     % inference rules
\usepackage[scaled=0.8]{helvet}    % Less huge \textsf{functionName}
\usepackage{enumitem}       % compacts lists and stuff
\usepackage[subtle]{savetrees}
\usepackage{soul}           % \hl for highlighting text; \st for strike-through

\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{tikz}
\usepackage{environ}  % For tikz fig spanning two columns
\usetikzlibrary{positioning}
% Used for displaying a sample figure. If possible, figure files should
% be included in EPS format.
%
% If you use the hyperref package, please uncomment the following line
% to display URLs in blue roman font according to Springer's eBook style:
\usepackage{hyperref}
%\renewcommand\UrlFont{\color{blue}\rmfamily}
% not the way to do it for arXiv though...
\usepackage{url}
\hypersetup{
    final, % Uncomment to remove all links (useful for printing in black and white)
    colorlinks=true, breaklinks=true, bookmarks=false,bookmarksnumbered,
    urlcolor=blue, linkcolor=black, citecolor=green, % Link colors
%   pdftitle={title of paper}, % PDF title
%   pdfauthor={auth1, auth2}, % PDF Author
%   pdfsubject={}, % PDF Subject
    pdfkeywords={}, % PDF Keywords
    pdfcreator={PdfLaTeX}, % PDF Creator
%   pdfproducer={Pandoc, XeLaTeX with hyperref} % PDF producer
}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

%\usepackage{algorithm}
%\usepackage{algpseudocode}         % https://en.wikibooks.org/wiki/LaTeX/Algorithms#Typesetting_using_the_algorithmic_package

\usepackage{draftwatermark}
\SetWatermarkText{\textbf{DRAFT}}
\SetWatermarkScale{2}
\SetWatermarkColor[gray]{.92}


\input{macros}

% Solution for letting a tikz figure to span two columns by Ulrike Fischer
% https://tex.stackexchange.com/questions/6388/how-to-scale-a-tikzpicture-to-textwidth
\makeatletter
\newsavebox{\measure@tikzpicture}
\NewEnviron{scaletikzpicturetowidth}[1]{%
  \def\tikz@width{#1}%
  \def\tikzscale{1}\begin{lrbox}{\measure@tikzpicture}%
  \BODY
  \end{lrbox}%
  \pgfmathparse{#1/\wd\measure@tikzpicture}%
  \edef\tikzscale{\pgfmathresult}%
  \BODY
}
\makeatother
%
\begin{document}
\title{EDHOC - Tamarin modeling paper}
\author{First Author\inst{1}\orcidID{0000-1111-2222-3333} \and
Second Author\inst{2,3}\orcidID{1111-2222-3333-4444} \and
Third Author\inst{3}\orcidID{2222--3333-4444-5555}
{\color{red} DRAFT: \today}
}
%
\authorrunning{F. Author et al.}
% First names are abbreviated in the running head.
% If there are more than two authors, 'et al.' is used.
%
\institute{
    KTH Royal Institute of Technology, SE-100 44, Stockholm, Sweden \and
    Ericsson Security Research, SE-164 83, Stockholm, Sweden,
    \email{karl.norrman@ericsson.com} \and
    ITU Copenhagen $\ldots$ \and
    Ericsson Intell. Autonomous sys$\ldots$
}
%
\maketitle
%

\begin{abstract}
\hl{250 words}
IETF is standardizing a key establishment protocol, named \mEdhoc, for
constrained IoT devices.
%
In contrast to more powerful IoT devices, such as video cameras and cars,
which receive most attention from media, constrained devices often have severe
restrictions on energy consumption.
%
Additionally, they often use specialized wireless communication links with tough
constraints on message sizes, which may vary from message to message.
%
\mEdhoc was first formally analyzed by Bruni
et.al.~\cite{DBLP:conf/secsr/BruniJPS18}.
%
Since then, IETF has significantly extended the protocol, which is now a
framework with a number of cryptographic cores, called methods, where the
initial version of \mEdhoc is now just one out of five possibilities.
%
In this paper we formally analyze all methods of \mEdhoc in a symbolic model,
using the Tamarin verification tool.
%
We show that the different methods provide sensible, but also rather
heterogeneous security properties, and discuss consequences of this.
%
\end{abstract}
%
{\color{red}
    Time plan (we keep weekly Thursday meetings for sync):
\begin{itemize}
    \item \textbf{Target conference:} Security Standardization Research (SSR),
                               \hl{Submit DL: 24/8},
                               Notification: 1/10,
                               Camera ready: 12/10,
                               20 pages including bib, LCNS template
    \item \textbf{18/6} Outline and work division proposed by Karl; Karl and
        Vaishnavi start writing our parts
    \item \textbf{25/6} Alessandro can start writing his parts
    \item \textbf{\hl{9/7}} \mArxiv version ready for upload (minus formatting issues)
    \item \textbf{13/7} \mArxiv formatted version sent out for review (at least to
        Mads Dam, IETF team and internal Eri review).
    \item \textbf{17/7} Possible comments from review fixed, and upload to
        \mArxiv. This DL is needed. Otherwise people at the IETF meeting will
        not be able to comment from the IETF meeting.
    \item \textbf{---} Vacation(...)
    \item \textbf{20/8} Reformatted to SSR 2020 LNCS; Possibly added properties
        to model and paper if something useful came up during vacation
    \item \textbf{24/8} SSR submission deadline
\end{itemize}
}

%-------------------------------------------------------------------------- sec
{\color{blue}
\section*{Outline}
This section is only for the outline and will be removed in the final
    paper. Don't worry about the language or style. Only the content matters.
\vspace{10pt}
\knote{Please do use and define macros in the file \texttt{macros.tex}!}
\knote{Notes like this one are defined for the macros
    \texttt{\textbackslash knote},
    \texttt{\textbackslash vnote} and
    \texttt{\textbackslash anote}}

\begin{itemize}
    \item \textbf{Section: Situation and setting (\hl{Karl})}
        \begin{itemize}
            \item Elaborate on the story line above
            \item Explain the exploratory and iterative nature of industrial
                  standards and why this has resulted in the new \mStat methods.
            \item Contrast with \mTls. Motivate why \mEdhoc is needed in
                addition to \mTls. Little analysis of \mEdhoc so far.
                Motivate that most security analysis and media attention is on
                larger IoT devices. Give examples and cite use cases whit
                constrained devices. Paint the (true) picture that this will
                become a serious security risk in the future if not a secure
                \mEdhoc is created.
            \item Subsection: Contributions: model, verified properties,
                guidance on how various methods can be used (for std and
                implementations)
            \item Subsection: Related work: \mOptls, \mNoise,
                Bruni~\cite{DBLP:conf/secsr/BruniJPS18}, Cremers' et. al. \mTls
                analysis with \mTamarin.
        \end{itemize}
    \item \textbf{Section: \mEdhoc description (\hl{Vaishnavi?})}
        \begin{itemize}
            \item Describe evolved protocol from last \mEdhoc verification,
            \item Describe the overarching goal of \mEdhoc of security context
                establishment for \mEdhoc.
            \item Describe that \mEdhoc is a framework based on three different
                crypto-cores (\mPsk-based DH, \mSigma and \mOptls/\mNoise).
                Some inital thoughts on \mNoise here~\ref{sec:mail-notes-noise}.
                Describe how one party may use a \mSigma-like authentication
                whereas the other party may use \mOptls. The session key is
                the combination of the corresponding key material.
                Describe that this essentially makes
                \mEdhoc a framework where it is possible to run one out of 5
                different protocols.
            \item Describe \mSigSig method and relate it to original \mEdhoc and
                \mSigma. This can be brief. Identify and focus on potential
                differences.
            \item Describe \mPskPsk method.
            \item Main focus of this section. Describe \mStat based methods, which
                  have very different properties compared to original \mEdhoc,
                  which only had the single \mSigma method.
                  Draw a figure (use tikz for easiest handling), showing how the
                  protocols look like (\mStatStat, \mStatSig, \mSigStat are
                  sufficient, the \mPsk and \mSigSig methods are simpler/old and
                  less interesting).
                  Explain the difference in signatures: "Normal" vs. challenge
                  response signatures of \mStat-based method.
                  Explain how \mStatStat is basically running two interleaved
                  \mOptls protocols runs. Compare how \mStat based methods relate
                  to \mOptls and to relevant instance from \mNoise framework.
                  Make mapping as precise as possible, down to key derivation
                  inputs. If the mapping of protocol elements and inputs to
                  key derivations and other processing is sufficiently close,
                  then point to security proof for Noise and cite it. Otherwise
                  point out the differences.
             \item Describe additional components of \mEdhoc we've modeled,
                  e.g., \mCi and \mCr etc.
                  Explain relevance of \mCi and \mCr to \mOscore.
             \item Describe algorithm negotiation.
             \item Describe negotiation of method.
             \item Describe transmission of aux data and expected security
                 properties.
        \end{itemize}
    \item \textbf{Section: \mEdhoc security model and formalization (\hl{Alessandro?})}
        \begin{itemize}
            \item Subsection: threat model. We assume secure binding between
                credentials and the identity. We assume adversary cannot
                register another key for a name for an uncorrupted party. We
                assume adversary has Dolev-Yao style access to communication
                between agents. We assume adversary can compromise session keys,
                but is then not allowed to "test" that session key (in
                computational terminology). We assume adversary can compromise
                parties, but is not allowed to "test" them or their partners if
                he has done so. Two peers are partnered if they agree on: Their
                identities, and the session key material (except \mGiy in the
                relevant cases of \mStat). That is the session identifier and it
                is unique per run, which the injective agreement lemmas show.
                Define what is the key material for each method
                (see the \mTamarin model).
            \item Subsection: Short description of \mTamarin. It is known by
                now, but a short overview does not hurt.
            \item Subsection: Explain details of model, which properties we have
                modeled, how, which trade-offs were made and why.
                Explain how we modeled inj-agree (a sentence or two). Explain
                why it fails when $I$ uses \mStat-method and the implicit auth
                lemma we showed instead
                (cite~\cite{DBLP:journals/iacr/GuilhemFW19} here where I got the
                basic idea. It is then extended with the reveal queries in our
                model; obviously: if you know about other sources for this
                please cite them too). Include code/lemmas as you see fit.
            \item Subsection: Clear bullet-list of what we have shown, including
                some statics of running time code size perhaps.
                Scan draft-selander and check what props are claimed there; see
                what we have covered and what we haven't.
                Already shown:
                \begin{itemize}
                    \item Mutual injective agreement on session key, method and identities for
                        $R \rightarrow I$ and $I \rightarrow R$ for all methods
                        except when $I$ uses STAT. When $I$ uses STAT, $R \rightarrow I$ holds,
                        but not $I \rightarrow R$.
                    \item Injective implicit agreement on session key.
                        Only really needed for $I \rightarrow R$, because in all other cases we have
                        the stronger injective agreement property. But show it now for all
                        methods to having a common (and reasonable) level of security that
                        holds no matter which method user chooses.
                    \item PFS on session key for all methods.
                    \item Key secrecy (follows from PFS).
                    \item Session key independence (follows from how we modeled PFS).
                    \item Entity authentication - we show this in the same lemmas as we show
                          inj-agree on session key.  We don't have this property when $I$ uses
                          STAT method because $I$ then gets no confirmation of
                          Pre-specified peer model.
                    \item Key confirmation (except for when $I$ uses \mStat
                        method, then $I$ gets no key confirmation on \mGiy)
                \end{itemize}
            \item See~\ref{sec:mail-notes-encr} for how encryption is modeled.
            \item Caveat: we have not modeled running all methods in parallel,
                so we don't know if an adversary can somehow trick $I$ into
                running one method and $R$ another, and by that causing some
                attack.
        \end{itemize}
    \item \textbf{Section: Discussion (\hl{Karl})}
        \begin{itemize}
            \item Discuss that the security properties varies between methods
                and that this may confuse implementers and user of libraries.
            \item Discuss the overlayed \mOptls construction and how an
                additional \mOscore message $R \rightarrow I$ would give key
                confirmation and hence explicit inj-agree also for $I$.
            \item Discuss Identities and use-cases with the neighbours printer
                (now included in draft, but only after we mentioned it),
                See~\ref{sec:mail-notes-identity}.
            \item Discuss Transcipt hashes that lag behind one message and that
                it is supposed to "cover as much as possible", but sometimes
                does not (check tamarin model also for inconsistencies between
                methods). Unclear design except "as much as possible".
            \item Discuss unclearity regarding security model (trusted execution
                environment or not?). \mOptls has clear separation and therefore
                use both $g^{xy}$ and $g^{iy}$ etc. \mEdhoc is not as cleanly
                designed and according to IETF guys they don't care about
                trusted execution environments (see mail in txt-file).
                Would \mEdhoc be OK with skipping $g^{iy}$ from the session key
                material and only use $g^{xy}$ in that model? Probably yes, and
                then we can get inj-agree on the session key material, but then
                extending \mEdhoc implementations with a trusted execution
                environment for LTK operations is useless.
            \item Discuss practice of listing claimed properties (likely copied
                from some academic paper) without justification in IETF drafts.
            \item Discuss algorithm negotiation.
            \item Discuss session key authentication and the problem of \mGiy,
                see~\ref{sec:mail-notes-session-key-auth}
                and~\ref{sec:mail-notes-session-key-imp-auth}
            \item Discuss what should be used as session key and what the
                consequences of the choices are,
                see~\ref{sec:mail-notes-secrecy-sessions} and
                \ref{sec:mail-notes-session-key-mtrl}.
            \item Discuss non-repudiation that was not included until we pointed
                it out.
        \end{itemize}
\end{itemize}
}

%-------------------------------------------------------------------------- sec
\section{Introduction}
\label{sec:introduction}
%-------------------------------------------------------------------------- sub
\subsection{Motivation}
\label{sec:motivation}
IoT security threats involving cars, web-cameras and other resourceful devices
receive most attention from media and academia.
%
These devices are computationally strong with no severe bandwidth or energy
consumption restrictions.
%
Securing the communication between such devices can readily be done using
\mDandTls.
%
Constrained devices, on the other hand, where such restrictions are common,
have received much less attention.
%
These devices may be simple sensors with the only task of relaying
measurements of their physical environment to a server every hour, and doing so
autonomously for a decade without maintenance.
%
Constrained devices therefore often have limitations on energy consumption.
%
To keep energy consumption down, highly specialized radio links with small
and heterogeneous frame-sizes are sometimes used.
%
In some cases, \mDandTls messages are too large to fit into the radio frames.
%
This is one of the reasons IETF standardized the \mOscore protocol to secure
communications between constrained devices, as a complement for when \mDandTls
is too heavy weight~\cite{rfc8613}.
%

The \mOscore protocol requires a pre-established security context.
%
The IETF Lightweight Authenticated Key Exchange (LAKE) working group
currently develops requirements and a key exchange protocol capable of
establishing \mOscore security contexts.
%
The key establishment protocol is named \mEdhoc~\cite{selander-lake-edhoc-01}.
%
Naturally, \mEdhoc must work under the same constrained requirements as
\mOscore itself.
%

While neither the requirements nor the use-cases for \mEdhoc are firmly set,
the overarching design goal of \mEdhoc is to establish an \mOscore security
context with decent security while keeping the messages small.
%
The protocol has evolved significantly over time to cater for smaller messages
and more use-cases.
%
The first incarnation of \mEdhoc appeared in March 2016.
%
It contained two different cryptographic cores, one based on a
pre-shared key Diffie-Hellman and a second following a draft of the
then emerging \mbox{\mTls v1.3} standard~\cite{ietf-tls-tls13-11}, using
challenge-response signatures.
%
The latter was then replaced by \mSigma, and this version, from May 2018, was
formally analyzed by Bruni et. al.~\cite{DBLP:conf/secsr/BruniJPS18}.
%
The protocol has now further evolved and variants using challenge-response
signatures have now been added again.
%
On top of this, mixed variants where one party uses a challenge-response
signature and the other a regular signature have also been added.
%
Consequently, there are now five cryptographic cores in total, and it is prudent
to formally analyze them all to ensure a higher level of security assurance for
\mEdhoc.
%
This is especially important, since the standard itself lacks description of the
intended security model and overall security goals.
%
Filling this gap and deriving circumstances under which \mEdhoc can be
securely used to achieve certain goals is an important part of this paper.
%

%-------------------------------------------------------------------------- sub
\subsection{Contributions}
\label{sec:contributions}
Our main contributions are the following.
\begin{itemize}
    \item We provide formalization of \mEdhoc's all five cryptographic cores
        using \mTamarin.
    \item We give an explicit security model for the protocol and have verified
        essential security properties, such as session key and entity
        authentication, as well as Perfect Forward Secrecy (PFS), within that
        model.
    \item We provide consequence analysis of the verified properties to
        establish which types of use-cases \mEdhoc may be suitable for and
        to give recommendations for the future standards development.
    \item Our discussions with IETF LAKE working group members have already
        lead to improvements and clarifications of the standard based on
        observations we made during the construction of our formal model.
\end{itemize}

%-------------------------------------------------------------------------- sub
\subsection{Related work}
\label{sec:relatedWork}
The work closest to ours is Bruni et. al.~\cite{DBLP:conf/secsr/BruniJPS18},
which used \mProverif to analyze an earlier, two cryptographic core, version
of \mEdhoc.
%
We consider our work to be a sort of follow-up to that, doing a similar kind of
analysis of the most recent, and more elaborate, version of \mEdhoc using five
cores.
%
We also verify slightly different properties.
%
For instance, we include session key independence in our properties.
%
The \mTamarin tool has been used to verify many other protocols, perhaps closest
to our work is Cremers et.al's analysis of
\mTls~\cite{DBLP:conf/ccs/CremersHHSM17}.
%
Some of the cryptographic cores themselves have been analyzed in the
computational model, e.g., \mSigma by Canetti and
Krawczyk~\cite{DBLP:conf/crypto/CanettiK02} and \mOptls by Krawczyk and
Wee~\cite{DBLP:conf/eurosp/KrawczykW16}.
%

%-------------------------------------------------------------------------- sub
\subsection{Structure}
\label{sec:structure}
\knote{Only include this if we have space to spare.}


%-------------------------------------------------------------------------- ack
% Should be a run-in heading.  subsubsection works in llncs2e document class
\subsubsection*{Acknowledgments} This work was partially supported by
the Wallenberg AI, Autonomous Systems and Software Program (WASP) funded by
the Knut and Alice Wallenberg Foundation.
%

%-------------------------------------------------------------------------- bib
\bibliographystyle{plain}
\bibliography{ref}

%\printbibliography

\appendix
%-------------------------------------------------------------------------- sec
\section*{Appendix}

\input{notesFromModelConstruct}

\end{document}
