%\pdfoutput=1
\documentclass[runningheads,draft]{llncs}
\usepackage{amsmath,amssymb,amsfonts}
%\usepackage{stmaryrd}       % Semantic brackets \llbracket and \rrbracket
%\usepackage{mathpartir}     % inference rules
\usepackage[scaled=0.8]{helvet}    % Less huge \textsf{functionName}
\usepackage{enumitem}       % compacts lists and stuff
\usepackage[subtle]{savetrees}
\usepackage{soul}           % \hl for highlighting text; \st for strike-through

\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{tikz,tikzpeople}
\usetikzlibrary{trees,snakes,arrows}
\usepackage{environ}  % For tikz fig spanning two columns
\usetikzlibrary{positioning}
% Used for displaying a sample figure. If possible, figure files should
% be included in EPS format.
%
% If you use the hyperref package, please uncomment the following line
% to display URLs in blue roman font according to Springer's eBook style:
\usepackage{hyperref}
%\renewcommand\UrlFont{\color{blue}\rmfamily}
% not the way to do it for arXiv though...
\usepackage{url}
\hypersetup{
    final, % Uncomment to remove all links (useful for printing in black and white)
    colorlinks=true, breaklinks=true, bookmarks=false,bookmarksnumbered,
    urlcolor=blue, linkcolor=black, citecolor=green, % Link colors
%   pdftitle={title of paper}, % PDF title
%   pdfauthor={auth1, auth2}, % PDF Author
%   pdfsubject={}, % PDF Subject
    pdfkeywords={}, % PDF Keywords
    pdfcreator={PdfLaTeX}, % PDF Creator
%   pdfproducer={Pandoc, XeLaTeX with hyperref} % PDF producer
  }
\usepackage[final]{listings}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    identifierstyle=\color{black},
    keywordstyle=\color{magenta},
    numberstyle=\scriptsize\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\scriptsize\color{codegray},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
%    literate={--[}{$-\hspace{-3pt}[$}{3}{]->}{$]\hspace{-3pt}\rightarrow$}{3},
    keywords={let,in,rule,restriction,axiom,lemma,Ex,All,Fr,In,Out}
}

\lstset{style=mystyle}


\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

%\usepackage{algorithm}
%\usepackage{algpseudocode}         % https://en.wikibooks.org/wiki/LaTeX/Algorithms#Typesetting_using_the_algorithmic_package

\usepackage{draftwatermark}
\SetWatermarkText{\textbf{DRAFT}}
\SetWatermarkScale{2}
\SetWatermarkColor[gray]{.92}


\input{macros}

% Solution for letting a tikz figure to span two columns by Ulrike Fischer
% https://tex.stackexchange.com/questions/6388/how-to-scale-a-tikzpicture-to-textwidth
\makeatletter
\newsavebox{\measure@tikzpicture}
\NewEnviron{scaletikzpicturetowidth}[1]{%
  \def\tikz@width{#1}%
  \def\tikzscale{1}\begin{lrbox}{\measure@tikzpicture}%
  \BODY
  \end{lrbox}%
  \pgfmathparse{#1/\wd\measure@tikzpicture}%
  \edef\tikzscale{\pgfmathresult}%
  \BODY
}
\makeatother
%
\begin{document}
\title{EDHOC - Tamarin modeling paper}
\author{First Author\inst{1}\orcidID{0000-1111-2222-3333} \and
Second Author\inst{2,3}\orcidID{1111-2222-3333-4444} \and
Third Author\inst{3}\orcidID{2222--3333-4444-5555}
{\color{red} DRAFT: \today}
}
%
\authorrunning{F. Author et al.}
% First names are abbreviated in the running head.
% If there are more than two authors, 'et al.' is used.
%
\institute{
    KTH Royal Institute of Technology, SE-100 44, Stockholm, Sweden \and
    Ericsson Security Research, SE-164 83, Stockholm, Sweden,
    \email{karl.norrman@ericsson.com} \and
    ITU Copenhagen $\ldots$ \and
    Ericsson Intell. Autonomous sys$\ldots$
}
%
\maketitle
%

\begin{abstract}
\hl{250 words}
IETF is standardizing a key establishment protocol, named \mEdhoc, for
constrained IoT devices.
%
In contrast to more powerful IoT devices, such as video cameras and cars,
which receive most attention from media, constrained devices often have severe
restrictions on energy consumption.
%
Additionally, they often use specialized wireless communication links with tough
constraints on message sizes, which may vary from message to message.
%
\mEdhoc{} was first formally analyzed by
Bruni~et.~al.~\cite{DBLP:conf/secsr/BruniJPS18}.
%
Since then, IETF has significantly extended the protocol, which is now a
framework with a number of cryptographic cores, called methods, where the
initial version of \mEdhoc{} contained only two out of five possibilities.
%
In this paper we formally analyze all methods of \mEdhoc{} in a symbolic model,
using the \mTamarin{} verification tool.
%
We show that the different methods provide sensible, but also rather
heterogeneous security properties, and discuss consequences of this.
%
\end{abstract}
%
{\color{red}
    Time plan (we keep weekly Thursday meetings for sync):
\begin{itemize}
    \item \textbf{Target conference:} Security Standardization Research (SSR),
                               \hl{Submit DL: 24/8},
                               Notification: 1/10,
                               Camera ready: 12/10,
                               20 pages including bib, LCNS template
    \item \textbf{18/6} Outline and work division proposed by Karl; Karl and
        Vaishnavi start writing our parts
    \item \textbf{25/6} Alessandro can start writing his parts
    \item \textbf{\hl{9/7}} \mArxiv version ready for upload (minus formatting issues)
    \item \textbf{13/7} \mArxiv formatted version sent out for review (at least to
        Mads Dam, IETF team and internal Eri review).
    \item \textbf{17/7} Possible comments from review fixed, and upload to
        \mArxiv. This DL is needed. Otherwise people at the IETF meeting will
        not be able to comment from the IETF meeting.
    \item \textbf{---} Vacation(...)
    \item \textbf{20/8} Reformatted to SSR 2020 LNCS; Possibly added properties
        to model and paper if something useful came up during vacation
    \item \textbf{24/8} SSR submission deadline
\end{itemize}
}

%\input{diagram_sym.tex}

%-------------------------------------------------------------------------- sec
{\color{blue}
\section*{Outline}
This section is only for the outline and will be removed in the final
    paper. Don't worry about the language or style. Only the content matters.
\vspace{10pt}
\knote{Please do use and define macros in the file \texttt{macros.tex}!}
\knote{Notes like this one are defined for the macros
    \texttt{\textbackslash knote},
    \texttt{\textbackslash vnote} and
    \texttt{\textbackslash anote}}

\begin{itemize}
    \item \textbf{Section: Situation and setting (\hl{Karl})}
        \begin{itemize}
            \item OK: Elaborate on the story line above
            \item OK: Explain the exploratory and iterative nature of industrial
                  standards and why this has resulted in the new \mStat methods.
            \item OK: Contrast with \mTls. Motivate why \mEdhoc{} is needed in
                addition to \mTls. Little analysis of \mEdhoc{} so far.
                Motivate that most security analysis and media attention is on
                larger IoT devices. Give examples and cite use cases whit
                constrained devices. Paint the (true) picture that this will
                become a serious security risk in the future if not a secure
                \mEdhoc{} is created.
            \item OK: Subsection: Contributions: model, verified properties,
                guidance on how various methods can be used (for std and
                implementations)
            \item OK: Subsection: Related work: \mOptls, \mNoise,
                Bruni~\cite{DBLP:conf/secsr/BruniJPS18}, Cremers' et. al. \mTls
                analysis with \mTamarin.
        \end{itemize}
    \item \textbf{Section: \mEdhoc{} description (\hl{Vaishnavi})}
        \begin{itemize}
            \item Describe evolved protocol from last \mEdhoc{} verification,
            \item Describe the overarching goal of \mEdhoc{} of security context
                establishment for \mEdhoc.
            \item Describe that \mEdhoc{} is a framework based on three different
                crypto-cores (\mPsk-based DH, \mSigma and \mOptls/\mNoise).
                Some inital thoughts on \mNoise here~\ref{sec:mail-notes-noise}.
                Describe how one party may use a \mSigma-like authentication
                whereas the other party may use \mOptls. The session key is
                the combination of the corresponding key material.
                Describe that this essentially makes
                \mEdhoc{} a framework where it is possible to run one out of 5
                different protocols.
            \item Describe \mSigSig method and relate it to original \mEdhoc{} and
                \mSigma. This can be brief. Identify and focus on potential
                differences.
            \item Describe \mPskPsk method.
            \item Main focus of this section. Describe \mStat based methods, which
                  have very different properties compared to original \mEdhoc,
                  which only had the single \mSigma method.
                  Draw a figure (use tikz for easiest handling), showing how the
                  protocols look like (\mStatStat, \mStatSig, \mSigStat are
                  sufficient, the \mPsk and \mSigSig methods are simpler/old and
                  less interesting).
                  Explain the difference in signatures: "Normal" vs. challenge
                  response signatures of \mStat-based method.
                  Explain how \mStatStat is basically running two interleaved
                  \mOptls protocols runs. Compare how \mStat based methods relate
                  to \mOptls and to relevant instance from \mNoise framework.
                  Make mapping as precise as possible, down to key derivation
                  inputs. If the mapping of protocol elements and inputs to
                  key derivations and other processing is sufficiently close,
                  then point to security proof for Noise and cite it. Otherwise
                  point out the differences.
             \item Describe additional components of \mEdhoc{} we've modeled,
                  e.g., \mCi and \mCr etc.
                  Explain relevance of \mCi and \mCr to \mOscore.
             \item Describe algorithm negotiation.
             \item Describe negotiation of method.
             \item Describe transmission of aux data and expected security
                 properties.
        \end{itemize}
    \item \textbf{Section: \mEdhoc{} security model and formalization (\hl{Alessandro})}
        \begin{itemize}
            \item Subsection: threat model. We assume secure binding between
                credentials and the identity. We assume adversary cannot
                register another key for a name for an uncorrupted party. We
                assume adversary has Dolev-Yao style access to communication
                between agents. We assume adversary can compromise session keys,
                but is then not allowed to "test" that session key (in
                computational terminology). We assume adversary can compromise
                parties, but is not allowed to "test" them or their partners if
                he has done so. Two peers are partnered if they agree on: Their
                identities, and the session key material (except \mGiy in the
                relevant cases of \mStat). That is the session identifier and it
                is unique per run, which the injective agreement lemmas show.
                Define what is the key material for each method
                (see the \mTamarin model).
            \item Subsection: Short description of \mTamarin. It is known by
                now, but a short overview does not hurt.
            \item Subsection: Explain details of model, which properties we have
                modeled, how, which trade-offs were made and why.
                Explain how we modeled inj-agree (a sentence or two). Explain
                why it fails when $I$ uses \mStat-method and the implicit auth
                lemma we showed instead
                (cite~\cite{DBLP:journals/iacr/GuilhemFW19} here where I got the
                basic idea. It is then extended with the reveal queries in our
                model; obviously: if you know about other sources for this
                please cite them too). Include code/lemmas as you see fit.
            \item Subsection: Clear bullet-list of what we have shown, including
                some statics of running time code size perhaps.
                Scan draft-selander and check what props are claimed there; see
                what we have covered and what we haven't.
                Already shown:
                \begin{itemize}
                    \item Mutual injective agreement on session key, method and identities for
                        $R \rightarrow I$ and $I \rightarrow R$ for all methods
                        except when $I$ uses STAT. When $I$ uses STAT, $R \rightarrow I$ holds,
                        but not $I \rightarrow R$.
                    \item Injective implicit agreement on session key.
                        Only really needed for $I \rightarrow R$, because in all other cases we have
                        the stronger injective agreement property. But show it now for all
                        methods to having a common (and reasonable) level of security that
                        holds no matter which method user chooses.
                    \item PFS on session key for all methods.
                    \item Key secrecy (follows from PFS).
                    \item Session key independence (follows from how we modeled PFS).
                    \item Entity authentication - we show this in the same lemmas as we show
                          inj-agree on session key.  We don't have this property when $I$ uses
                          STAT method because $I$ then gets no confirmation of
                          Pre-specified peer model.
                    \item Key confirmation (except for when $I$ uses \mStat
                        method, then $I$ gets no key confirmation on \mGiy)
                \end{itemize}
            \item See~\ref{sec:mail-notes-encr} for how encryption is modeled.
            \item Caveat: we have not modeled running all methods in parallel,
                so we don't know if an adversary can somehow trick $I$ into
                running one method and $R$ another, and by that causing some
                attack.
        \end{itemize}
    \item \textbf{Section: Discussion (\hl{Karl})}
        \begin{itemize}
            \item{\textbf{Design practices}}
                \begin{itemize}
                \item OK. Discuss that the security properties varies between methods
                and that this may confuse implementers and user of libraries.
                \item OK. Discuss practice of listing claimed properties (likely copied
                from some academic paper) without justification in IETF drafts.
                \end{itemize}
            \item{\textbf{\mGiy and technical protocol issues}}
                \begin{itemize}
                \item Discuss unclearity regarding security model (trusted execution
                environment or not?). \mOptls has clear separation and therefore
                use both $g^{xy}$ and $g^{iy}$ etc. \mEdhoc{} is not as cleanly
                designed and according to IETF guys they don't care about
                trusted execution environments (see mail in txt-file).
                Would \mEdhoc{} be OK with skipping $g^{iy}$ from the session key
                material and only use $g^{xy}$ in that model? Probably yes, and
                then we can get inj-agree on the session key material, but then
                extending \mEdhoc{} implementations with a trusted execution
                environment for LTK operations is useless.
                \item OK: Discuss algorithm negotiation.
                \item OK: Discuss what should be used as session key and what the
                consequences of the choices are,
                see~\ref{sec:mail-notes-secrecy-sessions} and
                \ref{sec:mail-notes-session-key-mtrl}.
                \item OK: Discuss session key authentication and the problem of \mGiy,
                see~\ref{sec:mail-notes-session-key-auth}
                and~\ref{sec:mail-notes-session-key-imp-auth}
                \item OK: Discuss non-repudiation that was not included until we pointed
                it out.
                \item OK: Discuss the overlayed \mOptls construction and how an
                additional \mOscore message $R \rightarrow I$ would give key
                confirmation and hence explicit inj-agree also for $I$.
                \item Discuss Transcipt hashes that lag behind one message and that
                it is supposed to "cover as much as possible", but sometimes
                does not (check tamarin model also for inconsistencies between
                methods). Unclear design except "as much as possible".
                \end{itemize}
            \item{\textbf{Protocol user/implementor issues}}
                \begin{itemize}
                \item OK: Discuss Identities and use-cases with the neighbours printer
                (now included in draft, but only after we mentioned it),
                See~\ref{sec:mail-notes-identity}.
                \end{itemize}
        \end{itemize}
\end{itemize}
}

%-------------------------------------------------------------------------- sec
\section{Introduction}
\label{sec:introduction}
%-------------------------------------------------------------------------- sub
\subsection{Background and motivation}
\label{sec:motivation}
IoT security threats involving cars, web-cameras and other resourceful devices
receive most attention from media and academia.
%
These devices are computationally strong with no severe bandwidth or energy
consumption restrictions.
%
Securing the communication between such devices can readily be done using
\mDandTls.
%
Constrained devices, on the other hand, where such restrictions are common,
have received much less attention.
%
These devices may be simple sensors with the only task of relaying
measurements of their physical environment to a server every hour, and doing so
autonomously for a decade without maintenance.
%
Constrained devices therefore often have limitations on energy consumption.
%
To keep energy consumption down, highly specialized radio links with small
and heterogeneous frame-sizes are sometimes used.
%
In some cases, \mDandTls{} messages are too large to fit into the radio frames.
%
This is one of the reasons IETF standardized the \mOscore{} protocol to secure
communications between constrained devices, as a complement for when
\mDandTls{} is too heavy weight~\cite{rfc8613}.
%

The \mOscore{} protocol requires a pre-established security context.
%
The IETF Lightweight Authenticated Key Exchange (LAKE) working group
currently develops requirements and a key exchange protocol capable of
establishing \mOscore{} security contexts.
%
The key establishment protocol is named \mEdhoc~\cite{selander-lake-edhoc-01}.
%
Naturally, \mEdhoc{} must work under the same constrained requirements as
\mOscore{} itself.
%

While neither the requirements nor the use-cases for \mEdhoc{} are firmly set,
the overarching design goal of \mEdhoc{} is to establish an \mOscore{} security
context with decent security while keeping the messages small.
%
The LAKE working group is currently discussing whether a compressed version of
\mTls, named \mCtls~\cite{ietf-tls-ctls-00}, would solve the same use-cases as
\mOscore{} and \mEdhoc{} combined.
%

The \mEdhoc{} protocol has evolved significantly over time to cater for smaller
messages and more use-cases.
%
The first incarnation of \mEdhoc{} appeared in March 2016.
%
It contained two different cryptographic cores, one based on a
pre-shared key Diffie-Hellman and a second following a draft of the
then emerging \mbox{\mTls{} v1.3} standard~\cite{ietf-tls-tls13-11}, using
challenge-response signatures.
%
The latter was then replaced by \mSigma, and this version, from May 2018, was
formally analyzed by Bruni~et.~al.~\cite{DBLP:conf/secsr/BruniJPS18}.
%
The protocol has now further evolved and variants using challenge-response
signatures have now been added again.
%
On top of this, mixed variants where one party uses a challenge-response
signature and the other a regular signature have also been added.
%
Consequently, there are now five cryptographic cores in total, and it is prudent
to formally analyze them all to ensure a higher level of security assurance for
\mEdhoc.
%
This is especially important, since the \mSpec{} itself lacks description of the
intended security model and overall security goals.
%
Filling this gap and deriving circumstances under which \mEdhoc{} can be
securely used to achieve certain goals is an important part of this paper.
%

%-------------------------------------------------------------------------- sub
\subsection{Contributions}
\label{sec:contributions}
Our main contributions are the following.
\begin{itemize}
    \item We provide formalization of \mEdhoc's all five cryptographic cores
        using\linebreak \mTamarin~\cite{DBLP:conf/cav/MeierSCB13}.
    \item We give an explicit security model for the protocol and have verified
        essential security properties, such as session key and entity
        authentication, as well as Perfect Forward Secrecy (PFS), within that
        model.
    \item We provide consequence analysis of the verified properties to
        establish which types of use-cases \mEdhoc{} may be suitable for and
        to give recommendations for the future standards development.
    \item Our discussions with IETF LAKE working group members have already
        lead to improvements and clarifications of the standard \mSpec{} based
        on observations we made during the construction of our formal model.
\end{itemize}

%-------------------------------------------------------------------------- sub
\subsection{Related work}
\label{sec:relatedWork}
The work closest to ours is Bruni~et. al.~\cite{DBLP:conf/secsr/BruniJPS18},
which used \mProverif~\cite{DBLP:conf/csfw/Blanchet01} to analyze an earlier,
two cryptographic core, version of \mEdhoc.
%
We consider our work to be a sort of follow-up to that, doing a similar kind of
analysis of the most recent, and more elaborate, version of \mEdhoc{} using five
cores.
%
We also verify slightly different properties.
%
For instance, we include session key independence in our properties.
%
The \mTamarin{} tool has been used to verify many other protocols, perhaps closest
to our work is Cremers~et.~al's analysis of
\mTls~\cite{DBLP:conf/ccs/CremersHHSM17}.
%
Some of the cryptographic cores themselves have been analyzed in the
computational model, e.g., \mSigma{} by Canetti and
Krawczyk~\cite{DBLP:conf/crypto/CanettiK02} and \mOptls{} by Krawczyk and
Wee~\cite{DBLP:conf/eurosp/KrawczykW16}.
%
\knote{Add work on \mNoise{} here when Vaishnavi has added her section.}

%-------------------------------------------------------------------------- sub
\subsection{Structure}
\label{sec:structure}
\knote{Only include this if we have space to spare.}

%-------------------------------------------------------------------------- sec
\section{The \mEdhoc{} protocol}
\label{sec:edhoc}
\hl{Vaishnavi}
\input{edhocProtocol}

%-------------------------------------------------------------------------- sec
\section{Formalization and results}
\label{sec:formalization}
\hl{Alessandro}
\input{edhocFormalization}

%-------------------------------------------------------------------------- sec
\section{Discussion}
\label{sec:discussion}
%-------------------------------------------------------------------------- sub
\subsection{Design Practices}
\label{sec:designPractices}
\knote{Note to self: Long sentences. Not to the point. Revision needed.}
We start with two observations on the design practices, which the \mEdhoc{}
design shares with many other standards specifications.
%
\mPoint{Lack of clear security model}
The first observation is the lack of clearly defined security model.
%
This is common in standardization, and a nuisance for the formal methods
community~\cite{DBLP:conf/ccs/BasinDHRSS18}, who appear to expect industrial
standards, from organizations such as IETF and 3GPP, to be built from a
semi-theoretical framework to meet precise design goals.
\knote{Need to polish this sentence to not offend anyone.}
%
Because industrial standards aim to meet the needs of
existing, mixed with envisioned, use-cases, the work has a significant
explorative element.
%
Defining a strict security model from the start is difficult in this setting.
%
In many cases, a security model evolves during the design and is defined
by resistance to the attacks discussed in the process, not by a small set of
precise assumptions and the consequences drawn from those.
%
Even so, the lack of security model in \mEdhoc{} is somewhat troubling in that
it it does not even discuss general use-cases in its requirements
document~\cite{ietf-lake-reqs-04}.
%
The rationale is instead derived purely from technical aspects of the devices,
communication links and accompanying protocols with which \mEdhoc{} is to be used.
%
No direct consideration is given to the intended uses-cases for the systems
built from these technical components.
%
Because of this, it is unclear which security properties \mEdhoc{} should have.
%
Nonetheless, the \mSpec{} makes a number of detailed claims of properties
the protocol provides (see Section 8.1~\cite{selander-lake-edhoc-01}).
%
The intention may be that, if the academic protocol \mSigma{} is re-used as a
cryptographic core of \mEdhoc, then all the properties listed
in the paper analyzing \mSigma~\cite{DBLP:conf/crypto/CanettiK02} are the
necessary and sufficient ones and can be copied into the \mSpec.
%
(Note: likely the intention is the same for the other reused academic protocols,
but since the \mSpec{} is still work in progress, it is not yet written
down).
%
Section~8.1. states, \emph{"EDHOC inherits its security properties
from the theoretical SIGMA-I"}.
%
Designing a standard specification by re-using existing well-studied academic
components is good practice, but this approach has two problems.
%
First, it is unknown whether the properties provided by the cryptgraphic cores
are suitable for the situations in which \mEdhoc{} is to be used, whether
something is missing, or whether something is unnecessary.
%
The latter should be of concern because of the aim to optimize \mEdhoc{} for
message size.
%
Second, \mSigma{} and the other cryptographic cores used by \mEdhoc, are
typically designed for a precise setting with many underlying assumptions.
%
Without spelling those out in the \mSpec, and without showing how
\mEdhoc's adaptations to the cryptographic cores map to the academic protocols
used, such claims are not very informative and may even be misleading.
%

Another concrete example, we believe is important, is whether distributing
\mEdhoc{} processing across a trusted execution environment (TEE) and a less
trusted part, should be considered in the security model.
%
In our analysis we have chosen not to model such a distribution.
%
This is because we received indications that it was not necessary to consider
reveal of the session state, in particular the ephemeral secret keys when
\mSigma{} cannot protect against such an attack.
\knote{Personal correspondence. Should we include that?}
%
This is however only true if one restricts attention to key confidentiality.
%

We believe it would be useful to consider TEEs.
%
For example, TEE can provide protection against many other threats than
confidentiality.
%
Given that many IoT devices will be deployed in hostile environments there may
be use-cases where it may be acceptable that confidentiality is compromised, but
where impersonation attacks would be dangerous.
%
Further, \mEdhoc{} re-uses cryptographic cores from academic protocols such as
\mSigma{} and \mOptls, which were intentionally designed for a well-defined
security model where compromise of ephemeral keys is less critical than
compromise of long-term keys.
%
Not taking advantage of this seems wasteful.
%
With at least a roughly drawn security model, these considerations would have
surfaced earlier in the standardization process.
%
\textbf{Proposal:} We do not suggest that standard security protocols
necessarily should be built bottom up based on a formal theoretical framework.
%
Doing so would be helpful for subsequent formal verification, but would
likely grind standards to a halt.
%
However, it would be useful to add some justification for claims and the
intended mapping of the cryptographic core to the academic protocol used and
which differences there are.
%
This would greatly help academics to reverse engineer appropriate security
models and verify whether the claims do hold in that model.
%
It would also be useful to capture the intended uses of end-systems on a high
level to learn which security properties are required.
%

\mPoint{Property diversity between methods}
Our second observation is that the five different methods provide very different
security guarantees.
%
Each one is tailored for a specific situation, and the overarching goal of
optimization of message sizes resulted in them providing different guarantees.
%
However, when it comes to implementation and use of the protocol, this shifts the
responsibility of selecting the appropriate version to the user.
%
Should \mEdhoc{} become the protocol of choice for all the IoT applications to
come, it is easy to imagine developers downloading an \mEdhoc{} library and using
it similarly to how \mTls{} is used today.
%
Many developers will assume that \mEdhoc{} provides sufficient security and may
chose method based on performance rather than on security properties.
%
For example, consider a use-case where \mEdhoc{} is run over a near-field
communication radio to derive a token from the derived session key.
%
The token is then to be used at a later point in time.
%
In this case it would be useful that both parties get confirmation that the
other party computed the session key (key confirmation).
%
This property is not achieved by the \mEdhoc{} methods where the initator uses the
\mStat{} method for authentication.
%
Obviously, this can be solved on the application layer, but only if the
developer is aware of the discrepancy.
%

Another aspect showing the usefulness of considering \mEdhoc{} light-weight
use-cases is that, until we pointed it out, the \mSpec{} did not contain
any discussion on the topic of (non)-repudiation.
%
Non-repudiation may be a very useful property for an access control
solution for a nuclear power-plant, whereas it may undesirable for privacy
purposes in coffee vending machine.
%
Such a simple thought experiment would have caught the missing topic.
%
\textbf{Proposal:} There are some use-cases discussed in the LAKE working
group requirements draft~\cite{ietf-lake-reqs-04}.
%
It would, however, be useful to extend the security considerations section in
the \mSpec{} with example use-cases and showing the consequences of
choosing different methods.
%
It would also be helpful to capture and analyze more informal and light-weight
use-cases in the requirements document, to better understand which properties
are needed.
\knote{Adjust the last sentence depending on what happens to the requirements
draft.}

%-------------------------------------------------------------------------- sub
\subsection{Unclear identity management and authentication}
\label{sec:usableSecurity}
\mPoint{Protocol is unclear about what it means by authentication; also, why is
mutual auth required?}
%
The \mSpec{} is unclear about what kind of authentication it aims to achieve.
%
Most importantly, it is not stated whether implicit or explicit authentication
is required, or whether confirmation of the peer's agreement on the \mSid{} or
session key.
%
As our analysis shows, mutual injective agreement on the \mSid{} is achieved
by all methods, except for when the initiator is using the \mStat{} methods.
%
This is because the \mSid{} is unique among sessions (in the symbolic model it
is since the ephemeral keys are fresh and in the computational model they are
fresh with overwhelming probability).
%
Injective agreement provides explicit authentication.
%
In case the initiator uses the \mStat{} method, only implicit authentication
can be achieved.
%
Whether explicit authentication is an important feature for \mEdhoc{} or not, and
whether it violates the requirement on mutual
authentication~\cite{ietf-lake-reqs-04} is difficult to say.
%
Neither does the requirements document~\cite{ietf-lake-reqs-04} provide
intended use cases hinting at what level of authentication is required, nor does
it explain what the more technical term "mutual authentication"
is intended to cover.
%
\textbf{Proposal:}
It would be useful to clarify in the \mSpec{} that different methods provide
different types of authentication and elaborate on in which situations and
implementer should select which method.
%
The latter is important in an industrial standard because it can be expected
that many implementers may otherwise end up with an insecure solution
by select the most efficient method.
%

The requirements~\cite{ietf-lake-reqs-04} demand mutual authentication, but
do not provide any rationale, more than that it is expected of IETF protocols
(see Section 3).
%
We observe that if it is acceptable to sacrifice explicit authentication for
some methods to obtain shorter messages, it may also be acceptable for some
use-cases to only provide unilateral authentication and by that reducing the
number of messages to one round-trip.
%
Similar to how \mTls{} is often used, initiator authentication could then be
performed on the \mCoap{} level in the secure \mOscore{} channel.
%
Such a combination of authentications has worked well for many web
use-cases and provides mutual authentication for the application on a system
level.
%
Since few protocols, \mEdhoc{} included, are expected to work in isolation, this
may be a possible approach.
%
\textbf{Proposal:} Without some use-cases or user-stories, it is difficult to
determine whether mutual authentication is an appropriate requirement or whether
a more optimized unilateral authentication solution with possible \mCoap{} level
authentication would be better.
%
We propose considering light-weight use-case analysis to explore this option.
%

\mPoint{not verifying \mIdcredr{} is dangerous}
Section 3.2 of the \mSpec, states that a policy is required restricting the set
of peers an entity is allowed to run \mEdhoc{} with.
%
However, because the initator is not required to verify that the \mIdcredr{}
received in message 2 is the same as the one it intended when sending message 1,
this is insufficient for a general purpose AKE.
%
These small thought example shows why.
%
Assume someone has configured all devices in their home to be in the restricted
set, but that one of the devices $A$ has been compromised.
%
If another device $B$, unaware of the compromise, initiates a connection to a
third device $C$, the compromised device $A$ may interfere.
%
$A$ may respond in $C$ place, which may require blocking the response from $C$.
%
Since $A$ does not check that it is $C$'s identity in message 2, and device $A$
is part of the restricted set, $A$ will complete and accept the \mEdhoc{} run with
device $A$.
%
The obvious solution is for the initiator to match \mIdcredr{} to the intended
identity.
%
This is yet another example of where a small use-case or user-story uncovers
potential lacks in the \mSpec, and show that it would be a useful addition to
the requirements document~\cite{ietf-lake-reqs-04}.
%

%-------------------------------------------------------------------------- sub
\subsection{Session key material}
\label{sec:sessionKeyMaterial}
\mEdhoc{} establishes a session key state as output, from which session keys for
\mOscore{} can be derived using \mHkdf{}.
%
As discussed in section \hl{ref formalization section}, there are various
possibilities for defining which parameters from the \mEdhoc{} run should
provide the secret input to the session key state.

While we show bidirectional injective agreement on \mGx{} and \mGy{}
for all methods, initiators cannot obtain injective agreement on \mGiy{} when
using the \mStat{} method themselves.
%
Therefore, \mGiy{} cannot be considered part of the key material if mutual
injective agreement is considered an important property for \mEdhoc{}.
%
This would deviate from \mOptls{}, which is the cryptographic core used for
these methods.
%
Specifically, the proof of session key confidentiality in the face of long-term
key compromise for \mOptls{} cannot be adapted for \mEdhoc{}.
%
It is unclear whether other security properties of \mOptls{} would also fail if
\mGiy{} were excluded.
%

Another option is to include a fourth message from responder to initiator
carrying a message authentication code using a key derived from session key
material including \mGiy{}.
%
This would give the initiator sufficient guarantee that the responder indeed
uses the same \mGiy{} as the initiator.
%
The cost is an additional message, and our understanding is that this is
unacceptable.
%

In some use-cases there will be a such as message as part of
the subsequent \mOscore{} protocol run.
%
It would, however, create an additional dependence between the two protocols,
increasing complexity and the risk for insecure implementations.
%

Yet another option is to include \mGi{}, a hash of it, or a hash of \mIdcredi{}
if there is a one-to-one mapping between \mIdcredi{} and \mGi{}, in messages one
and two.
%
This would however increase message sizes, a grave concern for \mEdhoc{}, and
would prevent initiator identity protection.
%
While identity protection is important in general, the \mSpec{} nor the
requirements document give any rationale why the initiator's identity would be
more important to protect compared to the responder's.
%
The \mSpec{} states that the
initiator's identity is protected against active attacks and the responder's
against passive attacks, but that the roles should be assigned to the \mCoap{}
peers to protect the most sensitive identity the most (see
Section~8~\cite{selander-lake-edhoc-01}).
%
Roles could hence be swapped, so identity protection is not a strong argument
against this option.
%

We have show implicit agreement on \mGx{}, \mGy{} for all methods, and also on
\mGiy{} and \mGrx{} when these are used, see~\hl{ref formalization}.
%
If this weaker security guarantee is sufficient, both ephemeral and long-term
keys can be part of the session key material.
%
Whether it is sufficient or not, depends on the intended uses of \mEdhoc{}.
%

%-------------------------------------------------------------------------- sub
\subsection{Cipher suite negotiation}
\label{sec:ciphersuiteNegotiation}
%
\mEdhoc{}'s cipher suite negotiation spans two or more executions of the protocol.
%
That is, an initiator keeps state between protocol runs and proposes an updated
set of cipher suites if the first run resulted in a rejection of the
cipher suite from the responder (\hl{ref back to Protocol section}.
%
Our model does not cover this.
%
\knote{It would be nice to be able to say something more than that "it is
    obivious" that at least the reject is authentic because we have agreement
on the keys for message 2 and it would be covered by the MAC. Ideas?}

We note that keeping state between protocol runs implicitly creates a long-lived
meta-session covering multiple \mEdhoc{} sessions.
%
While the spirit of the description in Section 4.2.2 of the \mSpec{} is that
within some kind of application session setup there is a re-negotiation due to
cipher suite mismatch between the initator and responder, the \mSpec{} does not
describe for how long the initator should remember a rejected cipher suite for a
given party.
%
From a security perspective, remembering the rejected cipher suite for the
next \mEdhoc{} run within a given application session would be sufficient.
%
It would also result in that, if the responder is updated with a new cipher
suite before the next application session, this would be taken into account.
%
On the other hand, caching the rejected between application sessions would
reduce the number of round-trips for subsequent runs, should the responder not
have been updated.
%
Regardless, these considerations would be helpful in the security considerations
section of the \mSpec{}.
%

%-------------------------------------------------------------------------- ack
% Should be a run-in heading.  subsubsection works in llncs2e document class
\subsubsection*{Acknowledgments} This work was partially supported by
the Wallenberg AI, Autonomous Systems and Software Program (WASP) funded by
the Knut and Alice Wallenberg Foundation.
%

%-------------------------------------------------------------------------- bib
\bibliographystyle{plain}
\bibliography{ref}

%\printbibliography

\appendix
%-------------------------------------------------------------------------- sec
\section*{Appendix}

\input{notesFromModelConstruct}

\end{document}
