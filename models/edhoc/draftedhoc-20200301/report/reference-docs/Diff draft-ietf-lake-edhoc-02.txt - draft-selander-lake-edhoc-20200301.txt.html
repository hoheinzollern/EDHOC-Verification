<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by rfcdiff 1.48: rfcdiff  -->
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux dechaunac 3.2.0-6-amd64 #1 SMP Debian 3.2.102-1 x86_64 GNU/Linux -->
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.1.1, API: 1.1 (GNU MPFR 3.1.3, GNU MP 6.0.0) -->
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 -->
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.2 -->
<html xmlns="http://www.w3.org/1999/xhtml"><head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta http-equiv="Content-Style-Type" content="text/css"> 
  <title>Diff: draft-ietf-lake-edhoc-02.txt - draft-selander-lake-edhoc-20200301.txt</title> 
  <style type="text/css"> 
    body    { margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
    span.hide { display: none; color: #aaa;}    a:hover span { display: inline; }    tr.change { background-color: gray; } 
    tr.change a { text-decoration: none; color: black } 
  </style> 
     <script>
var chunk_index = 0;
var old_chunk = null;

function format_chunk(index) {
    var prefix = "diff";
    var str = index.toString();
    for (x=0; x<(4-str.length); ++x) {
        prefix+='0';
    }
    return prefix + str;
}

function find_chunk(n){
    return document.querySelector('tr[id$="' + n + '"]');
}

function change_chunk(offset) {
    var index = chunk_index + offset;
    var new_str;
    var new_chunk;

    new_str = format_chunk(index);
    new_chunk = find_chunk(new_str);
    if (!new_chunk) {
        return;
    }
    if (old_chunk) {
        old_chunk.style.outline = "";
    }
    old_chunk = new_chunk;
    old_chunk.style.outline = "1px solid red";
    window.location.hash = "#" + new_str;
    window.scrollBy(0,-100);
    chunk_index = index;
}

document.onkeydown = function(e) {
    switch (e.keyCode) {
    case 78:
        change_chunk(1);
        break;
    case 80:
        change_chunk(-1);
        break;
    }
};
   </script> 
</head> 
<body> 
  <table cellspacing="0" cellpadding="0" border="0"> 
  <tbody><tr id="part-1" bgcolor="orange"><th></th><th><a href="https://tools.ietf.org/rfcdiff?url2=draft-ietf-lake-edhoc-02.txt" style="color:#008; text-decoration:none;">&lt;</a>&nbsp;<a href="https://tools.ietf.org/html/draft-ietf-lake-edhoc-02.txt" style="color:#008">draft-ietf-lake-edhoc-02.txt</a>&nbsp;</th><th> </th><th>&nbsp;<a href="https://tools.ietf.org/html/draft-selander-lake-edhoc-20200301.txt" style="color:#008">draft-selander-lake-edhoc-20200301.txt</a>&nbsp;<a href="https://tools.ietf.org/rfcdiff?url1=draft-selander-lake-edhoc-20200301.txt" style="color:#008; text-decoration:none;">&gt;</a></th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Network Working Group                                        G. Selander</td><td> </td><td class="right">Network Working Group                                        G. Selander</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Internet-Draft                                               J. Mattsson</td><td> </td><td class="right">Internet-Draft                                               J. Mattsson</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Intended status: Standards Track                            F. Palombini</td><td> </td><td class="right">Intended status: Standards Track                            F. Palombini</td><td class="lineno"></td></tr>
      <tr id="diff0001"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">Expires: <span class="delete">May 6, 2021</span>                                         Ericsson AB</td><td> </td><td class="rblock">Expires: <span class="insert">4 September 2020</span>                                    Ericsson AB</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                       <span class="delete">November 02,</span> 2020</td><td> </td><td class="rblock">                                                            <span class="insert">3 March</span> 2020</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               Ephemeral Diffie-Hellman Over COSE (EDHOC)</td><td> </td><td class="right">               Ephemeral Diffie-Hellman Over COSE (EDHOC)</td><td class="lineno"></td></tr>
      <tr id="diff0002"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    <span class="delete">    draft-ietf-lake-edhoc-02</span></td><td> </td><td class="rblock">                    <span class="insert">draft-selander-lake-edhoc-latest</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Abstract</td><td> </td><td class="right">Abstract</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a</td><td> </td><td class="right">   This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   very compact, and lightweight authenticated Diffie-Hellman key</td><td> </td><td class="right">   very compact, and lightweight authenticated Diffie-Hellman key</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   exchange with ephemeral keys.  EDHOC provides mutual authentication,</td><td> </td><td class="right">   exchange with ephemeral keys.  EDHOC provides mutual authentication,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   perfect forward secrecy, and identity protection.  EDHOC is intended</td><td> </td><td class="right">   perfect forward secrecy, and identity protection.  EDHOC is intended</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   for usage in constrained scenarios and a main use case is to</td><td> </td><td class="right">   for usage in constrained scenarios and a main use case is to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   establish an OSCORE security context.  By reusing COSE for</td><td> </td><td class="right">   establish an OSCORE security context.  By reusing COSE for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   cryptography, CBOR for encoding, and CoAP for transport, the</td><td> </td><td class="right">   cryptography, CBOR for encoding, and CoAP for transport, the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-2" class="change"><td></td><th><small>skipping to change at</small><a href="#part-2"><em> page 1, line 38<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-2"><em> page 1, line 38<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   Internet-Drafts are working documents of the Internet Engineering</td><td> </td><td class="right">   Internet-Drafts are working documents of the Internet Engineering</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Task Force (IETF).  Note that other groups may also distribute</td><td> </td><td class="right">   Task Force (IETF).  Note that other groups may also distribute</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   working documents as Internet-Drafts.  The list of current Internet-</td><td> </td><td class="right">   working documents as Internet-Drafts.  The list of current Internet-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Drafts is at https://datatracker.ietf.org/drafts/current/.</td><td> </td><td class="right">   Drafts is at https://datatracker.ietf.org/drafts/current/.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Internet-Drafts are draft documents valid for a maximum of six months</td><td> </td><td class="right">   Internet-Drafts are draft documents valid for a maximum of six months</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and may be updated, replaced, or obsoleted by other documents at any</td><td> </td><td class="right">   and may be updated, replaced, or obsoleted by other documents at any</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   time.  It is inappropriate to use Internet-Drafts as reference</td><td> </td><td class="right">   time.  It is inappropriate to use Internet-Drafts as reference</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   material or to cite them other than as "work in progress."</td><td> </td><td class="right">   material or to cite them other than as "work in progress."</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0003"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   This Internet-Draft will expire on <span class="delete">May 6, 2021</span>.</td><td> </td><td class="rblock">   This Internet-Draft will expire on <span class="insert">4 September 2020</span>.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Copyright Notice</td><td> </td><td class="right">Copyright Notice</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Copyright (c) 2020 IETF Trust and the persons identified as the</td><td> </td><td class="right">   Copyright (c) 2020 IETF Trust and the persons identified as the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   document authors.  All rights reserved.</td><td> </td><td class="right">   document authors.  All rights reserved.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This document is subject to BCP 78 and the IETF Trust's Legal</td><td> </td><td class="right">   This document is subject to BCP 78 and the IETF Trust's Legal</td><td class="lineno"></td></tr>
      <tr id="diff0004"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Provisions Relating to IETF Documents</td><td> </td><td class="rblock">   Provisions Relating to IETF Documents <span class="insert">(https://trustee.ietf.org/</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">(https://trustee.ietf.org/license-info)</span> in effect on the date of</td><td> </td><td class="rblock"><span class="insert">   license-info)</span> in effect on the date of publication of this document.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   publication of this document.  Please review these documents</td><td> </td><td class="rblock">   Please review these documents carefully, as they describe your rights</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   carefully, as they describe your rights and restrictions with respect</td><td> </td><td class="rblock">   and restrictions with respect to this document.  Code Components</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   to this document.  Code Components extracted from this document must</td><td> </td><td class="rblock">   extracted from this document must include Simplified BSD License text</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   include Simplified BSD License text as described in Section 4.e of</td><td> </td><td class="rblock">   as described in Section 4.e of the Trust Legal Provisions and are</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   the Trust Legal Provisions and are provided without warranty as</td><td> </td><td class="rblock">   provided without warranty as described in the Simplified BSD License.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   described in the Simplified BSD License.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Table of Contents</td><td> </td><td class="right">Table of Contents</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3</td><td> </td><td class="right">   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3</td><td class="lineno"></td></tr>
      <tr id="diff0005"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     1.1.  Rationale for EDHOC . . . . . . . . . . . . . . . . . . .   <span class="delete">4</span></td><td> </td><td class="rblock">     1.1.  Rationale for EDHOC . . . . . . . . . . . . . . . . . . .   5</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     1.2.  Use of EDHOC  . . . . . . . . . . . . . . . . . . . . . .</span>   5</td><td> </td><td class="rblock">     <span class="insert">1.2.</span>  Terminology and Requirements Language . . . . . . . . . .   6</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     <span class="delete">1.3.</span>  Terminology and Requirements Language . . . . . . . . . .   6</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   2.  Background  . . . . . . . . . . . . . . . . . . . . . . . . .   6</td><td> </td><td class="right">   2.  Background  . . . . . . . . . . . . . . . . . . . . . . . . .   6</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   3.  EDHOC Overview  . . . . . . . . . . . . . . . . . . . . . . .   8</td><td> </td><td class="right">   3.  EDHOC Overview  . . . . . . . . . . . . . . . . . . . . . . .   8</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     3.1.  Transport and Message Correlation . . . . . . . . . . . .   9</td><td> </td><td class="right">     3.1.  Transport and Message Correlation . . . . . . . . . . . .   9</td><td class="lineno"></td></tr>
      <tr id="diff0006"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     3.2.  Authentication Keys and Identities  . . . . . . . . . . .  <span class="delete">10</span></td><td> </td><td class="rblock">     3.2.  Authentication Keys and Identities  . . . . . . . . . . .   <span class="insert">9</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     3.3.  Identifiers . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">11</span></td><td> </td><td class="rblock">     3.3.  Identifiers . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">10</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     3.4.  Cipher Suites . . . . . . . . . . . . . . . . . . . . . .  11</td><td> </td><td class="right">     3.4.  Cipher Suites . . . . . . . . . . . . . . . . . . . . . .  11</td><td class="lineno"></td></tr>
      <tr id="diff0007"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     3.5.  Communication/Negotiation of Protocol Features  . . . . .  <span class="delete">12</span></td><td> </td><td class="rblock">     3.5.  Communication/Negotiation of Protocol Features  . . . . .  <span class="insert">11</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     3.6.  Auxiliary Data  . . . . . . . . . . . . . . . . . . . . .  <span class="delete">13</span></td><td> </td><td class="rblock">     3.6.  Auxiliary Data  . . . . . . . . . . . . . . . . . . . . .  <span class="insert">12</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     3.7.  Ephemeral Public Keys . . . . . . . . . . . . . . . . . .  <span class="delete">13</span></td><td> </td><td class="rblock">     3.7.  Ephemeral Public Keys . . . . . . . . . . . . . . . . . .  <span class="insert">12</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     3.8.  Key Derivation  . . . . . . . . . . . . . . . . . . . . .  13</td><td> </td><td class="right">     3.8.  Key Derivation  . . . . . . . . . . . . . . . . . . . . .  13</td><td class="lineno"></td></tr>
      <tr id="diff0008"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   4.  EDHOC Authenticated with Asymmetric Keys  . . . . . . . . . .  1<span class="delete">6</span></td><td> </td><td class="rblock">   4.  EDHOC Authenticated with Asymmetric Keys  . . . . . . . . . .  1<span class="insert">5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     4.1.  Overview  . . . . . . . . . . . . . . . . . . . . . . . .  16</td><td> </td><td class="right">     4.1.  Overview  . . . . . . . . . . . . . . . . . . . . . . . .  16</td><td class="lineno"></td></tr>
      <tr id="diff0009"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     4.2.  <span class="delete">Encoding of Public Authentication Key Identifiers</span> . . . .  <span class="delete">16</span></td><td> </td><td class="rblock">     4.2.  <span class="insert">EDHOC Message 1 . .</span> . . . . . . . . . . . . . . . . . . .  18</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     4.3.  Encoding of bstr_identifier</span> . . . . . . . . . . . . . . .  18</td><td> </td><td class="rblock">     <span class="insert">4.3.  EDHOC Message 2 . . . . . . . . . . . . . . . . . . . . .  20</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     4.4.  EDHOC Message 1 . . . . . . . . . . . . . . . . . . . . .  <span class="delete">18</span></td><td> </td><td class="rblock">     4.4.  EDHOC Message <span class="insert">3 . . . . . . . . . . . . . . . . . . . . .  23</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     4.5.</span>  EDHOC Message 2 . . . . . . . . . . . . . . . . . . . . .  <span class="delete">20</span></td><td> </td><td class="rblock"><span class="insert">   5.  EDHOC Authenticated with Symmetric Keys . . . . . . . . . . .  26</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     4.6.</span>  EDHOC Message 3 . . . . . . . . . . . . . . . . . . . . .  <span class="delete">23</span></td><td> </td><td class="rblock"><span class="insert">     5.1.  Overview  . . . . . . . . . . . . . . . . . . . . . . . .  26</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   5.</span>  Error Handling  . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">27</span></td><td> </td><td class="rblock"><span class="insert">     5.2.  EDHOC Message</span> 1 . . . . . . . . . . . . . . . . . . . . .  <span class="insert">27</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     5.1.</span>  EDHOC Error Message . . . . . . . . . . . . . . . . . . .  <span class="delete">27</span></td><td> </td><td class="rblock"><span class="insert">     5.3.</span>  EDHOC Message 2 . . . . . . . . . . . . . . . . . . . . .  <span class="insert">28</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   6.</span>  Transferring EDHOC and Deriving an OSCORE Context . . . . . .  <span class="delete">29</span></td><td> </td><td class="rblock"><span class="insert">     5.4.</span>  EDHOC Message 3 . . . . . . . . . . . . . . . . . . . . .  <span class="insert">28</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     6.1.</span>  Transferring EDHOC in CoAP  . . . . . . . . . . . . . . .  <span class="delete">29</span></td><td> </td><td class="rblock"><span class="insert">   6.</span>  Error Handling  . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">29</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   7.</span>  Security Considerations . . . . . . . . . . . . . . . . . . .  <span class="delete">32</span></td><td> </td><td class="rblock"><span class="insert">     6.1.</span>  EDHOC Error Message . . . . . . . . . . . . . . . . . . .  <span class="insert">29</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     7.1.</span>  Security Properties . . . . . . . . . . . . . . . . . . .  <span class="delete">32</span></td><td> </td><td class="rblock"><span class="insert">   7.</span>  Transferring EDHOC and Deriving an OSCORE Context . . . . . .  <span class="insert">31</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     7.2.</span>  Cryptographic Considerations  . . . . . . . . . . . . . .  <span class="delete">33</span></td><td> </td><td class="rblock"><span class="insert">     7.1.</span>  Transferring EDHOC in CoAP  . . . . . . . . . . . . . . .  <span class="insert">31</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     7.3.</span>  Cipher Suites . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">34</span></td><td> </td><td class="rblock"><span class="insert">   8.</span>  Security Considerations . . . . . . . . . . . . . . . . . . .  <span class="insert">33</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     7.4.</span>  Unprotected Data  . . . . . . . . . . . . . . . . . . . .  <span class="delete">34</span></td><td> </td><td class="rblock"><span class="insert">     8.1.</span>  Security Properties . . . . . . . . . . . . . . . . . . .  <span class="insert">33</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     7.5.</span>  Denial-of-Service . . . . . . . . . . . . . . . . . . . .  <span class="delete">35</span></td><td> </td><td class="rblock"><span class="insert">     8.2.</span>  Cryptographic Considerations  . . . . . . . . . . . . . .  <span class="insert">35</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     7.6.</span>  Implementation Considerations . . . . . . . . . . . . . .  <span class="delete">35</span></td><td> </td><td class="rblock"><span class="insert">     8.3.</span>  Cipher Suites . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">36</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     7.7.</span>  Other Documents Referencing EDHOC . . . . . . . . . . . .  <span class="delete">36</span></td><td> </td><td class="rblock"><span class="insert">     8.4.</span>  Unprotected Data  . . . . . . . . . . . . . . . . . . . .  <span class="insert">36</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   8.</span>  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <span class="delete">36</span></td><td> </td><td class="rblock"><span class="insert">     8.5.</span>  Denial-of-Service . . . . . . . . . . . . . . . . . . . .  <span class="insert">36</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     8.1.</span>  EDHOC Cipher Suites Registry  . . . . . . . . . . . . . .  <span class="delete">36</span></td><td> </td><td class="rblock"><span class="insert">     8.6.</span>  Implementation Considerations . . . . . . . . . . . . . .  <span class="insert">37</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     8.2.</span>  EDHOC Method Type Registry  . . . . . . . . . . . . . . .  <span class="delete">37</span></td><td> </td><td class="rblock"><span class="insert">     8.7.</span>  Other Documents Referencing EDHOC . . . . . . . . . . . .  <span class="insert">38</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     8.3.</span>  The Well-Known URI Registry . . . . . . . . . . . . . . .  <span class="delete">37</span></td><td> </td><td class="rblock"><span class="insert">   9.</span>  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <span class="insert">38</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     8.4.</span>  Media Types Registry  . . . . . . . . . . . . . . . . . .  <span class="delete">38</span></td><td> </td><td class="rblock"><span class="insert">     9.1.</span>  EDHOC Cipher Suites Registry  . . . . . . . . . . . . . .  <span class="insert">38</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     8.5.</span>  CoAP Content-Formats Registry . . . . . . . . . . . . . .  <span class="delete">39</span></td><td> </td><td class="rblock"><span class="insert">     9.2.</span>  EDHOC Method Type Registry  . . . . . . . . . . . . . . .  <span class="insert">39</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     8.6.</span>  Expert Review Instructions  . . . . . . . . . . . . . . .  <span class="delete">39</span></td><td> </td><td class="rblock"><span class="insert">     9.3.</span>  The Well-Known URI Registry . . . . . . . . . . . . . . .  <span class="insert">39</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   9.</span>  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">39</span></td><td> </td><td class="rblock"><span class="insert">     9.4.</span>  Media Types Registry  . . . . . . . . . . . . . . . . . .  <span class="insert">40</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     9.1.</span>  Normative References  . . . . . . . . . . . . . . . . . .  <span class="delete">39</span></td><td> </td><td class="rblock"><span class="insert">     9.5.</span>  CoAP Content-Formats Registry . . . . . . . . . . . . . .  <span class="insert">40</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     9.2.</span>  Informative References  . . . . . . . . . . . . . . . . .  <span class="delete">41</span></td><td> </td><td class="rblock"><span class="insert">     9.6.</span>  Expert Review Instructions  . . . . . . . . . . . . . . .  <span class="insert">41</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Appendix A.  Use of CBOR, CDDL and COSE in EDHOC  . . . . . . . .  <span class="delete">44</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     A.1.  CBOR and CDDL . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">44</span></td><td> </td><td class="rblock"><span class="insert">   10.</span> References  . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">41</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     A.2.  COSE  . . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">45</span></td><td> </td><td class="rblock"><span class="insert">     10.1.</span>  Normative References . . . . . . . . . . . . . . . . . .  <span class="insert">41</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Appendix B.  Test Vectors . . . . . . . . . . . . . . . . . . . .  <span class="delete">45</span></td><td> </td><td class="rblock"><span class="insert">     10.2.</span>  Informative References . . . . . . . . . . . . . . . . .  <span class="insert">43</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   Appendix A.  Use of CBOR, CDDL and COSE in EDHOC  . . . . . . . .  <span class="insert">46</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     A.1.  CBOR and CDDL . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">46</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     A.2.  COSE  . . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">47</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   Appendix B.  Test Vectors . . . . . . . . . . . . . . . . . . . .  <span class="insert">47</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     B.1.  Test Vectors for EDHOC Authenticated with Signature Keys</td><td> </td><td class="right">     B.1.  Test Vectors for EDHOC Authenticated with Signature Keys</td><td class="lineno"></td></tr>
      <tr id="diff0010"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">           <span class="delete">(x5t)</span> . . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">45</span></td><td> </td><td class="rblock">           <span class="insert">(RPK)</span> . . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">47</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     B.2.  Test Vectors for EDHOC Authenticated with <span class="delete">Static Diffie-</span></td><td> </td><td class="rblock">     B.2.  Test Vectors for EDHOC Authenticated with <span class="insert">Symmetric</span> Keys</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">           Hellman</span> Keys  . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">60</span></td><td> </td><td class="rblock">           <span class="insert">(PSK) . . . . . . . . . . . . . . .</span> . . . . . . . . . . .  <span class="insert">63</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">73</span></td><td> </td><td class="rblock"><span class="insert">     B.3.  Test Vectors for EDHOC Authenticated with Static</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">73</span></td><td> </td><td class="rblock"><span class="insert">           Diffie-Hellman Keys . . . . . . . .</span> . . . . . . . . . . .  <span class="insert">76</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">94</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">95</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">1.  Introduction</td><td> </td><td class="right">1.  Introduction</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Security at the application layer provides an attractive option for</td><td> </td><td class="right">   Security at the application layer provides an attractive option for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protecting Internet of Things (IoT) deployments, for example where</td><td> </td><td class="right">   protecting Internet of Things (IoT) deployments, for example where</td><td class="lineno"></td></tr>
      <tr id="diff0011"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   protection needs to work over a variety of underlying protocols.  IoT</td><td> </td><td class="rblock">   <span class="insert">transport layer security is not sufficient</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   devices may be constrained in various ways, including memory,</td><td> </td><td class="rblock"><span class="insert">   [I-D.hartke-core-e2e-security-reqs] or where the</span> protection needs to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   storage, processing capacity, and energy [RFC7228].  A method for</td><td> </td><td class="rblock">   work over a variety of underlying protocols.  IoT devices may be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   protecting individual messages at the application layer suitable for</td><td> </td><td class="rblock">   constrained in various ways, including memory, storage, processing</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   constrained devices, is provided by CBOR Object Signing and</td><td> </td><td class="rblock">   capacity, and energy [RFC7228].  A method for protecting individual</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Encryption (COSE) [RFC8152]), which builds on the Concise Binary</td><td> </td><td class="rblock">   messages at the application layer suitable for constrained devices,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Object Representation (CBOR) [RFC7049].  Object Security for</td><td> </td><td class="rblock">   is provided by CBOR Object Signing and Encryption (COSE) [RFC8152]),</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Constrained RESTful Environments (OSCORE) [RFC8613] is a method for</td><td> </td><td class="rblock">   which builds on the Concise Binary Object Representation (CBOR)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   application-layer protection of the Constrained Application Protocol</td><td> </td><td class="rblock">   [RFC7049].  Object Security for Constrained RESTful Environments</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   (CoAP), using COSE.</td><td> </td><td class="rblock">   (OSCORE) [RFC8613] is a method for application-layer protection of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   the Constrained Application Protocol (CoAP), using COSE.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   In order for a communication session to provide forward secrecy, the</td><td> </td><td class="right">   In order for a communication session to provide forward secrecy, the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   communicating parties can run an Elliptic Curve Diffie-Hellman (ECDH)</td><td> </td><td class="right">   communicating parties can run an Elliptic Curve Diffie-Hellman (ECDH)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   key exchange protocol with ephemeral keys, from which shared key</td><td> </td><td class="right">   key exchange protocol with ephemeral keys, from which shared key</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   material can be derived.  This document specifies Ephemeral Diffie-</td><td> </td><td class="right">   material can be derived.  This document specifies Ephemeral Diffie-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Hellman Over COSE (EDHOC), a lightweight key exchange protocol</td><td> </td><td class="right">   Hellman Over COSE (EDHOC), a lightweight key exchange protocol</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   providing perfect forward secrecy and identity protection.</td><td> </td><td class="right">   providing perfect forward secrecy and identity protection.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Authentication is based on credentials established out of band, e.g.</td><td> </td><td class="right">   Authentication is based on credentials established out of band, e.g.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   from a trusted third party, such as an Authorization Server as</td><td> </td><td class="right">   from a trusted third party, such as an Authorization Server as</td><td class="lineno"></td></tr>
      <tr id="diff0012"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   specified by [I-D.ietf-ace-oauth-authz].  <span class="delete">The construction provided</span></td><td> </td><td class="rblock">   specified by [I-D.ietf-ace-oauth-authz].  EDHOC <span class="insert">supports</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   by</span> EDHOC <span class="delete">can be applied to authenticate</span> raw public keys <span class="delete">(RPK)</span> and</td><td> </td><td class="rblock"><span class="insert">   authentication using pre-shared keys (PSK),</span> raw public keys <span class="insert">(RPK),</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   public key certificates.  <span class="delete">This version of the protocol is focusing on</span></td><td> </td><td class="rblock">   and public key certificates.  After successful completion of the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   RPK and certificates by reference which is the initial focus for the</span></td><td> </td><td class="rblock">   EDHOC protocol, application keys and other application specific data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   LAKE WG (see Section 2.2 of [I-D.ietf-lake-reqs]).</span></td><td> </td><td class="rblock">   can be derived using the <span class="insert">EDHOC-Exporter</span> interface.  A main use case</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock">   for EDHOC is to establish an OSCORE security context.  EDHOC uses</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   After successful completion of the EDHOC protocol, application keys</td><td> </td><td class="rblock">   COSE for cryptography, CBOR for encoding, and CoAP for transport.  By</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   and other application specific data can be derived using the <span class="delete">EDHOC-</span></td><td> </td><td class="rblock">   reusing existing libraries, the additional code footprint can be kept</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Exporter</span> interface.  A main use case for EDHOC is to establish an</td><td> </td><td class="rblock">   very low.  <span class="insert">Note that this document focuses on authentication and key</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   OSCORE security context.  EDHOC uses COSE for cryptography, CBOR for</td><td> </td><td class="rblock"><span class="insert">   establishment: for integration with authorization of resource access,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   encoding, and CoAP for transport.  By reusing existing libraries, the</td><td> </td><td class="rblock"><span class="insert">   refer to [I-D.ietf-ace-oscore-profile].</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   additional code footprint can be kept very low.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0013"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   EDHOC is designed <span class="delete">for</span> highly constrained <span class="delete">settings</span> making it</td><td> </td><td class="rblock">   EDHOC is designed <span class="insert">to work in</span> highly constrained <span class="insert">scenarios</span> making it</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   especially suitable for <span class="delete">low-power wide area networks [RFC8376]</span> such</td><td> </td><td class="rblock">   especially suitable for <span class="insert">network technologies</span> such as Cellular IoT,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   as Cellular IoT, <span class="delete">6TiSCH,</span> and <span class="delete">LoRaWAN.</span>  Compared to the DTLS 1.3</td><td> </td><td class="rblock">   <span class="insert">6TiSCH [I-D.ietf-6tisch-dtsecurity-zerotouch-join],</span> and <span class="insert">LoRaWAN</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   handshake [I-D.ietf-tls-dtls13] with ECDH and connection ID, the</td><td> </td><td class="rblock"><span class="insert">   [LoRa1][LoRa2].  These network technologies are characterized by</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   number of bytes in EDHOC + CoAP <span class="delete">can be</span> less than 1/6 when RPK</td><td> </td><td class="rblock"><span class="insert">   their low throughput, low power consumption, and small frame sizes.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   Compared to the DTLS 1.3 handshake [I-D.ietf-tls-dtls13] with ECDH</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   and connection ID, the number of bytes in EDHOC + CoAP <span class="insert">is less than</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   1/4 when PSK authentication is used and</span> less than 1/6 when RPK</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authentication is used, see</td><td> </td><td class="right">   authentication is used, see</td><td class="lineno"></td></tr>
      <tr id="diff0014"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [I-D.ietf-lwig-security-protocol-comparison].  <span class="delete">Figure 1 shows two</span></td><td> </td><td class="rblock">   [I-D.ietf-lwig-security-protocol-comparison].  <span class="insert">Typical</span> message sizes</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   examples of</span> message sizes for EDHOC with <span class="delete">different kinds of</span></td><td> </td><td class="rblock">   for EDHOC with <span class="insert">pre-shared keys, raw public</span> keys <span class="insert">with</span> static <span class="insert">Diffie-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   authentication</span> keys <span class="delete">and different COSE header parameters for</span></td><td> </td><td class="rblock"><span class="insert">   Hellman keyss,</span> and <span class="insert">two different way to identify</span> X.509 certificates</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   identification:</span> static <span class="delete">Diffie-Hellman keys identified by 'kid'</span></td><td> </td><td class="rblock">   <span class="insert">with signature keys</span> are <span class="insert">shown in Figure 1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   [RFC8152],</span> and X.509 <span class="delete">signature</span> certificates <span class="delete">identified by a hash</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   value using 'x5t' [I-D.ietf-cose-x509].  Further reductions of</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   message sizes</span> are <span class="delete">possible, for example by eliding redundant length</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   indications.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0015"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    <span class="delete">=================================</span></td><td> </td><td class="rblock">   <span class="insert">=====================================================================</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">                                        kid</span>       x5t</td><td> </td><td class="rblock"><span class="insert">                  PSK       RPK</span>       x5t     <span class="insert">x5chain</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    <span class="delete">---------------------------------</span></td><td> </td><td class="rblock"><span class="insert">   ---------------------------------------------------------------------</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    message_1            37        37</td><td> </td><td class="rblock">   message_1       <span class="insert">38        37</span>        37        37</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    message_2            46       117</td><td> </td><td class="rblock">   message_2       <span class="insert">44</span>        46       117       <span class="insert">110 + Certificate</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    message_3            20        91</td><td> </td><td class="rblock">   message_3       <span class="insert">10</span>        20        91        <span class="insert">84 + Certificate</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    <span class="delete">----------------------------------</span></td><td> </td><td class="rblock"><span class="insert">   ---------------------------------------------------------------------</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    Total               103       245</td><td> </td><td class="rblock">   Total           <span class="insert">92</span>       103       245       <span class="insert">231 + Certificates</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                    <span class="delete">=================================</span></td><td> </td><td class="rblock"><span class="insert">   =====================================================================</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0016"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">               <span class="delete">Figure 1: Example of message sizes in bytes.</span></td><td> </td><td class="rblock">               <span class="insert">   Figure 1: Typical message sizes in bytes</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0017"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The ECDH exchange and the key derivation follow <span class="delete">known protocol</span></td><td> </td><td class="rblock">   The ECDH exchange and the key derivation follow [SIGMA], NIST <span class="insert">SP-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   constructions such as</span> [SIGMA], NIST <span class="delete">SP-800-56A</span> [SP-800-56A], and HKDF</td><td> </td><td class="rblock"><span class="insert">   800-56A</span> [SP-800-56A], and HKDF [RFC5869].  CBOR [RFC7049] and COSE</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [RFC5869].  CBOR [RFC7049] and COSE [RFC8152] are used to implement</td><td> </td><td class="rblock">   [RFC8152] are used to implement these standards.  The use of COSE</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   these standards.  The use of COSE provides crypto agility and enables</td><td> </td><td class="rblock">   provides crypto agility and enables use of future algorithms and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   use of future algorithms and headers designed for constrained IoT.</td><td> </td><td class="rblock">   headers designed for constrained IoT.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This document is organized as follows: Section 2 describes how EDHOC</td><td> </td><td class="right">   This document is organized as follows: Section 2 describes how EDHOC</td><td class="lineno"></td></tr>
      <tr id="diff0018"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">authenticated with digital signatures</span> builds on SIGMA-I, Section 3</td><td> </td><td class="rblock">   builds on SIGMA-I, Section 3 specifies general properties of EDHOC,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   specifies general properties of EDHOC, including message flow,</td><td> </td><td class="rblock">   including message flow, formatting of the ephemeral public keys, and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   formatting of the ephemeral public keys, and key derivation,</td><td> </td><td class="rblock">   key derivation, Section 4 specifies EDHOC with signature key and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Section 4 specifies EDHOC with signature key and static <span class="delete">Diffie-</span></td><td> </td><td class="rblock">   static <span class="insert">Diffie-Hellman</span> key authentication, Section 5 specifies <span class="insert">EDHOC</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Hellman</span> key authentication, Section 5 specifies the EDHOC error</td><td> </td><td class="rblock"><span class="insert">   with symmetric key authentication, Section 6 specifies</span> the EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   message, and Section <span class="delete">6</span> describes how EDHOC can be transferred in CoAP</td><td> </td><td class="rblock">   error message, and Section <span class="insert">7</span> describes how EDHOC can be transferred</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   and used to establish an OSCORE security context.</td><td> </td><td class="rblock">   in CoAP and used to establish an OSCORE security context.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">1.1.  Rationale for EDHOC</td><td> </td><td class="right">1.1.  Rationale for EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Many constrained IoT systems today do not use any security at all,</td><td> </td><td class="right">   Many constrained IoT systems today do not use any security at all,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and when they do, they often do not follow best practices.  One</td><td> </td><td class="right">   and when they do, they often do not follow best practices.  One</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   reason is that many current security protocols are not designed with</td><td> </td><td class="right">   reason is that many current security protocols are not designed with</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   constrained IoT in mind.  Constrained IoT systems often deal with</td><td> </td><td class="right">   constrained IoT in mind.  Constrained IoT systems often deal with</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   personal information, valuable business data, and actuators</td><td> </td><td class="right">   personal information, valuable business data, and actuators</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   interacting with the physical world.  Not only do such systems need</td><td> </td><td class="right">   interacting with the physical world.  Not only do such systems need</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   security and privacy, they often need end-to-end protection with</td><td> </td><td class="right">   security and privacy, they often need end-to-end protection with</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-3" class="change"><td></td><th><small>skipping to change at</small><a href="#part-3"><em> page 5, line 42<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-3"><em> page 6, line 5<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   small message overhead and efficient parsing in constrained devices.</td><td> </td><td class="right">   small message overhead and efficient parsing in constrained devices.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC is not bound to a particular transport layer, but it is</td><td> </td><td class="right">   EDHOC is not bound to a particular transport layer, but it is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   recommended to transport the EDHOC message in CoAP payloads.  EDHOC</td><td> </td><td class="right">   recommended to transport the EDHOC message in CoAP payloads.  EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   is not bound to a particular communication security protocol but</td><td> </td><td class="right">   is not bound to a particular communication security protocol but</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   works off-the-shelf with OSCORE [RFC8613] providing the necessary</td><td> </td><td class="right">   works off-the-shelf with OSCORE [RFC8613] providing the necessary</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   input parameters with required properties.  Maximum code complexity</td><td> </td><td class="right">   input parameters with required properties.  Maximum code complexity</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   (ROM/Flash) is often a constraint in many devices and by reusing</td><td> </td><td class="right">   (ROM/Flash) is often a constraint in many devices and by reusing</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   already existing libraries, the additional code footprint for EDHOC +</td><td> </td><td class="right">   already existing libraries, the additional code footprint for EDHOC +</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   OSCORE can be kept very low.</td><td> </td><td class="right">   OSCORE can be kept very low.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0019"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">1.2.  <span class="delete">Use of EDHOC</span></td><td> </td><td class="rblock">1.2.  Terminology and Requirements Language</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   EDHOC is designed as a lightweight AKE for OSCORE, i.e. to provide</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   authentication and session key establishment for IoT use cases such</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   as those built on CoAP [RFC7252].  CoAP is a specialized web transfer</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   protocol for use with constrained nodes and networks, providing a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   request/response interaction model between application endpoints.  As</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   such, EDHOC is targeting a large variety of use cases involving</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   'things' with embedded microcontrollers, sensors and actuators.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   A typical setting is when one of the endpoints is constrained or in a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   constrained network, and the other endpoint is a node on the Internet</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   (such as a mobile phone) or at the edge of the constrained network</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   (such as a gateway).  Thing-to-thing interactions over constrained</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   networks are also relevant since both endpoints would then benefit</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   from the lightweight properties of the protocol.  EDHOC could e.g. be</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   run when a device/device(s) connect(s) for the first time, or to</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   establish fresh keys which are not compromised by a later compromise</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   of the long-term keys.  (Further security properties are described in</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Section 7.1.)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">1.3.</span>  Terminology and Requirements Language</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",</td><td> </td><td class="right">   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and</td><td> </td><td class="right">   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   "OPTIONAL" in this document are to be interpreted as described in BCP</td><td> </td><td class="right">   "OPTIONAL" in this document are to be interpreted as described in BCP</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   14 [RFC2119] [RFC8174] when, and only when, they appear in all</td><td> </td><td class="right">   14 [RFC2119] [RFC8174] when, and only when, they appear in all</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   capitals, as shown here.</td><td> </td><td class="right">   capitals, as shown here.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Readers are expected to be familiar with the terms and concepts</td><td> </td><td class="right">   Readers are expected to be familiar with the terms and concepts</td><td class="lineno"></td></tr>
      <tr id="diff0020"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   described in CBOR <span class="delete">[RFC7049], CBOR Sequences [RFC8742],</span> COSE</td><td> </td><td class="rblock">   described in CBOR <span class="insert">[RFC7049] [I-D.ietf-cbor-sequence],</span> COSE [RFC8152],</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [RFC8152], and CDDL [RFC8610].  The Concise Data Definition Language</td><td> </td><td class="rblock">   and CDDL [RFC8610].  The Concise Data Definition Language (CDDL) is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   (CDDL) is used to express CBOR data structures [RFC7049].  Examples</td><td> </td><td class="rblock">   used to express CBOR data structures [RFC7049].  Examples of CBOR and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   of CBOR and CDDL are provided in Appendix A.1.</td><td> </td><td class="rblock">   CDDL are provided in Appendix A.1.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">2.  Background</td><td> </td><td class="right">2.  Background</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0021"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">EDHOC specifies different authentication methods of the Diffie-</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Hellman key exchange: digital signatures and static Diffie-Hellman</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   keys.  This section outlines the digital signature based method.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   SIGMA (SIGn-and-MAc) is a family of theoretical protocols with a</td><td> </td><td class="right">   SIGMA (SIGn-and-MAc) is a family of theoretical protocols with a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   large number of variants [SIGMA].  Like IKEv2 [RFC7296] and (D)TLS</td><td> </td><td class="right">   large number of variants [SIGMA].  Like IKEv2 [RFC7296] and (D)TLS</td><td class="lineno"></td></tr>
      <tr id="diff0022"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   1.3 [RFC8446], EDHOC <span class="delete">authenticated with digital signatures</span> is built</td><td> </td><td class="rblock">   1.3 [RFC8446], EDHOC is built on a variant of the SIGMA protocol</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   on a variant of the SIGMA protocol which provide identity protection</td><td> </td><td class="rblock">   which provide identity protection of the initiator (SIGMA-I), and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   of the initiator (SIGMA-I), and like IKEv2 [RFC7296], EDHOC</td><td> </td><td class="rblock">   like IKEv2 [RFC7296], EDHOC implements the SIGMA-I variant as <span class="insert">Mac-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   implements the SIGMA-I variant as <span class="delete">Mac-then-Sign.</span>  The SIGMA-I</td><td> </td><td class="rblock"><span class="insert">   then-Sign.</span>  The SIGMA-I protocol using an authenticated encryption</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   protocol using an authenticated encryption algorithm is shown in</td><td> </td><td class="rblock">   algorithm is shown in Figure 2.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Figure 2.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     Initiator                                               Responder</td><td> </td><td class="right">     Initiator                                               Responder</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        |                          G_X                            |</td><td> </td><td class="right">        |                          G_X                            |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        +--------------------------------------------------------&gt;|</td><td> </td><td class="right">        +--------------------------------------------------------&gt;|</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        |                                                         |</td><td> </td><td class="right">        |                                                         |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        |  G_Y, AEAD( K_2; ID_CRED_R, Sig(R; CRED_R, G_X, G_Y) )  |</td><td> </td><td class="right">        |  G_Y, AEAD( K_2; ID_CRED_R, Sig(R; CRED_R, G_X, G_Y) )  |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        |&lt;--------------------------------------------------------+</td><td> </td><td class="right">        |&lt;--------------------------------------------------------+</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        |                                                         |</td><td> </td><td class="right">        |                                                         |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        |     AEAD( K_3; ID_CRED_I, Sig(I; CRED_I, G_Y, G_X) )    |</td><td> </td><td class="right">        |     AEAD( K_3; ID_CRED_I, Sig(I; CRED_I, G_Y, G_X) )    |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        +--------------------------------------------------------&gt;|</td><td> </td><td class="right">        +--------------------------------------------------------&gt;|</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">        |                                                         |</td><td> </td><td class="right">        |                                                         |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    Figure 2: Authenticated encryption variant of the SIGMA-I protocol.</td><td> </td><td class="right">    Figure 2: Authenticated encryption variant of the SIGMA-I protocol.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The parties exchanging messages are called Initiator (I) and</td><td> </td><td class="right">   The parties exchanging messages are called Initiator (I) and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Responder (R).  They exchange ephemeral public keys, compute the</td><td> </td><td class="right">   Responder (R).  They exchange ephemeral public keys, compute the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   shared secret, and derive symmetric application keys.</td><td> </td><td class="right">   shared secret, and derive symmetric application keys.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0023"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  G_X and G_Y are the ECDH ephemeral public keys of I and R,</td><td> </td><td class="rblock">   <span class="insert">*</span>  G_X and G_Y are the ECDH ephemeral public keys of I and R,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      respectively.</td><td> </td><td class="right">      respectively.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0024"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  CRED_I and CRED_R are the credentials containing the public</td><td> </td><td class="rblock">   <span class="insert">*</span>  CRED_I and CRED_R are the credentials containing the public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      authentication keys of I and R, respectively.</td><td> </td><td class="right">      authentication keys of I and R, respectively.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0025"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  ID_CRED_I and ID_CRED_R are data enabling the recipient party to</td><td> </td><td class="rblock">   <span class="insert">*</span>  ID_CRED_I and ID_CRED_R are data enabling the recipient party to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      retrieve the credential of I and R, respectively.</td><td> </td><td class="right">      retrieve the credential of I and R, respectively.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0026"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Sig(I; . ) and S(R; . ) denote signatures made with the private</td><td> </td><td class="rblock">   <span class="insert">*</span>  Sig(I; . ) and S(R; . ) denote signatures made with the private</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      authentication key of I and R, respectively.</td><td> </td><td class="right">      authentication key of I and R, respectively.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0027"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  AEAD(K; . ) denotes authenticated encryption with additional data</td><td> </td><td class="rblock">   <span class="insert">*</span>  AEAD(K; . ) denotes authenticated encryption with additional data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      using a key K derived from the shared secret.</td><td> </td><td class="right">      using a key K derived from the shared secret.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   In order to create a "full-fledged" protocol some additional protocol</td><td> </td><td class="right">   In order to create a "full-fledged" protocol some additional protocol</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   elements are needed.  EDHOC adds:</td><td> </td><td class="right">   elements are needed.  EDHOC adds:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0028"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Explicit connection identifiers C_I, C_R chosen by I and R,</td><td> </td><td class="rblock">   <span class="insert">*</span>  Explicit connection identifiers C_I, C_R chosen by I and R,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      respectively, enabling the recipient to find the protocol state.</td><td> </td><td class="right">      respectively, enabling the recipient to find the protocol state.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0029"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Transcript hashes (hashes of message data) TH_2, TH_3, TH_4 used</td><td> </td><td class="rblock">   <span class="insert">*</span>  Transcript hashes (hashes of message data) TH_2, TH_3, TH_4 used</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      for key derivation and as additional authenticated data.</td><td> </td><td class="right">      for key derivation and as additional authenticated data.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0030"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Computationally independent keys derived from the ECDH shared</td><td> </td><td class="rblock">   <span class="insert">*</span>  Computationally independent keys derived from the ECDH shared</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      secret and used for authenticated encryption of different</td><td> </td><td class="right">      secret and used for authenticated encryption of different</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      messages.</td><td> </td><td class="right">      messages.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0031"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Verification of a common preferred cipher suite:</td><td> </td><td class="rblock">   <span class="insert">*</span>  Verification of a common preferred cipher suite:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0032"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  The Initiator lists supported cipher suites in order of</td><td> </td><td class="rblock">      <span class="insert">-</span>  The Initiator lists supported cipher suites in order of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         preference</td><td> </td><td class="right">         preference</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0033"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  The Responder verifies that the selected cipher suite is the</td><td> </td><td class="rblock">      <span class="insert">-</span>  The Responder verifies that the selected cipher suite is the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         first supported cipher suite</td><td> </td><td class="right">         first supported cipher suite</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0034"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Method types and error handling.</td><td> </td><td class="rblock">   <span class="insert">*</span>  Method types and error handling.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0035"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Transport of opaque auxiliary data.</td><td> </td><td class="rblock">   <span class="insert">*</span>  Transport of opaque auxiliary data.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC is designed to encrypt and integrity protect as much</td><td> </td><td class="right">   EDHOC is designed to encrypt and integrity protect as much</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   information as possible, and all symmetric keys are derived using as</td><td> </td><td class="right">   information as possible, and all symmetric keys are derived using as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   much previous information as possible.  EDHOC is furthermore designed</td><td> </td><td class="right">   much previous information as possible.  EDHOC is furthermore designed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   to be as compact and lightweight as possible, in terms of message</td><td> </td><td class="right">   to be as compact and lightweight as possible, in terms of message</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   sizes, processing, and the ability to reuse already existing CBOR,</td><td> </td><td class="right">   sizes, processing, and the ability to reuse already existing CBOR,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   COSE, and CoAP libraries.</td><td> </td><td class="right">   COSE, and CoAP libraries.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   To simplify for implementors, the use of CBOR in EDHOC is summarized</td><td> </td><td class="right">   To simplify for implementors, the use of CBOR in EDHOC is summarized</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   in Appendix A and test vectors including CBOR diagnostic notation are</td><td> </td><td class="right">   in Appendix A and test vectors including CBOR diagnostic notation are</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   given in Appendix B.</td><td> </td><td class="right">   given in Appendix B.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.  EDHOC Overview</td><td> </td><td class="right">3.  EDHOC Overview</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC consists of three messages (message_1, message_2, message_3)</td><td> </td><td class="right">   EDHOC consists of three messages (message_1, message_2, message_3)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   that maps directly to the three messages in SIGMA-I, plus an EDHOC</td><td> </td><td class="right">   that maps directly to the three messages in SIGMA-I, plus an EDHOC</td><td class="lineno"></td></tr>
      <tr id="diff0036"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   error message.  EDHOC messages are CBOR Sequences <span class="delete">[RFC8742],</span> where</td><td> </td><td class="rblock">   error message.  EDHOC messages are CBOR Sequences</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   the first data item (METHOD_CORR) of message_1 is an int specifying</td><td> </td><td class="rblock">   <span class="insert">[I-D.ietf-cbor-sequence],</span> where the first data item (METHOD_CORR) of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   the method and the correlation properties of the transport used, see</td><td> </td><td class="rblock">   message_1 is an int specifying the method and the correlation</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Section 3.1.  The method specifies the authentication methods used</td><td> </td><td class="rblock">   properties of the transport used, see Section 3.1.  The method</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   (signature, static <span class="delete">DH),</span> see Section <span class="delete">8.2.</span>  An implementation may</td><td> </td><td class="rblock">   specifies the authentication methods used (signature, static <span class="insert">DH,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   support only Initiator or Responder.  An implementation may support</td><td> </td><td class="rblock"><span class="insert">   symmetric),</span> see Section <span class="insert">9.2.</span>  An implementation may support only</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   only a single method.  The Initiator and the Responder need to have</td><td> </td><td class="rblock">   Initiator or Responder.  An implementation may support only a single</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   agreed on a single method to be used for EDHOC.</td><td> </td><td class="rblock">   method.  The Initiator and the Responder need to have agreed on a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   single method to be used for EDHOC.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   While EDHOC uses the COSE_Key, COSE_Sign1, and COSE_Encrypt0</td><td> </td><td class="right">   While EDHOC uses the COSE_Key, COSE_Sign1, and COSE_Encrypt0</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   structures, only a subset of the parameters is included in the EDHOC</td><td> </td><td class="right">   structures, only a subset of the parameters is included in the EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   messages.  The unprotected COSE header in COSE_Sign1, and</td><td> </td><td class="right">   messages.  The unprotected COSE header in COSE_Sign1, and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   COSE_Encrypt0 (not included in the EDHOC message) MAY contain</td><td> </td><td class="right">   COSE_Encrypt0 (not included in the EDHOC message) MAY contain</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   parameters (e.g. 'alg').  After creating EDHOC message_3, the</td><td> </td><td class="right">   parameters (e.g. 'alg').  After creating EDHOC message_3, the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Initiator can derive symmetric application keys, and application</td><td> </td><td class="right">   Initiator can derive symmetric application keys, and application</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protected data can therefore be sent in parallel with EDHOC</td><td> </td><td class="right">   protected data can therefore be sent in parallel with EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_3.  The application may protect data using the algorithms</td><td> </td><td class="right">   message_3.  The application may protect data using the algorithms</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   (AEAD, hash, etc.) in the selected cipher suite and the connection</td><td> </td><td class="right">   (AEAD, hash, etc.) in the selected cipher suite and the connection</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   identifiers (C_I, C_R).  EDHOC may be used with the media type</td><td> </td><td class="right">   identifiers (C_I, C_R).  EDHOC may be used with the media type</td><td class="lineno"></td></tr>
      <tr id="diff0037"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   application/edhoc defined in Section <span class="delete">8</span>.</td><td> </td><td class="rblock">   application/edhoc defined in Section <span class="insert">9</span>.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Initiator                                             Responder</td><td> </td><td class="right">      Initiator                                             Responder</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         |                                                       |</td><td> </td><td class="right">         |                                                       |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         | ------------------ EDHOC message_1 -----------------&gt; |</td><td> </td><td class="right">         | ------------------ EDHOC message_1 -----------------&gt; |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         |                                                       |</td><td> </td><td class="right">         |                                                       |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         | &lt;----------------- EDHOC message_2 ------------------ |</td><td> </td><td class="right">         | &lt;----------------- EDHOC message_2 ------------------ |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         |                                                       |</td><td> </td><td class="right">         |                                                       |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         | ------------------ EDHOC message_3 -----------------&gt; |</td><td> </td><td class="right">         | ------------------ EDHOC message_3 -----------------&gt; |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         |                                                       |</td><td> </td><td class="right">         |                                                       |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         | &lt;----------- Application Protected Data ------------&gt; |</td><td> </td><td class="right">         | &lt;----------- Application Protected Data ------------&gt; |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         |                                                       |</td><td> </td><td class="right">         |                                                       |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0038"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                       Figure 3: EDHOC message flow</td><td> </td><td class="rblock">                       <span class="insert"> </span>Figure 3: EDHOC message flow</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.1.  Transport and Message Correlation</td><td> </td><td class="right">3.1.  Transport and Message Correlation</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Cryptographically, EDHOC does not put requirements on the lower</td><td> </td><td class="right">   Cryptographically, EDHOC does not put requirements on the lower</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   layers.  EDHOC is not bound to a particular transport layer, and can</td><td> </td><td class="right">   layers.  EDHOC is not bound to a particular transport layer, and can</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   be used in environments without IP.  The transport is responsible to</td><td> </td><td class="right">   be used in environments without IP.  The transport is responsible to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   handle message loss, reordering, message duplication, fragmentation,</td><td> </td><td class="right">   handle message loss, reordering, message duplication, fragmentation,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and denial of service protection, where necessary.  The Initiator and</td><td> </td><td class="right">   and denial of service protection, where necessary.  The Initiator and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the Responder need to have agreed on a transport to be used for</td><td> </td><td class="right">   the Responder need to have agreed on a transport to be used for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC.  It is recommended to transport EDHOC in CoAP payloads, see</td><td> </td><td class="right">   EDHOC.  It is recommended to transport EDHOC in CoAP payloads, see</td><td class="lineno"></td></tr>
      <tr id="diff0039"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Section <span class="delete">6</span>.</td><td> </td><td class="rblock">   Section <span class="insert">7</span>.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC includes connection identifiers (C_I, C_R) to correlate</td><td> </td><td class="right">   EDHOC includes connection identifiers (C_I, C_R) to correlate</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   messages.  The connection identifiers C_I and C_R do not have any</td><td> </td><td class="right">   messages.  The connection identifiers C_I and C_R do not have any</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   cryptographic purpose in EDHOC.  They contain information</td><td> </td><td class="right">   cryptographic purpose in EDHOC.  They contain information</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   facilitating retrieval of the protocol state and may therefore be</td><td> </td><td class="right">   facilitating retrieval of the protocol state and may therefore be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   very short.  The connection identifier MAY be used with an</td><td> </td><td class="right">   very short.  The connection identifier MAY be used with an</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   application protocol (e.g.  OSCORE) for which EDHOC establishes keys,</td><td> </td><td class="right">   application protocol (e.g.  OSCORE) for which EDHOC establishes keys,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   in which case the connection identifiers SHALL adhere to the</td><td> </td><td class="right">   in which case the connection identifiers SHALL adhere to the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   requirements for that protocol.  Each party choses a connection</td><td> </td><td class="right">   requirements for that protocol.  Each party choses a connection</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   identifier it desires the other party to use in outgoing messages.</td><td> </td><td class="right">   identifier it desires the other party to use in outgoing messages.</td><td class="lineno"></td></tr>
      <tr id="diff0040"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">(For OSCORE this results in the endpoint selecting its Recipient ID,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   see Section 3.1 of [RFC8613]).</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   If the transport provides a mechanism for correlating messages, some</td><td> </td><td class="right">   If the transport provides a mechanism for correlating messages, some</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   of the connection identifiers may be omitted.  There are four cases:</td><td> </td><td class="right">   of the connection identifiers may be omitted.  There are four cases:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0041"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  corr = 0, the transport does not provide a correlation mechanism.</td><td> </td><td class="rblock">   <span class="insert">*</span>  corr = 0, the transport does not provide a correlation mechanism.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0042"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  corr = 1, the transport provides a correlation mechanism that</td><td> </td><td class="rblock">   <span class="insert">*</span>  corr = 1, the transport provides a correlation mechanism that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      enables the Responder to correlate message_2 and message_1.</td><td> </td><td class="right">      enables the Responder to correlate message_2 and message_1.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0043"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  corr = 2, the transport provides a correlation mechanism that</td><td> </td><td class="rblock">   <span class="insert">*</span>  corr = 2, the transport provides a correlation mechanism that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      enables the Initiator to correlate message_3 and message_2.</td><td> </td><td class="right">      enables the Initiator to correlate message_3 and message_2.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0044"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  corr = 3, the transport provides a correlation mechanism that</td><td> </td><td class="rblock">   <span class="insert">*</span>  corr = 3, the transport provides a correlation mechanism that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      enables both parties to correlate all three messages.</td><td> </td><td class="right">      enables both parties to correlate all three messages.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   For example, if the key exchange is transported over CoAP, the CoAP</td><td> </td><td class="right">   For example, if the key exchange is transported over CoAP, the CoAP</td><td class="lineno"></td></tr>
      <tr id="diff0045"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Token can be used to correlate messages, see Section <span class="delete">6</span>.1.</td><td> </td><td class="rblock">   Token can be used to correlate messages, see Section <span class="insert">7</span>.1.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.2.  Authentication Keys and Identities</td><td> </td><td class="right">3.2.  Authentication Keys and Identities</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0046"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The EDHOC message exchange may be authenticated using raw public keys</td><td> </td><td class="rblock">   The EDHOC message exchange may be authenticated using <span class="insert">pre-shared keys</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">(RPK)</span> or public key certificates.  The certificates and RPKs can</td><td> </td><td class="rblock"><span class="insert">   (PSK),</span> raw public keys <span class="insert">(RPK),</span> or public key certificates.  The</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   contain signature keys or static <span class="delete">Diffie-Hellman</span> keys.  In X.509</td><td> </td><td class="rblock">   certificates and RPKs can contain signature keys or static <span class="insert">Diffie-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   certificates, signature keys typically have key usage</td><td> </td><td class="rblock"><span class="insert">   Hellman</span> keys.  In X.509 certificates, signature keys typically have</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   "digitalSignature" and Diffie-Hellman keys typically have key usage</td><td> </td><td class="rblock">   key usage "digitalSignature" and Diffie-Hellman keys typically have</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   "keyAgreement".</td><td> </td><td class="rblock">   key usage "keyAgreement".  EDHOC assumes the existence of mechanisms</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock">   (certification authority, trusted third party, manual distribution,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   EDHOC assumes the existence of mechanisms (certification authority,</td><td> </td><td class="rblock">   etc.) for distributing authentication keys <span class="insert">(public or pre-shared)</span> and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   trusted third party, manual distribution, etc.) for <span class="delete">specifying and</span></td><td> </td><td class="rblock">   identities.  Policies are set based on the identity of the other</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   distributing authentication keys and identities.  Policies are set</td><td> </td><td class="rblock">   party, and parties typically only allow connections from a small</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   based on the identity of the other party, and parties typically only</td><td> </td><td class="rblock">   restricted set of identities.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   allow connections from a <span class="delete">specific identity or a</span> small restricted <span class="delete">set</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   of identities.  For example, in the case of a device connecting to a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   network, the network may only allow connections from devices which</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   authenticate with certificates having a particular range of serial</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   numbers in the subject field and signed by a particular CA.  On the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   other side, the device may only be allowed to connect to a network</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   which authenticate with a particular public key (information of which</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   may be provisioned, e.g., out of band or in the Auxiliary Data, see</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Section 3.6).</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   The EDHOC implementation must be able to receive and enforce</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   information from the application about what is the intended peer</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   endpoint, and in particular whether it is a specific identity or a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   set of identities.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0047"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  When a Public Key Infrastructure (PKI) is used, the trust anchor</td><td> </td><td class="rblock">   <span class="insert">*</span>  When a Public Key Infrastructure (PKI) is used, the trust anchor</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      is a Certification Authority (CA) certificate, and the identity is</td><td> </td><td class="right">      is a Certification Authority (CA) certificate, and the identity is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the subject whose unique name (e.g. a domain name, NAI, or EUI) is</td><td> </td><td class="right">      the subject whose unique name (e.g. a domain name, NAI, or EUI) is</td><td class="lineno"></td></tr>
      <tr id="diff0048"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      included in the <span class="delete">endpoint's</span> certificate.  Before running EDHOC each</td><td> </td><td class="rblock">      included in the <span class="insert">other party's</span> certificate.  Before running EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      party needs at least one CA public key certificate, or just the</td><td> </td><td class="rblock">      each party needs at least one CA public key certificate, or just</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      public key, and a <span class="delete">specific identity or</span> set of identities it is</td><td> </td><td class="rblock">      the public key, and a set of identities it is allowed to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      allowed to communicate with.  <span class="delete">Only</span> validated public-key</td><td> </td><td class="rblock">      communicate with.  <span class="insert">Any</span> validated public-key <span class="insert">certificate</span> with an</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">certificates</span> with an allowed subject <span class="delete">name, as specified by the</span></td><td> </td><td class="rblock">      allowed subject <span class="insert">name is</span> accepted.  EDHOC provides proof that the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      application, are to be</span> accepted.  EDHOC provides proof that the</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      other party possesses the private authentication key corresponding</td><td> </td><td class="right">      other party possesses the private authentication key corresponding</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      to the public authentication key in its certificate.  The</td><td> </td><td class="right">      to the public authentication key in its certificate.  The</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      certification path provides proof that the subject of the</td><td> </td><td class="right">      certification path provides proof that the subject of the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      certificate owns the public key in the certificate.</td><td> </td><td class="right">      certificate owns the public key in the certificate.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0049"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  When public keys are used but not with a PKI (RPK, self-signed</td><td> </td><td class="rblock">   <span class="insert">*</span>  When public keys are used but not with a PKI (RPK, self-signed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      certificate), the trust anchor is the public authentication key of</td><td> </td><td class="right">      certificate), the trust anchor is the public authentication key of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the other party.  In this case, the identity is typically directly</td><td> </td><td class="right">      the other party.  In this case, the identity is typically directly</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      associated to the public authentication key of the other party.</td><td> </td><td class="right">      associated to the public authentication key of the other party.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      For example, the name of the subject may be a canonical</td><td> </td><td class="right">      For example, the name of the subject may be a canonical</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      representation of the public key.  Alternatively, if identities</td><td> </td><td class="right">      representation of the public key.  Alternatively, if identities</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      can be expressed in the form of unique subject names assigned to</td><td> </td><td class="right">      can be expressed in the form of unique subject names assigned to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      public keys, then a binding to identity can be achieved by</td><td> </td><td class="right">      public keys, then a binding to identity can be achieved by</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      including both public key and associated subject name in the</td><td> </td><td class="right">      including both public key and associated subject name in the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      protocol message computation: CRED_I or CRED_R may be a self-</td><td> </td><td class="right">      protocol message computation: CRED_I or CRED_R may be a self-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      signed certificate or COSE_Key containing the public</td><td> </td><td class="right">      signed certificate or COSE_Key containing the public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      authentication key and the subject name, see Figure 2.  Before</td><td> </td><td class="right">      authentication key and the subject name, see Figure 2.  Before</td><td class="lineno"></td></tr>
      <tr id="diff0050"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      running EDHOC, each <span class="delete">endpoint needs a specific public</span></td><td> </td><td class="rblock">      running EDHOC, each <span class="insert">party need</span> a set of public authentication</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      authentication key/unique associated subject name, or</span> a set of</td><td> </td><td class="rblock">      keys/unique associated subject <span class="insert">names</span> it is allowed to communicate</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      public authentication keys/unique associated subject <span class="delete">names, which</span></td><td> </td><td class="rblock">      with.  EDHOC provides proof that the other party possesses the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      it is allowed to communicate with.  EDHOC provides proof that the</td><td> </td><td class="rblock">      private authentication key corresponding to the public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      other party possesses the private authentication key corresponding</td><td> </td><td class="rblock">      authentication key.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      to the public authentication key.</td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">*  TODO: PSK</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.3.  Identifiers</td><td> </td><td class="right">3.3.  Identifiers</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   One byte connection and credential identifiers are realistic in many</td><td> </td><td class="right">   One byte connection and credential identifiers are realistic in many</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   scenarios as most constrained devices only have a few keys and</td><td> </td><td class="right">   scenarios as most constrained devices only have a few keys and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   connections.  In cases where a node only has one connection or key,</td><td> </td><td class="right">   connections.  In cases where a node only has one connection or key,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the identifiers may even be the empty byte string.</td><td> </td><td class="right">   the identifiers may even be the empty byte string.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.4.  Cipher Suites</td><td> </td><td class="right">3.4.  Cipher Suites</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-4" class="change"><td></td><th><small>skipping to change at</small><a href="#part-4"><em> page 12, line 27<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-4"><em> page 11, line 37<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">      3. ( 30, -16, 1, -7, 1, 10, -16 )</td><td> </td><td class="right">      3. ( 30, -16, 1, -7, 1, 10, -16 )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         (AES-CCM-16-128-128, SHA-256, P-256, ES256, P-256,</td><td> </td><td class="right">         (AES-CCM-16-128-128, SHA-256, P-256, ES256, P-256,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">          AES-CCM-16-64-128, SHA-256)</td><td> </td><td class="right">          AES-CCM-16-64-128, SHA-256)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The different methods use the same cipher suites, but some algorithms</td><td> </td><td class="right">   The different methods use the same cipher suites, but some algorithms</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   are not used in some methods.  The EDHOC signature algorithm and the</td><td> </td><td class="right">   are not used in some methods.  The EDHOC signature algorithm and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC signature algorithm curve are not used is methods without</td><td> </td><td class="right">   EDHOC signature algorithm curve are not used is methods without</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   signature authentication.</td><td> </td><td class="right">   signature authentication.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator need to have a list of cipher suites it supports in</td><td> </td><td class="right">   The Initiator need to have a list of cipher suites it supports in</td><td class="lineno"></td></tr>
      <tr id="diff0051"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   order of preference.  The Responder need to have a list of cipher</td><td> </td><td class="rblock">   order of <span class="insert">decreasing</span> preference.  The Responder need to have a list of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   suites it supports.</td><td> </td><td class="rblock">   cipher suites it supports.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.5.  Communication/Negotiation of Protocol Features</td><td> </td><td class="right">3.5.  Communication/Negotiation of Protocol Features</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC allows the communication or negotiation of various protocol</td><td> </td><td class="right">   EDHOC allows the communication or negotiation of various protocol</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   features during the execution of the protocol.</td><td> </td><td class="right">   features during the execution of the protocol.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0052"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The Initiator proposes a cipher suite (see Section 3.4), and the</td><td> </td><td class="rblock">   <span class="insert">*</span>  The Initiator proposes a cipher suite (see Section 3.4), and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Responder either accepts or rejects, and may make a counter</td><td> </td><td class="right">      Responder either accepts or rejects, and may make a counter</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      proposal.</td><td> </td><td class="right">      proposal.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0053"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The Initiator decides on the correlation parameter corr (see</td><td> </td><td class="rblock">   <span class="insert">*</span>  The Initiator decides on the correlation parameter corr (see</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Section 3.1).  This is typically given by the transport which the</td><td> </td><td class="right">      Section 3.1).  This is typically given by the transport which the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Initiator and the Responder have agreed on beforehand.  The</td><td> </td><td class="right">      Initiator and the Responder have agreed on beforehand.  The</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Responder either accepts or rejects.</td><td> </td><td class="right">      Responder either accepts or rejects.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0054"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  The Initiator decides on the method parameter, see Section 8</span>.2.</td><td> </td><td class="rblock">   <span class="insert">*  The Initiator decides on the method parameter, see Section 9</span>.2.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      The Responder either accepts or rejects.</td><td> </td><td class="right">      The Responder either accepts or rejects.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0055"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The Initiator and the Responder decide on the representation of</td><td> </td><td class="rblock">   <span class="insert">TODO: Do we want to enable parties negotiating public key method?</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *</span>  The Initiator and the Responder decide on the representation of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the identifier of their respective credentials, ID_CRED_I and</td><td> </td><td class="right">      the identifier of their respective credentials, ID_CRED_I and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      ID_CRED_R.  The decision is reflected by the label used in the</td><td> </td><td class="right">      ID_CRED_R.  The decision is reflected by the label used in the</td><td class="lineno"></td></tr>
      <tr id="diff0056"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      CBOR map, see for example Section <span class="delete">4.2.</span></td><td> </td><td class="rblock">      CBOR map, see for example Section <span class="insert">4.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TODO: Do we want to enable parties to communicate that they already</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   have or have not access to key or certificate of the other?</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.6.  Auxiliary Data</td><td> </td><td class="right">3.6.  Auxiliary Data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   In order to reduce round trips and number of messages, and in some</td><td> </td><td class="right">   In order to reduce round trips and number of messages, and in some</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   cases also streamline processing, certain security applications may</td><td> </td><td class="right">   cases also streamline processing, certain security applications may</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   be integrated into EDHOC by transporting auxiliary data together with</td><td> </td><td class="right">   be integrated into EDHOC by transporting auxiliary data together with</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the messages.  One example is the transport of third-party</td><td> </td><td class="right">   the messages.  One example is the transport of third-party</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authorization information protected outside of EDHOC</td><td> </td><td class="right">   authorization information protected outside of EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.selander-ace-ake-authz].  Another example is the embedding of a</td><td> </td><td class="right">   [I-D.selander-ace-ake-authz].  Another example is the embedding of a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   certificate enrolment request or a newly issued certificate.</td><td> </td><td class="right">   certificate enrolment request or a newly issued certificate.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC allows opaque auxiliary data (AD) to be sent in the EDHOC</td><td> </td><td class="right">   EDHOC allows opaque auxiliary data (AD) to be sent in the EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   messages.  Unprotected Auxiliary Data (AD_1, AD_2) may be sent in</td><td> </td><td class="right">   messages.  Unprotected Auxiliary Data (AD_1, AD_2) may be sent in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_1 and message_2, respectively.  Protected Auxiliary Data</td><td> </td><td class="right">   message_1 and message_2, respectively.  Protected Auxiliary Data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   (AD_3) may be sent in message_3.</td><td> </td><td class="right">   (AD_3) may be sent in message_3.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0057"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Since data carried in <span class="delete">AD_1</span> and <span class="delete">AD_2</span> may not be protected, and the</td><td> </td><td class="rblock">   Since data carried in <span class="insert">AD1</span> and <span class="insert">AD2</span> may not be protected, and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   content of <span class="delete">AD_3</span> is available to both the Initiator and the Responder,</td><td> </td><td class="rblock">   content of <span class="insert">AD3</span> is available to both the Initiator and the Responder,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   special considerations need to be made such that the availability of</td><td> </td><td class="right">   special considerations need to be made such that the availability of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the data a) does not violate security and privacy requirements of the</td><td> </td><td class="right">   the data a) does not violate security and privacy requirements of the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   service which uses this data, and b) does not violate the security</td><td> </td><td class="right">   service which uses this data, and b) does not violate the security</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   properties of EDHOC.</td><td> </td><td class="right">   properties of EDHOC.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.7.  Ephemeral Public Keys</td><td> </td><td class="right">3.7.  Ephemeral Public Keys</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The ECDH ephemeral public keys are formatted as a COSE_Key of type</td><td> </td><td class="right">   The ECDH ephemeral public keys are formatted as a COSE_Key of type</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EC2 or OKP according to Sections 13.1 and 13.2 of [RFC8152], but only</td><td> </td><td class="right">   EC2 or OKP according to Sections 13.1 and 13.2 of [RFC8152], but only</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the 'x' parameter is included in the EDHOC messages.  For Elliptic</td><td> </td><td class="right">   the 'x' parameter is included in the EDHOC messages.  For Elliptic</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Curve Keys of type EC2, compact representation as per [RFC6090] MAY</td><td> </td><td class="right">   Curve Keys of type EC2, compact representation as per [RFC6090] MAY</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   be used also in the COSE_Key.  If the COSE implementation requires an</td><td> </td><td class="right">   be used also in the COSE_Key.  If the COSE implementation requires an</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   'y' parameter, any of the possible values of the y-coordinate can be</td><td> </td><td class="right">   'y' parameter, any of the possible values of the y-coordinate can be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   used, see Appendix C of [RFC6090].  COSE [RFC8152] always use compact</td><td> </td><td class="right">   used, see Appendix C of [RFC6090].  COSE [RFC8152] always use compact</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   output for Elliptic Curve Keys of type EC2.</td><td> </td><td class="right">   output for Elliptic Curve Keys of type EC2.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.8.  Key Derivation</td><td> </td><td class="right">3.8.  Key Derivation</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0058"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   EDHOC <span class="delete">uses</span> HKDF [RFC5869] <span class="delete">with</span> the EDHOC hash algorithm in the</td><td> </td><td class="rblock">   <span class="insert">Keys and IVs in</span> EDHOC <span class="insert">is derived with</span> HKDF [RFC5869] <span class="insert">using a</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   selected cipher <span class="delete">suite to derive keys.  HKDF-Extract is used to derive</span></td><td> </td><td class="rblock"><span class="insert">   pseudorandom key (PRK) and</span> the EDHOC hash algorithm in the selected</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   fixed-length uniformly pseudorandom keys (PRK) from ECDH shared</span></td><td> </td><td class="rblock">   cipher <span class="insert">suite.</span>  The PRKs are derived using <span class="insert">HKDF-Extract</span> [RFC5869].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   secrets.  HKDF-Expand is used to derive additional output keying</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   material (OKM) from the PRKs.</span>  The PRKs are derived using <span class="delete">HKDF-</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Extract</span> [RFC5869].</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      PRK = HKDF-Extract( salt, IKM )</td><td> </td><td class="right">      PRK = HKDF-Extract( salt, IKM )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   PRK_2e is used to derive key and IV to encrypt message_2.  PRK_3e2m</td><td> </td><td class="right">   PRK_2e is used to derive key and IV to encrypt message_2.  PRK_3e2m</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   is used to derive keys and IVs produce a MAC in message_2 and to</td><td> </td><td class="right">   is used to derive keys and IVs produce a MAC in message_2 and to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   encrypt message_3.  PRK_4x3m is used to derive keys and IVs produce a</td><td> </td><td class="right">   encrypt message_3.  PRK_4x3m is used to derive keys and IVs produce a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   MAC in message_3 and to derive application specific data.</td><td> </td><td class="right">   MAC in message_3 and to derive application specific data.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   PRK_2e is derived with the following input:</td><td> </td><td class="right">   PRK_2e is derived with the following input:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0059"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The salt SHALL be the empty byte <span class="delete">string.</span>  Note that [RFC5869]</td><td> </td><td class="rblock">   <span class="insert">*</span>  The salt SHALL be the <span class="insert">PSK when EDHOC is authenticated with</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      specifies that if the salt is not provided, it is set to a string</td><td> </td><td class="rblock"><span class="insert">      symmetric keys, and the</span> empty byte <span class="insert">string when EDHOC is</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      of zeros (see Section 2.2 of [RFC5869]).  For implementation</td><td> </td><td class="rblock"><span class="insert">      authenticated with asymmetric keys (signature or static DH).  The</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      purposes, not providing the salt is the same as setting the salt</td><td> </td><td class="rblock"><span class="insert">      PSK is used as 'salt' to simplify implementation.</span>  Note that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      to the empty byte string.</td><td> </td><td class="rblock">      [RFC5869] specifies that if the salt is not provided, it is set to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">      a string of zeros (see Section 2.2 of [RFC5869]).  For</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">      implementation purposes, not providing the salt is the same as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">      setting the salt to the empty byte string.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0060"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The input keying material (IKM) SHALL be the ECDH shared secret</td><td> </td><td class="rblock">   <span class="insert">*</span>  The input keying material (IKM) SHALL be the ECDH shared secret</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      G_XY (calculated from G_X and Y or G_Y and X) as defined in</td><td> </td><td class="right">      G_XY (calculated from G_X and Y or G_Y and X) as defined in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Section 12.4.1 of [RFC8152].</td><td> </td><td class="right">      Section 12.4.1 of [RFC8152].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Example: Assuming the use of SHA-256 the extract phase of HKDF</td><td> </td><td class="right">   Example: Assuming the use of SHA-256 the extract phase of HKDF</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   produces PRK_2e as follows:</td><td> </td><td class="right">   produces PRK_2e as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      PRK_2e = HMAC-SHA-256( salt, G_XY )</td><td> </td><td class="right">      PRK_2e = HMAC-SHA-256( salt, G_XY )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0061"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   where salt = 0x (the empty byte <span class="delete">string).</span></td><td> </td><td class="rblock">   where salt = 0x (the empty byte <span class="insert">string) in the asymmetric case and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   salt = PSK in the symmetric case.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The pseudorandom keys PRK_3e2m and PRK_4x3m are defined as follow:</td><td> </td><td class="right">   The pseudorandom keys PRK_3e2m and PRK_4x3m are defined as follow:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0062"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  If the Reponder authenticates with a static Diffie-Hellman key,</td><td> </td><td class="rblock">   <span class="insert">*</span>  If the Reponder authenticates with a static Diffie-Hellman key,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      then PRK_3e2m = HKDF-Extract( PRK_2e, G_RX ), where G_RX is the</td><td> </td><td class="right">      then PRK_3e2m = HKDF-Extract( PRK_2e, G_RX ), where G_RX is the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      ECDH shared secret calculated from G_R and X, or G_X and R, else</td><td> </td><td class="right">      ECDH shared secret calculated from G_R and X, or G_X and R, else</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      PRK_3e2m = PRK_2e.</td><td> </td><td class="right">      PRK_3e2m = PRK_2e.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0063"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  If the Initiator authenticates with a static Diffie-Hellman key,</td><td> </td><td class="rblock">   <span class="insert">*</span>  If the Initiator authenticates with a static Diffie-Hellman key,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      then PRK_4x3m = HKDF-Extract( PRK_3e2m, G_IY ), where G_IY is the</td><td> </td><td class="right">      then PRK_4x3m = HKDF-Extract( PRK_3e2m, G_IY ), where G_IY is the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      ECDH shared secret calculated from G_I and Y, or G_Y and I, else</td><td> </td><td class="right">      ECDH shared secret calculated from G_I and Y, or G_Y and I, else</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      PRK_4x3m = PRK_3e2m.</td><td> </td><td class="right">      PRK_4x3m = PRK_3e2m.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Example: Assuming the use of curve25519, the ECDH shared secrets</td><td> </td><td class="right">   Example: Assuming the use of curve25519, the ECDH shared secrets</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   G_XY, G_RX, and G_IY are the outputs of the X25519 function</td><td> </td><td class="right">   G_XY, G_RX, and G_IY are the outputs of the X25519 function</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC7748]:</td><td> </td><td class="right">   [RFC7748]:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      G_XY = X25519( Y, G_X ) = X25519( X, G_Y )</td><td> </td><td class="right">      G_XY = X25519( Y, G_X ) = X25519( X, G_Y )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The keys and IVs used in EDHOC are derived from PRK using HKDF-Expand</td><td> </td><td class="right">   The keys and IVs used in EDHOC are derived from PRK using HKDF-Expand</td><td class="lineno"></td></tr>
      <tr id="diff0064"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [RFC5869] <span class="delete">where the EDHOC-KDF is instantiated with the EDHOC AEAD</span></td><td> </td><td class="rblock">   [RFC5869]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   algorithm in the selected cipher suite.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0065"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      OKM = <span class="delete">EDHOC-</span>KDF( PRK, transcript_hash, label, length )</td><td> </td><td class="rblock">      OKM = KDF( PRK, transcript_hash, label, length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">          = HKDF-Expand( PRK, info, length )</td><td> </td><td class="right">          = HKDF-Expand( PRK, info, length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   where info is the CBOR encoding of</td><td> </td><td class="right">   where info is the CBOR encoding of</td><td class="lineno"></td></tr>
      <tr id="diff0066"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                                         </span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   info = [</td><td> </td><td class="right">   info = [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      edhoc_aead_id : int / tstr,</td><td> </td><td class="right">      edhoc_aead_id : int / tstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      transcript_hash : bstr,</td><td> </td><td class="right">      transcript_hash : bstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      label : tstr,</td><td> </td><td class="right">      label : tstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      length : uint</td><td> </td><td class="right">      length : uint</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   ]</td><td> </td><td class="right">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   where</td><td> </td><td class="right">   where</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0067"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  edhoc_aead_id is an int or tstr containing the algorithm</td><td> </td><td class="rblock">   <span class="insert">*</span>  edhoc_aead_id is an int or tstr containing the algorithm</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      identifier of the EDHOC AEAD algorithm in the selected cipher</td><td> </td><td class="right">      identifier of the EDHOC AEAD algorithm in the selected cipher</td><td class="lineno"></td></tr>
      <tr id="diff0068"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      suite encoded as defined in [RFC8152].  <span class="delete">Note that a single fixed</span></td><td> </td><td class="rblock">      suite encoded as defined in [RFC8152].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      edhoc_aead_id is used in all invocations of EDHOC-KDF, including</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      the derivation of K_2e and invocations of the EDHOC-Exporter.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0069"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  transcript_hash is a bstr set to one of the transcript hashes</td><td> </td><td class="rblock">   <span class="insert">*</span>  transcript_hash is a bstr set to one of the transcript hashes</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      TH_2, TH_3, or TH_4 as defined in Sections <span class="delete">4.5.1, 4.6.1,</span> and</td><td> </td><td class="rblock">      TH_2, TH_3, or TH_4 as defined in Sections <span class="insert">4.3.1, 4.4.1,</span> and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      3.8.1.</td><td> </td><td class="right">      3.8.1.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0070"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  label is a tstr set to the name of the derived key or IV, i.e.</td><td> </td><td class="rblock">   <span class="insert">*</span>  label is a tstr set to the name of the derived key or IV, i.e.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      "K_2m", "IV_2m", "K_2e", "K_3m", "IV_3m", "K_3ae", or <span class="delete">"IV_3ae".</span></td><td> </td><td class="rblock">      "K_2m", "IV_2m", "K_2e", <span class="insert">"K_2ae", "IV_2ae",</span> "K_3m", "IV_3m",</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">      "K_3ae", or <span class="insert">"IV_2ae".</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0071"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  length is the length of output keying material (OKM) in bytes</td><td> </td><td class="rblock">   <span class="insert">*</span>  length is the length of output keying material (OKM) in bytes</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0072"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   K_2m and IV_2m are derived using the transcript hash TH_2 and the</td><td> </td><td class="rblock">   <span class="insert">K_2ae and IV_2ae are derived using the transcript hash TH_2 and the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   pseudorandom key PRK_3e2m.  K_3ae and IV_3ae are derived using the</td><td> </td><td class="rblock"><span class="insert">   pseudorandom key PRK_2e.</span>  K_2m and IV_2m are derived using the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   transcript hash TH_3 and the pseudorandom key PRK_3e2m.  K_3m and</td><td> </td><td class="rblock">   transcript hash TH_2 and the pseudorandom key PRK_3e2m.  K_3ae and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   IV_3m are derived using the transcript hash TH_3 and the pseudorandom</td><td> </td><td class="rblock">   IV_3ae are derived using the transcript hash TH_3 and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   key PRK_4x3m.  IVs are only used if the EDHOC AEAD algorithm uses</td><td> </td><td class="rblock">   pseudorandom key PRK_3e2m.  K_3m and IV_3m are derived using the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   IVs.</td><td> </td><td class="rblock">   transcript hash TH_3 and the pseudorandom key PRK_4x3m.  IVs are only</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   used if the EDHOC AEAD algorithm uses IVs.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">Assuming that length is smaller than the hash function output size,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the expand phase of HKDF consists of a single HMAC invocation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      OKM = first "length" bytes of HMAC( PRK, info || 0x01 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   where || means byte string concatenation.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Example: Assume the use of the algorithm AES-CCM-16-64-128 and SHA-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   256, K_j and IV_j are therefore the first 16 and 13 bytes,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   respectively, of</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      HMAC-SHA-256( PRK_j, info || 0x01 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   \calculated with (edhoc_aead_id, length) = (10, 16) and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (edhoc_aead_id, length) = (10, 13), respectively.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">3.8.1.  EDHOC-Exporter Interface</td><td> </td><td class="right">3.8.1.  EDHOC-Exporter Interface</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Application keys and other application specific data can be derived</td><td> </td><td class="right">   Application keys and other application specific data can be derived</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   using the EDHOC-Exporter interface defined as:</td><td> </td><td class="right">   using the EDHOC-Exporter interface defined as:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0073"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      EDHOC-Exporter(label, length)</td><td> </td><td class="rblock">      EDHOC-Exporter(label, length) = <span class="insert">KDF(PRK_4x3m,</span> TH_4, label, length)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">        = <span class="delete">EDHOC-KDF(PRK_4x3m,</span> TH_4, label, length)</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0074"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   where label is a tstr defined by the application and length is <span class="delete">a</span> uint</td><td> </td><td class="rblock">   where label is a tstr defined by the application and length is <span class="insert">an</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   defined by the application.  The label SHALL be different for each</td><td> </td><td class="rblock">   uint defined by the application.  The label SHALL be different for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   different exporter value.  The transcript hash TH_4 is a CBOR encoded</td><td> </td><td class="rblock">   each different exporter value.  The transcript hash TH_4 is a CBOR</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   bstr and the input to the hash function is a CBOR Sequence.</td><td> </td><td class="rblock">   encoded bstr and the input to the hash function is a CBOR Sequence.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      TH_4 = H( TH_3, CIPHERTEXT_3 )</td><td> </td><td class="right">      TH_4 = H( TH_3, CIPHERTEXT_3 )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   where H() is the hash function in the selected cipher suite.  Example</td><td> </td><td class="right">   where H() is the hash function in the selected cipher suite.  Example</td><td class="lineno"></td></tr>
      <tr id="diff0075"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   use of the EDHOC-Exporter is given in Sections <span class="delete">6</span>.1.1.</td><td> </td><td class="rblock">   use of the EDHOC-Exporter is given in Sections <span class="insert">3.8.2 and 7</span>.1.1.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0076"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">4.</span>  EDHOC <span class="delete">Authenticated with Asymmetric Keys</span></td><td> </td><td class="rblock"><span class="insert">3.8.2.</span>  EDHOC <span class="insert">PSK Chaining</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   An application using EDHOC may want to derive new PSKs to use for</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   authentication in future EDHOC exchanges.  In this case, the new PSK</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   and the ID_PSK 'kid_value' parameter SHOULD be derived as follows</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   where length is the key length (in bytes) of the EDHOC AEAD</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Algorithm.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      PSK     = EDHOC-Exporter( "EDHOC Chaining PSK", length )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      kid_psk = EDHOC-Exporter( "EDHOC Chaining kid_psk", 4 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0077"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">4.  EDHOC Authenticated with Asymmetric Keys</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">4.1.  Overview</td><td> </td><td class="right">4.1.  Overview</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This section specifies authentication method = 0, 1, 2, and 3, see</td><td> </td><td class="right">   This section specifies authentication method = 0, 1, 2, and 3, see</td><td class="lineno"></td></tr>
      <tr id="diff0078"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Section <span class="delete">8</span>.2.  EDHOC supports authentication with signature or static</td><td> </td><td class="rblock">   Section <span class="insert">9</span>.2.  EDHOC supports authentication with signature or static</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Diffie-Hellman keys in the form of raw public keys (RPK) and public</td><td> </td><td class="right">   Diffie-Hellman keys in the form of raw public keys (RPK) and public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   key certificates with the requirements that:</td><td> </td><td class="right">   key certificates with the requirements that:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0079"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Only the Responder SHALL have access to the Responder's private</td><td> </td><td class="rblock">   <span class="insert">*</span>  Only the Responder SHALL have access to the Responder's private</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      authentication key,</td><td> </td><td class="right">      authentication key,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0080"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Only the Initiator SHALL have access to the Initiator's private</td><td> </td><td class="rblock">   <span class="insert">*</span>  Only the Initiator SHALL have access to the Initiator's private</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      authentication key,</td><td> </td><td class="right">      authentication key,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0081"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The Initiator is able to retrieve the Responder's public</td><td> </td><td class="rblock">   <span class="insert">*</span>  The Initiator is able to retrieve the Responder's public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      authentication key using ID_CRED_R,</td><td> </td><td class="right">      authentication key using ID_CRED_R,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0082"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The Responder is able to retrieve the Initiator's public</td><td> </td><td class="rblock">   <span class="insert">*</span>  The Responder is able to retrieve the Initiator's public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      authentication key using ID_CRED_I,</td><td> </td><td class="right">      authentication key using ID_CRED_I,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0083"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   where ID_CRED_I and ID_CRED_R are <span class="delete">the identifiers</span> of <span class="delete">the</span> public</td><td> </td><td class="rblock">   where <span class="insert">the identifiers</span> ID_CRED_I and ID_CRED_R are <span class="insert">COSE header_maps,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   authentication <span class="delete">keys.  Their encoding is specified in Section 4.2.</span></td><td> </td><td class="rblock"><span class="insert">   i.e. CBOR maps containing COSE Common Header Parameters, see</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">   Section 3.1</span> of <span class="insert">[RFC8152]).  ID_CRED_I and ID_CRED_R need to contain</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator                                                   Responder</span></td><td> </td><td class="rblock"><span class="insert">   parameters that can identify a</span> public authentication <span class="insert">key.  In the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |               METHOD_CORR, SUITES_I, G_X, C_I, AD_1               |</span></td><td> </td><td class="rblock"><span class="insert">   following paragraph we give some examples of possible COSE header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   +------------------------------------------------------------------&gt;|</span></td><td> </td><td class="rblock"><span class="insert">   parameters used.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |                             message_1                             |</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |                                                                   |</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |   C_I, G_Y, C_R, Enc(K_2e; ID_CRED_R, Signature_or_MAC_2, AD_2)   |</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |&lt;------------------------------------------------------------------+</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |                             message_2                             |</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |                                                                   |</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |       C_R, AEAD(K_3ae; ID_CRED_I, Signature_or_MAC_3, AD_3)       |</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   +------------------------------------------------------------------&gt;|</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   |                             message_3                             |</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0084"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">Figure 4: Overview of EDHOC</span> with <span class="delete">asymmetric key authentication.</span></td><td> </td><td class="rblock">   <span class="insert">Raw public keys are most optimally stored as COSE_Key objects and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   identified</span> with <span class="insert">a 'kid' parameter:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0085"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">4.2.  Encoding of Public Authentication Key Identifiers</span></td><td> </td><td class="rblock"><span class="insert">   *  ID_CRED_x = { 4 : kid_x }, where kid_x : bstr, for x = I or R.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0086"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The identifiers ID_CRED_I and ID_CRED_R are COSE header_maps, i.e.</span></td><td> </td><td class="rblock">   <span class="insert">Public key certificates</span> can <span class="insert">be identified in different ways.  Several</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   CBOR maps containing COSE Common Header Parameters, see Section 3.1</span></td><td> </td><td class="rblock">   header parameters <span class="insert">for identifying X.509 certificates are defined in</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   of [RFC8152]).  ID_CRED_I and ID_CRED_R need to contain parameters</span></td><td> </td><td class="rblock"><span class="insert">   [I-D.ietf-cose-x509]:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   that</span> can <span class="delete">identify a public authentication key.  In the following</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   paragraph we give some examples of possible COSE</span> header parameters</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">used.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0087"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Raw public keys are most optimally stored as COSE_Key objects and</span></td><td> </td><td class="rblock">   <span class="insert">*  by</span> a <span class="insert">bag of certificates with the 'x5bag' parameter; or</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   identified with</span> a <span class="delete">'kid' parameter:</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0088"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  ID_CRED_x = { 4 : kid_x }, where kid_x : bstr, for x = I or R.</span></td><td> </td><td class="rblock">   <span class="insert">   -  ID_CRED_x = { 32 : COSE_X509 }, for x = I or R,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0089"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Public key certificates can be identified in different ways.  Header</span></td><td> </td><td class="rblock">   <span class="insert">*  by a certificate chain with the 'x5chain' parameter;</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   parameters for identifying X.509 certificates are defined in</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   [I-D.ietf-cose-x509], for example:</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0090"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  by a hash value with the 'x5t' parameter;</span></td><td> </td><td class="rblock">   <span class="insert">   -  ID_CRED_x = { 33 : COSE_X509 }, for x = I or R,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0091"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">   *  ID_CRED_x = { 34 : COSE_CertHash }, for x = I or R,</span></td><td> </td><td class="rblock">   <span class="insert">*  by a hash value with the 'x5t' parameter;</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0092"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  by a URL with the 'x5u' parameter;</span></td><td> </td><td class="rblock">   <span class="insert">   -  ID_CRED_x = { 34 : COSE_CertHash }, for x = I or R,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0093"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      *  ID_CRED_x = { 35 : uri }, for x = I or R,</td><td> </td><td class="rblock">   *  <span class="insert">by a URL with the 'x5u' parameter;</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -</span>  ID_CRED_x = { 35 : uri }, for x = I or R,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0094"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The purpose of ID_CRED_I and ID_CRED_R is to facilitate retrieval of</td><td> </td><td class="rblock">   <span class="insert">In the first two examples, ID_CRED_I and ID_CRED_R contain the actual</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   a public authentication key and when they do not contain the actual</td><td> </td><td class="rblock"><span class="insert">   credential used for authentication.</span>  The purpose of ID_CRED_I and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   credential, they may be very short.  <span class="delete">ID_CRED_I and ID_CRED_R MAY</span></td><td> </td><td class="rblock">   ID_CRED_R is to facilitate retrieval of a public authentication key</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   contain the actual credential used for authentication.</span>  It is</td><td> </td><td class="rblock">   and when they do not contain the actual credential, they may be very</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   RECOMMENDED that they uniquely identify the public authentication key</td><td> </td><td class="rblock">   short.  It is RECOMMENDED that they uniquely identify the public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   as the recipient may otherwise have to try several keys.  ID_CRED_I</td><td> </td><td class="rblock">   authentication key as the recipient may otherwise have to try several</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   and ID_CRED_R are transported in the ciphertext, see Section <span class="delete">4.5.2</span></td><td> </td><td class="rblock">   keys.  ID_CRED_I and ID_CRED_R are transported in the ciphertext, see</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   and Section <span class="delete">4.6.2.</span></td><td> </td><td class="rblock">   Section <span class="insert">4.3.2</span> and Section <span class="insert">4.4.2.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The authentication key MUST be a signature key or static Diffie-</td><td> </td><td class="right">   The authentication key MUST be a signature key or static Diffie-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Hellman key.  The Initiator and the Responder MAY use different types</td><td> </td><td class="right">   Hellman key.  The Initiator and the Responder MAY use different types</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   of authentication keys, e.g. one uses a signature key and the other</td><td> </td><td class="right">   of authentication keys, e.g. one uses a signature key and the other</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   uses a static Diffie-Hellman key.  When using a signature key, the</td><td> </td><td class="right">   uses a static Diffie-Hellman key.  When using a signature key, the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authentication is provided by a signature.  When using a static</td><td> </td><td class="right">   authentication is provided by a signature.  When using a static</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Diffie-Hellman key the authentication is provided by a Message</td><td> </td><td class="right">   Diffie-Hellman key the authentication is provided by a Message</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Authentication Code (MAC) computed from an ephemeral-static ECDH</td><td> </td><td class="right">   Authentication Code (MAC) computed from an ephemeral-static ECDH</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   shared secret which enables significant reductions in message sizes.</td><td> </td><td class="right">   shared secret which enables significant reductions in message sizes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The MAC is implemented with an AEAD algorithm.  When using a static</td><td> </td><td class="right">   The MAC is implemented with an AEAD algorithm.  When using a static</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Diffie-Hellman keys the Initiator's and Responder's private</td><td> </td><td class="right">   Diffie-Hellman keys the Initiator's and Responder's private</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authentication keys are called I and R, respectively, and the public</td><td> </td><td class="right">   authentication keys are called I and R, respectively, and the public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authentication keys are called G_I and G_R, respectively.</td><td> </td><td class="right">   authentication keys are called G_I and G_R, respectively.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The actual credentials CRED_I and CRED_R are signed or MAC:ed by the</td><td> </td><td class="right">   The actual credentials CRED_I and CRED_R are signed or MAC:ed by the</td><td class="lineno"></td></tr>
      <tr id="diff0095"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Initiator and the Responder respectively, see Section <span class="delete">4.6.1</span> and</td><td> </td><td class="rblock">   Initiator and the Responder respectively, see Section <span class="insert">4.4.1</span> and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Section <span class="delete">4.5.1.</span>  The Initiator and the Responder MAY use different</td><td> </td><td class="rblock">   Section <span class="insert">4.3.1.</span>  The Initiator and the Responder MAY use different</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   types of credentials, e.g. one uses RPK and the other uses</td><td> </td><td class="right">   types of credentials, e.g. one uses RPK and the other uses</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   certificate.  When the credential is a certificate, CRED_x is end-</td><td> </td><td class="right">   certificate.  When the credential is a certificate, CRED_x is end-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   entity certificate (i.e. not the certificate chain) encoded as a CBOR</td><td> </td><td class="right">   entity certificate (i.e. not the certificate chain) encoded as a CBOR</td><td class="lineno"></td></tr>
      <tr id="diff0096"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   bstr.  When the credential is a COSE_Key, CRE<span class="delete">D</span>_x is a CBOR map only</td><td> </td><td class="rblock">   bstr.  When the credential is a COSE_Key, CRE<span class="insert">X</span>_x is a CBOR map only</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   contains specific fields from the COSE_Key.  For COSE_Keys of type</td><td> </td><td class="right">   contains specific fields from the COSE_Key.  For COSE_Keys of type</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   OKP the CBOR map SHALL only include the parameters 1 (kty), -1 (crv),</td><td> </td><td class="right">   OKP the CBOR map SHALL only include the parameters 1 (kty), -1 (crv),</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and -2 (x-coordinate).  For COSE_Keys of type EC2 the CBOR map SHALL</td><td> </td><td class="right">   and -2 (x-coordinate).  For COSE_Keys of type EC2 the CBOR map SHALL</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   only include the parameters 1 (kty), -1 (crv), -2 (x-coordinate), and</td><td> </td><td class="right">   only include the parameters 1 (kty), -1 (crv), -2 (x-coordinate), and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   -3 (y-coordinate).  If the parties have agreed on an identity besides</td><td> </td><td class="right">   -3 (y-coordinate).  If the parties have agreed on an identity besides</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the public key, the indentity is included in the CBOR map with the</td><td> </td><td class="right">   the public key, the indentity is included in the CBOR map with the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   label "subject name", otherwise the subject name is the empty text</td><td> </td><td class="right">   label "subject name", otherwise the subject name is the empty text</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   string.  The parameters SHALL be encoded in decreasing order with int</td><td> </td><td class="right">   string.  The parameters SHALL be encoded in decreasing order with int</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   labels first and text string labels last.  An example of CRED_x when</td><td> </td><td class="right">   labels first and text string labels last.  An example of CRED_x when</td><td class="lineno"></td></tr>
      <tr id="diff0097"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   the RPK contains a<span class="delete">n</span> X25519 static Diffie-Hellman key and the parties</td><td> </td><td class="rblock">   the RPK contains a X25519 static Diffie-Hellman key and the parties</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   have agreed on an EUI-64 identity is shown below:</td><td> </td><td class="right">   have agreed on an EUI-64 identity is shown below:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   CRED_x = {</td><td> </td><td class="right">   CRED_x = {</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     1:  1,</td><td> </td><td class="right">     1:  1,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    -1:  4,</td><td> </td><td class="right">    -1:  4,</td><td class="lineno"></td></tr>
      <tr id="diff0098"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    -2:  <span class="delete">h'b1a3e89460e88d3a8d54211dc95f0b90</span></td><td> </td><td class="rblock">    -2:  <span class="insert">h'b1a3e89460e88d3a8d54211dc95f0b903ff205eb71912d6db8f4af980d2db83a',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">           3ff205eb71912d6db8f4af980d2db83a',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    "subject name" : "42-50-31-FF-EF-37-32-39"</td><td> </td><td class="right">    "subject name" : "42-50-31-FF-EF-37-32-39"</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   }</td><td> </td><td class="right">   }</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0099"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">4.3.  Encoding of bstr_identifier</span></td><td> </td><td class="rblock">   <span class="insert">Initiator                                                   Responder</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">   |               METHOD_CORR, SUITES_I, G_X, C_I, AD_1               |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   A bstr_identifier is a special encoding for byte strings, used</span></td><td> </td><td class="rblock"><span class="insert">   +------------------------------------------------------------------&gt;|</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   throughout the protocol.</span></td><td> </td><td class="rblock"><span class="insert">   |                             message_1                             |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">   |                                                                   |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Byte strings of length greater than one are encoded as CBOR byte</span></td><td> </td><td class="rblock"><span class="insert">   |   C_I, G_Y, C_R, Enc(K_2e; ID_CRED_R, Signature_or_MAC_2, AD_2)   |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   strings.  Byte strings of length one are encoded as the corresponding</span></td><td> </td><td class="rblock"><span class="insert">   |&lt;------------------------------------------------------------------+</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   integer - 24.</span></td><td> </td><td class="rblock"><span class="insert">   |                             message_2                             |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">   |                                                                   |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   For example, the byte string h'59e9' encoded as a bstr_identifier is</span></td><td> </td><td class="rblock"><span class="insert">   |       C_R, AEAD(K_3ae; ID_CRED_I, Signature_or_MAC_3, AD_3)       |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   equal to h'59e9', while the byte string h'2a' is encoded as the</span></td><td> </td><td class="rblock"><span class="insert">   +------------------------------------------------------------------&gt;|</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   integer 18.</span></td><td> </td><td class="rblock"><span class="insert">   |                             message_3                             |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   The CDDL definition of the bstr_identifier is given below:</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   bstr_identifier = bstr / int</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0100"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Note that, despite what could be interpreted by the CDDL definition</span></td><td> </td><td class="rblock">      <span class="insert">Figure 4: Overview of EDHOC with asymmetric key authentication.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   only, bstr_identifier once decoded are always byte strings.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0101"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">4</span>.  EDHOC Message 1</td><td> </td><td class="rblock">4.<span class="insert">2</span>.  EDHOC Message 1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0102"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">4</span>.1.  Formatting of Message 1</td><td> </td><td class="rblock">4.<span class="insert">2</span>.1.  Formatting of Message 1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_1 SHALL be a CBOR Sequence (see Appendix A.1) as defined</td><td> </td><td class="right">   message_1 SHALL be a CBOR Sequence (see Appendix A.1) as defined</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   below</td><td> </td><td class="right">   below</td><td class="lineno"></td></tr>
      <tr id="diff0103"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                                         </span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_1 = (</td><td> </td><td class="right">   message_1 = (</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     METHOD_CORR : int,</td><td> </td><td class="right">     METHOD_CORR : int,</td><td class="lineno"></td></tr>
      <tr id="diff0104"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     SUITES_I : [ selected : suite, supported : 2* suite ] / suite,</td><td> </td><td class="rblock">     SUITES_I : [ selected : suite, supported : 2* suite ] / s<span class="insert">elected : s</span>uite,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     G_X : bstr,</td><td> </td><td class="right">     G_X : bstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     C_I : bstr_identifier,</td><td> </td><td class="right">     C_I : bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     ? AD_1 : bstr,</td><td> </td><td class="right">     ? AD_1 : bstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   suite = int</td><td> </td><td class="right">   suite = int</td><td class="lineno"></td></tr>
      <tr id="diff0105"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   bstr_identifier = bsrt / int</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   where:</td><td> </td><td class="right">   where:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0106"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  METHOD_CORR = 4 * method + corr, where method = 0, 1, 2, or 3 (see</td><td> </td><td class="rblock">   <span class="insert">*</span>  METHOD_CORR = 4 * method + corr, where method = 0, 1, 2, or 3 (see</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      Section <span class="delete">8.2)</span> and the correlation parameter corr is chosen based on</td><td> </td><td class="rblock">      Section <span class="insert">9.2)</span> and the correlation parameter corr is chosen based on</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the transport and determines which connection identifiers that are</td><td> </td><td class="right">      the transport and determines which connection identifiers that are</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      omitted (see Section 3.1).</td><td> </td><td class="right">      omitted (see Section 3.1).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0107"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  SUITES_I - cipher suites which the Initiator supports in order of</td><td> </td><td class="rblock">   <span class="insert">*</span>  SUITES_I - cipher suites which the Initiator supports in order of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">(decreasing)</span> preference.  <span class="delete">The list of supported cipher suites can</span></td><td> </td><td class="rblock">      <span class="insert">decreasing</span> preference.  One of the supported cipher suites is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      be truncated at the end, as is detailed in the processing steps</span></td><td> </td><td class="rblock">      selected.  If a single supported cipher suite is conveyed then</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      below.</span>  One of the supported cipher suites is selected.  If a</td><td> </td><td class="rblock">      that cipher suite is selected and the selected cipher suite is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      single supported cipher suite is conveyed then that cipher suite</td><td> </td><td class="rblock">      encoded as an int instead of an array.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      is selected and the selected cipher suite is encoded as an int</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      instead of an array.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0108"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  G_X - the ephemeral public key of the Initiator</td><td> </td><td class="rblock">   <span class="insert">*</span>  G_X - the ephemeral public key of the Initiator</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0109"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  C_I - variable length connection <span class="delete">identifier,</span> encoded as <span class="delete">a</span></td><td> </td><td class="rblock">   <span class="insert">*</span>  C_I - variable length connection <span class="insert">identifier.  An bstr_identifier</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      bstr_identifier (see Section 4.3).</span></td><td> </td><td class="rblock"><span class="insert">      is a byte string with special encoding.  Byte strings of length</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      one is</span> encoded as <span class="insert">the corresponding integer - 24, i.e. h'2a' is</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      encoded as 18.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0110"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  AD_1 - bstr containing unprotected opaque auxiliary data</td><td> </td><td class="rblock">   <span class="insert">*</span>  AD_1 - bstr containing unprotected opaque auxiliary data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0111"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">4</span>.2.  Initiator Processing of Message 1</td><td> </td><td class="rblock">4.<span class="insert">2</span>.2.  Initiator Processing of Message 1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator SHALL compose message_1 as follows:</td><td> </td><td class="right">   The Initiator SHALL compose message_1 as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0112"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The supported cipher suites and the order of preference MUST NOT</td><td> </td><td class="rblock">   <span class="insert">*</span>  The supported cipher suites and the order of preference MUST NOT</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      be changed based on previous error messages.  However, the list</td><td> </td><td class="right">      be changed based on previous error messages.  However, the list</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      SUITES_I sent to the Responder MAY be truncated such that cipher</td><td> </td><td class="right">      SUITES_I sent to the Responder MAY be truncated such that cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      suites which are the least preferred are omitted.  The amount of</td><td> </td><td class="right">      suites which are the least preferred are omitted.  The amount of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      truncation MAY be changed between sessions, e.g. based on previous</td><td> </td><td class="right">      truncation MAY be changed between sessions, e.g. based on previous</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      error messages (see next bullet), but all cipher suites which are</td><td> </td><td class="right">      error messages (see next bullet), but all cipher suites which are</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      more preferred than the least preferred cipher suite in the list</td><td> </td><td class="right">      more preferred than the least preferred cipher suite in the list</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      MUST be included in the list.</td><td> </td><td class="right">      MUST be included in the list.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0113"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Determine the cipher suite to use with the Responder in message_1.</td><td> </td><td class="rblock">   <span class="insert">*</span>  Determine the cipher suite to use with the Responder in message_1.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      If the Initiator previously received from the Responder an error</td><td> </td><td class="right">      If the Initiator previously received from the Responder an error</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      message to a message_1 with diagnostic payload identifying a</td><td> </td><td class="right">      message to a message_1 with diagnostic payload identifying a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      cipher suite that the Initiator supports, then the Initiator SHALL</td><td> </td><td class="right">      cipher suite that the Initiator supports, then the Initiator SHALL</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      use that cipher suite.  Otherwise the first supported (i.e. the</td><td> </td><td class="right">      use that cipher suite.  Otherwise the first supported (i.e. the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      most preferred) cipher suite in SUITES_I MUST be used.</td><td> </td><td class="right">      most preferred) cipher suite in SUITES_I MUST be used.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0114"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Generate an ephemeral ECDH key pair as specified in Section 5 of</td><td> </td><td class="rblock">   <span class="insert">*</span>  Generate an ephemeral ECDH key pair as specified in Section 5 of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      [SP-800-56A] using the curve in the selected cipher suite and</td><td> </td><td class="right">      [SP-800-56A] using the curve in the selected cipher suite and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      format it as a COSE_Key.  Let G_X be the 'x' parameter of the</td><td> </td><td class="right">      format it as a COSE_Key.  Let G_X be the 'x' parameter of the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      COSE_Key.</td><td> </td><td class="right">      COSE_Key.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0115"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Choose a connection identifier C_I and store it for the length of</td><td> </td><td class="rblock">   <span class="insert">*</span>  Choose a connection identifier C_I and store it for the length of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the protocol.</td><td> </td><td class="right">      the protocol.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0116"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Encode message_1 as a sequence of CBOR encoded data items as</td><td> </td><td class="rblock">   <span class="insert">*</span>  Encode message_1 as a sequence of CBOR encoded data items as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      specified in Section <span class="delete">4.4.1</span></td><td> </td><td class="rblock">      specified in Section <span class="insert">4.2.1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0117"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">4</span>.3.  Responder Processing of Message 1</td><td> </td><td class="rblock">4.<span class="insert">2</span>.3.  Responder Processing of Message 1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Responder SHALL process message_1 as follows:</td><td> </td><td class="right">   The Responder SHALL process message_1 as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0118"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Decode message_1 (see Appendix A.1).</td><td> </td><td class="rblock">   <span class="insert">*</span>  Decode message_1 (see Appendix A.1).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0119"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Verify that the selected cipher suite is supported and that no</td><td> </td><td class="rblock">   <span class="insert">*</span>  Verify that the selected cipher suite is supported and that no</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      prior cipher suites in SUITES_I are supported.</td><td> </td><td class="right">      prior cipher suites in SUITES_I are supported.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0120"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Pass AD_1 to the security application.</td><td> </td><td class="rblock">   <span class="insert">*</span>  Pass AD_1 to the security application.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   If any verification step fails, the Initiator MUST send an EDHOC</td><td> </td><td class="right">   If any verification step fails, the Initiator MUST send an EDHOC</td><td class="lineno"></td></tr>
      <tr id="diff0121"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   error message back, formatted as defined in Section <span class="delete">5,</span> and the</td><td> </td><td class="rblock">   error message back, formatted as defined in Section <span class="insert">6,</span> and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   protocol MUST be discontinued.  If <span class="delete">the Responder</span> does not support the</td><td> </td><td class="rblock">   protocol MUST be discontinued.  If <span class="insert">V</span> does not support the selected</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   selected cipher suite, then SUITES_R MUST include one or more</td><td> </td><td class="rblock">   cipher suite, then SUITES_R MUST include one or more supported cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   supported cipher suites.  If the Responder does not support the</td><td> </td><td class="rblock">   suites.  If the Responder does not support the selected cipher suite,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   selected cipher suite, but supports another cipher suite in SUITES_I,</td><td> </td><td class="rblock">   but supports another cipher suite in SUITES_I, then SUITES_R MUST</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   then SUITES_R MUST include the first supported cipher suite in</td><td> </td><td class="rblock">   include the first supported cipher suite in SUITES_I.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   SUITES_I.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0122"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">5</span>.  EDHOC Message 2</td><td> </td><td class="rblock">4.<span class="insert">3</span>.  EDHOC Message 2</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0123"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">5</span>.1.  Formatting of Message 2</td><td> </td><td class="rblock">4.<span class="insert">3</span>.1.  Formatting of Message 2</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_2 and data_2 SHALL be CBOR Sequences (see Appendix A.1) as</td><td> </td><td class="right">   message_2 and data_2 SHALL be CBOR Sequences (see Appendix A.1) as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   defined below</td><td> </td><td class="right">   defined below</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_2 = (</td><td> </td><td class="right">   message_2 = (</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     data_2,</td><td> </td><td class="right">     data_2,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     CIPHERTEXT_2 : bstr,</td><td> </td><td class="right">     CIPHERTEXT_2 : bstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr id="diff0124"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                                         </span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   data_2 = (</td><td> </td><td class="right">   data_2 = (</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     ? C_I : bstr_identifier,</td><td> </td><td class="right">     ? C_I : bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     G_Y : bstr,</td><td> </td><td class="right">     G_Y : bstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     C_R : bstr_identifier,</td><td> </td><td class="right">     C_R : bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   where:</td><td> </td><td class="right">   where:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0125"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  G_Y - the ephemeral public key of the Responder</td><td> </td><td class="rblock">   <span class="insert">*</span>  G_Y - the ephemeral public key of the Responder</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0126"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  C_R - variable length connection <span class="delete">identifier, encoded as a</span></td><td> </td><td class="rblock">   <span class="insert">*</span>  C_R - variable length connection <span class="insert">identifier</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      bstr_identifier (see Section 4.3).</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0127"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">5</span>.2.  Responder Processing of Message 2</td><td> </td><td class="rblock">4.<span class="insert">3</span>.2.  Responder Processing of Message 2</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Responder SHALL compose message_2 as follows:</td><td> </td><td class="right">   The Responder SHALL compose message_2 as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0128"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  If corr (METHOD_CORR mod 4) equals 1 or 3, C_I is omitted,</td><td> </td><td class="rblock">   <span class="insert">*</span>  If corr (METHOD_CORR mod 4) equals 1 or 3, C_I is omitted,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      otherwise C_I is not omitted.</td><td> </td><td class="right">      otherwise C_I is not omitted.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0129"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Generate an ephemeral ECDH key pair as specified in Section 5 of</td><td> </td><td class="rblock">   <span class="insert">*</span>  Generate an ephemeral ECDH key pair as specified in Section 5 of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      [SP-800-56A] using the curve in the selected cipher suite and</td><td> </td><td class="right">      [SP-800-56A] using the curve in the selected cipher suite and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      format it as a COSE_Key.  Let G_Y be the 'x' parameter of the</td><td> </td><td class="right">      format it as a COSE_Key.  Let G_Y be the 'x' parameter of the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      COSE_Key.</td><td> </td><td class="right">      COSE_Key.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0130"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Choose a connection identifier C_R and store it for the length of</td><td> </td><td class="rblock">   <span class="insert">*</span>  Choose a connection identifier C_R and store it for the length of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the protocol.</td><td> </td><td class="right">      the protocol.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0131"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Compute the transcript hash TH_2 = H(message_1, data_2) where H()</td><td> </td><td class="rblock">   <span class="insert">*</span>  Compute the transcript hash TH_2 = H(message_1, data_2) where H()</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      is the hash function in the selected cipher suite.  The transcript</td><td> </td><td class="right">      is the hash function in the selected cipher suite.  The transcript</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      hash TH_2 is a CBOR encoded bstr and the input to the hash</td><td> </td><td class="right">      hash TH_2 is a CBOR encoded bstr and the input to the hash</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      function is a CBOR Sequence.</td><td> </td><td class="right">      function is a CBOR Sequence.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0132"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Compute an inner COSE_Encrypt0 as defined in Section 5.3 of</td><td> </td><td class="rblock">   <span class="insert">*</span>  Compute an inner COSE_Encrypt0 as defined in Section 5.3 of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      [RFC8152], with the EDHOC AEAD algorithm in the selected cipher</td><td> </td><td class="right">      [RFC8152], with the EDHOC AEAD algorithm in the selected cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      suite, K_2m, IV_2m, and the following parameters:</td><td> </td><td class="right">      suite, K_2m, IV_2m, and the following parameters:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0133"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  protected = &lt;&lt; ID_CRED_R &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  protected = &lt;&lt; ID_CRED_R &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0134"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  ID_CRED_R - identifier to facilitate retrieval of CRED_R,</td><td> </td><td class="rblock">         <span class="insert">o</span>  ID_CRED_R - identifier to facilitate retrieval of CRED_R,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            see Section <span class="delete">4.2</span></td><td> </td><td class="rblock">            see Section <span class="insert">4.1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0135"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  external_aad = &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  external_aad = &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0136"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  CRED_R - bstr containing the credential of the Responder,</td><td> </td><td class="rblock">         <span class="insert">o</span>  CRED_R - bstr containing the credential of the Responder,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            see Section <span class="delete">4.2.</span></td><td> </td><td class="rblock">            see Section <span class="insert">4.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0137"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  AD_2 = bstr containing opaque unprotected auxiliary data</td><td> </td><td class="rblock">         <span class="insert">o</span>  AD_2 = bstr containing opaque unprotected auxiliary data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0138"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  plaintext = h''</td><td> </td><td class="rblock">      <span class="insert">-</span>  plaintext = h''</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      COSE constructs the input to the AEAD [RFC5116] as follows:</td><td> </td><td class="right">      COSE constructs the input to the AEAD [RFC5116] as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0139"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*  Key K = EDHOC-</span>KDF( PRK_3e2m, TH_2, "K_2m", length )</td><td> </td><td class="rblock">      <span class="insert">-  Key K = </span>KDF( PRK_3e2m, TH_2, "K_2m", length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0140"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*  Nonce N = EDHOC-</span>KDF( PRK_3e2m, TH_2, "IV_2m", length )</td><td> </td><td class="rblock">      <span class="insert">-  Nonce N = </span>KDF( PRK_3e2m, TH_2, "IV_2m", length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0141"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Plaintext P = 0x (the empty string)</td><td> </td><td class="rblock">      <span class="insert">-</span>  Plaintext P = 0x (the empty string)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0142"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Associated data A =</td><td> </td><td class="rblock">      <span class="insert">-</span>  Associated data A =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         [ "Encrypt0", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt; ]</td><td> </td><td class="right">         [ "Encrypt0", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt; ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      MAC_2 is the 'ciphertext' of the inner COSE_Encrypt0.</td><td> </td><td class="right">      MAC_2 is the 'ciphertext' of the inner COSE_Encrypt0.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0143"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  If the Reponder authenticates with a static Diffie-Hellman key</td><td> </td><td class="rblock">   <span class="insert">*</span>  If the Reponder authenticates with a static Diffie-Hellman key</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      (method equals 1 or 3), then Signature_or_MAC_2 is MAC_2.  If the</td><td> </td><td class="right">      (method equals 1 or 3), then Signature_or_MAC_2 is MAC_2.  If the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Reponder authenticates with a signature key (method equals 0 or</td><td> </td><td class="right">      Reponder authenticates with a signature key (method equals 0 or</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      2), then Signature_or_MAC_2 is the 'signature' of a COSE_Sign1</td><td> </td><td class="right">      2), then Signature_or_MAC_2 is the 'signature' of a COSE_Sign1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      object as defined in Section 4.4 of [RFC8152] using the signature</td><td> </td><td class="right">      object as defined in Section 4.4 of [RFC8152] using the signature</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      algorithm in the selected cipher suite, the private authentication</td><td> </td><td class="right">      algorithm in the selected cipher suite, the private authentication</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      key of the Responder, and the following parameters:</td><td> </td><td class="right">      key of the Responder, and the following parameters:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0144"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  protected = &lt;&lt; ID_CRED_R &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  protected = &lt;&lt; ID_CRED_R &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0145"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  external_aad = &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  external_aad = &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0146"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  payload = MAC_2</td><td> </td><td class="rblock">      <span class="insert">-</span>  payload = MAC_2</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      COSE constructs the input to the Signature Algorithm as:</td><td> </td><td class="right">      COSE constructs the input to the Signature Algorithm as:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0147"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  The key is the private authentication key of the Responder.</td><td> </td><td class="rblock">      <span class="insert">-</span>  The key is the private authentication key of the Responder.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0148"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  The message M to be signed =</td><td> </td><td class="rblock">      <span class="insert">-</span>  The message M to be signed =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         [ "Signature1", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;,</td><td> </td><td class="right">         [ "Signature1", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         MAC_2 ]</td><td> </td><td class="right">         MAC_2 ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0149"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a</td><td> </td><td class="rblock">   <span class="insert">*</span>  CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      plaintext with the following common parameters:</td><td> </td><td class="right">      plaintext with the following common parameters:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0150"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  plaintext = ( ID_CRED_R / bstr_identifier, Signature_or_MAC_2,</td><td> </td><td class="rblock">      <span class="insert">-</span>  plaintext = ( ID_CRED_R / bstr_identifier, Signature_or_MAC_2,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         ? AD_2 )</td><td> </td><td class="right">         ? AD_2 )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0151"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  Note that if ID_CRED_R contains a single 'kid' parameter,</td><td> </td><td class="rblock">         <span class="insert">o</span>  Note that if ID_CRED_R contains a single 'kid' parameter,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">            i.e., ID_CRED_R = { 4 : kid_R }, only the byte string kid_R</td><td> </td><td class="right">            i.e., ID_CRED_R = { 4 : kid_R }, only the byte string kid_R</td><td class="lineno"></td></tr>
      <tr id="diff0152"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            is conveyed in the plaintext encoded as <span class="delete">a</span> bstr_identifier,</td><td> </td><td class="rblock">            is conveyed in the plaintext encoded as <span class="insert">an</span> bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            see Section <span class="delete">4.2 and Section 4.3.</span></td><td> </td><td class="rblock">            see Section <span class="insert">4.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0153"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  CIPHERTEXT_2 = plaintext XOR K_2e</td><td> </td><td class="rblock">      <span class="insert">-</span>  CIPHERTEXT_2 = plaintext XOR K_2e</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0154"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  K_2e = <span class="delete">EDHOC-KDF(</span> PRK_2e, TH_2, "K_2e", length ), where length</td><td> </td><td class="rblock">      <span class="insert">-</span>  K_2e = <span class="insert">KDF(</span> PRK_2e, TH_2, "K_2e", length ), where length is the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         is the length of the plaintext.</td><td> </td><td class="rblock">         length of the plaintext.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0155"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Encode message_2 as a sequence of CBOR encoded data items as</td><td> </td><td class="rblock">   <span class="insert">*</span>  Encode message_2 as a sequence of CBOR encoded data items as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      specified in Section <span class="delete">4.5.1.</span></td><td> </td><td class="rblock">      specified in Section <span class="insert">4.3.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0156"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">5</span>.3.  Initiator Processing of Message 2</td><td> </td><td class="rblock">4.<span class="insert">3</span>.3.  Initiator Processing of Message 2</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator SHALL process message_2 as follows:</td><td> </td><td class="right">   The Initiator SHALL process message_2 as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0157"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Decode message_2 (see Appendix A.1).</td><td> </td><td class="rblock">   <span class="insert">*</span>  Decode message_2 (see Appendix A.1).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0158"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Retrieve the protocol state using the connection identifier C_I</td><td> </td><td class="rblock">   <span class="insert">*</span>  Retrieve the protocol state using the connection identifier C_I</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      and/or other external information such as the CoAP Token and the</td><td> </td><td class="right">      and/or other external information such as the CoAP Token and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      5-tuple.</td><td> </td><td class="right">      5-tuple.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0159"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Decrypt CIPHERTEXT_2.  The decryption process depends on the</td><td> </td><td class="rblock">   <span class="insert">*</span>  Decrypt CIPHERTEXT_2.  The decryption process depends on the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      method, see Section <span class="delete">4.5.2.</span></td><td> </td><td class="rblock">      method, see Section <span class="insert">4.3.2.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0160"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Verify that the identity of the Responder is <span class="delete">an</span> allowed <span class="delete">identity</span></td><td> </td><td class="rblock">   <span class="insert">*</span>  Verify that the identity of the Responder is <span class="insert">among the</span> allowed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      for this <span class="delete">connection, see Section 3.2.</span></td><td> </td><td class="rblock">      <span class="insert">identities</span> for this <span class="insert">connection.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0161"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Verify Signature_or_MAC_2 using the algorithm in the selected</td><td> </td><td class="rblock">   <span class="insert">*</span>  Verify Signature_or_MAC_2 using the algorithm in the selected</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      cipher suite.  The verification process depends on the method, see</td><td> </td><td class="right">      cipher suite.  The verification process depends on the method, see</td><td class="lineno"></td></tr>
      <tr id="diff0162"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      Section 4.<span class="delete">5</span>.2.</td><td> </td><td class="rblock">      Section 4.<span class="insert">3</span>.2.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0163"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Pass AD_2 to the security application.</td><td> </td><td class="rblock">   <span class="insert">*</span>  Pass AD_2 to the security application.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   If any verification step fails, the Responder MUST send an EDHOC</td><td> </td><td class="right">   If any verification step fails, the Responder MUST send an EDHOC</td><td class="lineno"></td></tr>
      <tr id="diff0164"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   error message back, formatted as defined in Section <span class="delete">5</span>, and the</td><td> </td><td class="rblock">   error message back, formatted as defined in Section <span class="insert">6</span>, and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protocol MUST be discontinued.</td><td> </td><td class="right">   protocol MUST be discontinued.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0165"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">6</span>.  EDHOC Message 3</td><td> </td><td class="rblock">4.<span class="insert">4</span>.  EDHOC Message 3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0166"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">6</span>.1.  Formatting of Message 3</td><td> </td><td class="rblock">4.<span class="insert">4</span>.1.  Formatting of Message 3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_3 and data_3 SHALL be CBOR Sequences (see Appendix A.1) as</td><td> </td><td class="right">   message_3 and data_3 SHALL be CBOR Sequences (see Appendix A.1) as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   defined below</td><td> </td><td class="right">   defined below</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_3 = (</td><td> </td><td class="right">   message_3 = (</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     data_3,</td><td> </td><td class="right">     data_3,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     CIPHERTEXT_3 : bstr,</td><td> </td><td class="right">     CIPHERTEXT_3 : bstr,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr id="diff0167"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                                         </span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   data_3 = (</td><td> </td><td class="right">   data_3 = (</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     ? C_R : bstr_identifier,</td><td> </td><td class="right">     ? C_R : bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0168"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">4.<span class="delete">6</span>.2.  Initiator Processing of Message 3</td><td> </td><td class="rblock">4.<span class="insert">4</span>.2.  Initiator Processing of Message 3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator SHALL compose message_3 as follows:</td><td> </td><td class="right">   The Initiator SHALL compose message_3 as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0169"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  If corr (METHOD_CORR mod 4) equals 2 or 3, C_R is omitted,</td><td> </td><td class="rblock">   <span class="insert">*</span>  If corr (METHOD_CORR mod 4) equals 2 or 3, C_R is omitted,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      otherwise C_R is not omitted.</td><td> </td><td class="right">      otherwise C_R is not omitted.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0170"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Compute the transcript hash TH_3 = H(TH_2 , CIPHERTEXT_2, data_3)</td><td> </td><td class="rblock">   <span class="insert">*</span>  Compute the transcript hash TH_3 = H(TH_2 , CIPHERTEXT_2, data_3)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      where H() is the hash function in the the selected cipher suite.</td><td> </td><td class="right">      where H() is the hash function in the the selected cipher suite.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      The transcript hash TH_3 is a CBOR encoded bstr and the input to</td><td> </td><td class="right">      The transcript hash TH_3 is a CBOR encoded bstr and the input to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the hash function is a CBOR Sequence.</td><td> </td><td class="right">      the hash function is a CBOR Sequence.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0171"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Compute an inner COSE_Encrypt0 as defined in Section 5.3 of</td><td> </td><td class="rblock">   <span class="insert">*</span>  Compute an inner COSE_Encrypt0 as defined in Section 5.3 of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      [RFC8152], with the EDHOC AEAD algorithm in the selected cipher</td><td> </td><td class="right">      [RFC8152], with the EDHOC AEAD algorithm in the selected cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      suite, K_3m, IV_3m, and the following parameters:</td><td> </td><td class="right">      suite, K_3m, IV_3m, and the following parameters:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0172"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  protected = &lt;&lt; ID_CRED_I &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  protected = &lt;&lt; ID_CRED_I &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0173"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  ID_CRED_I - identifier to facilitate retrieval of CRED_I,</td><td> </td><td class="rblock">         <span class="insert">o</span>  ID_CRED_I - identifier to facilitate retrieval of CRED_I,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            see Section <span class="delete">4.2</span></td><td> </td><td class="rblock">            see Section <span class="insert">4.1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0174"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  external_aad = &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  external_aad = &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0175"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  CRED_I - bstr containing the credential of the Initiator,</td><td> </td><td class="rblock">         <span class="insert">o</span>  CRED_I - bstr containing the credential of the Initiator,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            see Section <span class="delete">4.2.</span></td><td> </td><td class="rblock">            see Section <span class="insert">4.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0176"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  AD_3 = bstr containing opaque protected auxiliary data</td><td> </td><td class="rblock">         <span class="insert">o</span>  AD_3 = bstr containing opaque protected auxiliary data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0177"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  plaintext = h''</td><td> </td><td class="rblock">      <span class="insert">-</span>  plaintext = h''</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      COSE constructs the input to the AEAD [RFC5116] as follows:</td><td> </td><td class="right">      COSE constructs the input to the AEAD [RFC5116] as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0178"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*  Key K = EDHOC-</span>KDF( PRK_4x3m, TH_3, "K_3m", length )</td><td> </td><td class="rblock">      <span class="insert">-  Key K = </span>KDF( PRK_4x3m, TH_3, "K_3m", length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0179"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*  Nonce N = EDHOC-</span>KDF( PRK_4x3m, TH_3, "IV_3m", length )</td><td> </td><td class="rblock">      <span class="insert">-  Nonce N = </span>KDF( PRK_4x3m, TH_3, "IV_3m", length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0180"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Plaintext P = 0x (the empty string)</td><td> </td><td class="rblock">      <span class="insert">-</span>  Plaintext P = 0x (the empty string)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0181"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Associated data A =</td><td> </td><td class="rblock">      <span class="insert">-</span>  Associated data A =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         [ "Encrypt0", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt; ]</td><td> </td><td class="right">         [ "Encrypt0", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt; ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      MAC_3 is the 'ciphertext' of the inner COSE_Encrypt0.</td><td> </td><td class="right">      MAC_3 is the 'ciphertext' of the inner COSE_Encrypt0.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0182"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  If the Initiator authenticates with a static Diffie-Hellman key</td><td> </td><td class="rblock">   <span class="insert">*</span>  If the Initiator authenticates with a static Diffie-Hellman key</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      (method equals 2 or 3), then Signature_or_MAC_3 is MAC_3.  If the</td><td> </td><td class="right">      (method equals 2 or 3), then Signature_or_MAC_3 is MAC_3.  If the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Initiator authenticates with a signature key (method equals 0 or</td><td> </td><td class="right">      Initiator authenticates with a signature key (method equals 0 or</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      1), then Signature_or_MAC_3 is the 'signature' of a COSE_Sign1</td><td> </td><td class="right">      1), then Signature_or_MAC_3 is the 'signature' of a COSE_Sign1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      object as defined in Section 4.4 of [RFC8152] using the signature</td><td> </td><td class="right">      object as defined in Section 4.4 of [RFC8152] using the signature</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      algorithm in the selected cipher suite, the private authentication</td><td> </td><td class="right">      algorithm in the selected cipher suite, the private authentication</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      key of the Initiator, and the following parameters:</td><td> </td><td class="right">      key of the Initiator, and the following parameters:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0183"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  protected = &lt;&lt; ID_CRED_I &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  protected = &lt;&lt; ID_CRED_I &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0184"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  external_aad = &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;</td><td> </td><td class="rblock">      <span class="insert">-</span>  external_aad = &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0185"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  payload = MAC_3</td><td> </td><td class="rblock">      <span class="insert">-</span>  payload = MAC_3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      COSE constructs the input to the Signature Algorithm as:</td><td> </td><td class="right">      COSE constructs the input to the Signature Algorithm as:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0186"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  The key is the private authentication key of the Initiator.</td><td> </td><td class="rblock">      <span class="insert">-</span>  The key is the private authentication key of the Initiator.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0187"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  The message M to be signed =</td><td> </td><td class="rblock">      <span class="insert">-</span>  The message M to be signed =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         [ "Signature1", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;,</td><td> </td><td class="right">         [ "Signature1", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         MAC_3 ]</td><td> </td><td class="right">         MAC_3 ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0188"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Compute an outer COSE_Encrypt0 as defined in Section 5.3 of</td><td> </td><td class="rblock">   <span class="insert">*</span>  Compute an outer COSE_Encrypt0 as defined in Section 5.3 of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      [RFC8152], with the EDHOC AEAD algorithm in the selected cipher</td><td> </td><td class="right">      [RFC8152], with the EDHOC AEAD algorithm in the selected cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      suite, K_3ae, IV_3ae, and the following parameters.  The protected</td><td> </td><td class="right">      suite, K_3ae, IV_3ae, and the following parameters.  The protected</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      header SHALL be empty.</td><td> </td><td class="right">      header SHALL be empty.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0189"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  external_aad = TH_3</td><td> </td><td class="rblock">      <span class="insert">-</span>  external_aad = TH_3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0190"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  plaintext = ( ID_CRED_I / bstr_identifier, Signature_or_MAC_3,</td><td> </td><td class="rblock">      <span class="insert">-</span>  plaintext = ( ID_CRED_I / bstr_identifier, Signature_or_MAC_3,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         ? AD_3 )</td><td> </td><td class="right">         ? AD_3 )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0191"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">         <span class="delete">+</span>  Note that if ID_CRED_I contains a single 'kid' parameter,</td><td> </td><td class="rblock">         <span class="insert">o</span>  Note that if ID_CRED_I contains a single 'kid' parameter,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">            i.e., ID_CRED_I = { 4 : kid_I }, only the byte string kid_I</td><td> </td><td class="right">            i.e., ID_CRED_I = { 4 : kid_I }, only the byte string kid_I</td><td class="lineno"></td></tr>
      <tr id="diff0192"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            is conveyed in the plaintext encoded as <span class="delete">a</span> bstr_identifier,</td><td> </td><td class="rblock">            is conveyed in the plaintext encoded as <span class="insert">an</span> bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">            see Section <span class="delete">4.2 and Section 4.3.</span></td><td> </td><td class="rblock">            see Section <span class="insert">4.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      COSE constructs the input to the AEAD [RFC5116] as follows:</td><td> </td><td class="right">      COSE constructs the input to the AEAD [RFC5116] as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0193"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*  Key K = EDHOC-</span>KDF( PRK_3e2m, TH_3, "K_3ae", length )</td><td> </td><td class="rblock">      <span class="insert">-  Key K = </span>KDF( PRK_3e2m, TH_3, "K_3ae", length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0194"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*  Nonce N = EDHOC-</span>KDF( PRK_3e2m, TH_3, "IV_3ae", length )</td><td> </td><td class="rblock">      <span class="insert">-  Nonce N = </span>KDF( PRK_3e2m, TH_3, "IV_3ae", length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0195"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Plaintext P = ( ID_CRED_I / bstr_identifier,</td><td> </td><td class="rblock">      <span class="insert">-</span>  Plaintext P = ( ID_CRED_I / bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         Signature_or_MAC_3, ? AD_3 )</td><td> </td><td class="right">         Signature_or_MAC_3, ? AD_3 )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0196"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Associated data A = [ "Encrypt0", h'', TH_3 ]</td><td> </td><td class="rblock">      <span class="insert">-</span>  Associated data A = [ "Encrypt0", h'', TH_3 ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      CIPHERTEXT_3 is the 'ciphertext' of the outer COSE_Encrypt0.</td><td> </td><td class="right">      CIPHERTEXT_3 is the 'ciphertext' of the outer COSE_Encrypt0.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0197"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Encode message_3 as a sequence of CBOR encoded data items as</td><td> </td><td class="rblock">   <span class="insert">*</span>  Encode message_3 as a sequence of CBOR encoded data items as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      specified in Section <span class="delete">4.6.1.</span></td><td> </td><td class="rblock">      specified in Section <span class="insert">4.4.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Pass the connection identifiers (C_I, C_R) and the application</td><td> </td><td class="right">   Pass the connection identifiers (C_I, C_R) and the application</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   algorithms in the selected cipher suite to the application.  The</td><td> </td><td class="right">   algorithms in the selected cipher suite to the application.  The</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   application can now derive application keys using the EDHOC-Exporter</td><td> </td><td class="right">   application can now derive application keys using the EDHOC-Exporter</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   interface.</td><td> </td><td class="right">   interface.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0198"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">After sending message_3, the Initiator is assured that no other party</span></td><td> </td><td class="rblock"><span class="insert">4.4.3.</span>  Responder Processing of Message 3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   than the Responder can compute the key PRK_4x3m (implicit key</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   authentication).  The Initiator does however not know that the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Responder has actually computed the key PRK_4x3m.  While the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator can securely send protected application data, the Initiator</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   SHOULD NOT store the keying material PRK_4x3m and TH_4 until the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator is assured that the Responder has actually computed the key</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   PRK_4x3m (explicit key confirmation).  Explicit key confirmation is</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   e.g. assured when the Initiator has verified an OSCORE message from</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the Responder.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">4.6.3.</span>  Responder Processing of Message 3</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Responder SHALL process message_3 as follows:</td><td> </td><td class="right">   The Responder SHALL process message_3 as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0199"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Decode message_3 (see Appendix A.1).</td><td> </td><td class="rblock">   <span class="insert">*</span>  Decode message_3 (see Appendix A.1).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0200"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Retrieve the protocol state using the connection identifier C_R</td><td> </td><td class="rblock">   <span class="insert">*</span>  Retrieve the protocol state using the connection identifier C_R</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      and/or other external information such as the CoAP Token and the</td><td> </td><td class="right">      and/or other external information such as the CoAP Token and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      5-tuple.</td><td> </td><td class="right">      5-tuple.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0201"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Decrypt and verify the outer COSE_Encrypt0 as defined in</td><td> </td><td class="rblock">   <span class="insert">*</span>  Decrypt and verify the outer COSE_Encrypt0 as defined in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Section 5.3 of [RFC8152], with the EDHOC AEAD algorithm in the</td><td> </td><td class="right">      Section 5.3 of [RFC8152], with the EDHOC AEAD algorithm in the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      selected cipher suite, K_3ae, and IV_3ae.</td><td> </td><td class="right">      selected cipher suite, K_3ae, and IV_3ae.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0202"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Verify that the identity of the Initiator is <span class="delete">an</span> allowed <span class="delete">identity</span></td><td> </td><td class="rblock">   <span class="insert">*</span>  Verify that the identity of the Initiator is <span class="insert">among the</span> allowed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      for this <span class="delete">connection, see Section 3.2.</span></td><td> </td><td class="rblock">      <span class="insert">identities</span> for this <span class="insert">connection.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0203"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Verify Signature_or_MAC_3 using the algorithm in the selected</td><td> </td><td class="rblock">   <span class="insert">*</span>  Verify Signature_or_MAC_3 using the algorithm in the selected</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      cipher suite.  The verification process depends on the method, see</td><td> </td><td class="right">      cipher suite.  The verification process depends on the method, see</td><td class="lineno"></td></tr>
      <tr id="diff0204"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      Section 4.<span class="delete">6</span>.2.</td><td> </td><td class="rblock">      Section 4.<span class="insert">4</span>.2.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0205"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Pass AD_3, the connection identifiers (C_I, C_R), and the</td><td> </td><td class="rblock">   <span class="insert">*</span>  Pass AD_3, the connection identifiers (C_I, C_R), and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      application algorithms in the selected cipher suite to the</td><td> </td><td class="right">      application algorithms in the selected cipher suite to the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      security application.  The application can now derive application</td><td> </td><td class="right">      security application.  The application can now derive application</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      keys using the EDHOC-Exporter interface.</td><td> </td><td class="right">      keys using the EDHOC-Exporter interface.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   If any verification step fails, the Responder MUST send an EDHOC</td><td> </td><td class="right">   If any verification step fails, the Responder MUST send an EDHOC</td><td class="lineno"></td></tr>
      <tr id="diff0206"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   error message back, formatted as defined in Section <span class="delete">5</span>, and the</td><td> </td><td class="rblock">   error message back, formatted as defined in Section <span class="insert">6</span>, and the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protocol MUST be discontinued.</td><td> </td><td class="right">   protocol MUST be discontinued.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0207"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">After verifying message_3, the Responder is assured that the</span></td><td> </td><td class="rblock"><span class="insert">5.  EDHOC Authenticated with Symmetric Keys</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator has calculated the key PRK_4x3m (explicit key confirmation)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   and that no other party than the Responder can compute the key.  The</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Responder can securely send protected application data and store the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   keying material PRK_4x3m and TH_4.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0208"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">5.<span class="delete">  Error Handling</span></td><td> </td><td class="rblock">5.<span class="insert">1.  Overview</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0209"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">5.1.</span>  EDHOC Error Message</td><td> </td><td class="rblock">   <span class="insert">EDHOC supports authentication with pre-shared keys (authentication</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   method = 4, see Section 9.2).  The Initiator and the Responder are</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   assumed to have a pre-shared key (PSK) with a good amount of</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   randomness and the requirement that:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  Only the Initiator and the Responder SHALL have access to the PSK,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  The Responder is able to retrieve the PSK using ID_PSK.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   where the identifier ID_PSK is a COSE header_map (i.e. a CBOR map</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   containing COSE Common Header Parameters, see [RFC8152]) containing</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   COSE header parameter that can identify a pre-shared key.  Pre-shared</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   keys are typically stored as COSE_Key objects and identified with a</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   'kid' parameter (see [RFC8152]):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  ID_PSK = { 4 : kid_psk } , where kid_psk : bstr</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The purpose of ID_PSK is to facilitate retrieval of the PSK and in</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the case a 'kid' parameter is used it may be very short.  It is</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   RECOMMENDED that it uniquely identify the PSK as the recipient may</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   otherwise have to try several keys.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   EDHOC with symmetric key authentication is illustrated in Figure 5.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Initiator                                                   Responder</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |           METHOD_CORR, SUITES_I, G_X, C_I, ID_PSK, AD_1           |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   +------------------------------------------------------------------&gt;|</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |                             message_1                             |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |                                                                   |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |               C_I, G_Y, C_R, AEAD(K_2ae; TH_2, AD_2)              |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |&lt;------------------------------------------------------------------+</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |                             message_2                             |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |                                                                   |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |                    C_R, AEAD(K_3ae; TH_3, AD_3)                   |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   +------------------------------------------------------------------&gt;|</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |                             message_3                             |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Figure 5: Overview of EDHOC with symmetric key authentication.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   EDHOC with symmetric key authentication is very similar to EDHOC with</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   asymmetric authentication.  In the following subsections the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   differences compared to EDHOC with asymmetric authentication are</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   described.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">5.2.  EDHOC Message 1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">5.2.1.  Formatting of Message 1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_1 SHALL be a CBOR Sequence (see Appendix A.1) as defined</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   below</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_1 = (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     METHOD_CORR : int,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     SUITES_I : [ index : uint, 2* suite ] / suite,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     G_X : bstr,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     C_I :  bstr_identifier,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     ID_PSK : header_map / bstr_identifier,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     ? AD_1 : bstr,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   where:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  METHOD_CORR = 4 * method + corr, where method = 4 and the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      connection parameter corr is chosen based on the transport and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      determines which connection identifiers that are omitted (see</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      Section 3.1).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  ID_PSK - identifier to facilitate retrieval of the pre-shared key.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      If ID_PSK contains a single 'kid' parameter, i.e., ID_PSK = { 4 :</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      kid_psk }, only the byte string kid_psk is conveyed encoded as an</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      bstr_identifier.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">5.3.  EDHOC Message 2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">5.3.1.  Processing of Message 2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  Signature_or_MAC_2 is not used.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  The outer COSE_Encrypt0 is computed as defined in Section 5.3 of</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      [RFC8152], with the EDHOC AEAD algorithm in the selected cipher</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      suite, K_2ae, IV_2ae, and the following parameters.  The protected</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      header SHALL be empty.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  plaintext = ? AD_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         o  AD_2 = bstr containing opaque unprotected auxiliary data</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  external_aad = TH_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      COSE constructs the input to the AEAD [RFC5116] as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Key K = KDF( PRK_2e, TH_2, "K_2ae", length )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Nonce N = KDF( PRK_2e, TH_2, "IV_2ae", length )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Plaintext P = ? AD_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Associated data A = [ "Encrypt0", h'', TH_2 ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">5.4.  EDHOC Message 3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">5.4.1.  Processing of Message 3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  Signature_or_MAC_3 is not used.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  COSE_Encrypt0 is computed as defined in Section 5.3 of [RFC8152],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      with the EDHOC AEAD algorithm in the selected cipher suite, K_3ae,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      IV_3ae, and the following parameters.  The protected header SHALL</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      be empty.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  plaintext = ? AD_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         o  AD_3 = bstr containing opaque protected auxiliary data</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  external_aad = TH_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      COSE constructs the input to the AEAD [RFC5116] as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Key K = KDF( PRK_3e2m, TH_3, "K_3ae", length )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Nonce N = KDF( PRK_3e2m, TH_3, "IV_3ae", length )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Plaintext P = ? AD_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -  Associated data A = [ "Encrypt0", h'', TH_3 ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">6.  Error Handling</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">6.1.</span>  EDHOC Error Message</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This section defines a message format for the EDHOC error message,</td><td> </td><td class="right">   This section defines a message format for the EDHOC error message,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   used during the protocol.  An EDHOC error message can be sent by both</td><td> </td><td class="right">   used during the protocol.  An EDHOC error message can be sent by both</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   parties as a reply to any non-error EDHOC message.  After sending an</td><td> </td><td class="right">   parties as a reply to any non-error EDHOC message.  After sending an</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   error message, the protocol MUST be discontinued.  Errors at the</td><td> </td><td class="right">   error message, the protocol MUST be discontinued.  Errors at the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC layer are sent as normal successful messages in the lower</td><td> </td><td class="right">   EDHOC layer are sent as normal successful messages in the lower</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   layers (e.g.  CoAP POST and 2.04 Changed).  An advantage of using</td><td> </td><td class="right">   layers (e.g.  CoAP POST and 2.04 Changed).  An advantage of using</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   such a construction is to avoid issues created by usage of cross</td><td> </td><td class="right">   such a construction is to avoid issues created by usage of cross</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protocol proxies (e.g.  UDP to TCP).</td><td> </td><td class="right">   protocol proxies (e.g.  UDP to TCP).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   error SHALL be a CBOR Sequence (see Appendix A.1) as defined below</td><td> </td><td class="right">   error SHALL be a CBOR Sequence (see Appendix A.1) as defined below</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   error = (</td><td> </td><td class="right">   error = (</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     ? C_x : bstr_identifier,</td><td> </td><td class="right">     ? C_x : bstr_identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">     ERR_MSG : tstr,</td><td> </td><td class="right">     ERR_MSG : tstr,</td><td class="lineno"></td></tr>
      <tr id="diff0210"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     ? SUITES_R : [ supported : 2* suite ] / suite,</td><td> </td><td class="rblock">     ? SUITES_R : [ supported : 2* suite ] / su<span class="insert">pported : su</span>ite,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   where:</td><td> </td><td class="right">   where:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0211"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  C_x - <span class="delete">variable length connection identifier, encoded as a</span></td><td> </td><td class="rblock">   <span class="insert">*</span>  C_x - <span class="insert">if</span> error is sent by the Responder and corr (METHOD_CORR mod</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      bstr_identifier (see Section 4.3).  If</span> error is sent by the</td><td> </td><td class="rblock">      4) equals 0 or 2 then C_x is set to C_I, else if error is sent by</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      Responder and corr (METHOD_CORR mod 4) equals 0 or 2 then C_x is</td><td> </td><td class="rblock">      the Initiator and corr (METHOD_CORR mod 4) equals 0 or 1 then C_x</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      set to C_I, else if error is sent by the Initiator and corr</td><td> </td><td class="rblock">      is set to C_R, else C_x is omitted.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      (METHOD_CORR mod 4) equals 0 or 1 then C_x is set to C_R, else C_x</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      is omitted.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0212"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  ERR_MSG - text string containing the diagnostic payload, defined</td><td> </td><td class="rblock">   <span class="insert">*</span>  ERR_MSG - text string containing the diagnostic payload, defined</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      in the same way as in Section 5.5.2 of [RFC7252].  ERR_MSG MAY be</td><td> </td><td class="right">      in the same way as in Section 5.5.2 of [RFC7252].  ERR_MSG MAY be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      a 0-length text string.</td><td> </td><td class="right">      a 0-length text string.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0213"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  SUITES_R - cipher suites from SUITES_I or the EDHOC cipher suites</td><td> </td><td class="rblock">   <span class="insert">*</span>  SUITES_R - cipher suites from SUITES_I or the EDHOC cipher suites</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      registry that the Responder supports.  SUITES_R MUST only be</td><td> </td><td class="right">      registry that the Responder supports.  SUITES_R MUST only be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      included in replies to message_1.  If a single supported cipher</td><td> </td><td class="right">      included in replies to message_1.  If a single supported cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      suite is conveyed then the supported cipher suite is encoded as an</td><td> </td><td class="right">      suite is conveyed then the supported cipher suite is encoded as an</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      int instead of an array.</td><td> </td><td class="right">      int instead of an array.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0214"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">After receiving SUITES_R, the Initiator can determine which selected</span></td><td> </td><td class="rblock"><span class="insert">6.1.1.</span>  Example Use of EDHOC Error Message with SUITES_R</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   cipher suite to use for the next EDHOC run with the Responder.  If</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the Initiator intends to contact the Responder in the future, the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator SHOULD remember which selected cipher suite to use until</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the next message_1 has been sent, otherwise the Initiator and</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Responder will likely run into an infinite loop.  After a successful</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   run of EDHOC, the Initiator MAY remember the selected cipher suite to</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   use in future EDHOC runs.  Note that if the Initiator or Responder is</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   updated with new cipher suite policies, any cached information may be</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   outdated.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">5.1.1.</span>  Example Use of EDHOC Error Message with SUITES_R</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Assuming that the Initiator supports the five cipher suites 5, 6, 7,</td><td> </td><td class="right">   Assuming that the Initiator supports the five cipher suites 5, 6, 7,</td><td class="lineno"></td></tr>
      <tr id="diff0215"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   8, and 9 in decreasing order of preference, Figures <span class="delete">5 and 6</span> show</td><td> </td><td class="rblock">   8, and 9 in decreasing order of preference, Figures <span class="insert">6 and 7</span> show</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   examples of how the Responder can truncate SUITES_I and how SUITES_R</td><td> </td><td class="right">   examples of how the Responder can truncate SUITES_I and how SUITES_R</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   is used by the Responder to give the Initiator information about the</td><td> </td><td class="right">   is used by the Responder to give the Initiator information about the</td><td class="lineno"></td></tr>
      <tr id="diff0216"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   cipher suites that the Responder supports.  In Figure <span class="delete">5</span>, the</td><td> </td><td class="rblock">   cipher suites that the Responder supports.  In Figure <span class="insert">6</span>, the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Responder supports cipher suite 6 but not the selected cipher suite</td><td> </td><td class="right">   Responder supports cipher suite 6 but not the selected cipher suite</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   5.</td><td> </td><td class="right">   5.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Initiator                                                   Responder</td><td> </td><td class="right">   Initiator                                                   Responder</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |        METHOD_CORR, SUITES_I = [5, 5, 6, 7], G_X, C_I, AD_1       |</td><td> </td><td class="right">   |        METHOD_CORR, SUITES_I = [5, 5, 6, 7], G_X, C_I, AD_1       |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   +------------------------------------------------------------------&gt;|</td><td> </td><td class="right">   +------------------------------------------------------------------&gt;|</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                             message_1                             |</td><td> </td><td class="right">   |                             message_1                             |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                                                                   |</td><td> </td><td class="right">   |                                                                   |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                     C_I, ERR_MSG, SUITES_R = 6                    |</td><td> </td><td class="right">   |                     C_I, ERR_MSG, SUITES_R = 6                    |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |&lt;------------------------------------------------------------------+</td><td> </td><td class="right">   |&lt;------------------------------------------------------------------+</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                               error                               |</td><td> </td><td class="right">   |                               error                               |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                                                                   |</td><td> </td><td class="right">   |                                                                   |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |         METHOD_CORR, SUITES_I = [6, 5, 6], G_X, C_I, AD_1         |</td><td> </td><td class="right">   |         METHOD_CORR, SUITES_I = [6, 5, 6], G_X, C_I, AD_1         |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   +------------------------------------------------------------------&gt;|</td><td> </td><td class="right">   +------------------------------------------------------------------&gt;|</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                             message_1                             |</td><td> </td><td class="right">   |                             message_1                             |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0217"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">           Figure <span class="delete">5</span>: Example use of error message with SUITES_R.</td><td> </td><td class="rblock">           Figure <span class="insert">6</span>: Example use of error message with SUITES_R.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0218"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   In Figure <span class="delete">6</span>, the Responder supports cipher suite 7 but not cipher</td><td> </td><td class="rblock">   In Figure <span class="insert">7</span>, the Responder supports cipher suite 7 but not cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   suites 5 and 6.</td><td> </td><td class="right">   suites 5 and 6.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Initiator                                                   Responder</td><td> </td><td class="right">   Initiator                                                   Responder</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |         METHOD_CORR, SUITES_I = [5, 5, 6], G_X, C_I, AD_1         |</td><td> </td><td class="right">   |         METHOD_CORR, SUITES_I = [5, 5, 6], G_X, C_I, AD_1         |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   +------------------------------------------------------------------&gt;|</td><td> </td><td class="right">   +------------------------------------------------------------------&gt;|</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                             message_1                             |</td><td> </td><td class="right">   |                             message_1                             |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                                                                   |</td><td> </td><td class="right">   |                                                                   |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                  C_I, ERR_MSG, SUITES_R = [7, 9]                  |</td><td> </td><td class="right">   |                  C_I, ERR_MSG, SUITES_R = [7, 9]                  |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |&lt;------------------------------------------------------------------+</td><td> </td><td class="right">   |&lt;------------------------------------------------------------------+</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                               error                               |</td><td> </td><td class="right">   |                               error                               |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                                                                   |</td><td> </td><td class="right">   |                                                                   |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |        METHOD_CORR, SUITES_I = [7, 5, 6, 7], G_X, C_I, AD_1       |</td><td> </td><td class="right">   |        METHOD_CORR, SUITES_I = [7, 5, 6, 7], G_X, C_I, AD_1       |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   +------------------------------------------------------------------&gt;|</td><td> </td><td class="right">   +------------------------------------------------------------------&gt;|</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |                             message_1                             |</td><td> </td><td class="right">   |                             message_1                             |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0219"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">           Figure <span class="delete">6</span>: Example use of error message with SUITES_R.</td><td> </td><td class="rblock">           Figure <span class="insert">7</span>: Example use of error message with SUITES_R.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   As the Initiator's list of supported cipher suites and order of</td><td> </td><td class="right">   As the Initiator's list of supported cipher suites and order of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   preference is fixed, and the Responder only accepts message_1 if the</td><td> </td><td class="right">   preference is fixed, and the Responder only accepts message_1 if the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   selected cipher suite is the first cipher suite in SUITES_I that the</td><td> </td><td class="right">   selected cipher suite is the first cipher suite in SUITES_I that the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Responder supports, the parties can verify that the selected cipher</td><td> </td><td class="right">   Responder supports, the parties can verify that the selected cipher</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   suite is the most preferred (by the Initiator) cipher suite supported</td><td> </td><td class="right">   suite is the most preferred (by the Initiator) cipher suite supported</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   by both parties.  If the selected cipher suite is not the first</td><td> </td><td class="right">   by both parties.  If the selected cipher suite is not the first</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   cipher suite in SUITES_I that the Responder supports, the Responder</td><td> </td><td class="right">   cipher suite in SUITES_I that the Responder supports, the Responder</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   will discontinue the protocol.</td><td> </td><td class="right">   will discontinue the protocol.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0220"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">6</span>.  Transferring EDHOC and Deriving an OSCORE Context</td><td> </td><td class="rblock"><span class="insert">7</span>.  Transferring EDHOC and Deriving an OSCORE Context</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0221"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">6</span>.1.  Transferring EDHOC in CoAP</td><td> </td><td class="rblock"><span class="insert">7</span>.1.  Transferring EDHOC in CoAP</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   It is recommended to transport EDHOC as an exchange of CoAP [RFC7252]</td><td> </td><td class="right">   It is recommended to transport EDHOC as an exchange of CoAP [RFC7252]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   messages.  CoAP is a reliable transport that can preserve packet</td><td> </td><td class="right">   messages.  CoAP is a reliable transport that can preserve packet</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   ordering and handle message duplication.  CoAP can also perform</td><td> </td><td class="right">   ordering and handle message duplication.  CoAP can also perform</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   fragmentation and protect against denial of service attacks.  It is</td><td> </td><td class="right">   fragmentation and protect against denial of service attacks.  It is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   recommended to carry the EDHOC messages in Confirmable messages,</td><td> </td><td class="right">   recommended to carry the EDHOC messages in Confirmable messages,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   especially if fragmentation is used.</td><td> </td><td class="right">   especially if fragmentation is used.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   By default, the CoAP client is the Initiator and the CoAP server is</td><td> </td><td class="right">   By default, the CoAP client is the Initiator and the CoAP server is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the Responder, but the roles SHOULD be chosen to protect the most</td><td> </td><td class="right">   the Responder, but the roles SHOULD be chosen to protect the most</td><td class="lineno"></td></tr>
      <tr id="diff0222"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   sensitive identity, see Section <span class="delete">7</span>.  By default, EDHOC is transferred</td><td> </td><td class="rblock">   sensitive identity, see Section <span class="insert">8</span>.  By default, EDHOC is transferred</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   in POST requests and 2.04 (Changed) responses to the Uri-Path:</td><td> </td><td class="right">   in POST requests and 2.04 (Changed) responses to the Uri-Path:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   "/.well-known/edhoc", but an application may define its own path that</td><td> </td><td class="right">   "/.well-known/edhoc", but an application may define its own path that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   can be discovered e.g. using resource directory</td><td> </td><td class="right">   can be discovered e.g. using resource directory</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-core-resource-directory].</td><td> </td><td class="right">   [I-D.ietf-core-resource-directory].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   By default, the message flow is as follows: EDHOC message_1 is sent</td><td> </td><td class="right">   By default, the message flow is as follows: EDHOC message_1 is sent</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   in the payload of a POST request from the client to the server's</td><td> </td><td class="right">   in the payload of a POST request from the client to the server's</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   resource for EDHOC.  EDHOC message_2 or the EDHOC error message is</td><td> </td><td class="right">   resource for EDHOC.  EDHOC message_2 or the EDHOC error message is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   sent from the server to the client in the payload of a 2.04 (Changed)</td><td> </td><td class="right">   sent from the server to the client in the payload of a 2.04 (Changed)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   response.  EDHOC message_3 or the EDHOC error message is sent from</td><td> </td><td class="right">   response.  EDHOC message_3 or the EDHOC error message is sent from</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the client to the server's resource in the payload of a POST request.</td><td> </td><td class="right">   the client to the server's resource in the payload of a POST request.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   If needed, an EDHOC error message is sent from the server to the</td><td> </td><td class="right">   If needed, an EDHOC error message is sent from the server to the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   client in the payload of a 2.04 (Changed) response.</td><td> </td><td class="right">   client in the payload of a 2.04 (Changed) response.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   An example of a successful EDHOC exchange using CoAP is shown in</td><td> </td><td class="right">   An example of a successful EDHOC exchange using CoAP is shown in</td><td class="lineno"></td></tr>
      <tr id="diff0223"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Figure <span class="delete">7</span>.  In this case the CoAP Token enables the Initiator to</td><td> </td><td class="rblock">   Figure <span class="insert">8</span>.  In this case the CoAP Token enables the Initiator to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   correlate message_1 and message_2 so the correlation parameter corr =</td><td> </td><td class="right">   correlate message_1 and message_2 so the correlation parameter corr =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   1.</td><td> </td><td class="right">   1.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">             Client    Server</td><td> </td><td class="right">             Client    Server</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               +---------&gt;| Header: POST (Code=0.02)</td><td> </td><td class="right">               +---------&gt;| Header: POST (Code=0.02)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td> </td><td class="right">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          | Content-Format: application/edhoc</td><td> </td><td class="right">               |          | Content-Format: application/edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          | Payload: EDHOC message_1</td><td> </td><td class="right">               |          | Payload: EDHOC message_1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-5" class="change"><td></td><th><small>skipping to change at</small><a href="#part-5"><em> page 30, line 33<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-5"><em> page 32, line 25<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               +---------&gt;| Header: POST (Code=0.02)</td><td> </td><td class="right">               +---------&gt;| Header: POST (Code=0.02)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td> </td><td class="right">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          | Content-Format: application/edhoc</td><td> </td><td class="right">               |          | Content-Format: application/edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          | Payload: EDHOC message_3</td><td> </td><td class="right">               |          | Payload: EDHOC message_3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |&lt;---------+ Header: 2.04 Changed</td><td> </td><td class="right">               |&lt;---------+ Header: 2.04 Changed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |   2.04   |</td><td> </td><td class="right">               |   2.04   |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0224"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                   <span class="delete">Figure 7</span>: Transferring EDHOC in CoAP</td><td> </td><td class="rblock">                   <span class="insert"> Figure 8</span>: Transferring EDHOC in CoAP</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0225"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The exchange in Figure <span class="delete">7</span> protects the client identity against active</td><td> </td><td class="rblock">   The exchange in Figure <span class="insert">8</span> protects the client identity against active</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   attackers and the server identity against passive attackers.  An</td><td> </td><td class="right">   attackers and the server identity against passive attackers.  An</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   alternative exchange that protects the server identity against active</td><td> </td><td class="right">   alternative exchange that protects the server identity against active</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   attackers and the client identity against passive attackers is shown</td><td> </td><td class="right">   attackers and the client identity against passive attackers is shown</td><td class="lineno"></td></tr>
      <tr id="diff0226"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   in Figure <span class="delete">8</span>.  In this case the CoAP Token enables the Responder to</td><td> </td><td class="rblock">   in Figure <span class="insert">9</span>.  In this case the CoAP Token enables the Responder to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   correlate message_2 and message_3 so the correlation parameter corr =</td><td> </td><td class="right">   correlate message_2 and message_3 so the correlation parameter corr =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   2.</td><td> </td><td class="right">   2.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">             Client    Server</td><td> </td><td class="right">             Client    Server</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               +---------&gt;| Header: POST (Code=0.02)</td><td> </td><td class="right">               +---------&gt;| Header: POST (Code=0.02)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td> </td><td class="right">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |&lt;---------+ Header: 2.04 Changed</td><td> </td><td class="right">               |&lt;---------+ Header: 2.04 Changed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |   2.04   | Content-Format: application/edhoc</td><td> </td><td class="right">               |   2.04   | Content-Format: application/edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-6" class="change"><td></td><th><small>skipping to change at</small><a href="#part-6"><em> page 31, line 23<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-6"><em> page 33, line 4<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               +---------&gt;| Header: POST (Code=0.02)</td><td> </td><td class="right">               +---------&gt;| Header: POST (Code=0.02)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td> </td><td class="right">               |   POST   | Uri-Path: "/.well-known/edhoc"</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          | Content-Format: application/edhoc</td><td> </td><td class="right">               |          | Content-Format: application/edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          | Payload: EDHOC message_2</td><td> </td><td class="right">               |          | Payload: EDHOC message_2</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |&lt;---------+ Header: 2.04 Changed</td><td> </td><td class="right">               |&lt;---------+ Header: 2.04 Changed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |   2.04   | Content-Format: application/edhoc</td><td> </td><td class="right">               |   2.04   | Content-Format: application/edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          | Payload: EDHOC message_3</td><td> </td><td class="right">               |          | Payload: EDHOC message_3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">               |          |</td><td> </td><td class="right">               |          |</td><td class="lineno"></td></tr>
      <tr id="diff0227"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock">                    Figure <span class="insert">9:</span> Transferring EDHOC in CoAP</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                   Figure <span class="delete">8:</span> Transferring EDHOC in CoAP</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   To protect against denial-of-service attacks, the CoAP server MAY</td><td> </td><td class="right">   To protect against denial-of-service attacks, the CoAP server MAY</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   respond to the first POST request with a 4.01 (Unauthorized)</td><td> </td><td class="right">   respond to the first POST request with a 4.01 (Unauthorized)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   containing an Echo option [I-D.ietf-core-echo-request-tag].  This</td><td> </td><td class="right">   containing an Echo option [I-D.ietf-core-echo-request-tag].  This</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   forces the initiator to demonstrate its reachability at its apparent</td><td> </td><td class="right">   forces the initiator to demonstrate its reachability at its apparent</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   network address.  If message fragmentation is needed, the EDHOC</td><td> </td><td class="right">   network address.  If message fragmentation is needed, the EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   messages may be fragmented using the CoAP Block-Wise Transfer</td><td> </td><td class="right">   messages may be fragmented using the CoAP Block-Wise Transfer</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   mechanism [RFC7959].</td><td> </td><td class="right">   mechanism [RFC7959].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0228"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">6</span>.1.1.  Deriving an OSCORE Context from EDHOC</td><td> </td><td class="rblock"><span class="insert">7</span>.1.1.  Deriving an OSCORE Context from EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   When EDHOC is used to derive parameters for OSCORE [RFC8613], the</td><td> </td><td class="right">   When EDHOC is used to derive parameters for OSCORE [RFC8613], the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   parties make sure that the EDHOC connection identifiers are unique,</td><td> </td><td class="right">   parties make sure that the EDHOC connection identifiers are unique,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   i.e. C_R MUST NOT be equal to C_I.  The CoAP client and server MUST</td><td> </td><td class="right">   i.e. C_R MUST NOT be equal to C_I.  The CoAP client and server MUST</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   be able to retrieve the OSCORE protocol state using its chosen</td><td> </td><td class="right">   be able to retrieve the OSCORE protocol state using its chosen</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   connection identifier and optionally other information such as the</td><td> </td><td class="right">   connection identifier and optionally other information such as the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   5-tuple.  In case that the CoAP client is the Initiator and the CoAP</td><td> </td><td class="right">   5-tuple.  In case that the CoAP client is the Initiator and the CoAP</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   server is the Responder:</td><td> </td><td class="right">   server is the Responder:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0229"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The client's OSCORE Sender ID is C_R and the server's OSCORE</td><td> </td><td class="rblock">   <span class="insert">*</span>  The client's OSCORE Sender ID is C_R and the server's OSCORE</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Sender ID is C_I, as defined in this document</td><td> </td><td class="right">      Sender ID is C_I, as defined in this document</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0230"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The AEAD Algorithm and the hash algorithm are the application AEAD</td><td> </td><td class="rblock">   <span class="insert">*</span>  The AEAD Algorithm and the hash algorithm are the application AEAD</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      and hash algorithms in the selected cipher suite.</td><td> </td><td class="right">      and hash algorithms in the selected cipher suite.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0231"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  The Master Secret and Master Salt are derived as follows where</td><td> </td><td class="rblock">   <span class="insert">*</span>  The Master Secret and Master Salt are derived as follows where</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      length is the key length (in bytes) of the application AEAD</td><td> </td><td class="right">      length is the key length (in bytes) of the application AEAD</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Algorithm.</td><td> </td><td class="right">      Algorithm.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Master Secret = EDHOC-Exporter( "OSCORE Master Secret", length )</td><td> </td><td class="right">      Master Secret = EDHOC-Exporter( "OSCORE Master Secret", length )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Master Salt   = EDHOC-Exporter( "OSCORE Master Salt", 8 )</td><td> </td><td class="right">      Master Salt   = EDHOC-Exporter( "OSCORE Master Salt", 8 )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0232"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.  Security Considerations</td><td> </td><td class="rblock"><span class="insert">8</span>.  Security Considerations</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0233"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.1.  Security Properties</td><td> </td><td class="rblock"><span class="insert">8</span>.1.  Security Properties</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC inherits its security properties from the theoretical SIGMA-I</td><td> </td><td class="right">   EDHOC inherits its security properties from the theoretical SIGMA-I</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protocol [SIGMA].  Using the terminology from [SIGMA], EDHOC provides</td><td> </td><td class="right">   protocol [SIGMA].  Using the terminology from [SIGMA], EDHOC provides</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   perfect forward secrecy, mutual authentication with aliveness,</td><td> </td><td class="right">   perfect forward secrecy, mutual authentication with aliveness,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   consistency, peer awareness.  As described in [SIGMA], peer awareness</td><td> </td><td class="right">   consistency, peer awareness.  As described in [SIGMA], peer awareness</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   is provided to the Responder, but not to the Initiator.</td><td> </td><td class="right">   is provided to the Responder, but not to the Initiator.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0234"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   EDHOC protects the credential identifier of the Initiator against</td><td> </td><td class="rblock">   <span class="insert">When a Public Key Infrastructure (PKI) is used,</span> EDHOC <span class="insert">provides</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   active attacks and the credential identifier of the Responder against</td><td> </td><td class="rblock"><span class="insert">   identity protection of the Initiator against active attacks and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   passive attacks.  The roles should be assigned to protect the most</td><td> </td><td class="rblock"><span class="insert">   identity protection of the Responder against passive attacks.  When</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   sensitive identity/identifier, typically that which is not possible</td><td> </td><td class="rblock"><span class="insert">   PKI is not used (kid, x5t) the identity is not sent on the wire and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   to infer from routing information in the lower layers.</td><td> </td><td class="rblock"><span class="insert">   EDHOC with asymmetric authentication</span> protects the credential</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   identifier of the Initiator against active attacks and the credential</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   identifier of the Responder against passive attacks.  The roles</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   should be assigned to protect the most sensitive identity/identifier,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   typically that which is not possible to infer from routing</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   information in the lower layers.  <span class="insert">EDHOC with symmetric authentication</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   does not offer protection of the PSK identifier ID_PSK.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Compared to [SIGMA], EDHOC adds an explicit method type and expands</td><td> </td><td class="right">   Compared to [SIGMA], EDHOC adds an explicit method type and expands</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the message authentication coverage to additional elements such as</td><td> </td><td class="right">   the message authentication coverage to additional elements such as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   algorithms, auxiliary data, and previous messages.  This protects</td><td> </td><td class="right">   algorithms, auxiliary data, and previous messages.  This protects</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   against an attacker replaying messages or injecting messages from</td><td> </td><td class="right">   against an attacker replaying messages or injecting messages from</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   another session.</td><td> </td><td class="right">   another session.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC also adds negotiation of connection identifiers and downgrade</td><td> </td><td class="right">   EDHOC also adds negotiation of connection identifiers and downgrade</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protected negotiation of cryptographic parameters, i.e. an attacker</td><td> </td><td class="right">   protected negotiation of cryptographic parameters, i.e. an attacker</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   cannot affect the negotiated parameters.  A single session of EDHOC</td><td> </td><td class="right">   cannot affect the negotiated parameters.  A single session of EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-7" class="change"><td></td><th><small>skipping to change at</small><a href="#part-7"><em> page 32, line 50<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-7"><em> page 34, line 37<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   is to use a key exchange that provides perfect forward secrecy.</td><td> </td><td class="right">   is to use a key exchange that provides perfect forward secrecy.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC therefore only supports methods with perfect forward secrecy.</td><td> </td><td class="right">   EDHOC therefore only supports methods with perfect forward secrecy.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   To limit the effect of breaches, it is important to limit the use of</td><td> </td><td class="right">   To limit the effect of breaches, it is important to limit the use of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   symmetrical group keys for bootstrapping.  EDHOC therefore strives to</td><td> </td><td class="right">   symmetrical group keys for bootstrapping.  EDHOC therefore strives to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   make the additional cost of using raw public keys and self-signed</td><td> </td><td class="right">   make the additional cost of using raw public keys and self-signed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   certificates as small as possible.  Raw public keys and self-signed</td><td> </td><td class="right">   certificates as small as possible.  Raw public keys and self-signed</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   certificates are not a replacement for a public key infrastructure,</td><td> </td><td class="right">   certificates are not a replacement for a public key infrastructure,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   but SHOULD be used instead of symmetrical group keys for</td><td> </td><td class="right">   but SHOULD be used instead of symmetrical group keys for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   bootstrapping.</td><td> </td><td class="right">   bootstrapping.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0235"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Compromise of the long-term keys <span class="delete">(private signature</span> or <span class="delete">static DH</span></td><td> </td><td class="rblock">   Compromise of the long-term keys <span class="insert">(PSK</span> or <span class="insert">private authentication</span> keys)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   keys) does not compromise the security of completed EDHOC exchanges.</td><td> </td><td class="rblock">   does not compromise the security of completed EDHOC exchanges.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Compromising the private authentication keys of one party lets an</td><td> </td><td class="right">   Compromising the private authentication keys of one party lets an</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   active attacker impersonate that compromised party in EDHOC exchanges</td><td> </td><td class="right">   active attacker impersonate that compromised party in EDHOC exchanges</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   with other parties, but does not let the attacker impersonate other</td><td> </td><td class="right">   with other parties, but does not let the attacker impersonate other</td><td class="lineno"></td></tr>
      <tr id="diff0236"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   parties in EDHOC exchanges with the compromised party.  Compromise of</td><td> </td><td class="rblock">   parties in EDHOC exchanges with the compromised party.  <span class="insert">Compromising</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   the long-term keys does not enable a passive attacker to compromise</td><td> </td><td class="rblock"><span class="insert">   the PSK lets an active attacker impersonate the Initiator in EDHOC</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   future session keys.  Compromise of the HDKF input parameters (ECDH</td><td> </td><td class="rblock"><span class="insert">   exchanges with the Responder and impersonate the Responder in EDHOC</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   shared <span class="delete">secret)</span> leads to compromise of all session keys derived from</td><td> </td><td class="rblock"><span class="insert">   exchanges with the Initiator.</span>  Compromise of the long-term keys does</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   that compromised shared secret.  Compromise of one session key does</td><td> </td><td class="rblock">   not enable a passive attacker to compromise future session keys.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   not compromise other session keys.</td><td> </td><td class="rblock">   Compromise of the HDKF input parameters (ECDH shared <span class="insert">secret and/or</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"><span class="insert">   PSK)</span> leads to compromise of all session keys derived from that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">If supported by the device, it is RECOMMENDED that at least the long-</span></td><td> </td><td class="rblock">   compromised shared secret.  Compromise of one session key does not</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   term private keys is stored in a Trusted Execution Environment (TEE)</span></td><td> </td><td class="rblock">   compromise other session keys.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   and that sensitive operations using these keys are performed inside</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the TEE.  To achieve even higher security additional operation such</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   as ephemeral key generation, all computations of shared secrets, and</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   storage of the PRK keys can be done inside the TEE.  Optimally, the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   whole EDHOC protocol can be implemented inside the TEE.  Typically an</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   adversary with physical access to a device can be assumed to gain</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   access to all information outside of the TEE, but none of the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   information inside the TEE.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Key compromise impersonation (KCI): In EDHOC authenticated with</td><td> </td><td class="right">   Key compromise impersonation (KCI): In EDHOC authenticated with</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   signature keys, EDHOC provides KCI protection against an attacker</td><td> </td><td class="right">   signature keys, EDHOC provides KCI protection against an attacker</td><td class="lineno"></td></tr>
      <tr id="diff0237"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   having access to the long term key or the ephemeral secret key.  With</td><td> </td><td class="rblock">   having access to the long term key or the ephemeral secret key.  <span class="insert">In</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   static Diffie-Hellman key authentication, KCI protection would be</td><td> </td><td class="rblock"><span class="insert">   EDHOC authenticated with symmetric keys, EDHOC provides KCI</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   provided against an attacker having access to the long-term <span class="delete">Diffie-</span></td><td> </td><td class="rblock"><span class="insert">   protection against an attacker having access to the ephemeral secret</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Hellman</span> key, but not to an attacker having access to the ephemeral</td><td> </td><td class="rblock"><span class="insert">   key, but not against an attacker having access to the long-term PSK.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   secret key.  Note that the term KCI has typically been used for</td><td> </td><td class="rblock">   With static Diffie-Hellman key authentication, KCI protection would</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   compromise of long-term keys, and that an attacker with access to the</td><td> </td><td class="rblock">   be provided against an attacker having access to the long-term</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   ephemeral secret key can only attack that specific protocol run.</td><td> </td><td class="rblock">   <span class="insert">Diffie-Hellman</span> key, but not to an attacker having access to the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ephemeral secret key.  Note that the term KCI has typically been used</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   for compromise of long-term keys, and that an attacker with access to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   the ephemeral secret key can only attack that specific protocol run.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0238"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Repudiation: In EDHOC authenticated with signature keys, <span class="delete">the</span></td><td> </td><td class="rblock">   Repudiation: In EDHOC authenticated with signature keys, <span class="insert">Party U</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator</span> could theoretically prove that <span class="delete">the Responder</span> performed a</td><td> </td><td class="rblock">   could theoretically prove that <span class="insert">Party V</span> performed a run of the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   run of the protocol by presenting the private ephemeral key, and vice</td><td> </td><td class="rblock">   protocol by presenting the private ephemeral key, and vice versa.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   versa.  Note that storing the private ephemeral keys violates the</td><td> </td><td class="rblock">   Note that storing the private ephemeral keys violates the protocol</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   protocol requirements.  With static Diffie-Hellman key</td><td> </td><td class="rblock">   requirements.  With static Diffie-Hellman key <span class="insert">authentication or PSK</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authentication, both parties can always deny having participated in</td><td> </td><td class="right">   authentication, both parties can always deny having participated in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the protocol.</td><td> </td><td class="right">   the protocol.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0239"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.2.  Cryptographic Considerations</td><td> </td><td class="rblock"><span class="insert">8</span>.2.  Cryptographic Considerations</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The security of the SIGMA protocol requires the MAC to be bound to</td><td> </td><td class="right">   The security of the SIGMA protocol requires the MAC to be bound to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the identity of the signer.  Hence the message authenticating</td><td> </td><td class="right">   the identity of the signer.  Hence the message authenticating</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   functionality of the authenticated encryption in EDHOC is critical:</td><td> </td><td class="right">   functionality of the authenticated encryption in EDHOC is critical:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authenticated encryption MUST NOT be replaced by plain encryption</td><td> </td><td class="right">   authenticated encryption MUST NOT be replaced by plain encryption</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   only, even if authentication is provided at another level or through</td><td> </td><td class="right">   only, even if authentication is provided at another level or through</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   a different mechanism.  EDHOC implements SIGMA-I using the same Sign-</td><td> </td><td class="right">   a different mechanism.  EDHOC implements SIGMA-I using the same Sign-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   then-MAC approach as TLS 1.3.</td><td> </td><td class="right">   then-MAC approach as TLS 1.3.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   To reduce message overhead EDHOC does not use explicit nonces and</td><td> </td><td class="right">   To reduce message overhead EDHOC does not use explicit nonces and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-8" class="change"><td></td><th><small>skipping to change at</small><a href="#part-8"><em> page 34, line 25<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-8"><em> page 36, line 7<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   Initiator and the Responder should enforce a minimum security level.</td><td> </td><td class="right">   Initiator and the Responder should enforce a minimum security level.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The data rates in many IoT deployments are very limited.  Given that</td><td> </td><td class="right">   The data rates in many IoT deployments are very limited.  Given that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the application keys are protected as well as the long-term</td><td> </td><td class="right">   the application keys are protected as well as the long-term</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   authentication keys they can often be used for years or even decades</td><td> </td><td class="right">   authentication keys they can often be used for years or even decades</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   before the cryptographic limits are reached.  If the application keys</td><td> </td><td class="right">   before the cryptographic limits are reached.  If the application keys</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   established through EDHOC need to be renewed, the communicating</td><td> </td><td class="right">   established through EDHOC need to be renewed, the communicating</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   parties can derive application keys with other labels or run EDHOC</td><td> </td><td class="right">   parties can derive application keys with other labels or run EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   again.</td><td> </td><td class="right">   again.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0240"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.3.  Cipher Suites</td><td> </td><td class="rblock"><span class="insert">8</span>.3.  Cipher Suites</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Cipher suite number 0 (AES-CCM-16-64-128, SHA-256, X25519, EdDSA,</td><td> </td><td class="right">   Cipher suite number 0 (AES-CCM-16-64-128, SHA-256, X25519, EdDSA,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Ed25519, AES-CCM-16-64-128, SHA-256) is mandatory to implement.</td><td> </td><td class="right">   Ed25519, AES-CCM-16-64-128, SHA-256) is mandatory to implement.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Implementations only need to implement the algorithms needed for</td><td> </td><td class="right">   Implementations only need to implement the algorithms needed for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   their supported methods.  For many constrained IoT devices it is</td><td> </td><td class="right">   their supported methods.  For many constrained IoT devices it is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   problematic to support more than one cipher suites, so some</td><td> </td><td class="right">   problematic to support more than one cipher suites, so some</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   deployments with P-256 may not support the mandatory cipher suite.</td><td> </td><td class="right">   deployments with P-256 may not support the mandatory cipher suite.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This is not a problem for local deployments.</td><td> </td><td class="right">   This is not a problem for local deployments.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The HMAC algorithm HMAC 256/64 (HMAC w/ SHA-256 truncated to 64 bits)</td><td> </td><td class="right">   The HMAC algorithm HMAC 256/64 (HMAC w/ SHA-256 truncated to 64 bits)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   SHALL NOT be supported for use in EDHOC.</td><td> </td><td class="right">   SHALL NOT be supported for use in EDHOC.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0241"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.4.  Unprotected Data</td><td> </td><td class="rblock"><span class="insert">8</span>.4.  Unprotected Data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator and the Responder must make sure that unprotected data</td><td> </td><td class="right">   The Initiator and the Responder must make sure that unprotected data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and metadata do not reveal any sensitive information.  This also</td><td> </td><td class="right">   and metadata do not reveal any sensitive information.  This also</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   applies for encrypted data sent to an unauthenticated party.  In</td><td> </td><td class="right">   applies for encrypted data sent to an unauthenticated party.  In</td><td class="lineno"></td></tr>
      <tr id="diff0242"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   particular, it applies to AD_1, ID_CRED_R, AD_2, and <span class="delete">ERR_MSG.</span>  Using</td><td> </td><td class="rblock">   particular, it applies to AD_1, ID_CRED_R, AD_2, and <span class="insert">ERR_MSG in the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   the same AD_1 in several EDHOC sessions allows passive eavesdroppers</td><td> </td><td class="rblock"><span class="insert">   asymmetric case, and ID_PSK, AD_1, and ERR_MSG in the symmetric case.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   to correlate the different sessions.  Another consideration is that</td><td> </td><td class="rblock">   Using the same <span class="insert">ID_PSK or</span> AD_1 in several EDHOC sessions allows</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   the list of supported cipher suites may <span class="delete">potentially</span> be used to</td><td> </td><td class="rblock">   passive eavesdroppers to correlate the different sessions.  <span class="insert">The</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   identify the application.</td><td> </td><td class="rblock"><span class="insert">   communicating parties may therefore anonymize ID_PSK.</span>  Another</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   consideration is that the list of supported cipher suites may be used</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   to identify the application.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator and the Responder must also make sure that</td><td> </td><td class="right">   The Initiator and the Responder must also make sure that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   unauthenticated data does not trigger any harmful actions.  In</td><td> </td><td class="right">   unauthenticated data does not trigger any harmful actions.  In</td><td class="lineno"></td></tr>
      <tr id="diff0243"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   particular, this applies to AD_1 and <span class="delete">ERR_MSG.</span></td><td> </td><td class="rblock">   particular, this applies to AD_1 and <span class="insert">ERR_MSG in the asymmetric case,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   and ID_PSK, AD_1, and ERR_MSG in the symmetric case.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0244"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.5.  Denial-of-Service</td><td> </td><td class="rblock"><span class="insert">8</span>.5.  Denial-of-Service</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC itself does not provide countermeasures against Denial-of-</td><td> </td><td class="right">   EDHOC itself does not provide countermeasures against Denial-of-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Service attacks.  By sending a number of new or replayed message_1 an</td><td> </td><td class="right">   Service attacks.  By sending a number of new or replayed message_1 an</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   attacker may cause the Responder to allocate state, perform</td><td> </td><td class="right">   attacker may cause the Responder to allocate state, perform</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   cryptographic operations, and amplify messages.  To mitigate such</td><td> </td><td class="right">   cryptographic operations, and amplify messages.  To mitigate such</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   attacks, an implementation SHOULD rely on lower layer mechanisms such</td><td> </td><td class="right">   attacks, an implementation SHOULD rely on lower layer mechanisms such</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   as the Echo option in CoAP [I-D.ietf-core-echo-request-tag] that</td><td> </td><td class="right">   as the Echo option in CoAP [I-D.ietf-core-echo-request-tag] that</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   forces the initiator to demonstrate reachability at its apparent</td><td> </td><td class="right">   forces the initiator to demonstrate reachability at its apparent</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   network address.</td><td> </td><td class="right">   network address.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0245"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.6.  Implementation Considerations</td><td> </td><td class="rblock"><span class="insert">8</span>.6.  Implementation Considerations</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The availability of a secure pseudorandom number generator and truly</td><td> </td><td class="right">   The availability of a secure pseudorandom number generator and truly</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   random seeds are essential for the security of EDHOC.  If no true</td><td> </td><td class="right">   random seeds are essential for the security of EDHOC.  If no true</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   random number generator is available, a truly random seed must be</td><td> </td><td class="right">   random number generator is available, a truly random seed must be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   provided from an external source.  As each pseudorandom number must</td><td> </td><td class="right">   provided from an external source.  As each pseudorandom number must</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   only be used once, an implementation need to get a new truly random</td><td> </td><td class="right">   only be used once, an implementation need to get a new truly random</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   seed after reboot, or continuously store state in nonvolatile memory,</td><td> </td><td class="right">   seed after reboot, or continuously store state in nonvolatile memory,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   see ([RFC8613], Appendix B.1.1) for issues and solution approaches</td><td> </td><td class="right">   see ([RFC8613], Appendix B.1.1) for issues and solution approaches</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   for writing to nonvolatile memory.  If ECDSA is supported,</td><td> </td><td class="right">   for writing to nonvolatile memory.  If ECDSA is supported,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   "deterministic ECDSA" as specified in [RFC6979] is RECOMMENDED.</td><td> </td><td class="right">   "deterministic ECDSA" as specified in [RFC6979] is RECOMMENDED.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-9" class="change"><td></td><th><small>skipping to change at</small><a href="#part-9"><em> page 35, line 40<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-9"><em> page 37, line 29<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   along with any ephemeral ECDH secrets after the key derivation is</td><td> </td><td class="right">   along with any ephemeral ECDH secrets after the key derivation is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   completed.  The ECDH shared secret, keys, and IVs MUST be secret.</td><td> </td><td class="right">   completed.  The ECDH shared secret, keys, and IVs MUST be secret.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Implementations should provide countermeasures to side-channel</td><td> </td><td class="right">   Implementations should provide countermeasures to side-channel</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   attacks such as timing attacks.  Depending on the selected curve, the</td><td> </td><td class="right">   attacks such as timing attacks.  Depending on the selected curve, the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   parties should perform various validations of each other's public</td><td> </td><td class="right">   parties should perform various validations of each other's public</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   keys, see e.g.  Section 5 of [SP-800-56A].</td><td> </td><td class="right">   keys, see e.g.  Section 5 of [SP-800-56A].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator and the Responder are responsible for verifying the</td><td> </td><td class="right">   The Initiator and the Responder are responsible for verifying the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   integrity of certificates.  The selection of trusted CAs should be</td><td> </td><td class="right">   integrity of certificates.  The selection of trusted CAs should be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   done very carefully and certificate revocation should be supported.</td><td> </td><td class="right">   done very carefully and certificate revocation should be supported.</td><td class="lineno"></td></tr>
      <tr id="diff0246"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The private authentication keys MUST be kept secret.</td><td> </td><td class="rblock">   The private authentication keys <span class="insert">and the PSK (even though it is used</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   as salt)</span> MUST be kept secret.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The Initiator and the Responder are allowed to select the connection</td><td> </td><td class="right">   The Initiator and the Responder are allowed to select the connection</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   identifiers C_I and C_R, respectively, for the other party to use in</td><td> </td><td class="right">   identifiers C_I and C_R, respectively, for the other party to use in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the ongoing EDHOC protocol as well as in a subsequent application</td><td> </td><td class="right">   the ongoing EDHOC protocol as well as in a subsequent application</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   protocol (e.g.  OSCORE [RFC8613]).  The choice of connection</td><td> </td><td class="right">   protocol (e.g.  OSCORE [RFC8613]).  The choice of connection</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   identifier is not security critical in EDHOC but intended to simplify</td><td> </td><td class="right">   identifier is not security critical in EDHOC but intended to simplify</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the retrieval of the right security context in combination with using</td><td> </td><td class="right">   the retrieval of the right security context in combination with using</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   short identifiers.  If the wrong connection identifier of the other</td><td> </td><td class="right">   short identifiers.  If the wrong connection identifier of the other</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   party is used in a protocol message it will result in the receiving</td><td> </td><td class="right">   party is used in a protocol message it will result in the receiving</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   party not being able to retrieve a security context (which will</td><td> </td><td class="right">   party not being able to retrieve a security context (which will</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-10" class="change"><td></td><th><small>skipping to change at</small><a href="#part-10"><em> page 36, line 18<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-10"><em> page 38, line 8<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   If two nodes unintentionally initiate two simultaneous EDHOC message</td><td> </td><td class="right">   If two nodes unintentionally initiate two simultaneous EDHOC message</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   exchanges with each other even if they only want to complete a single</td><td> </td><td class="right">   exchanges with each other even if they only want to complete a single</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC message exchange, they MAY terminate the exchange with the</td><td> </td><td class="right">   EDHOC message exchange, they MAY terminate the exchange with the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   lexicographically smallest G_X.  If the two G_X values are equal, the</td><td> </td><td class="right">   lexicographically smallest G_X.  If the two G_X values are equal, the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   received message_1 MUST be discarded to mitigate reflection attacks.</td><td> </td><td class="right">   received message_1 MUST be discarded to mitigate reflection attacks.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Note that in the case of two simultaneous EDHOC exchanges where the</td><td> </td><td class="right">   Note that in the case of two simultaneous EDHOC exchanges where the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   nodes only complete one and where the nodes have different preferred</td><td> </td><td class="right">   nodes only complete one and where the nodes have different preferred</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   cipher suites, an attacker can affect which of the two nodes'</td><td> </td><td class="right">   cipher suites, an attacker can affect which of the two nodes'</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   preferred cipher suites will be used by blocking the other exchange.</td><td> </td><td class="right">   preferred cipher suites will be used by blocking the other exchange.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0247"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">7</span>.7.  Other Documents Referencing EDHOC</td><td> </td><td class="rblock"><span class="insert">8</span>.7.  Other Documents Referencing EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   EDHOC has been analyzed in several other documents.  A formal</td><td> </td><td class="right">   EDHOC has been analyzed in several other documents.  A formal</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   verification of EDHOC was done in [SSR18], an analysis of EDHOC for</td><td> </td><td class="right">   verification of EDHOC was done in [SSR18], an analysis of EDHOC for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   certificate enrollment was done in [Kron18], the use of EDHOC in</td><td> </td><td class="right">   certificate enrollment was done in [Kron18], the use of EDHOC in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   LoRaWAN is analyzed in [LoRa1] and [LoRa2], the use of EDHOC in IoT</td><td> </td><td class="right">   LoRaWAN is analyzed in [LoRa1] and [LoRa2], the use of EDHOC in IoT</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   bootstrapping is analyzed in [Perez18], and the use of EDHOC in</td><td> </td><td class="right">   bootstrapping is analyzed in [Perez18], and the use of EDHOC in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   6TiSCH is described in [I-D.ietf-6tisch-dtsecurity-zerotouch-join].</td><td> </td><td class="right">   6TiSCH is described in [I-D.ietf-6tisch-dtsecurity-zerotouch-join].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0248"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">8</span>.  IANA Considerations</td><td> </td><td class="rblock"><span class="insert">9</span>.  IANA Considerations</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0249"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">8</span>.1.  EDHOC Cipher Suites Registry</td><td> </td><td class="rblock"><span class="insert">9</span>.1.  EDHOC Cipher Suites Registry</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   IANA has created a new registry titled "EDHOC Cipher Suites" under</td><td> </td><td class="right">   IANA has created a new registry titled "EDHOC Cipher Suites" under</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the new heading "EDHOC".  The registration procedure is "Expert</td><td> </td><td class="right">   the new heading "EDHOC".  The registration procedure is "Expert</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Review".  The columns of the registry are Value, Array, Description,</td><td> </td><td class="right">   Review".  The columns of the registry are Value, Array, Description,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and Reference, where Value is an integer and the other columns are</td><td> </td><td class="right">   and Reference, where Value is an integer and the other columns are</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   text strings.  The initial contents of the registry are:</td><td> </td><td class="right">   text strings.  The initial contents of the registry are:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Value: -24</td><td> </td><td class="right">   Value: -24</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Algorithms: N/A</td><td> </td><td class="right">   Algorithms: N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Desc: Reserved for Private Use</td><td> </td><td class="right">   Desc: Reserved for Private Use</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-11" class="change"><td></td><th><small>skipping to change at</small><a href="#part-11"><em> page 37, line 22<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-11"><em> page 39, line 16<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   Desc: AES-CCM-16-64-128, SHA-256, P-256, ES256, P-256,</td><td> </td><td class="right">   Desc: AES-CCM-16-64-128, SHA-256, P-256, ES256, P-256,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         AES-CCM-16-64-128, SHA-256</td><td> </td><td class="right">         AES-CCM-16-64-128, SHA-256</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Reference: [[this document]]</td><td> </td><td class="right">   Reference: [[this document]]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Value: 3</td><td> </td><td class="right">   Value: 3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Array: 30, 5, 1, -7, 1, 10, 5</td><td> </td><td class="right">   Array: 30, 5, 1, -7, 1, 10, 5</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Desc: AES-CCM-16-128-128, SHA-256, P-256, ES256, P-256,</td><td> </td><td class="right">   Desc: AES-CCM-16-128-128, SHA-256, P-256, ES256, P-256,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">         AES-CCM-16-64-128, SHA-256</td><td> </td><td class="right">         AES-CCM-16-64-128, SHA-256</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Reference: [[this document]]</td><td> </td><td class="right">   Reference: [[this document]]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0250"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">8</span>.2.  EDHOC Method Type Registry</td><td> </td><td class="rblock"><span class="insert">9</span>.2.  EDHOC Method Type Registry</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   IANA has created a new registry titled "EDHOC Method Type" under the</td><td> </td><td class="right">   IANA has created a new registry titled "EDHOC Method Type" under the</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   new heading "EDHOC".  The registration procedure is "Expert Review".</td><td> </td><td class="right">   new heading "EDHOC".  The registration procedure is "Expert Review".</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The columns of the registry are Value, Description, and Reference,</td><td> </td><td class="right">   The columns of the registry are Value, Description, and Reference,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   where Value is an integer and the other columns are text strings.</td><td> </td><td class="right">   where Value is an integer and the other columns are text strings.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The initial contents of the registry are:</td><td> </td><td class="right">   The initial contents of the registry are:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   +-------+-------------------+-------------------+-------------------+</td><td> </td><td class="right">   +-------+-------------------+-------------------+-------------------+</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   | Value | Initiator         | Responder         | Reference         |</td><td> </td><td class="right">   | Value | Initiator         | Responder         | Reference         |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   +-------+-------------------+-------------------+-------------------+</td><td> </td><td class="right">   +-------+-------------------+-------------------+-------------------+</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |     0 | Signature Key     | Signature Key     | [[this document]] |</td><td> </td><td class="right">   |     0 | Signature Key     | Signature Key     | [[this document]] |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |     1 | Signature Key     | Static DH Key     | [[this document]] |</td><td> </td><td class="right">   |     1 | Signature Key     | Static DH Key     | [[this document]] |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |     2 | Static DH Key     | Signature Key     | [[this document]] |</td><td> </td><td class="right">   |     2 | Static DH Key     | Signature Key     | [[this document]] |</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   |     3 | Static DH Key     | Static DH Key     | [[this document]] |</td><td> </td><td class="right">   |     3 | Static DH Key     | Static DH Key     | [[this document]] |</td><td class="lineno"></td></tr>
      <tr id="diff0251"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   |     4 | PSK               | PSK               | [[this document]] |</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   +-------+-------------------+-------------------+-------------------+</td><td> </td><td class="right">   +-------+-------------------+-------------------+-------------------+</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0252"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                          Figure <span class="delete">9</span>: Method Types</td><td> </td><td class="rblock">                          Figure <span class="insert">10</span>: Method Types</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0253"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">8</span>.3.  The Well-Known URI Registry</td><td> </td><td class="rblock"><span class="insert">9</span>.3.  The Well-Known URI Registry</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   IANA has added the well-known URI 'edhoc' to the Well-Known URIs</td><td> </td><td class="right">   IANA has added the well-known URI 'edhoc' to the Well-Known URIs</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   registry.</td><td> </td><td class="right">   registry.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0254"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  URI suffix: edhoc</td><td> </td><td class="rblock">   <span class="insert">*</span>  URI suffix: edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0255"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Change controller: IETF</td><td> </td><td class="rblock">   <span class="insert">*</span>  Change controller: IETF</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0256"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Specification document(s): [[this document]]</td><td> </td><td class="rblock">   <span class="insert">*</span>  Specification document(s): [[this document]]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  Related information: None</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0257"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">8.4.</span>  Media Types Registry</td><td> </td><td class="rblock">   <span class="insert">*  Related information: None</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">9.4.</span>  Media Types Registry</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   IANA has added the media type 'application/edhoc' to the Media Types</td><td> </td><td class="right">   IANA has added the media type 'application/edhoc' to the Media Types</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   registry.</td><td> </td><td class="right">   registry.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0258"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Type name: application</td><td> </td><td class="rblock">   <span class="insert">*</span>  Type name: application</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0259"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Subtype name: edhoc</td><td> </td><td class="rblock">   <span class="insert">*</span>  Subtype name: edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0260"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Required parameters: N/A</td><td> </td><td class="rblock">   <span class="insert">*</span>  Required parameters: N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0261"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Optional parameters: N/A</td><td> </td><td class="rblock">   <span class="insert">*</span>  Optional parameters: N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0262"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Encoding considerations: binary</td><td> </td><td class="rblock">   <span class="insert">*</span>  Encoding considerations: binary</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0263"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Security considerations: See Section 7 of this document.</td><td> </td><td class="rblock">   <span class="insert">*</span>  Security considerations: See Section 7 of this document.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0264"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Interoperability considerations: N/A</td><td> </td><td class="rblock">   <span class="insert">*</span>  Interoperability considerations: N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0265"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Published specification: [[this document]] (this document)</td><td> </td><td class="rblock">   <span class="insert">*</span>  Published specification: [[this document]] (this document)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0266"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Applications that use this media type: To be identified</td><td> </td><td class="rblock">   <span class="insert">*</span>  Applications that use this media type: To be identified</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0267"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Fragment identifier considerations: N/A</td><td> </td><td class="rblock">   <span class="insert">*</span>  Fragment identifier considerations: N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0268"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Additional information:</td><td> </td><td class="rblock">   <span class="insert">*</span>  Additional information:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0269"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Magic number(s): N/A</td><td> </td><td class="rblock">      <span class="insert">-</span>  Magic number(s): N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0270"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  File extension(s): N/A</td><td> </td><td class="rblock">      <span class="insert">-</span>  File extension(s): N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0271"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">      <span class="delete">*</span>  Macintosh file type code(s): N/A</td><td> </td><td class="rblock">      <span class="insert">-</span>  Macintosh file type code(s): N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0272"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Person &amp; email address to contact for further information: See</td><td> </td><td class="rblock">   <span class="insert">*</span>  Person &amp; email address to contact for further information: See</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      "Authors' Addresses" section.</td><td> </td><td class="right">      "Authors' Addresses" section.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0273"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Intended usage: COMMON</td><td> </td><td class="rblock">   <span class="insert">*</span>  Intended usage: COMMON</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0274"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Restrictions on usage: N/A</td><td> </td><td class="rblock">   <span class="insert">*</span>  Restrictions on usage: N/A</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0275"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Author: See "Authors' Addresses" section.</td><td> </td><td class="rblock">   <span class="insert">*</span>  Author: See "Authors' Addresses" section.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0276"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Change Controller: IESG</td><td> </td><td class="rblock">   <span class="insert">*</span>  Change Controller: IESG</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0277"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">8</span>.5.  CoAP Content-Formats Registry</td><td> </td><td class="rblock"><span class="insert">9</span>.5.  CoAP Content-Formats Registry</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   IANA has added the media type 'application/edhoc' to the CoAP</td><td> </td><td class="right">   IANA has added the media type 'application/edhoc' to the CoAP</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Content-Formats registry.</td><td> </td><td class="right">   Content-Formats registry.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0278"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Media Type: application/edhoc</td><td> </td><td class="rblock">   <span class="insert">*</span>  Media Type: application/edhoc</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0279"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Encoding:</td><td> </td><td class="rblock">   <span class="insert">*</span>  Encoding:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0280"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  ID: TBD42</td><td> </td><td class="rblock">   <span class="insert">*</span>  ID: TBD42</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0281"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Reference: [[this document]]</td><td> </td><td class="rblock">   <span class="insert">*</span>  Reference: [[this document]]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0282"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">8</span>.6.  Expert Review Instructions</td><td> </td><td class="rblock"><span class="insert">9</span>.6.  Expert Review Instructions</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The IANA Registries established in this document is defined as</td><td> </td><td class="right">   The IANA Registries established in this document is defined as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   "Expert Review".  This section gives some general guidelines for what</td><td> </td><td class="right">   "Expert Review".  This section gives some general guidelines for what</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   the experts should be looking for, but they are being designated as</td><td> </td><td class="right">   the experts should be looking for, but they are being designated as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   experts for a reason so they should be given substantial latitude.</td><td> </td><td class="right">   experts for a reason so they should be given substantial latitude.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Expert reviewers should take into consideration the following points:</td><td> </td><td class="right">   Expert reviewers should take into consideration the following points:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0283"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Clarity and correctness of registrations.  Experts are expected to</td><td> </td><td class="rblock">   <span class="insert">*</span>  Clarity and correctness of registrations.  Experts are expected to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      check the clarity of purpose and use of the requested entries.</td><td> </td><td class="right">      check the clarity of purpose and use of the requested entries.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Expert needs to make sure the values of algorithms are taken from</td><td> </td><td class="right">      Expert needs to make sure the values of algorithms are taken from</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      the right registry, when that's required.  Expert should consider</td><td> </td><td class="right">      the right registry, when that's required.  Expert should consider</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      requesting an opinion on the correctness of registered parameters</td><td> </td><td class="right">      requesting an opinion on the correctness of registered parameters</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      from relevant IETF working groups.  Encodings that do not meet</td><td> </td><td class="right">      from relevant IETF working groups.  Encodings that do not meet</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      these objective of clarity and completeness should not be</td><td> </td><td class="right">      these objective of clarity and completeness should not be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      registered.</td><td> </td><td class="right">      registered.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0284"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Experts should take into account the expected usage of fields when</td><td> </td><td class="rblock">   <span class="insert">*</span>  Experts should take into account the expected usage of fields when</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      approving point assignment.  The length of the encoded value</td><td> </td><td class="right">      approving point assignment.  The length of the encoded value</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      should be weighed against how many code points of that length are</td><td> </td><td class="right">      should be weighed against how many code points of that length are</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      left, the size of device it will be used on, and the number of</td><td> </td><td class="right">      left, the size of device it will be used on, and the number of</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      code points left that encode to that size.</td><td> </td><td class="right">      code points left that encode to that size.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0285"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  Specifications are recommended.  When specifications are not</td><td> </td><td class="rblock">   <span class="insert">*</span>  Specifications are recommended.  When specifications are not</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      provided, the description provided needs to have sufficient</td><td> </td><td class="right">      provided, the description provided needs to have sufficient</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      information to verify the points above.</td><td> </td><td class="right">      information to verify the points above.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0286"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">9</span>.  References</td><td> </td><td class="rblock"><span class="insert">10</span>.  References</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0287"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">9.1.</span>  Normative References</td><td> </td><td class="rblock"><span class="insert">10.1.</span>  Normative References</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">[I-D.ietf-cbor-sequence]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Bormann, C., "Concise Binary Object Representation (CBOR)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Sequences", Work in Progress, Internet-Draft, draft-ietf-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              cbor-sequence-02, 25 September 2019, &lt;http://www.ietf.org/</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              internet-drafts/draft-ietf-cbor-sequence-02.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-core-echo-request-tag]</td><td> </td><td class="right">   [I-D.ietf-core-echo-request-tag]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Amsuess, C., Mattsson, J., and G. Selander, "CoAP: Echo,</td><td> </td><td class="right">              Amsuess, C., Mattsson, J., and G. Selander, "CoAP: Echo,</td><td class="lineno"></td></tr>
      <tr id="diff0288"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Request-Tag, and Token Processing", <span class="delete">draft-ietf-core-echo-</span></td><td> </td><td class="rblock">              Request-Tag, and Token Processing", <span class="insert">Work</span> in <span class="insert">Progress,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              request-tag-10 (work</span> in <span class="delete">progress), July 2020.</span></td><td> </td><td class="rblock"><span class="insert">              Internet-Draft, draft-ietf-core-echo-request-tag-08, 4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              November 2019, &lt;http://www.ietf.org/internet-drafts/draft-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              ietf-core-echo-request-tag-08.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-cose-x509]</td><td> </td><td class="right">   [I-D.ietf-cose-x509]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Schaad, J., "CBOR Object Signing and Encryption (COSE):</td><td> </td><td class="right">              Schaad, J., "CBOR Object Signing and Encryption (COSE):</td><td class="lineno"></td></tr>
      <tr id="diff0289"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">Header parameters</span> for carrying and referencing X.509</td><td> </td><td class="rblock">              <span class="insert">Headers</span> for carrying and referencing X.509 certificates",</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              certificates", <span class="delete">draft-ietf-cose-x509-07 (work</span> in <span class="delete">progress),</span></td><td> </td><td class="rblock">              <span class="insert">Work</span> in <span class="insert">Progress, Internet-Draft, draft-ietf-cose-x509-05,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              September 2020.</span></td><td> </td><td class="rblock"><span class="insert">              4 November 2019, &lt;http://www.ietf.org/internet-drafts/</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">              draft-ietf-cose-x509-05.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   [I-D.ietf-lake-reqs]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Vucinic, M., Selander, G., Mattsson, J., and D. Garcia-</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Carillo, "Requirements for a Lightweight AKE for OSCORE",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              draft-ietf-lake-reqs-04 (work in progress), June 2020.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate</td><td> </td><td class="right">   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Requirement Levels", BCP 14, RFC 2119,</td><td> </td><td class="right">              Requirement Levels", BCP 14, RFC 2119,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              DOI 10.17487/RFC2119, March 1997,</td><td> </td><td class="right">              DOI 10.17487/RFC2119, March 1997,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.rfc-editor.org/info/rfc2119&gt;.</td><td> </td><td class="right">              &lt;https://www.rfc-editor.org/info/rfc2119&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC5116]  McGrew, D., "An Interface and Algorithms for Authenticated</td><td> </td><td class="right">   [RFC5116]  McGrew, D., "An Interface and Algorithms for Authenticated</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Encryption", RFC 5116, DOI 10.17487/RFC5116, January 2008,</td><td> </td><td class="right">              Encryption", RFC 5116, DOI 10.17487/RFC5116, January 2008,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.rfc-editor.org/info/rfc5116&gt;.</td><td> </td><td class="right">              &lt;https://www.rfc-editor.org/info/rfc5116&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-12" class="change"><td></td><th><small>skipping to change at</small><a href="#part-12"><em> page 41, line 22<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-12"><em> page 43, line 18<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.rfc-editor.org/info/rfc7959&gt;.</td><td> </td><td class="right">              &lt;https://www.rfc-editor.org/info/rfc7959&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC8152]  Schaad, J., "CBOR Object Signing and Encryption (COSE)",</td><td> </td><td class="right">   [RFC8152]  Schaad, J., "CBOR Object Signing and Encryption (COSE)",</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              RFC 8152, DOI 10.17487/RFC8152, July 2017,</td><td> </td><td class="right">              RFC 8152, DOI 10.17487/RFC8152, July 2017,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.rfc-editor.org/info/rfc8152&gt;.</td><td> </td><td class="right">              &lt;https://www.rfc-editor.org/info/rfc8152&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC</td><td> </td><td class="right">   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,</td><td> </td><td class="right">              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              May 2017, &lt;https://www.rfc-editor.org/info/rfc8174&gt;.</td><td> </td><td class="right">              May 2017, &lt;https://www.rfc-editor.org/info/rfc8174&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0290"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">[RFC8376]  Farrell, S., Ed., "Low-Power Wide Area Network (LPWAN)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Overview", RFC 8376, DOI 10.17487/RFC8376, May 2018,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              &lt;https://www.rfc-editor.org/info/rfc8376&gt;.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC8610]  Birkholz, H., Vigano, C., and C. Bormann, "Concise Data</td><td> </td><td class="right">   [RFC8610]  Birkholz, H., Vigano, C., and C. Bormann, "Concise Data</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Definition Language (CDDL): A Notational Convention to</td><td> </td><td class="right">              Definition Language (CDDL): A Notational Convention to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Express Concise Binary Object Representation (CBOR) and</td><td> </td><td class="right">              Express Concise Binary Object Representation (CBOR) and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              JSON Data Structures", RFC 8610, DOI 10.17487/RFC8610,</td><td> </td><td class="right">              JSON Data Structures", RFC 8610, DOI 10.17487/RFC8610,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              June 2019, &lt;https://www.rfc-editor.org/info/rfc8610&gt;.</td><td> </td><td class="right">              June 2019, &lt;https://www.rfc-editor.org/info/rfc8610&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC8613]  Selander, G., Mattsson, J., Palombini, F., and L. Seitz,</td><td> </td><td class="right">   [RFC8613]  Selander, G., Mattsson, J., Palombini, F., and L. Seitz,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              "Object Security for Constrained RESTful Environments</td><td> </td><td class="right">              "Object Security for Constrained RESTful Environments</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              (OSCORE)", RFC 8613, DOI 10.17487/RFC8613, July 2019,</td><td> </td><td class="right">              (OSCORE)", RFC 8613, DOI 10.17487/RFC8613, July 2019,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.rfc-editor.org/info/rfc8613&gt;.</td><td> </td><td class="right">              &lt;https://www.rfc-editor.org/info/rfc8613&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0291"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">[RFC8742]  Bormann, C., "Concise Binary Object Representation (CBOR)</span></td><td> </td><td class="rblock">   <span class="insert">[SIGMA]    Krawczyk, H., "SIGMA - The 'SIGn-and-MAc' Approach to</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Sequences", RFC 8742, DOI 10.17487/RFC8742, February 2020,</span></td><td> </td><td class="rblock"><span class="insert">              Authenticated Diffie-Hellman and Its Use in the IKE-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              &lt;https://www.rfc-editor.org/info/rfc8742&gt;.</span></td><td> </td><td class="rblock"><span class="insert">              Protocols (Long version)", June 2003,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              &lt;http://webee.technion.ac.il/~hugo/sigma-pdf.pdf&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0292"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">9.2.</span>  Informative References</td><td> </td><td class="rblock">   <span class="insert">[SP-800-56A]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Barker, E., Chen, L., Roginsky, A., Vassilev, A., and R.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Davis, "Recommendation for Pair-Wise Key-Establishment</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Schemes Using Discrete Logarithm Cryptography",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              NIST Special Publication 800-56A Revision 3, April 2018,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              &lt;https://doi.org/10.6028/NIST.SP.800-56Ar3&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">10.2.</span>  Informative References</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [CborMe]   Bormann, C., "CBOR Playground", May 2018,</td><td> </td><td class="right">   [CborMe]   Bormann, C., "CBOR Playground", May 2018,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;http://cbor.me/&gt;.</td><td> </td><td class="right">              &lt;http://cbor.me/&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0293"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">[I-D.hartke-core-e2e-security-reqs]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Selander, G., Palombini, F., and K. Hartke, "Requirements</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              for CoAP End-To-End Security", Work in Progress, Internet-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Draft, draft-hartke-core-e2e-security-reqs-03, 29 July</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              2017, &lt;http://www.ietf.org/internet-drafts/draft-hartke-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              core-e2e-security-reqs-03.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-6tisch-dtsecurity-zerotouch-join]</td><td> </td><td class="right">   [I-D.ietf-6tisch-dtsecurity-zerotouch-join]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Richardson, M., "6tisch Zero-Touch Secure Join protocol",</td><td> </td><td class="right">              Richardson, M., "6tisch Zero-Touch Secure Join protocol",</td><td class="lineno"></td></tr>
      <tr id="diff0294"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">draft-ietf-6tisch-dtsecurity-zerotouch-join-04 (work</span> in</td><td> </td><td class="rblock">              <span class="insert">Work</span> in <span class="insert">Progress, Internet-Draft, draft-ietf-6tisch-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">progress),</span> July <span class="delete">2019.</span></td><td> </td><td class="rblock"><span class="insert">              dtsecurity-zerotouch-join-04, 8</span> July <span class="insert">2019,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              &lt;http://www.ietf.org/internet-drafts/draft-ietf-6tisch-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              dtsecurity-zerotouch-join-04.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-ace-oauth-authz]</td><td> </td><td class="right">   [I-D.ietf-ace-oauth-authz]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Seitz, L., Selander, G., Wahlstroem, E., Erdtman, S., and</td><td> </td><td class="right">              Seitz, L., Selander, G., Wahlstroem, E., Erdtman, S., and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              H. Tschofenig, "Authentication and Authorization for</td><td> </td><td class="right">              H. Tschofenig, "Authentication and Authorization for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Constrained Environments (ACE) using the OAuth 2.0</td><td> </td><td class="right">              Constrained Environments (ACE) using the OAuth 2.0</td><td class="lineno"></td></tr>
      <tr id="diff0295"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Framework (ACE-OAuth)", <span class="delete">draft-ietf-ace-oauth-authz-35</span></td><td> </td><td class="rblock">              Framework (ACE-OAuth)", <span class="insert">Work</span> in <span class="insert">Progress, Internet-Draft,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              (work</span> in <span class="delete">progress), June 2020.</span></td><td> </td><td class="rblock"><span class="insert">              draft-ietf-ace-oauth-authz-33, 6 February 2020,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              &lt;http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              authz-33.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [I-D.ietf-ace-oscore-profile]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Palombini, F., Seitz, L., Selander, G., and M. Gunnarsson,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              "OSCORE profile of the Authentication and Authorization</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              for Constrained Environments Framework", Work in Progress,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Internet-Draft, draft-ietf-ace-oscore-profile-09, 2 March</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              2020, &lt;http://www.ietf.org/internet-drafts/draft-ietf-ace-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              oscore-profile-09.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-core-resource-directory]</td><td> </td><td class="right">   [I-D.ietf-core-resource-directory]</td><td class="lineno"></td></tr>
      <tr id="diff0296"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">Amsuess, C.,</span> Shelby, Z., Koster, M., Bormann, C., <span class="delete">and P.</span></td><td> </td><td class="rblock">              Shelby, Z., Koster, M., Bormann, C., Stok, <span class="insert">P., and C.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Stok, "CoRE Resource Directory", <span class="delete">draft-ietf-core-resource-</span></td><td> </td><td class="rblock"><span class="insert">              Amsuess,</span> "CoRE Resource Directory", <span class="insert">Work</span> in <span class="insert">Progress,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              directory-26 (work</span> in <span class="delete">progress), November 2020.</span></td><td> </td><td class="rblock"><span class="insert">              Internet-Draft, draft-ietf-core-resource-directory-23, 8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              July 2019, &lt;http://www.ietf.org/internet-drafts/draft-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              ietf-core-resource-directory-23.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-lwig-security-protocol-comparison]</td><td> </td><td class="right">   [I-D.ietf-lwig-security-protocol-comparison]</td><td class="lineno"></td></tr>
      <tr id="diff0297"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Mattsson, <span class="delete">J., Palombini, F.,</span> and <span class="delete">M. Vucinic,</span> "Comparison</td><td> </td><td class="rblock">              Mattsson, <span class="insert">J.</span> and <span class="insert">F. Palombini,</span> "Comparison of CoAP</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              of CoAP Security Protocols", <span class="delete">draft-ietf-lwig-security-</span></td><td> </td><td class="rblock">              Security Protocols", <span class="insert">Work</span> in <span class="insert">Progress, Internet-Draft,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              protocol-comparison-05 (work</span> in <span class="delete">progress), November 2020.</span></td><td> </td><td class="rblock"><span class="insert">              draft-ietf-lwig-security-protocol-comparison-03, 11 March</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              2019, &lt;http://www.ietf.org/internet-drafts/draft-ietf-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              lwig-security-protocol-comparison-03.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.ietf-tls-dtls13]</td><td> </td><td class="right">   [I-D.ietf-tls-dtls13]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Rescorla, E., Tschofenig, H., and N. Modadugu, "The</td><td> </td><td class="right">              Rescorla, E., Tschofenig, H., and N. Modadugu, "The</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Datagram Transport Layer Security (DTLS) Protocol Version</td><td> </td><td class="right">              Datagram Transport Layer Security (DTLS) Protocol Version</td><td class="lineno"></td></tr>
      <tr id="diff0298"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              1.3", <span class="delete">draft-ietf-tls-dtls13-38 (work</span> in <span class="delete">progress), May</span></td><td> </td><td class="rblock">              1.3", <span class="insert">Work</span> in <span class="insert">Progress, Internet-Draft, draft-ietf-tls-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              2020.</span></td><td> </td><td class="rblock"><span class="insert">              dtls13-34, 19 November 2019, &lt;http://www.ietf.org/</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              internet-drafts/draft-ietf-tls-dtls13-34.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [I-D.selander-ace-ake-authz]</td><td> </td><td class="right">   [I-D.selander-ace-ake-authz]</td><td class="lineno"></td></tr>
      <tr id="diff0299"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Selander, G., Mattsson, J., Vucinic, M., <span class="delete">Richardson, M.,</span></td><td> </td><td class="rblock">              Selander, G., Mattsson, J., Vucinic, M., and <span class="insert">M.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              and <span class="delete">A. Schellenbaum,</span> "Lightweight Authorization for</td><td> </td><td class="rblock"><span class="insert">              Richardson,</span> "Lightweight Authorization for Authenticated</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Authenticated Key Exchange.", <span class="delete">draft-selander-ace-ake-</span></td><td> </td><td class="rblock">              Key Exchange.", <span class="insert">Work</span> in <span class="insert">Progress, Internet-Draft, draft-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              authz-01 (work</span> in <span class="delete">progress), March 2020.</span></td><td> </td><td class="rblock"><span class="insert">              selander-ace-ake-authz-00, 6 February 2020,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              &lt;http://www.ietf.org/internet-drafts/draft-selander-ace-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              ake-authz-00.txt&gt;.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [Kron18]   Krontiris, A., "Evaluation of Certificate Enrollment over</td><td> </td><td class="right">   [Kron18]   Krontiris, A., "Evaluation of Certificate Enrollment over</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Application Layer Security", May 2018,</td><td> </td><td class="right">              Application Layer Security", May 2018,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.nada.kth.se/~ann/exjobb/</td><td> </td><td class="right">              &lt;https://www.nada.kth.se/~ann/exjobb/</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              alexandros_krontiris.pdf&gt;.</td><td> </td><td class="right">              alexandros_krontiris.pdf&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0300"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [LoRa1]    Sanchez-Iborra, R., <span class="delete">Sanchez-Gomez,</span> J., <span class="delete">Perez,</span> S.,</td><td> </td><td class="rblock">   [LoRa1]    Sanchez-Iborra, R., <span class="insert">Sánchez-Gómez,</span> J., <span class="insert">Pérez,</span> S.,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">Fernandez, P.,</span> Santa, J., <span class="delete">Hernandez-Ramos, J.,</span> and <span class="delete">A.</span></td><td> </td><td class="rblock">              <span class="insert">Fernández, P.J.,</span> Santa, J., <span class="insert">Hernández-Ramos, J.L.,</span> and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Skarmeta, "Enhancing LoRaWAN Security through a</td><td> </td><td class="rblock">              <span class="insert">A.F.</span> Skarmeta, "Enhancing LoRaWAN Security through a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Lightweight and Authenticated Key Management Approach",</td><td> </td><td class="right">              Lightweight and Authenticated Key Management Approach",</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              June 2018,</td><td> </td><td class="right">              June 2018,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6021899/pdf/</td><td> </td><td class="right">              &lt;https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6021899/pdf/</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              sensors-18-01833.pdf&gt;.</td><td> </td><td class="right">              sensors-18-01833.pdf&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0301"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [LoRa2]    Sanchez-Iborra, R., <span class="delete">Sanchez-Gomez,</span> J., <span class="delete">Perez,</span> S.,</td><td> </td><td class="rblock">   [LoRa2]    Sanchez-Iborra, R., <span class="insert">Sánchez-Gómez,</span> J., <span class="insert">Pérez,</span> S.,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">Fernandez, P.,</span> Santa, J., <span class="delete">Hernandez-Ramos, J.,</span> and <span class="delete">A.</span></td><td> </td><td class="rblock">              <span class="insert">Fernández, P.J.,</span> Santa, J., <span class="insert">Hernández-Ramos, J.L.,</span> and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Skarmeta, "Internet Access for LoRaWAN Devices Considering</td><td> </td><td class="rblock">              <span class="insert">A.F.</span> Skarmeta, "Internet Access for LoRaWAN Devices</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              Security Issues", June 2018,</td><td> </td><td class="rblock">              Considering Security Issues", June 2018,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://ants.inf.um.es/~josesanta/doc/GIoTS1.pdf&gt;.</td><td> </td><td class="right">              &lt;https://ants.inf.um.es/~josesanta/doc/GIoTS1.pdf&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0302"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [Perez18]  <span class="delete">Perez,</span> S., Garcia-Carrillo, D., <span class="delete">Marin-Lopez,</span> R.,</td><td> </td><td class="rblock">   [Perez18]  <span class="insert">Pérez,</span> S., Garcia-Carrillo, D., <span class="insert">Marín-López,</span> R.,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">Hernandez-Ramos,</span> J., <span class="delete">Marin-Perez,</span> R., and A. Skarmeta,</td><td> </td><td class="rblock">              <span class="insert">Hernández-Ramos,</span> J., <span class="insert">Marín-Pérez,</span> R., and A. Skarmeta,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              "Architecture of security association establishment based</td><td> </td><td class="right">              "Architecture of security association establishment based</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              on bootstrapping technologies for enabling critical IoT</td><td> </td><td class="right">              on bootstrapping technologies for enabling critical IoT</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              K", October 2018, &lt;http://www.anastacia-</td><td> </td><td class="right">              K", October 2018, &lt;http://www.anastacia-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              h2020.eu/publications/Architecture_of_security_association</td><td> </td><td class="right">              h2020.eu/publications/Architecture_of_security_association</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              _establishment_based_on_bootstrapping_technologies_for_ena</td><td> </td><td class="right">              _establishment_based_on_bootstrapping_technologies_for_ena</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              bling_critical_IoT_infrastructures.pdf&gt;.</td><td> </td><td class="right">              bling_critical_IoT_infrastructures.pdf&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC7228]  Bormann, C., Ersue, M., and A. Keranen, "Terminology for</td><td> </td><td class="right">   [RFC7228]  Bormann, C., Ersue, M., and A. Keranen, "Terminology for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Constrained-Node Networks", RFC 7228,</td><td> </td><td class="right">              Constrained-Node Networks", RFC 7228,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              DOI 10.17487/RFC7228, May 2014,</td><td> </td><td class="right">              DOI 10.17487/RFC7228, May 2014,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-13" class="change"><td></td><th><small>skipping to change at</small><a href="#part-13"><em> page 43, line 32<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-13"><em> page 46, line 9<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC7296]  Kaufman, C., Hoffman, P., Nir, Y., Eronen, P., and T.</td><td> </td><td class="right">   [RFC7296]  Kaufman, C., Hoffman, P., Nir, Y., Eronen, P., and T.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Kivinen, "Internet Key Exchange Protocol Version 2</td><td> </td><td class="right">              Kivinen, "Internet Key Exchange Protocol Version 2</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              (IKEv2)", STD 79, RFC 7296, DOI 10.17487/RFC7296, October</td><td> </td><td class="right">              (IKEv2)", STD 79, RFC 7296, DOI 10.17487/RFC7296, October</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              2014, &lt;https://www.rfc-editor.org/info/rfc7296&gt;.</td><td> </td><td class="right">              2014, &lt;https://www.rfc-editor.org/info/rfc7296&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC8446]  Rescorla, E., "The Transport Layer Security (TLS) Protocol</td><td> </td><td class="right">   [RFC8446]  Rescorla, E., "The Transport Layer Security (TLS) Protocol</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              Version 1.3", RFC 8446, DOI 10.17487/RFC8446, August 2018,</td><td> </td><td class="right">              Version 1.3", RFC 8446, DOI 10.17487/RFC8446, August 2018,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.rfc-editor.org/info/rfc8446&gt;.</td><td> </td><td class="right">              &lt;https://www.rfc-editor.org/info/rfc8446&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0303"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">[SIGMA]    Krawczyk, H., "SIGMA - The 'SIGn-and-MAc' Approach to</span></td><td> </td><td class="rblock">   [SSR18]    Bruni, A., Sahl <span class="insert">Jørgensen,</span> T., <span class="insert">Grønbech</span> Petersen, T., and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Authenticated Diffie-Hellman and Its Use in the IKE-</span></td><td> </td><td class="rblock">              C. <span class="insert">Schürmann,</span> "Formal Verification of Ephemeral <span class="insert">Diffie-</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Protocols (Long version)", June 2003,</span></td><td> </td><td class="rblock"><span class="insert">              Hellman</span> Over COSE (EDHOC)", November 2018,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              &lt;http://webee.technion.ac.il/~hugo/sigma-pdf.pdf&gt;.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   [SP-800-56A]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Barker, E., Chen, L., Roginsky, A., Vassilev, A., and R.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Davis, "Recommendation for Pair-Wise Key-Establishment</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              Schemes Using Discrete Logarithm Cryptography",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              NIST Special Publication 800-56A Revision 3, April 2018,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">              &lt;https://doi.org/10.6028/NIST.SP.800-56Ar3&gt;.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [SSR18]    Bruni, A., Sahl <span class="delete">Joergensen,</span> T., <span class="delete">Groenbech</span> Petersen, T.,</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              and C. <span class="delete">Schuermann,</span> "Formal Verification of Ephemeral</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">              <span class="delete">Diffie-Hellman</span> Over COSE (EDHOC)", November 2018,</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              &lt;https://www.springerprofessional.de/en/formal-</td><td> </td><td class="right">              &lt;https://www.springerprofessional.de/en/formal-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              verification-of-ephemeral-diffie-hellman-over-cose-</td><td> </td><td class="right">              verification-of-ephemeral-diffie-hellman-over-cose-</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">              edhoc/16284348&gt;.</td><td> </td><td class="right">              edhoc/16284348&gt;.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Appendix A.  Use of CBOR, CDDL and COSE in EDHOC</td><td> </td><td class="right">Appendix A.  Use of CBOR, CDDL and COSE in EDHOC</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This Appendix is intended to simplify for implementors not familiar</td><td> </td><td class="right">   This Appendix is intended to simplify for implementors not familiar</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   with CBOR [RFC7049], CDDL [RFC8610], COSE [RFC8152], and HKDF</td><td> </td><td class="right">   with CBOR [RFC7049], CDDL [RFC8610], COSE [RFC8152], and HKDF</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC5869].</td><td> </td><td class="right">   [RFC5869].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-14" class="change"><td></td><th><small>skipping to change at</small><a href="#part-14"><em> page 44, line 29<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-14"><em> page 46, line 40<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">   [RFC8610] provides a way to express structures for protocol messages</td><td> </td><td class="right">   [RFC8610] provides a way to express structures for protocol messages</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and APIs that use CBOR.  [RFC8610] also extends the diagnostic</td><td> </td><td class="right">   and APIs that use CBOR.  [RFC8610] also extends the diagnostic</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   notation.</td><td> </td><td class="right">   notation.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   CBOR data items are encoded to or decoded from byte strings using a</td><td> </td><td class="right">   CBOR data items are encoded to or decoded from byte strings using a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   type-length-value encoding scheme, where the three highest order bits</td><td> </td><td class="right">   type-length-value encoding scheme, where the three highest order bits</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   of the initial byte contain information about the major type.  CBOR</td><td> </td><td class="right">   of the initial byte contain information about the major type.  CBOR</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   supports several different types of data items, in addition to</td><td> </td><td class="right">   supports several different types of data items, in addition to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   integers (int, uint), simple values (e.g. null), byte strings (bstr),</td><td> </td><td class="right">   integers (int, uint), simple values (e.g. null), byte strings (bstr),</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and text strings (tstr), CBOR also supports arrays [] of data items,</td><td> </td><td class="right">   and text strings (tstr), CBOR also supports arrays [] of data items,</td><td class="lineno"></td></tr>
      <tr id="diff0304"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   maps {} of pairs of data items, and sequences <span class="delete">[RFC8742]</span> of data</td><td> </td><td class="rblock">   maps {} of pairs of data items, and sequences</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   items.  Some examples are given below.  For a complete specification</td><td> </td><td class="rblock">   <span class="insert">[I-D.ietf-cbor-sequence]</span> of data items.  Some examples are given</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   and more examples, see [RFC7049] and [RFC8610].  We recommend</td><td> </td><td class="rblock">   below.  For a complete specification and more examples, see [RFC7049]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   implementors to get used to CBOR by using the CBOR playground</td><td> </td><td class="rblock">   and [RFC8610].  We recommend implementors to get used to CBOR by</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   [CborMe].</td><td> </td><td class="rblock">   using the CBOR playground [CborMe].</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    Diagnostic          Encoded              Type</td><td> </td><td class="right">    Diagnostic          Encoded              Type</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    ------------------------------------------------------------------</td><td> </td><td class="right">    ------------------------------------------------------------------</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    1                   0x01                 unsigned integer</td><td> </td><td class="right">    1                   0x01                 unsigned integer</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    24                  0x1818               unsigned integer</td><td> </td><td class="right">    24                  0x1818               unsigned integer</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    -24                 0x37                 negative integer</td><td> </td><td class="right">    -24                 0x37                 negative integer</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    -25                 0x3818               negative integer</td><td> </td><td class="right">    -25                 0x3818               negative integer</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    null                0xf6                 simple value</td><td> </td><td class="right">    null                0xf6                 simple value</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    h'12cd'             0x4212cd             byte string</td><td> </td><td class="right">    h'12cd'             0x4212cd             byte string</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    '12cd'              0x4431326364         byte string</td><td> </td><td class="right">    '12cd'              0x4431326364         byte string</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="part-15" class="change"><td></td><th><small>skipping to change at</small><a href="#part-15"><em> page 45, line 11<span class="hide"> ¶</span></em></a></th><th> </th><th><small>skipping to change at</small><a href="#part-15"><em> page 47, line 28<span class="hide"> ¶</span></em></a></th><td></td></tr>
      <tr><td class="lineno"></td><td class="left">    ( 1, 2, null )      0x0102f6             sequence</td><td> </td><td class="right">    ( 1, 2, null )      0x0102f6             sequence</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    1, 2, null          0x0102f6             sequence</td><td> </td><td class="right">    1, 2, null          0x0102f6             sequence</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">    ------------------------------------------------------------------</td><td> </td><td class="right">    ------------------------------------------------------------------</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">A.2.  COSE</td><td> </td><td class="right">A.2.  COSE</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   CBOR Object Signing and Encryption (COSE) [RFC8152] describes how to</td><td> </td><td class="right">   CBOR Object Signing and Encryption (COSE) [RFC8152] describes how to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   create and process signatures, message authentication codes, and</td><td> </td><td class="right">   create and process signatures, message authentication codes, and</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   encryption using CBOR.  COSE builds on JOSE, but is adapted to allow</td><td> </td><td class="right">   encryption using CBOR.  COSE builds on JOSE, but is adapted to allow</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   more efficient processing in constrained devices.  EDHOC makes use of</td><td> </td><td class="right">   more efficient processing in constrained devices.  EDHOC makes use of</td><td class="lineno"></td></tr>
      <tr id="diff0305"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   COSE_Key, COSE_Encrypt0, <span class="delete">and COSE_Sign1</span> objects.</td><td> </td><td class="rblock">   COSE_Key, COSE_Encrypt0, <span class="insert">COSE_Sign1, and COSE_KDF_Context</span> objects.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Appendix B.  Test Vectors</td><td> </td><td class="right">Appendix B.  Test Vectors</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   This appendix provides detailed test vectors to ease implementation</td><td> </td><td class="right">   This appendix provides detailed test vectors to ease implementation</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   and ensure interoperability.  In addition to hexadecimal, all CBOR</td><td> </td><td class="right">   and ensure interoperability.  In addition to hexadecimal, all CBOR</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   data items and sequences are given in CBOR diagnostic notation.  The</td><td> </td><td class="right">   data items and sequences are given in CBOR diagnostic notation.  The</td><td class="lineno"></td></tr>
      <tr id="diff0306"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   test vectors use the default mapping to CoAP where the Initiator acts</td><td> </td><td class="rblock">   test vectors use <span class="insert">1 byte key identifiers, 1 byte connection IDs, and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   as CoAP client (this means that corr = 1).</td><td> </td><td class="rblock">   the default mapping to CoAP where the Initiator acts as CoAP client</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock">   (this means that corr = 1).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">A more extensive test vector suite covering more combinations of</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   authentication method used between Initiator and Responder and</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   related code to generate them can be found at</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   https://github.com/EricssonResearch/EDHOC/tree/master/Test%20Vectors</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   .</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0307"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">B.1.  Test Vectors for EDHOC Authenticated with Signature Keys (<span class="delete">x5t</span>)</td><td> </td><td class="rblock">B.1.  Test Vectors for EDHOC Authenticated with Signature Keys (<span class="insert">RPK</span>)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0308"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   EDHOC with signature authentication <span class="delete">and X.509 certificates</span> is <span class="delete">used.</span></td><td> </td><td class="rblock">   EDHOC with signature authentication is <span class="insert">used:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   In this test vector, the hash value 'x5t' is used to identify the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   certificate.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   method (Signature Authentication)</td><td> </td><td class="right">   method (Signature Authentication)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   0</td><td> </td><td class="right">   0</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0309"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Co<span class="delete">A</span>P is used as transport and the Initiator acts as CoAP client:</td><td> </td><td class="rblock">   Co<span class="insert">a</span>P is used as transport and the Initiator acts as CoAP client:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   corr (the Initiator can correlate message_1 and message_2)</td><td> </td><td class="right">   corr (the Initiator can correlate message_1 and message_2)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   1</td><td> </td><td class="right">   1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0310"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there, METHOD_CORR has the following value:</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   METHOD_CORR (4 * method + corr) (int)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   1</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   No unprotected opaque auxiliary data is sent in the message</td><td> </td><td class="right">   No unprotected opaque auxiliary data is sent in the message</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   exchanges.</td><td> </td><td class="right">   exchanges.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0311"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The <span class="delete">list of supported cipher suites of</span> the Initiator <span class="delete">in order of</span></td><td> </td><td class="rblock">   The <span class="insert">pre-defined Cipher Suite 0 is in place both on</span> the Initiator <span class="insert">and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   preference is</span> the <span class="delete">following:</span></td><td> </td><td class="rblock">   the <span class="insert">Responder, see Section 8.3.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0312"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Supported Cipher Suites (4 bytes)</span></td><td> </td><td class="rblock"><span class="insert">B.1.1.  Input for the Initiator</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   00 01 02 03</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0313"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The <span class="delete">cipher suite selected by</span> the Initiator <span class="delete">is</span> the <span class="delete">most preferred:</span></td><td> </td><td class="rblock">   The <span class="insert">following are the parameters that are set in</span> the Initiator <span class="insert">before</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   the <span class="insert">first message exchange.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0314"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Selected Cipher Suite (int)</span></td><td> </td><td class="rblock">   <span class="insert">Initiator's private authentication key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   0</span></td><td> </td><td class="rblock"><span class="insert">   53 21 fc 01 c2 98 20 06 3a 72 50 8f c6 39 25 1d c8 30 e2 f7 68 3e b8 e3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8a f1 64 a5 b9 af 9b e3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0315"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The mandatory-to-implement cipher suite 0 is supported by both the</span></td><td> </td><td class="rblock">   <span class="insert">Initiator's public authentication key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator and the Responder, see Section 7.3.</span></td><td> </td><td class="rblock"><span class="insert">   42 4c 75 6a b7 7c c6 fd ec f0 b3 ec fc ff b7 53 10 c0 15 bf 5c ba 2e c0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a2 36 e6 65 0c 8a b9 c7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0316"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">B.1.1.  Message_1</span></td><td> </td><td class="rblock">   <span class="insert">kid value to identify the Initiator's public authentication key (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0317"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">X (Initiator's ephemeral private key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">This test vector uses COSE_Key objects to store the raw public keys.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 8f 78 1a 09 53 72 f8 5b 6d 9f 61 09 ae 42 26 11 73 4d 7d bf a0 06 9a 2d</span></td><td> </td><td class="rblock"><span class="insert">   Moreover, EC2 keys with curve Ed25519 are used.  That is in agreement</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> f2 93 5b b2 e0 53 bf 35</span></td><td> </td><td class="rblock"><span class="insert">   with the Cipher Suite 0.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0318"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_X (Initiator's ephemeral public key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">CRED_I =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 89 8f f7 9a 02 06 7a 16 ea 1e cc b9 0f a5 22 46 f5 aa 4d d6 ec 07 6b ba</span></td><td> </td><td class="rblock"><span class="insert">   &lt;&lt; {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 02 59 d9 04 b7 ec 8b 0c</span></td><td> </td><td class="rblock"><span class="insert">     1:  1,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -1:  6,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -2:  h'424c756ab77cc6fdecf0b3ecfcffb75310c015bf5cba2ec0a236e6650c8ab9c7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           '</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   } &gt;&gt;</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0319"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Initiator chooses a connection identifier C_I:</span></td><td> </td><td class="rblock">   <span class="insert">CRED_I (bstr-wrapped COSE_Key) (CBOR-encoded) (42 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 28 a3 01 01 20 06 21 58 20 42 4c 75 6a b7 7c c6 fd ec f0 b3 ec fc ff</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   b7 53 10 c0 15 bf 5c ba 2e c0 a2 36 e6 65 0c 8a b9 c7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0320"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Connection identifier chosen by Initiator (0 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Because COSE_Keys are used, and because kid = h'a2':</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ~~~~~~~~~~~~~~~~~~~~~~~ ID_CRED_I = { 4: h'a2' }</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ~~~~~~~~~~~~~~~~~~~~~~~</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0321"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since no unprotected opaque auxiliary data</span> is <span class="delete">sent</span> in the <span class="delete">message</span></td><td> </td><td class="rblock">   <span class="insert">Note that since the map for ID_CRED_I contains a single 'kid'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   exchanges:</span></td><td> </td><td class="rblock"><span class="insert">   parameter, ID_CRED_I</span> is <span class="insert">used when transported</span> in the <span class="insert">protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of the COSE Object, but only the kid_I is used when added to the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   plaintext (see Section 4.4.2):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0322"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">AD_1 (0</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">ID_CRED_I (in protected header) (CBOR-encoded) (4</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">a1 04 41 a2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   kid_I (in plaintext) (CBOR-encoded) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0323"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since</span> the <span class="delete">list of supported cipher suites needs to contain the</span></td><td> </td><td class="rblock"><span class="insert">B.1.2.  Input for</span> the <span class="insert">Responder</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   selected cipher suite, the initiator truncates the list of supported</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   cipher suites to one cipher suite only, 00.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0324"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Because one single selected cipher suite is conveyed, it is encoded</span></td><td> </td><td class="rblock">   <span class="insert">The following are the parameters that are set in the Responder before</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   as an int instead of an array:</span></td><td> </td><td class="rblock"><span class="insert">   the first message exchange.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0325"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">SUITES_I (int)</span></td><td> </td><td class="rblock">   <span class="insert">the Responder's private authentication key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   74 56 b3 a3 e5 8d 8d 26 dd 36 bc 75 d5 5b 88 63 a8 5d 34 72 f4 a0 1f 02</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   24 62 1b 1c b8 16 6d a9</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the Responder's public authentication key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   1b 66 1e e5 d5 ef 16 72 a2 d8 77 cd 5b c2 0f 46 30 dc 78 a1 14 de 65 9c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   7e 50 4d 0f 52 9a 6b d3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   kid value to identify V's public authentication key (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   This test vector uses COSE_Key objects to store the raw public keys.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Moreover, EC2 keys with curve Ed25519 are used.  That is in agreement</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   with the Cipher Suite 0.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CRED_R =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   &lt;&lt; {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     1:  1,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -1:  6,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -2:  h'1b661ee5d5ef1672a2d877cd5bc20f4630dc78a114de659c7e504d0f529a6bd3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           '</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   } &gt;&gt;</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CRED_R (bstr-wrapped COSE_Key) (CBOR-encoded) (42 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 28 a3 01 01 20 06 21 58 20 1b 66 1e e5 d5 ef 16 72 a2 d8 77 cd 5b c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0f 46 30 dc 78 a1 14 de 65 9c 7e 50 4d 0f 52 9a 6b d3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Because COSE_Keys are used, and because kid = h'a3':</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ~~~~~~~~~~~~~~~~~~~~~~~ ID_CRED_R = { 4: h'a3' }</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ~~~~~~~~~~~~~~~~~~~~~~~</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Note that since the map for ID_CRED_R contains a single 'kid'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   parameter, ID_CRED_I is used when transported in the protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of the COSE Object, but only the kid_R is used when added to the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   plaintext (see Section 4.4.2):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ID_CRED_R (in protected header) (CBOR-encoded) (4 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 04 41 a3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   kid_R (in plaintext) (CBOR-encoded) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.1.3.  Message 1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the input parameters (in Appendix B.1.1):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TYPE (4 * method + corr)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   suite</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   0</td><td> </td><td class="right">   0</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0326"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">With</span> SUITES_I <span class="delete">= 0, message_1 is constructed, as the CBOR Sequence of</span></td><td> </td><td class="rblock">   SUITES_I <span class="insert">: suite</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the CBOR data items above.</span></td><td> </td><td class="rblock"><span class="insert">   0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0327"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">message_1 =</span></td><td> </td><td class="rblock">   <span class="insert">Initiator's ephemeral private key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  (</span></td><td> </td><td class="rblock"><span class="insert">   d4 d8 1a ba fa d9 08 a0 cc ef ef 5a d6 b0 5d 50 27 02 f1 c1 6f 23 2c 25</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    1,</span></td><td> </td><td class="rblock"><span class="insert">   92 93 09 ac 44 1b 95 8e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    0,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'898ff79a02067a16ea1eccb90fa52246f5aa4dd6ec076bba0259d904b7ec8b0c',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h''</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  )</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0328"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">message_1 (CBOR Sequence) (37</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">G_X (X-coordinate of the ephemeral public key of the Initiator) (32</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">01 00 58 20 89 8f f7 9a 02 06 7a 16 ea 1e cc b9 0f a5 22 46 f5 aa 4d d6</span></td><td> </td><td class="rblock">   <span class="insert">b1 a3 e8 94 60 e8 8d 3a 8d 54 21 1d c9 5f 0b 90 3f f2 05 eb 71 91 2d 6d</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ec 07 6b ba 02 59 d9 04 b7 ec 8b 0c 40</span></td><td> </td><td class="rblock"><span class="insert">   b8 f4 af 98 0d 2d b8 3a</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0329"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">B.1.2.  Message_2</span></td><td> </td><td class="rblock">   <span class="insert">C_I (Connection identifier chosen by the Initiator) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0330"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since METHOD_CORR mod 4 equals 1, C_I is omitted from data_2</span>.</td><td> </td><td class="rblock">   <span class="insert">No AD_1 is provided, so AD_1 is absent from message_1</span>.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0331"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Y (Responder's ephemeral private key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Message_1 is constructed, as the CBOR Sequence of the CBOR data items</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> fd 8c d8 77 c9 ea 38 6e 6a f3 4f f7 e6 06 c4 b6 4c a8 31 c8 ba 33 13 4f</span></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> d4 cd 71 67 ca ba ec da</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0332"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_Y (Responder's ephemeral public key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">message_1 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 71 a3 d5 99 c2 1d a1 89 02 a1 ae a8 10 b2 b6 38 2c cd 8d 5f 9b f0 19 52</span></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 81 75 4c 5e bc af 30 1e</span></td><td> </td><td class="rblock"><span class="insert">     1,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     0,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'b1a3e89460e88d3a8d54211dc95f0b903ff205eb71912d6db8f4af980d2db83a',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c3'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0333"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From G_X and Y or from G_Y and X the ECDH shared secret is computed:</span></td><td> </td><td class="rblock">   <span class="insert">message_1 (CBOR Sequence) (38 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   01 00 58 20 b1 a3 e8 94 60 e8 8d 3a 8d 54 21 1d c9 5f 0b 90 3f f2 05 eb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   71 91 2d 6d b8 f4 af 98 0d 2d b8 3a 41 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0334"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_XY (ECDH shared secret)</span> (32 bytes)</td><td> </td><td class="rblock"><span class="insert">B.1.4.  Message 2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">2b b7 fa 6e 13 5b c3 35 d0 22 d6 34 cb fb 14 b3 f5</span> 82 f3 <span class="delete">e2 e3</span> af <span class="delete">b2</span> b3</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">15 04</span> 91 <span class="delete">49 5c</span> 61 <span class="delete">78</span> 2b</td><td> </td><td class="rblock"><span class="insert">   Since TYPE mod 4 equals 1, C_I is omitted from data_2.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Responder's ephemeral private key</span> (32 bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">17 cd c7 bc a3 f2 a0 bd a6 0c 6d e5 b9 6f</span> 82 <span class="insert">a3 62 39 b4 4b de 39 7a 38</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   62 d5 29 ba 8b 3d 7c 62</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_Y (X-coordinate of the ephemeral public key of the Responder) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8d b5 77 f9 b9 c2 74 47 98 98 7d b5 57 bf 31 ca 48 ac d2 05 a9 db 8c 32</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0e 5d 49</span> f3 <span class="insert">02 a9 64 74</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   C_R (Connection identifier chosen by the Responder) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Data_2 is constructed, as the CBOR Sequence of the CBOR data items</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'8db577f9b9c2744798987db557bf31ca48acd205a9db8c320e5d49f302a96474',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c4'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_2 (CBOR Sequence) (36 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 8d b5 77 f9 b9 c2 74 47 98 98 7d b5 57 bf 31 ca 48 ac d2 05 a9 db</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8c 32 0e 5d 49 f3 02 a9 64 74 41 c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From data_2 and message_1 (from Appendix B.1.3), compute the input to</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the transcript hash TH_2 = H( message_1, data_2 ), as a CBOR Sequence</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of these 2 data items.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ( message_1, data_2 ) (CBOR Sequence) (74 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   01 00 58 20 b1 a3 e8 94 60 e8 8d 3a 8d 54 21 1d c9 5f 0b 90 3f f2 05 eb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   71 91 2d 6d b8 f4</span> af <span class="insert">98 0d 2d b8 3a 41 c3 58 20 8d b5 77 f9 b9 c2 74 47</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   98 98 7d b5 57 bf 31 ca 48 ac d2 05 a9 db 8c 32 0e 5d 49 f3 02 a9 64 74</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from there, compute the transcript hash TH_2 = SHA-256(</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_1, data_2 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_2 value (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   55 50</span> b3 <span class="insert">dc 59 84 b0 20 9a e7 4e a2 6a 18</span> 91 <span class="insert">89 57 50 8e 30 33 2b 11 da</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   68 1d c2 af dd 87 03 55</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_2 (CBOR-encoded) (34 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 55 50 b3 dc 59 84 b0 20 9a e7 4e a2 6a 18 91 89 57 50 8e 30 33 2b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   11 da 68 1d c2 af dd 87 03 55</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.1.4.1.  Signature Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   COSE_Sign1 is computed with the following parameters.  From</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Appendix B.1.2:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  protected = bstr .cbor ID_CRED_R</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  payload = CRED_R</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from Appendix B.1.4:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  external_aad = TH_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Sig_structure M_R to be signed is: [ "Signature1",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   &lt;&lt; ID_CRED_R &gt;&gt;, TH_2, CRED_R ] , as defined in Section 4.3.2:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   M_R =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "Signature1",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     &lt;&lt; { 4: h'a3' } &gt;&gt;,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'5550b3dc5984b0209ae74ea26a18918957508e30332b11da681dc2afdd870355',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     &lt;&lt; {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       1:  1,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -1:  6,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -2:  h'1b661ee5d5ef1672a2d877cd5bc20f4630dc78a114de659c7e504d0f529a6b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               d3'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     } &gt;&gt;</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Which encodes to the following byte string ToBeSigned:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   M_R (message to be signed with Ed25519) (CBOR-encoded) (93 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 6a 53 69 67 6e</span> 61 <span class="insert">74 75 72 65 31 44 a1 04 41 a3 58 20 55 50 b3 dc 59</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 b0 20 9a e7 4e a2 6a 18 91 89 57 50 8e 30 33</span> 2b <span class="insert">11 da 68 1d c2 af dd</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   87 03 55 58 28 a3 01 01 20 06 21 58 20 1b 66 1e e5 d5 ef 16 72 a2 d8 77</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   cd 5b c2 0f 46 30 dc 78 a1 14 de 65 9c 7e 50 4d 0f 52 9a 6b d3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The message is signed using the private authentication key of V, and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   produces the following signature:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   V's signature (64 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   52 3d 99 6d fd 9e 2f 77 c7 68 71 8a 30 c3 48 77 8c 5e b8 64 dd 53 7e 55</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   5e 4a 00 05 e2 09 53 07 13 ca 14 62 0d e8 18 7e 81 99 6e e8 04 d1 53 b8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 f6 08 49 6f dc d9 3d 30 fc 1c 8b 45 be cc 06</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.1.4.2.  Key and Nonce Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The key and nonce for calculating the ciphertext are calculated as</td><td> </td><td class="right">   The key and nonce for calculating the ciphertext are calculated as</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   follows, as specified in Section 3.8.</td><td> </td><td class="right">   follows, as specified in Section 3.8.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</td><td> </td><td class="right">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0335"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   PRK<span class="delete">_2e</span> = HMAC-SHA-256(salt, G_XY)</td><td> </td><td class="rblock">   PRK = HMAC-SHA-256(salt, G_XY)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0336"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Salt is the empty byte string.</td><td> </td><td class="rblock">   S<span class="insert">ince this is the asymmetric case, s</span>alt is the empty byte string.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0337"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">salt (0 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">G_XY is the shared secret, and since the curve25519 is used, the ECDH</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   shared secret is the output of the X25519 function.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0338"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there, PRK_2e is computed:</span></td><td> </td><td class="rblock">   <span class="insert">G_XY (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c6 1e 09 09 a1 9d 64 24 01 63 ec 26 2e 9c c4 f8 8c e7 7b e1 23 c5 ab 53</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8d 26 b0 69 22 a5 20 67</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0339"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">PRK_2e (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From there, PRK is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ec 62 92 a0 67 f1 37 fc 7f 59 62 9d 22 6f bf c4 e0 68 89 49 f6 62 a9 7f</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> d8 2f be b7 99 71 39 4a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> SK_R (Responders's private authentication key) (32 bytes)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> df 69 27 4d 71 32 96 e2 46 30 63 65 37 2b 46 83 ce d5 38 1b fc ad cd 44</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0a 24 c3 91 d2 fe db 94</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0340"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since neither the Initiator nor the Responder authenticates with a</span></td><td> </td><td class="rblock">   <span class="insert">PRK (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   static Diffie-Hellman key, PRK_3e2m = PRK_2e</span></td><td> </td><td class="rblock"><span class="insert">   ba 9c 2c a1 c5 62 14 a6 e0 f6 13 ed a8 91 86 8a 4c a3 e3 fa bc c7 79 8f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   dc 01 60 80 07 59 16 71</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0341"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">PRK_3e2m (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Key K_2 is the output of HKDF-Expand(PRK, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ec 62 92 a0 67 f1 37 fc 7f 59 62 9d 22 6f bf c4 e0 68 89 49 f6 62 a9 7f</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> d8 2f be b7 99 71 39 4a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0342"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Responder chooses a connection identifier C_R.</span></td><td> </td><td class="rblock">   <span class="insert">info is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0343"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Connection identifier chosen by Responder (1 byte)</span></td><td> </td><td class="rblock">   <span class="insert">info for K_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   2b</span></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     10,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'5550b3dc5984b0209ae74ea26a18918957508e30332b11da681dc2af</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   dd870355']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0344"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Note that since C_R is a byte string of length one, it is encoded</span> as</td><td> </td><td class="rblock">   <span class="insert">Which</span> as <span class="insert">a</span> CBOR <span class="insert">encoded data item is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">the corresponding integer subtracted by 24 (see bstr_identifier in</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Section 4.3).  Thus 0x2b = 43, 43 - 24 = 19, and 19 in</span> CBOR <span class="delete">encoding</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   is equal to 0x13.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0345"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">C_R (1 byte)</span></td><td> </td><td class="rblock">   <span class="insert">info (K_2) (CBOR-encoded) (48 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   13</span></td><td> </td><td class="rblock"><span class="insert">   84 0a 83 f6 f6 f6 83 f6 f6 f6 83 18 80 40 58 20 55 50 b3 dc 59 84 b0 20</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   9a e7 4e a2 6a 18 91 89 57 50 8e 30 33 2b 11 da 68 1d c2 af dd 87 03 55</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0346"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Data_2 is constructed, as the CBOR Sequence of G_Y and C_R</span>.</td><td> </td><td class="rblock">   <span class="insert">L is the length of K_2, so 16 bytes</span>.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0347"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">data_2 =</span></td><td> </td><td class="rblock">   <span class="insert">From these parameters, K_2 is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  (</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'71a3d599c21da18902a1aea810b2b6382ccd8d5f9bf0195281754c5ebcaf301e',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'13'</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  )</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0348"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">data_2 (CBOR Sequence) (35</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">K_2 (16</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">58 20 71</span> a3 <span class="delete">d5 99 c2 1d a1 89 02 a1 ae a8 10 b2 b6</span> 38 <span class="delete">2c cd 8d 5f 9b f0</span></td><td> </td><td class="rblock">   <span class="insert">da d7 44 af 07 c4 da 27 d1 f0</span> a3 <span class="insert">8a 0c 4b 87</span> 38</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 19 52 81 75 4c 5e bc af 30 1e 13</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0349"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From data_2 and message_1, compute</span> the <span class="delete">input to the transcript hash</span></td><td> </td><td class="rblock">   <span class="insert">Nonce IV_2 is</span> the <span class="insert">output</span> of <span class="insert">HKDF-Expand(PRK, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   TH_2 = H( message_1, data_2 ), as a CBOR Sequence</span> of <span class="delete">these 2 data</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   items.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0350"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Input to calculate TH_2 (CBOR Sequence) (72 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">info is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 01 00 58 20 89 8f f7 9a 02 06 7a 16 ea 1e cc b9 0f a5 22 46 f5 aa 4d d6</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ec 07 6b ba 02 59 d9 04 b7 ec 8b 0c 40 58 20 71 a3 d5 99 c2 1d a1 89 02</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a1 ae a8 10 b2 b6 38 2c cd 8d 5f 9b f0 19 52 81 75 4c 5e bc af 30 1e 13</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0351"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">And from there, compute the transcript hash TH_2</span> = <span class="delete">SHA-256(</span></td><td> </td><td class="rblock">   <span class="insert">info for IV_2</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   message_1, data_2 )</span></td><td> </td><td class="rblock">   <span class="insert">[</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "IV-GENERATION",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 104, h'', h'5550b3dc5984b0209ae74ea26a18918957508e30332b11da681dc2af</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   dd870355']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0352"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">TH_2 (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Which as a CBOR encoded data item is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47 b9 ca fb 60</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 9d e4 f6 a1 76 0d 6c f7</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0353"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Responder's subject name is the empty string:</span></td><td> </td><td class="rblock">   <span class="insert">info (IV_2) (CBOR-encoded) (61 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 6d 49 56 2d 47 45 4e 45 52 41 54 49 4f 4e 83 f6 f6 f6 83 f6 f6 f6 83</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   18 68 40 58 20 55 50 b3 dc 59 84 b0 20 9a e7 4e a2 6a 18 91 89 57 50 8e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   30 33 2b 11 da 68 1d c2 af dd 87 03 55</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0354"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Responders's subject name (text string)</span></td><td> </td><td class="rblock">   <span class="insert">L is the length of IV_2, so 13 bytes.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   ""</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0355"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">CRED_R is the certificate (X509_R) encoded as a CBOR byte string</span>:</td><td> </td><td class="rblock">   <span class="insert">From these parameters, IV_2 is computed</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0356"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">X509_R (110</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">IV_2 (13</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">47 62 4d c9 cd c6 82 4b 2a 4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e 4b f9</span></td><td> </td><td class="rblock">   fb <span class="insert">a1 65 d9</span> 08 <span class="insert">da a7 8e 4f 84 41 42</span> d0</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 03 15 00 ce e6 86 99 79 c2 97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e 5c 50</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> db 78 97 4c 27 15 79 b0 16 33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6 18 0b</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 5a 6a f3 1e 80 20 9a 08 5c</span> fb <span class="delete">f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d 0f fb</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 8e 3f 9a 32 a5</span> 08 <span class="delete">59 ec</span> d0 <span class="delete">bf cf f2 c2 18</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0357"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">CRED_R (112 bytes)</span></td><td> </td><td class="rblock"><span class="insert">B.1.4.3.  Ciphertext Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 58 6e 47 62 4d c9 cd c6 82 4b 2a 4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 4b f9 03 15 00 ce e6 86 99 79 c2 97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 5c 50 db 78 97 4c 27 15 79 b0 16 33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 18 0b 5a 6a f3 1e 80 20 9a 08 5c fb f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0f fb 8e 3f 9a 32 a5 08 59 ec d0 bf cf f2 c2 18</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0358"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">And because certificates are identified by a hash value</span> with the</td><td> </td><td class="rblock">   <span class="insert">COSE_Encrypt0 is computed</span> with the <span class="insert">following parameters.  Note that</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">'x5t' parameter, ID_CRED_R</span> is <span class="delete">the following:</span></td><td> </td><td class="rblock"><span class="insert">   AD_2</span> is <span class="insert">omitted.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0359"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_R = { 34 : COSE_CertHash }. In this example, the hash</span></td><td> </td><td class="rblock">   <span class="insert">*  empty protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   algorithm used is SHA-2 256-bit with hash truncated to 64-bits (value</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   -15).  The hash value is calculated over the certificate X509_R.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0360"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_R</span> =</td><td> </td><td class="rblock">   <span class="insert">*  external_aad</span> = <span class="insert">TH_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">{</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     34: [-15, h'FC79990F2431A3F5']</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   }</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0361"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_R (14 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">*  plaintext = CBOR Sequence of the items kid_R, signature, in this</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   a1 18 22 82 2e 48 fc 79 99 0f 24 31 a3 f5</span></td><td> </td><td class="rblock"><span class="insert">      order.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0362"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since no unprotected opaque auxiliary data is sent</span> in <span class="delete">the message</span></td><td> </td><td class="rblock">   <span class="insert">with kid_R taken from Appendix B.1.2, and signature as calculated</span> in</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   exchanges:</span></td><td> </td><td class="rblock">   <span class="insert">Appendix B.1.4.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0363"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">AD_2  (0 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">The plaintext is the following:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0364"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Plaintext is defined as the empty string:</span></td><td> </td><td class="rblock">   <span class="insert">P_2  (68 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a3 58 40 52 3d 99 6d fd 9e 2f 77 c7 68 71 8a 30 c3 48 77 8c 5e b8 64</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   dd 53 7e 55 5e 4a 00 05 e2 09 53 07 13 ca 14 62 0d e8 18 7e 81 99 6e e8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   04 d1 53 b8 a1 f6 08 49 6f dc d9 3d 30 fc 1c 8b 45 be cc 06</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0365"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">P_2m (0 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From the parameters above, the</span> Enc_structure <span class="insert">A_2</span> is <span class="insert">computed.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   The</span> Enc_structure is <span class="delete">defined as follows: [ "Encrypt0",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R &gt;&gt; ]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0366"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">A_2m</span> =</td><td> </td><td class="rblock">   <span class="insert">A_2</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> [</td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   "Encrypt0",</td><td> </td><td class="rblock">     "Encrypt0",</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">h'A11822822E48FC79990F2431A3F5',</span></td><td> </td><td class="rblock">     <span class="insert">h'',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   h'5820B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF</span></td><td> </td><td class="rblock"><span class="insert">     h'5550b3dc5984b0209ae74ea26a18918957508e30332b11da681dc2afdd870355'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   7586E47624DC9CDC6824B2A4C52E95EC9D6B0534B71C2B49E4BF9031500CEE6869979</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   C297BB5A8B381E98DB714108415E5C50DB78974C271579B01633A3EF6271BE5C225EB</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   28F9CF6180B5A6AF31E80209A085CFBF95F3FDCF9B18B693D6C0E0D0FFB8E3F9A32A5</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   0859ECD0BFCFF2C218'</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   ]</td><td> </td><td class="right">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which encodes to the following byte string to be used as Additional</td><td> </td><td class="right">   Which encodes to the following byte string to be used as Additional</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Authenticated Data:</td><td> </td><td class="right">   Authenticated Data:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0367"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">A_2m</span> (CBOR-encoded) <span class="delete">(173</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">A_2</span> (CBOR-encoded) <span class="insert">(45</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 83 68 45 6e 63 72 79 70 74 30 <span class="delete">4e a1 18 22 82 2e 48 fc 79 99 0f 24 31 a3</span></td><td> </td><td class="rblock">   83 68 45 6e 63 72 79 70 74 30 <span class="insert">40</span> 58 20 <span class="insert">55</span> 50 <span class="insert">b3 dc 59 84</span> b0 20 9a <span class="insert">e7 4e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> f5 58 92</span> 58 20 <span class="delete">b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a</span></td><td> </td><td class="rblock"><span class="insert">   a2 6a 18 91 89 57 50</span> 8e <span class="insert">30 33 2b 11 da 68 1d</span> c2 <span class="insert">af dd 87 03 55</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 47 b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 58 6e 47 62 4d c9 cd c6 82 4b 2a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e 4b f9 03 15 00 ce e6 86 99 79 c2</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e 5c</span> 50 <span class="delete">db 78 97 4c 27 15 79</span> b0 <span class="delete">16</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6 18 0b 5a 6a f3 1e 80</span> 20 9a <span class="delete">08 5c</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> fb f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d 0f fb</span> 8e <span class="delete">3f 9a 32 a5 08 59 ec d0</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> bf cf f2</span> c2 <span class="delete">18</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0368"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">info for K_2m is defined as follows</span>:</td><td> </td><td class="rblock">   <span class="insert">The key and nonce used are defined in Appendix B.1.4.2</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0369"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">info for K_2m</span> =</td><td> </td><td class="rblock">   <span class="insert">*  key</span> = <span class="insert">K_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">[</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    10,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF7',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_2m",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    16</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  ]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0370"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Which as a CBOR encoded data item is:</span></td><td> </td><td class="rblock">   <span class="insert">*  nonce = IV_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0371"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">info for K_2m (CBOR-encoded) (42 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Using the parameters above, the ciphertext CIPHERTEXT_2 can be</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 84 0a 58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47</span></td><td> </td><td class="rblock"><span class="insert">   computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 64 4b 5f 32 6d 10</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0372"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, K_2m is computed.  Key K_2m is the output of</span></td><td> </td><td class="rblock">   <span class="insert">CIPHERTEXT_2 (76 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   HKDF-Expand(PRK_3e2m, info, L), where L is the length of K_2m, so 16</span></td><td> </td><td class="rblock"><span class="insert">   1e 6b fe 0e 77 99 ce f0 66 a3 4f 08 ef aa 90 00 6d b4 4c 90 1c f7 9b 23</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   bytes.</span></td><td> </td><td class="rblock"><span class="insert">   85 3a b9 7f d8 db c8 53 39 d5 ed 80 87 78 3c f7 a4 a7 e0 ea 38 c2 21 78</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   9f a3 71 be 64 e9 3c 43 a7 db 47 d1 e3 fb 14 78 8e 96 7f dd 78 d8 80 78</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   e4 9b 78 bf</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0373"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">K_2m (16 bytes)</span></td><td> </td><td class="rblock"><span class="insert">B.1.4.4.  message_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   b7 48 6a 94 a3 6c f6 9e 67 3f c4 57 55 ee 6b 95</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0374"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">info for IV_2m</span> is <span class="delete">defined</span> as <span class="delete">follows:</span></td><td> </td><td class="rblock">   <span class="insert">From the parameter computed in Appendix B.1.4 and Appendix B.1.4.3,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_2</span> is <span class="insert">computed,</span> as <span class="insert">the CBOR Sequence of the following items:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (G_Y, C_R, CIPHERTEXT_2).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0375"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">info for IV_2m</span> =</td><td> </td><td class="rblock">   <span class="insert">message_2</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">[</span></td><td> </td><td class="rblock">   <span class="insert">(</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    10,</span></td><td> </td><td class="rblock"><span class="insert">     h'8db577f9b9c2744798987db557bf31ca48acd205a9db8c320e5d49f302a96474',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF7',</span></td><td> </td><td class="rblock"><span class="insert">     h'c4',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "IV_2m",</span></td><td> </td><td class="rblock"><span class="insert">     h'1e6bfe0e7799cef066a34f08efaa90006db44c901cf79b23853ab97fd8dbc85339d5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    13</span></td><td> </td><td class="rblock"><span class="insert">       ed8087783cf7a4a7e0ea38c221789fa371be64e93c43a7db47d1e3fb14788e967fdd</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  ]</span></td><td> </td><td class="rblock"><span class="insert">       78d88078e49b78bf'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0376"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Which <span class="delete">as a CBOR encoded data item is</span>:</td><td> </td><td class="rblock">   Which <span class="insert">encodes to the following byte string</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0377"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">info for IV_2m (CBOR-encoded) (43</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">message_2 (CBOR Sequence) (114</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">84 0a</span> 58 20 <span class="delete">b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27</span> bf <span class="delete">c5 2e</span> 31 <span class="delete">1a 47</span></td><td> </td><td class="rblock">   58 20 <span class="insert">8d b5 77 f9 b9 c2 74 47 98 98 7d b5 57</span> bf 31 ca <span class="insert">48 ac d2 05 a9 db</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b9</span> ca <span class="delete">fb 60 9d e4 f6 a1 76 0d 6c f7 65 49 56 5f</span> 32 6d <span class="delete">0d</span></td><td> </td><td class="rblock"><span class="insert">   8c</span> 32 <span class="insert">0e 5d 49 f3 02 a9 64 74 41 c4 58 4c 1e 6b fe 0e 77 99 ce f0 66 a3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4f 08 ef aa 90 00</span> 6d <span class="insert">b4 4c 90 1c f7 9b 23 85 3a b9 7f d8 db c8 53 39 d5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ed 80 87 78 3c f7 a4 a7 e0 ea 38 c2 21 78 9f a3 71 be 64 e9 3c 43 a7 db</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   47 d1 e3 fb 14 78 8e 96 7f dd 78 d8 80 78 e4 9b 78 bf</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0378"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, IV_2m is computed.  IV_2m is the output of</span></td><td> </td><td class="rblock"><span class="insert">B.1.5.  Message 3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   HKDF-Expand(PRK_3e2m, info, L), where L is the length of IV_2m, so 13</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   bytes.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0379"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">IV_2m (13 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Since TYPE mod 4 equals 1, C_R is not omitted from data_3.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   c5 b7 17 0e 65 d5 4f 1a e0 5d 10 af 56</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0380"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Finally, COSE_Encrypt0 is computed from the parameters above.</span></td><td> </td><td class="rblock">   <span class="insert">C_R (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0381"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  protected header = CBOR-encoded ID_CRED_R</span></td><td> </td><td class="rblock">   <span class="insert">Data_3 is constructed, as the CBOR Sequence of the CBOR data item</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0382"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  external_aad</span> = <span class="delete">A_2m</span></td><td> </td><td class="rblock">   <span class="insert">data_3</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">(</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c4'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0383"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  empty plaintext = P_2m</span></td><td> </td><td class="rblock">   <span class="insert">data_3 (CBOR Sequence) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0384"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">MAC_2 (8 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From data_3, CIPHERTEXT_2 (Appendix B.1.4.3), and TH_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   cf 99 99 ae 75 9e c0 d8</span></td><td> </td><td class="rblock"><span class="insert">   (Appendix B.1.4), compute the input to the transcript hash TH_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   H(TH_2 , CIPHERTEXT_2, data_3), as a CBOR Sequence of these 3 data</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   items.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0385"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">To</span> compute the <span class="delete">Signature_or_MAC_2, the key</span> is the <span class="delete">private</span></td><td> </td><td class="rblock">   <span class="insert">( TH_2, CIPHERTEXT_2, data_3 ) (CBOR Sequence) (114 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   authentication key of the Responder and the message M_2</span> to be signed</td><td> </td><td class="rblock"><span class="insert">   58 20 55 50 b3 dc 59 84 b0 20 9a e7 4e a2 6a 18 91 89 57 50 8e 30 33 2b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">=</span> [ "Signature1", &lt;&lt; <span class="delete">ID_CRED_R</span> &gt;&gt;, &lt;&lt; <span class="delete">TH_2, CRED_R, ? AD_2</span> &gt;&gt;, <span class="delete">MAC_2</span></td><td> </td><td class="rblock"><span class="insert">   11 da 68 1d c2 af dd 87 03 55 58 4c 1e 6b fe 0e 77 99 ce f0 66 a3 4f 08</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ef aa 90 00 6d b4 4c 90 1c f7 9b 23 85 3a b9 7f d8 db c8 53 39 d5 ed 80</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   87 78 3c f7 a4 a7 e0 ea 38 c2 21 78 9f a3 71 be 64 e9 3c 43 a7 db 47 d1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   e3 fb 14 78 8e 96 7f dd 78 d8 80 78 e4 9b 78 bf 41 c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from there,</span> compute the <span class="insert">transcript hash TH_3 = SHA-256(TH_2 ,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_2, data_3)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_3 value (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   21 cc b6 78 b7 91 14 96 09 55 88 5b 90 a2 b8 2e 3b 2c a2 7e 8e 37 4a 79</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   07 f3 e7 85 43 67 fc 22</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_3 (CBOR-encoded) (34 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 21 cc b6 78 b7 91 14 96 09 55 88 5b 90 a2 b8 2e 3b 2c a2 7e 8e 37</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4a 79 07 f3 e7 85 43 67 fc 22</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.1.5.1.  Signature Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   COSE_Sign1</span> is <span class="insert">computed with</span> the <span class="insert">following parameters.  From</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Appendix B.1.1:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  protected = bstr .cbor ID_CRED_I</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  payload = CRED_I</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from Appendix B.1.5:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  external_aad = TH_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Sig_structure M_I</span> to be signed <span class="insert">is:</span> [ "Signature1",</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   &lt;&lt; <span class="insert">ID_CRED_I</span> &gt;&gt;, <span class="insert">TH_3, CRED_I ] , as defined in Section 4.4.2:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   M_I =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "Signature1",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     &lt;&lt; <span class="insert">{ 4: h'a2' }</span> &gt;&gt;,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     <span class="insert">h'21ccb678b79114960955885b90a2b82e3b2ca27e8e374a7907f3e7854367fc22',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     &lt;&lt; {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       1:  1,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -1:  6,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      -2:  h'424c756ab77cc6fdecf0b3ecfcffb75310c015bf5cba2ec0a236e6650c8ab9</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               c7'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     } &gt;&gt;</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   ]</td><td> </td><td class="right">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0386"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">M_2</span> =</td><td> </td><td class="rblock">   <span class="insert">Which encodes to the following byte string ToBeSigned:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> [</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">"Signature1",</span></td><td> </td><td class="rblock"><span class="insert">   M_I (message to be signed with Ed25519) (CBOR-encoded) (93 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   h'A11822822E48FC79990F2431A3F5',</span></td><td> </td><td class="rblock"><span class="insert">   84 6a 53 69 67 6e 61 74 75 72 65 31 44 a1 04 41 a2 58 20 21 cc b6 78 b7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   h'5820B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF</span></td><td> </td><td class="rblock"><span class="insert">   91 14 96 09 55 88 5b 90 a2 b8 2e 3b 2c a2 7e 8e 37 4a 79 07 f3 e7 85 43</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   7586E47624DC9CDC6824B2A4C52E95EC9D6B0534B71C2B49E4BF9031500CEE6869979</span></td><td> </td><td class="rblock"><span class="insert">   67 fc 22 58 28 a3 01 01 20 06 21 58 20 42 4c 75 6a b7 7c c6 fd ec f0 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   C297BB5A8B381E98DB714108415E5C50DB78974C271579B01633A3EF6271BE5C225EB</span></td><td> </td><td class="rblock"><span class="insert">   ec fc ff b7 53 10 c0 15 bf 5c ba 2e c0 a2 36 e6 65 0c 8a b9 c7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   28F9CF6180B5A6AF31E80209A085CFBF95F3FDCF9B18B693D6C0E0D0FFB8E3F9A32A5</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   0859ECD0BFCFF2C218',</span></td><td> </td><td class="rblock"><span class="insert">   The message is signed using the private authentication key of U, and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   h'CF9999AE759EC0D8'</span></td><td> </td><td class="rblock"><span class="insert">   produces the following signature:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> ]</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Initiator's signature (64 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   5c 7d 7d 64 c9 61 c5 f5 2d cf 33 91 25 92 a1 af f0 2c 33 62 b0 e7 55 0e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4b c5 66 b7 0c 20 61 f3 c5 f6 49 e5 ed 32 3d 30 a2 6c 61 2f bb 5c bd 25</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f3 1c 27 22 8c ea ec 64 29 31 95 41 fe 07 8e 0e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.1.5.2.  Key and Nonce Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce for calculating the ciphertext are calculated as</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   follows, as specified in Section 3.8.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0 ).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK</span> = <span class="insert">HMAC-SHA-256(salt, G_XY)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Since this is the asymmetric case, salt is the empty byte string.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_XY is the shared secret, and since the curve25519 is used, the ECDH</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   shared secret is the output of the X25519 function.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_XY (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c6 1e 09 09 a1 9d 64 24 01 63 ec 26 2e 9c c4 f8 8c e7 7b e1 23 c5 ab 53</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8d 26 b0 69 22 a5 20 67</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From there, PRK is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ba 9c 2c a1 c5 62 14 a6 e0 f6 13 ed a8 91 86 8a 4c a3 e3 fa bc c7 79 8f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   dc 01 60 80 07 59 16 71</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Key K_3 is the output of HKDF-Expand(PRK, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info for K_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     10,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     [ <span class="insert">128, h'', h'21ccb678b79114960955885b90a2b82e3b2ca27e8e374a7907f3e785</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   4367fc22']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0387"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">M_2 (184</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">info (K_3) (CBOR-encoded) (48</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 <span class="delete">6a 53 69 67 6e 61 74 75 72 65 31 4e a1</span> 18 <span class="delete">22 82 2e 48 fc 79 99 0f 24</span></td><td> </td><td class="rblock">   84 <span class="insert">0a 83 f6 f6 f6 83 f6 f6 f6 83</span> 18 <span class="insert">80 40</span> 58 20 <span class="insert">21 cc b6 78 b7 91 14 96</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 31 a3 f5 58 92</span> 58 20 <span class="delete">b0 dc 6c 1b a0 ba e6 e2</span> 88 <span class="delete">86 10 fa 0b 27 bf c5</span> 2e</td><td> </td><td class="rblock"><span class="insert">   09 55</span> 88 <span class="insert">5b 90 a2 b8</span> 2e <span class="insert">3b 2c a2 7e 8e 37 4a</span> 79 <span class="insert">07</span> f3 <span class="insert">e7 85 43 67 fc 22</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">31 1a 47 b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 58 6e 47 62 4d c9 cd c6 82</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 4b 2a 4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e 4b f9 03 15 00 ce e6 86 99</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 79 c2 97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e 5c 50 db 78 97 4c 27 15</span> 79</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">b0 16 33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6 18 0b 5a 6a</span> f3 <span class="delete">1e 80 20 9a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 08 5c fb f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d 0f fb 8e 3f 9a 32 a5 08 59</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ec d0 bf cf f2 c2 18 48 cf 99 99 ae 75 9e c0 d8</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0388"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there Signature_or_MAC_2 is a signature (since method = 0):</span></td><td> </td><td class="rblock">   <span class="insert">L is the length of K_3, so 16 bytes.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0389"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Signature_or_MAC_2 (64 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From these parameters, K_3 is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 45 47 81 ec ef eb b4 83 e6 90 83 9d 57 83 8d fe 24 a8 cf 3f 66 42 8a a0</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 16 20 4a 22 61 84 4a f8 4f 98 b8 c6 83 4f 38 7f dd 60 6a 29 41 3a dd e3</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a2 07 74 02 13 74 01 19 6f 6a 50 24 06 6f ac 0e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0390"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a</span></td><td> </td><td class="rblock">   <span class="insert">K_3 (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   plaintext constructed from the following parameters and the key K_2e.</span></td><td> </td><td class="rblock"><span class="insert">   e1 ac d4 76 f5 96 a4 60 72 44 a8 da 8c ff 49 df</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0391"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o</span>  plaintext = CBOR Sequence of the items <span class="delete">ID_CRED_R and</span></td><td> </td><td class="rblock">   <span class="insert">Nonce IV_3 is the output of HKDF-Expand(PRK, info, L).info is defined</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      Singature_or_MAC_2,</span> in this order.</td><td> </td><td class="rblock"><span class="insert">   as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info for IV_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "IV-GENERATION",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 104, h'', h'21ccb678b79114960955885b90a2b82e3b2ca27e8e374a7907f3e785</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   4367fc22']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Which as a CBOR encoded data item is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info (IV_3) (CBOR-encoded) (61 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 6d 49 56 2d 47 45 4e 45 52 41 54 49 4f 4e 83 f6 f6 f6 83 f6 f6 f6 83</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   18 68 40 58 20 21 cc b6 78 b7 91 14 96 09 55 88 5b 90 a2 b8 2e 3b 2c a2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   7e 8e 37 4a 79 07 f3 e7 85 43 67 fc 22</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From these parameters, IV_3 is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   IV_3 (13 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   de 53 02 13 ab a2 6a 47 1a 51 f3 d6 fb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.1.5.3.  Ciphertext Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   COSE_Encrypt0 is computed with the following parameters.  Note that</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   AD_3 is omitted.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  empty protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  external_aad = TH_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *</span>  plaintext = CBOR Sequence of the items <span class="insert">kid_I, signature,</span> in this</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">      order.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">with kid_I taken from Appendix B.1.1, and signature as calculated in</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Appendix B.1.5.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The plaintext is the following:</td><td> </td><td class="right">   The plaintext is the following:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0392"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">P_2e (CBOR Sequence) (80</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">P_3  (68</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">a1 18 22 82 2e 48 fc 79 99 0f 24 31 a3 f5</span> 58 40 <span class="delete">45 47 81 ec ef eb b4 83</span></td><td> </td><td class="rblock">   <span class="insert">41 a2</span> 58 40 <span class="insert">5c 7d 7d 64 c9 61 c5 f5 2d</span> cf <span class="insert">33 91 25 92 a1 af f0 2c 33 62</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e6 90 83 9d 57 83 8d fe 24 a8</span> cf <span class="delete">3f</span> 66 <span class="delete">42 8a a0 16</span> 20 <span class="delete">4a 22</span> 61 <span class="delete">84 4a f8</span></td><td> </td><td class="rblock"><span class="insert">   b0 e7 55 0e 4b c5</span> 66 <span class="insert">b7 0c</span> 20 61 <span class="insert">f3 c5 f6 49 e5 ed 32 3d 30 a2 6c 61 2f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 4f 98 b8 c6 83 4f 38 7f dd 60 6a</span> 29 41 <span class="delete">3a dd e3 a2</span> 07 <span class="delete">74 02 13 74 01 19</span></td><td> </td><td class="rblock"><span class="insert">   bb 5c bd 25 f3 1c 27 22 8c ea ec 64</span> 29 <span class="insert">31 95</span> 41 <span class="insert">fe</span> 07 <span class="insert">8e</span> 0e</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 6f 6a 50 24 06 6f ac</span> 0e</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0393"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">K_2e = HKDF-Expand( PRK, info, length ), where length is</span> the <span class="delete">length</span></td><td> </td><td class="rblock">   <span class="insert">From</span> the <span class="insert">parameters above,</span> the <span class="insert">Enc_structure A_3 is computed.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   of</span> the <span class="delete">plaintext, so 80.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0394"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">info for K_2e</span> =</td><td> </td><td class="rblock">   <span class="insert">A_3</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">10,</span></td><td> </td><td class="rblock">     <span class="insert">"Encrypt0",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF7',</span></td><td> </td><td class="rblock"><span class="insert">     h'',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_2e",</span></td><td> </td><td class="rblock"><span class="insert">     h'21ccb678b79114960955885b90a2b82e3b2ca27e8e374a7907f3e7854367fc22'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    80</span></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0395"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Which as <span class="delete">a CBOR encoded data item is:</span></td><td> </td><td class="rblock">   Which <span class="insert">encodes to the following byte string to be used</span> as <span class="insert">Additional</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Authenticated Data:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0396"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">info for K_2e</span> (CBOR-encoded) <span class="delete">(43</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">A_3</span> (CBOR-encoded) <span class="insert">(45</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">84 0a</span> 58 20 <span class="delete">b0 dc 6c 1b a0 ba e6 e2</span> 88 <span class="delete">86 10 fa 0b 27 bf c5</span> 2e <span class="delete">31 1a 47</span></td><td> </td><td class="rblock">   <span class="insert">83 68 45 6e 63 72 79 70 74 30 40</span> 58 20 <span class="insert">21 cc b6 78 b7 91 14 96 09 55</span> 88</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 64 4b 5f 32 65 18 50</span></td><td> </td><td class="rblock">   <span class="insert">5b 90 a2 b8</span> 2e <span class="insert">3b 2c a2 7e 8e 37 4a 79 07 f3 e7 85 43 67 fc 22</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0397"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there, K_2e is computed</span>:</td><td> </td><td class="rblock">   <span class="insert">The key and nonce used are defined in Appendix B.1.5.2</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0398"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">K_2e (80 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">*  key = K_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 38 cd 1a 83 89 6d 43 af 3d e8 39 35 27 42 0d ac 7d 7a 76 96 7e 85 74 58</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 26 bb 39 e1 76 21 8d 7e 5f e7 97 60 14 c9 ed ba c0 58 ee 18 cd 57 71 80</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a4 4d de 0b 83 00 fe 8e 09 66 9a 34 d6 3e 3a e6 10 12 26 ab f8 5c eb 28</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 05 dc 00 13 d1 78 2a 20</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0399"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Using the parameters above, the ciphertext <span class="delete">CIPHERTEXT_2</span> can be</td><td> </td><td class="rblock">   <span class="insert">*  nonce = IV_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   Using the parameters above, the ciphertext <span class="insert">CIPHERTEXT_3</span> can be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   computed:</td><td> </td><td class="right">   computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0400"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">CIPHERTEXT_2 (80</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">CIPHERTEXT_3 (76</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">99 d5 38 01 a7 25 bf d6 a4 e7 1d 04 84 b7 55 ec 38</span> 3d <span class="delete">f7 7a 91 6e c0 db</span></td><td> </td><td class="rblock">   <span class="insert">de 4a 83</span> 3d <span class="insert">48 b6 64 74 14 2c c9 bd ce 87 d9</span> 3a <span class="insert">f8 35 57 9c 2d bf 1b 9e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> c0 2b ba 7c 21 a2 00 80 7b 4f 58 5f 72 8b 67 1a d6 78 a4</span> 3a <span class="delete">ac d3 3b 78</span></td><td> </td><td class="rblock"><span class="insert">   2f b4 dc</span> 66 <span class="insert">60 0d ba</span> c6 <span class="insert">bb 3c c0 5c 29 0e f3 5d 51 5b 4d 7d 64 83 f5 09</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> eb d5</span> 66 <span class="delete">cd 00 4f</span> c6 <span class="delete">f1 d4 06 f0</span> 1d <span class="delete">97</span> 04 <span class="delete">e7 05 b2 15 52 a9 eb 28 ea 31</span></td><td> </td><td class="rblock"><span class="insert">   61 43 b5 56 44 cf af d1 ff aa 7f 2b a3 86 36 57 83</span> 1d <span class="insert">d2 e5 bd</span> 04 <span class="insert">04 38</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 6a b6 50 37 d7 17 86 2e</span></td><td> </td><td class="rblock"><span class="insert">   60 14 0d c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0401"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">message_2 is the CBOR Sequence of data_2 and CIPHERTEXT_2, in this</span></td><td> </td><td class="rblock"><span class="insert">B.1.5.4.  message_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   order:</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0402"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">message_2 =</span></td><td> </td><td class="rblock">   <span class="insert">From the parameter computed in Appendix B.1.5 and Appendix B.1.5.3,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> (</span></td><td> </td><td class="rblock"><span class="insert">   message_3 is computed, as the CBOR Sequence of the following items:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  data_2,</span></td><td> </td><td class="rblock"><span class="insert">   (C_R, CIPHERTEXT_3).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  h'99d53801a725bfd6a4e71d0484b755ec383df77a916ec0dbc02bba7c21a200807b4f</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 585f728b671ad678a43aacd33b78ebd566cd004fc6f1d406f01d9704e705b21552a9eb</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 28ea316ab65037d717862e'</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> )</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0403"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Which as a CBOR encoded data item is:</span></td><td> </td><td class="rblock">   <span class="insert">message_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c4',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'de4a833d48b66474142cc9bdce87d93af835579c2dbf1b9e2fb4dc66600dbac6bb3c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       c05c290ef35d515b4d7d6483f5096143b55644cfafd1ffaa7f2ba3863657831dd2e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       bd04043860140dc8'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0404"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">message_2 (CBOR Sequence) (117 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Which encodes to the following byte string:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 58 20 71 a3 d5 99 c2 1d a1 89 02 a1 ae a8 10 b2 b6 38 2c cd 8d 5f 9b f0</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 19 52 81 75 4c 5e bc af 30 1e 13 58 50 99 d5 38 01 a7 25 bf d6 a4 e7 1d</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 04 84 b7 55 ec 38 3d f7 7a 91 6e c0 db c0 2b ba 7c 21 a2 00 80 7b 4f 58</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 5f 72 8b 67 1a d6 78 a4 3a ac d3 3b 78 eb d5 66 cd 00 4f c6 f1 d4 06 f0</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1d 97 04 e7 05 b2 15 52 a9 eb 28 ea 31 6a b6 50 37 d7 17 86 2e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0405"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">B.1.3.  Message_3</span></td><td> </td><td class="rblock">   <span class="insert">message_3 (CBOR Sequence) (80 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 c4 58 4c de 4a 83 3d 48 b6 64 74 14 2c c9 bd ce 87 d9 3a f8 35 57 9c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   2d bf 1b 9e 2f b4 dc 66 60 0d ba c6 bb 3c c0 5c 29 0e f3 5d 51 5b 4d 7d</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   64 83 f5 09 61 43 b5 56 44 cf af d1 ff aa 7f 2b a3 86 36 57 83 1d d2 e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   bd 04 04 38 60 14 0d c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0406"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Since corr equals 1, C_R is not omitted from data_3.</span></td><td> </td><td class="rblock"><span class="insert">B.1.5.5.  OSCORE Security Context Derivation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0407"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">SK_I (Initiator's private authentication key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From the previous message exchange, the Common Security Context for</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 2f fc e7 a0 b2 b8 25 d3 97 d0 cb 54 f7 46 e3 da 3f 27 59 6e e0 6b 53 71</span></td><td> </td><td class="rblock"><span class="insert">   OSCORE [RFC8613] can be derived, as specified in Section 3.8.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 48 1d c0 e0 12 bc 34 d7</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0408"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">HKDF SHA-256</span> is the <span class="delete">HKDF used (as defined by cipher suite 0).</span></td><td> </td><td class="rblock">   <span class="insert">First af all, TH_4</span> is <span class="insert">computed: TH_4 = H( TH_3, CIPHERTEXT_3 ), where</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   the <span class="insert">input to the hash function is the CBOR Sequence of TH_3 and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0409"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">PRK_4x3m = HMAC-SHA-256 (PRK_3e2m, G_IY)</span></td><td> </td><td class="rblock">   <span class="insert">( TH_3, CIPHERTEXT_3 ) (CBOR Sequence) (112 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 21 cc b6 78 b7 91 14 96 09 55 88 5b 90 a2 b8 2e 3b 2c a2 7e 8e 37</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4a 79 07 f3 e7 85 43 67 fc 22 58 4c de 4a 83 3d 48 b6 64 74 14 2c c9 bd</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ce 87 d9 3a f8 35 57 9c 2d bf 1b 9e 2f b4 dc 66 60 0d ba c6 bb 3c c0 5c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   29 0e f3 5d 51 5b 4d 7d 64 83 f5 09 61 43 b5 56 44 cf af d1 ff aa 7f 2b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a3 86 36 57 83 1d d2 e5 bd 04 04 38 60 14 0d c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0410"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">PRK_4x3m</span> (32 bytes)</td><td> </td><td class="rblock">   <span class="insert">And from there, compute the transcript hash TH_4 = SHA-256( TH_3,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">ec 62 92 a0</span> 67 <span class="delete">f1 37 fc 7f 59 62</span> 9d <span class="delete">22 6f bf c4 e0 68 89 49 f6 62 a9</span> 7f</td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_3 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">d8 2f be b7 99 71 39 4a</span></td><td> </td><td class="rblock"><span class="insert">   TH_4 value</span> (32 bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">51 ed 39 32 bc ba e8 90 1c 1d 4d eb 94 bd</span> 67 <span class="insert">3a b4 d3 8c 34 81 96 09 ee</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0d 5c</span> 9d <span class="insert">a6 e9 80</span> 7f <span class="insert">e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0411"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">data 3 is equal to C_R.</span></td><td> </td><td class="rblock">   <span class="insert">When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0412"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">data_3 (CBOR Sequence) (1</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">TH_4 (CBOR-encoded) (34</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">13</span></td><td> </td><td class="rblock">   <span class="insert">58 20 51 ed 39 32 bc ba e8 90 1c 1d 4d eb 94 bd 67 3a b4 d3 8c 34 81 96</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   09 ee 0d 5c 9d a6 e9 80 7f e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0413"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From data_3, CIPHERTEXT_2, and TH_2, compute</span> the <span class="delete">input to</span> the</td><td> </td><td class="rblock">   <span class="insert">To derive</span> the <span class="insert">Master Secret and Master Salt</span> the <span class="insert">same HKDF-Expand</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">transcript hash TH_3 = H(TH_2 , CIPHERTEXT_2, data_3), as a CBOR</span></td><td> </td><td class="rblock"><span class="insert">   (PRK, info, L) is used, with different info and L.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Sequence of these 3 data items.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0414"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Input to calculate TH_3 (CBOR Sequence) (117 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">For Master Secret:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47 b9 ca</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> fb 60 9d e4 f6 a1 76 0d 6c f7 58 50 99 d5 38 01 a7 25 bf d6 a4 e7 1d 04</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 84 b7 55 ec 38 3d f7 7a 91 6e c0 db c0 2b ba 7c 21 a2 00 80 7b 4f 58 5f</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 72 8b 67 1a d6 78 a4 3a ac d3 3b 78 eb d5 66 cd 00 4f c6 f1 d4 06 f0 1d</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 97 04 e7 05 b2 15 52 a9 eb 28 ea 31 6a b6 50 37 d7 17 86 2e 13</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0415"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">And from there, compute the transcript hash TH_3</span> = <span class="delete">SHA-256(TH_2 ,</span></td><td> </td><td class="rblock">   <span class="insert">L for Master Secret</span> = <span class="insert">16</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   CIPHERTEXT_2, data_3)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0416"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">TH_3 (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">info for Master Secret =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e f6 ee e4 dd</span></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b3 2e 4a 27 ce 93 58 da</span></td><td> </td><td class="rblock"><span class="insert">     "OSCORE Master Secret",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'51ed3932bcbae8901c1d4deb94bd673ab4d38c34819609ee0d5c9da6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   e9807fe5']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0417"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The initiator's subject name is the empty string</span>:</td><td> </td><td class="rblock">   <span class="insert">When encoded as a CBOR bstr, that gives</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0418"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Initiator's subject name (text string)</span></td><td> </td><td class="rblock">   <span class="insert">info (OSCORE Master Secret) (CBOR-encoded) (68 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   ""</span></td><td> </td><td class="rblock"><span class="insert">   84 74 4f 53 43 4f 52 45 20 4d 61 73 74 65 72 20 53 65 63 72 65 74 83 f6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f6 f6 83 f6 f6 f6 83 18 80 40 58 20 51 ed 39 32 bc ba e8 90 1c 1d 4d eb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   94 bd 67 3a b4 d3 8c 34 81 96 09 ee 0d 5c 9d a6 e9 80 7f e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0419"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">CRED_I is the certificate (X509_I) encoded as a CBOR byte string</span>:</td><td> </td><td class="rblock">   <span class="insert">Finally, the Master Secret value computed is</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0420"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">X509_I (101</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">OSCORE Master Secret (16</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">fa 34 b2 2a 9c a4 a1 e1 29 24 ea e1 d1 76 60 88</span> 09 <span class="delete">84 49 cb 84 8f fc 79</span></td><td> </td><td class="rblock">   09 02 <span class="insert">9d b0 0c 3e 01 27 42 c3 a8 69 04 07 4c 0e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 5f 88 af c4 9c be 8a fd d1 ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01 95 60</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1f 6f 0a 08 52 97 8b d4 3d 28 20 7d 44 48 65</span> 02 <span class="delete">ff 7b dd a6 32 c7 88 37</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 00 16 b8 96 5b db 20 74 bf f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44 2b 87</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ec 3f f2 45 b7</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0421"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">CRED_I (103 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">For Master Salt:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 58 65 fa 34 b2 2a 9c a4 a1 e1 29 24 ea e1 d1 76 60 88 09 84 49 cb 84 8f</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> fc 79 5f 88 af c4 9c be 8a fd d1 ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 95 60 1f 6f 0a 08 52 97 8b d4 3d 28 20 7d 44 48 65 02 ff 7b dd a6 32 c7</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 88 37 00 16 b8 96 5b db 20 74 bf f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 2b 87 ec 3f f2 45 b7</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0422"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">And because certificates are identified by a hash value with the</span></td><td> </td><td class="rblock">   <span class="insert">L for Master Salt = 8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   'x5t' parameter, ID_CRED_I is the following:</span></td><td> </td><td class="rblock"><span class="insert">   info for Master Salt =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "OSCORE Master Salt",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 64, h'', h'51ed3932bcbae8901c1d4deb94bd673ab4d38c34819609ee0d5c9da6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   e9807fe5']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0423"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_I = { 34 : COSE_CertHash }. In this example, the hash</span></td><td> </td><td class="rblock">   <span class="insert">When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   algorithm used is SHA-2 256-bit with hash truncated to 64-bits (value</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   -15).  The hash value is calculated over the certificate X509_I.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0424"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_I</span> =</td><td> </td><td class="rblock">   <span class="insert">info (OSCORE Master Salt) (CBOR-encoded) (66 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 72 4f 53 43 4f 52 45 20 4d 61 73 74 65 72 20 53 61 6c 74 83 f6 f6 f6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   83 f6 f6 f6 83 18 40 40 58 20 51 ed 39 32 bc ba e8 90 1c 1d 4d eb 94 bd</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   67 3a b4 d3 8c 34 81 96 09 ee 0d 5c 9d a6 e9 80 7f e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Finally, the Master Salt value computed is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   OSCORE Master Salt (8 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   81 02 97 22 a2 30 4a 06</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Client's Sender ID takes the value of C_R:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Client's OSCORE Sender ID (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Server's Sender ID takes the value of C_I:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Server's OSCORE Sender ID (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The algorithms are those negociated in the cipher suite:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   AEAD Algorithm</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   10</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HMAC Algorithm</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.  Test Vectors for EDHOC Authenticated with Symmetric Keys (PSK)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Symmetric EDHOC is used:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   method (Symmetric Authentication)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CoaP is used as transport and the Initiator acts as CoAP client:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   corr (the Initiator can correlate message_1 and message_2)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   No unprotected opaque auxiliary data is sent in the message</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   exchanges.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The pre-defined Cipher Suite 0 is in place both on the Initiator and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the Responder, see Section 8.3.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.1.  Input for the Initiator</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The following are the parameters that are set in the Initiator before</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the first message exchange.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Initiator's ephemeral private key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f4 0c ea f8 6e 57 76 92 33 32 b8 d8 fd 3b ef 84 9c ad b1 9c 69 96 bc 27</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   2a f1 f6 48 d9 56 6a 4c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Initiator's ephemeral public key (value of G_X) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ab 2f ca 32 89 83 22 c2 08 fb 2d ab 50 48 bd 43 c3 55 c6 43 0f 58 88 97</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   cb 57 49 61 cf a9 80 6f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Connection identifier chosen by the Initiator (value of C_I) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Pre-shared Key (PSK) (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 1f 8f 12 d0 87 6f 73 6d 2d 8f d2 6e 14 c2 de</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   kid value to identify PSK (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   So ID_PSK is defined as the following:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ID_PSK</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   {</td><td> </td><td class="right">   {</td><td class="lineno"></td></tr>
      <tr id="diff0425"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     <span class="delete">34: [-15, h'FC79990F2431A3F5']</span></td><td> </td><td class="rblock">     <span class="insert">4:h'a1'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   }</td><td> </td><td class="right">   }</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0426"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_I (14 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">This test vector uses COSE_Key objects to store the pre-shared key.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   a1 18 22 82 2e 48 5b 78 69 88 43 9e bc f2</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0427"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since no opaque auxiliary data</span> is <span class="delete">exchanged:</span></td><td> </td><td class="rblock">   <span class="insert">Note that since the map for ID_PSK contains a single 'kid' parameter,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ID_PSK</span> is <span class="insert">used when transported in the protected header of the COSE</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Object, but only the kid is used when added to the plaintext (see</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Section 5.1):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0428"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">AD_3 (0</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">ID_PSK (in protected header) (CBOR-encoded) (4</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">a1 04 41 a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   kid (in plaintext) (CBOR-encoded) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0429"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   The Plaintext of the COSE_Encrypt is the empty string:</span></td><td> </td><td class="rblock"><span class="insert">B.2.2.  Input for the Responder</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0430"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">P_3m (0 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">The following are the parameters that are set in the Responder before</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the first message exchange.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0431"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The external_aad is the CBOR Sequence od CRED_I and TH_3, in this</span></td><td> </td><td class="rblock">   <span class="insert">Responder's ephemeral private key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   order:</span></td><td> </td><td class="rblock"><span class="insert">   d9 81 80 87 de 72 44 ab c1 b5 fc f2 8e 55 e4 2c 7f f9 c6 78 c0 60 51 81</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f3 7a c5 d7 41 4a 7b 95</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0432"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">A_3m (CBOR-encoded) (164</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">Responder's ephemeral public key (value of G_Y) (32</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">83 68 45 6e 63 72 79 70 74 30 4e a1 18</span> 22 <span class="delete">82 2e 48 5b 78 69 88 43 9e bc</span></td><td> </td><td class="rblock">   <span class="insert">fc 3b 33 93 67 a5</span> 22 <span class="insert">5d 53 a9</span> 2d <span class="insert">38 03 23 af d0 35 d7 81 7b</span> 6d <span class="insert">1b</span> e4 <span class="insert">7d</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> f2 58 89 58 20 a2 39 a6 27 ad a3 80</span> 2d <span class="delete">b8 da e5 1e c3 92 bf eb 92</span> 6d <span class="delete">39</span></td><td> </td><td class="rblock"><span class="insert">   94 6f 6b</span> 09 <span class="insert">a9</span> cb <span class="insert">dc 06</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 3e f6 ee</span> e4 <span class="delete">dd b3 2e 4a 27 ce 93 58 da 58 65 fa 34 b2 2a 9c a4 a1 e1 29</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 24 ea e1 d1 76 60 88</span> 09 <span class="delete">84 49</span> cb <span class="delete">84 8f fc 79 5f 88 af c4 9c be 8a fd d1</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01 95 60 1f 6f 0a 08 52 97 8b d4 3d</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 28 20 7d 44 48 65 02 ff 7b dd a6 32 c7 88 37 00 16 b8 96 5b db 20 74 bf</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44 2b 87 ec 3f f2 45 b7</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0433"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Info for K_3m is computed as follows:</span></td><td> </td><td class="rblock">   <span class="insert">Connection identifier chosen by the Responder (value of C_R) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0434"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for <span class="delete">K_3m</span> =</td><td> </td><td class="rblock">   <span class="insert">Pre-shared Key (PSK) (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock"><span class="insert">   a1 1f 8f 12 d0 87 6f 73 6d 2d 8f d2 6e 14 c2 de</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    10,</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',</span></td><td> </td><td class="rblock"><span class="insert">   kid value to identify PSK (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_3m",</span></td><td> </td><td class="rblock"><span class="insert">   a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    16</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">   So ID_PSK is defined as the following:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ID_PSK =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     4:h'a1'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   }</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   This test vector uses COSE_Key objects to store the pre-shared key.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Note that since the map for ID_PSK contains a single 'kid' parameter,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ID_PSK is used when transported in the protected header of the COSE</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Object, but only the kid is used when added to the plaintext (see</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Section 5.1):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ID_PSK (in protected header) (CBOR-encoded) (4 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 04 41 a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   kid (in plaintext) (CBOR-encoded) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.3.  Message 1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the input parameters (in Appendix B.2.1):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TYPE (4 * method + corr)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   suite</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   SUITES_I : suite</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_X (X-coordinate of the ephemeral public key of the Initiator) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ab 2f ca 32 89 83 22 c2 08 fb 2d ab 50 48 bd 43 c3 55 c6 43 0f 58 88 97</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   cb 57 49 61 cf a9 80 6f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   C_I (Connection identifier chosen by the Initiator) (CBOR encoded) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 c1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   kid of ID_PSK (CBOR encoded) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   No UAD_1 is provided, so AD_1 is absent from message_1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Message_1 is constructed, as the CBOR Sequence of the CBOR data items</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_1 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     5,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     0,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'ab2fca32898322c208fb2dab5048bd43c355c6430f588897cb574961cfa9806f',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c1',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'a1'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_1 (CBOR Sequence) (40 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   05 00 58 20 ab 2f ca 32 89 83 22 c2 08 fb 2d ab 50 48 bd 43 c3 55 c6 43</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0f 58 88 97 cb 57 49 61 cf a9 80 6f 41 c1 41 a1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.4.  Message 2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Since TYPE mod 4 equals 1, C_I is omitted from data_2.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_Y (X-coordinate of the ephemeral public key of the Responder) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   fc 3b 33 93 67 a5 22 5d 53 a9 2d 38 03 23 af d0 35 d7 81 7b 6d 1b e4 7d</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   94 6f 6b 09 a9 cb dc 06</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   C_R (Connection identifier chosen by the Responder) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Data_2 is constructed, as the CBOR Sequence of the CBOR data items</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'fc3b339367a5225d53a92d380323afd035d7817b6d1be47d946f6b09a9cbdc06',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c2'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_2 (CBOR Sequence) (36 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 fc 3b 33 93 67 a5 22 5d 53 a9 2d 38 03 23 af d0 35 d7 81 7b 6d 1b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   e4 7d 94 6f 6b 09 a9 cb dc 06 41 c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From data_2 and message_1 (from Appendix B.2.3), compute the input to</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the transcript hash TH_2 = H( message_1, data_2 ), as a CBOR Sequence</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of these 2 data items.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ( message_1, data_2 ) (CBOR Sequence) (76 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   05 00 58 20 ab 2f ca 32 89 83 22 c2 08 fb 2d ab 50 48 bd 43 c3 55 c6 43</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0f 58 88 97 cb 57 49 61 cf a9 80 6f 41 c1 41 a1 58 20 fc 3b 33 93 67 a5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   22 5d 53 a9 2d 38 03 23 af d0 35 d7 81 7b 6d 1b e4 7d 94 6f 6b 09 a9 cb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   dc 06 41 c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from there, compute the transcript hash TH_2 = SHA-256(</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_1, data_2 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_2 value (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   16 4f 44 d8 56 dd 15 22 2f a4 63 f2 02 d9 c6 0b e3 c6 9b 40 f7 35 8d 34</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   1c db 7b 07 de e1 70 ca</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_2 (CBOR-encoded) (34 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 16 4f 44 d8 56 dd 15 22 2f a4 63 f2 02 d9 c6 0b e3 c6 9b 40 f7 35</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8d 34 1c db 7b 07 de e1 70 ca</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.4.1.  Key and Nonce Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce for calculating the ciphertext are calculated as</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   follows, as specified in Section 3.8.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK = HMAC-SHA-256(salt, G_XY)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Since this is the symmetric case, salt is the PSK:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   salt (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 1f 8f 12 d0 87 6f 73 6d 2d 8f d2 6e 14 c2 de</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_XY is the shared secret, and since the curve25519 is used, the ECDH</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   shared secret is the output of the X25519 function.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_XY (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   d5 75 05 50 6d 8f 30 a8 60 a0 63 d0 1b 5b 7a d7 6a 09 4f 70 61 3b 4a e6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   6c 5a 90 e5 c2 1f 23 11</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From there, PRK is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   aa b2 f1 3c cb 1a 4f f7 96 a9 7a 32 a4 d2 fb 62 47 ef 0b 6b 06 da 04 d3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   d1 06 39 4b 28 76 e2 8c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Key K_2 is the output of HKDF-Expand(PRK, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   info for <span class="insert">K_2</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     10,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     <span class="insert">[ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'164f44d856dd15222fa463f202d9c60be3c69b40f7358d341cdb7b07</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   dee170ca']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0435"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for K_3m</span> (CBOR-encoded) <span class="delete">(42</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(K_2)</span> (CBOR-encoded) <span class="insert">(48</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 0a 58 20 <span class="delete">a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e</span></td><td> </td><td class="rblock">   84 0a <span class="insert">83 f6 f6 f6 83 f6 f6 f6 83 18 80 40</span> 58 20 <span class="insert">16 4f 44 d8 56</span> dd <span class="insert">15 22</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> f6 ee e4</span> dd <span class="delete">b3 2e 4a 27 ce 93 58 da 64 4b 5f 33 6d 10</span></td><td> </td><td class="rblock"><span class="insert">   2f a4 63 f2 02 d9 c6 0b e3 c6 9b 40 f7 35 8d 34 1c db 7b 07 de e1 70 ca</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0436"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, K_3m is computed.  Key K_3m is the output of</span></td><td> </td><td class="rblock">   L is the length of <span class="insert">K_2,</span> so 16 bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   HKDF-Expand(PRK_4x3m, info, L), where</span> L is the length of <span class="delete">K_2m,</span> so 16</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   bytes.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0437"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">K_3m (16 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From these parameters, K_2 is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   3d bb f0 d6 01 03 26 e8 27 3f c6 c6 c3 b0 de cd</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0438"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Nonce IV_3m is the output of HKDF-Expand(PRK_4x3m, info, L), where L</span></td><td> </td><td class="rblock">   <span class="insert">K_2 (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   = 13 bytes.</span></td><td> </td><td class="rblock"><span class="insert">   ac 42 6e 5e 7d 7a d6 ae 3b 19 aa bd e0 f6 25 57</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0439"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Info for IV_3m</span> is defined as follows:</td><td> </td><td class="rblock">   <span class="insert">Nonce IV_2 is the output of HKDF-Expand(PRK, info, L). info</span> is</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   defined as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0440"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for <span class="delete">IV_3m</span> =</td><td> </td><td class="rblock">   info for <span class="insert">IV_2</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">10,</span></td><td> </td><td class="rblock">     <span class="insert">"IV-GENERATION",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "IV_3m",</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    13</span></td><td> </td><td class="rblock"><span class="insert">     [ 104, h'', h'164f44d856dd15222fa463f202d9c60be3c69b40f7358d341cdb7b07</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">                   dee170ca']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0441"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for IV_3m</span> (CBOR-encoded) <span class="delete">(43</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(IV_2)</span> (CBOR-encoded) <span class="insert">(61</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 <span class="delete">0a 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92</span> 6d <span class="delete">39 3e</span></td><td> </td><td class="rblock">   84 6d <span class="insert">49 56 2d 47 45 4e 45 52 41 54 49 4f 4e 83</span> f6 <span class="insert">f6 f6 83 f6 f6 f6 83</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> f6 <span class="delete">ee e4 dd b3 2e 4a 27 ce 93</span> 58 <span class="delete">da 65 49</span> 56 <span class="delete">5f 33 6d 0d</span></td><td> </td><td class="rblock"><span class="insert">   18 68 40</span> 58 <span class="insert">20 16 4f 44 d8</span> 56 <span class="insert">dd 15 22 2f a4 63 f2 02 d9 c6 0b e3 c6 9b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   40 f7 35 8d 34 1c db 7b 07 de e1 70 ca</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0442"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, IV_3m is computed:</span></td><td> </td><td class="rblock">   <span class="insert">L is the length of IV_2, so 13 bytes.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0443"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">IV_3m (13 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From these parameters, IV_2 is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   10 b6 f4 41 4a 2c 91 3c cd a1 96 42 e3</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0444"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">MAC_3 is the ciphertext of the COSE_Encrypt0:</span></td><td> </td><td class="rblock">   <span class="insert">IV_2 (13 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ff 11 2e 1c 26 8a a2 a7 7c c3 ee 6c 4d</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0445"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">MAC_3 (8 bytes)</span></td><td> </td><td class="rblock"><span class="insert">B.2.4.2.  Ciphertext Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   5e ef b8 85 98 3c 22 d9</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0446"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since</span> the <span class="delete">method = 0, Signature_or_Mac_3</span> is <span class="delete">a signature:</span></td><td> </td><td class="rblock">   <span class="insert">COSE_Encrypt0 is computed with</span> the <span class="insert">following parameters.  Note that</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   AD_2</span> is <span class="insert">omitted.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0447"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  The message M_3 to be signed = [ "Signature1", &lt;&lt; ID_CRED_I &gt;&gt;,</span></td><td> </td><td class="rblock">   <span class="insert">*  empty protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      &lt;&lt; TH_3, CRED_I &gt;&gt;, MAC_3 ]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0448"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  The signing key is the private authentication key of the</span></td><td> </td><td class="rblock">   <span class="insert">*  external_aad = TH_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      Initiator.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0449"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">M_3 =</span></td><td> </td><td class="rblock">   <span class="insert">*  empty plaintext, since AD_2 is omitted</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> [</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   "Signature1",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   h'A11822822E485B786988439EBCF2',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   h'5820A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358D</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   A5865FA34B22A9CA4A1E12924EAE1D1766088098449CB848FFC795F88AFC49CBE8AFD</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   D1BA009F21675E8F6C77A4A2C30195601F6F0A0852978BD43D28207D44486502FF7BD</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   DA632C788370016B8965BDB2074BFF82E5A20E09BEC21F8406E86442B87EC3FF245</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   B7',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   h'5EEFB885983C22D9']</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0450"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Which as a CBOR encoded data item is:</span></td><td> </td><td class="rblock">   <span class="insert">*  empty plaintext, since AD_2 is omitted</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0451"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">M_3 (175 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From the parameters above, the Enc_structure A_2 is computed.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 84 6a 53 69 67 6e 61 74 75 72 65 31 4e a1 18 22 82 2e 48 5b 78 69 88 43</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 9e bc f2 58 89 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 6d 39 3e f6 ee e4 dd b3 2e 4a 27 ce 93 58 da 58 65 fa 34 b2 2a 9c a4 a1</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e1 29 24 ea e1 d1 76 60 88 09 84 49 cb 84 8f fc 79 5f 88 af c4 9c be 8a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> fd d1 ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01 95 60 1f 6f 0a 08 52 97 8b</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> d4 3d 28 20 7d 44 48 65 02 ff 7b dd a6 32 c7 88 37 00 16 b8 96 5b db 20</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 74 bf f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44 2b 87 ec 3f f2 45 b7 48 5e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ef b8 85 98 3c 22 d9</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0452"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there, the signature can be computed:</span></td><td> </td><td class="rblock">   <span class="insert">A_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "Encrypt0",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'164f44d856dd15222fa463f202d9c60be3c69b40f7358d341cdb7b07dee170ca'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0453"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Signature_or_MAC_3 (64 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Which encodes to the following byte string to be used as Additional</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b3 31 76 33 fa eb c7 f4 24 9c f3 ab 95 96 fd ae 2b eb c8 e7 27 5d 39 9f</span></td><td> </td><td class="rblock"><span class="insert">   Authenticated Data:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 42 00 04 f3 76 7b 88 d6 0f fe 37 dc f3 90 a0 00 d8 5a b0 ad b0 d7 24 e3</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a5 7c 4d fe 24 14 a4 1e 79 78 91 b9 55 35 89 06</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0454"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Finally, the outer COSE_Encrypt0 is computed.</span></td><td> </td><td class="rblock">   <span class="insert">A_2 (CBOR-encoded) (45 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   83 68 45 6e 63 72 79 70 74 30 40 58 20 16 4f 44 d8 56 dd 15 22 2f a4 63</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f2 02 d9 c6 0b e3 c6 9b 40 f7 35 8d 34 1c db 7b 07 de e1 70 ca</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0455"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The <span class="delete">Plaintext is the following CBOR Sequence: plaintext = ( ID_CRED_I</span></td><td> </td><td class="rblock">   The <span class="insert">key and nonce used are defined in Appendix B.2.4.1:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   , Signature_or_MAC_3 )</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0456"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">P_3ae (CBOR Sequence) (80 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">*  key = K_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a1 18 22 82 2e 48 5b 78 69 88 43 9e bc f2 58 40 b3 31 76 33 fa eb c7 f4</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 24 9c f3 ab 95 96 fd ae 2b eb c8 e7 27 5d 39 9f 42 00 04 f3 76 7b 88 d6</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0f fe 37 dc f3 90 a0 00 d8 5a b0 ad b0 d7 24 e3 a5 7c 4d fe 24 14 a4 1e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 79 78 91 b9 55 35 89 06</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0457"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Associated data A is the following: Associated data A</span> = <span class="delete">[</span></td><td> </td><td class="rblock">   <span class="insert">*  nonce</span> = <span class="insert">IV_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   "Encrypt0", h'', TH_3 ]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0458"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">A_3ae (CBOR-encoded) (45 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Using the parameters above, the ciphertext CIPHERTEXT_2 can be</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 83 68 45 6e 63 72 79 70 74 30 40 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5</span></td><td> </td><td class="rblock"><span class="insert">   computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1e c3 92 bf eb 92 6d 39 3e f6 ee e4 dd b3 2e 4a 27 ce 93 58 da</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0459"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Key <span class="delete">K_3ae</span> is the output of <span class="delete">HKDF-Expand(PRK_3e2m,</span> info, L).</td><td> </td><td class="rblock">   <span class="insert">CIPHERTEXT_2 (8 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ba 38 b9 a3 fc 1a 58 e9</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.4.3.  message_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the parameter computed in Appendix B.2.4 and Appendix B.2.4.2,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_2 is computed, as the CBOR Sequence of the following items:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (G_Y, C_R, CIPHERTEXT_2).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'fc3b339367a5225d53a92d380323afd035d7817b6d1be47d946f6b09a9cbdc06',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c2',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'ba38b9a3fc1a58e9'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Which encodes to the following byte string:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   message_2 (CBOR Sequence) (45 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 fc 3b 33 93 67 a5 22 5d 53 a9 2d 38 03 23 af d0 35 d7 81 7b 6d 1b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   e4 7d 94 6f 6b 09 a9 cb dc 06 41 c2 48 ba 38 b9 a3 fc 1a 58 e9</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.5.  Message 3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Since TYPE mod 4 equals 1, C_R is not omitted from data_3.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   C_R (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Data_3 is constructed, as the CBOR Sequence of the CBOR data item</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c2'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_3 (CBOR Sequence) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From data_3, CIPHERTEXT_2 (Appendix B.2.4.2), and TH_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (Appendix B.2.4), compute the input to the transcript hash TH_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   H(TH_2 , CIPHERTEXT_2, data_3), as a CBOR Sequence of these 3 data</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   items.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ( TH_2, CIPHERTEXT_2, data_3 ) (CBOR Sequence) (45 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 16 4f 44 d8 56 dd 15 22 2f a4 63 f2 02 d9 c6 0b e3 c6 9b 40 f7 35</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8d 34 1c db 7b 07 de e1 70 ca 48 ba 38 b9 a3 fc 1a 58 e9 41 c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from there, compute the transcript hash TH_3 = SHA-256(TH_2 ,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_2, data_3)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_3 value (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   11 98 aa b3 ed db 61 b8 a1 b1 93 a9 e5 60 2b 5d 5f ea 76 bc 28 52 89 54</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   81 b5 2b 8a f5 66 d7 fe</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_3 (CBOR-encoded) (34 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 11 98 aa b3 ed db 61 b8 a1 b1 93 a9 e5 60 2b 5d 5f ea 76 bc 28 52</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   89 54 81 b5 2b 8a f5 66 d7 fe</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.5.1.  Key and Nonce Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce for calculating the ciphertext are calculated as</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   follows, as specified in Section 3.8.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK = HMAC-SHA-256(salt, G_XY)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Since this is the symmetric case, salt is the PSK:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   salt (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 1f 8f 12 d0 87 6f 73 6d 2d 8f d2 6e 14 c2 de</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_XY is the shared secret, and since the curve25519 is used, the ECDH</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   shared secret is the output of the X25519 function.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   G_XY (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   d5 75 05 50 6d 8f 30 a8 60 a0 63 d0 1b 5b 7a d7 6a 09 4f 70 61 3b 4a e6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   6c 5a 90 e5 c2 1f 23 11</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From there, PRK is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   aa b2 f1 3c cb 1a 4f f7 96 a9 7a 32 a4 d2 fb 62 47 ef 0b 6b 06 da 04 d3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   d1 06 39 4b 28 76 e2 8c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   Key <span class="insert">K_3</span> is the output of <span class="insert">HKDF-Expand(PRK,</span> info, L).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   info is defined as follows:</td><td> </td><td class="right">   info is defined as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0460"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for <span class="delete">K_3ae</span> =</td><td> </td><td class="rblock">   info for <span class="insert">K_3</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    10,</td><td> </td><td class="rblock">     10,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',</span></td><td> </td><td class="rblock">     <span class="insert">[ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_3ae",</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    16</span></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'1198aab3eddb61b8a1b193a9e5602b5d5fea76bc2852895481b52b8a</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">                   f566d7fe']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0461"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for K_3ae</span> (CBOR-encoded) <span class="delete">(43</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(K_3)</span> (CBOR-encoded) <span class="insert">(48</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 0a 58 20 <span class="delete">a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e</span></td><td> </td><td class="rblock">   84 0a <span class="insert">83 f6 f6 f6 83 f6 f6 f6 83 18 80 40</span> 58 20 <span class="insert">11 98 aa</span> b3 <span class="insert">ed db 61 b8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> f6 ee e4 dd</span> b3 <span class="delete">2e 4a 27 ce</span> 93 <span class="delete">58 da 65 4b</span> 5f <span class="delete">33 61 65 10</span></td><td> </td><td class="rblock"><span class="insert">   a1 b1</span> 93 <span class="insert">a9 e5 60 2b 5d</span> 5f <span class="insert">ea 76 bc 28 52 89 54 81 b5 2b 8a f5 66 d7 fe</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0462"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   L is the length of K_3<span class="delete">ae</span>, so 16 bytes.</td><td> </td><td class="rblock">   L is the length of K_3, so 16 bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0463"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   From these parameters, K_3<span class="delete">ae</span> is computed:</td><td> </td><td class="rblock">   From these parameters, K_3 is computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0464"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">K_3ae</span> (16 bytes)</td><td> </td><td class="rblock">   <span class="insert">K_3</span> (16 bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">58 b5 2f 94 5b 30 9d 85 4c a7 36 cd 06 a9</span> 62 <span class="delete">95</span></td><td> </td><td class="rblock">   <span class="insert">fe 75 e3 44 27 f8 3a ad 84 16 83 c6 6f a3 8a</span> 62</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Nonce IV_3ae is the output of HKDF-Expand(PRK_3e2m, info, L).</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0465"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">info is defined as follows:</span></td><td> </td><td class="rblock">   <span class="insert">Nonce IV_3 is the output of HKDF-Expand(PRK, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0466"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info <span class="delete">for IV_3ae =</span></td><td> </td><td class="rblock">   info <span class="insert">is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  [</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    10,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "IV_3ae",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    13</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  ]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0467"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">info for IV_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "IV-GENERATION",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 104, h'', h'1198aab3eddb61b8a1b193a9e5602b5d5fea76bc2852895481b52b8a</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   f566d7fe']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0468"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for IV_3ae</span> (CBOR-encoded) <span class="delete">(44</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(IV_3)</span> (CBOR-encoded) <span class="insert">(61</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 <span class="delete">0a 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92</span> 6d <span class="delete">39 3e</span></td><td> </td><td class="rblock">   84 6d <span class="insert">49 56 2d 47 45 4e 45 52 41 54 49 4f 4e 83 f6 f6 f6 83 f6</span> f6 <span class="insert">f6 83</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> f6 <span class="delete">ee e4 dd</span> b3 <span class="delete">2e 4a 27 ce</span> 93 <span class="delete">58 da 66 49 56</span> 5f <span class="delete">33 61 65 0d</span></td><td> </td><td class="rblock"><span class="insert">   18 68 40 58 20 11 98 aa</span> b3 <span class="insert">ed db 61 b8 a1 b1</span> 93 <span class="insert">a9 e5 60 2b 5d</span> 5f <span class="insert">ea 76</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   bc 28 52 89 54 81 b5 2b 8a f5 66 d7 fe</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0469"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   L is the length of IV_3<span class="delete">ae</span>, so 13 bytes.</td><td> </td><td class="rblock">   L is the length of IV_3, so 13 bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0470"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   From these parameters, IV_3<span class="delete">ae</span> is computed:</td><td> </td><td class="rblock">   From these parameters, IV_3 is computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0471"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">IV_3ae</span> (13 bytes)</td><td> </td><td class="rblock">   <span class="insert">IV_3</span> (13 bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">cf a9 a5 85 58 10 d6 dc e9</span> 74 <span class="delete">3c 3b c3</span></td><td> </td><td class="rblock">   <span class="insert">60 0a 33 b4 16 de 08 23 52 67 71 ec 8a</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.2.5.2.  Ciphertext Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   COSE_Encrypt0 is computed with the following parameters.  Note that</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   AD_3 is omitted.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  empty protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  external_aad = TH_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  empty plaintext, since AD_3 is omitted</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the parameters above, the Enc_structure A_3 is computed.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   A_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "Encrypt0",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'1198aab3eddb61b8a1b193a9e5602b5d5fea76bc2852895481b52b8af566d7fe'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Which encodes to the following byte string to be used as Additional</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Authenticated Data:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   A_3 (CBOR-encoded) (45 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   83 68 45 6e 63 72 79 70</span> 74 <span class="insert">30 40 58 20 11 98 aa b3 ed db 61 b8 a1 b1 93</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a9 e5 60 2b 5d 5f ea 76 bc 28 52 89 54 81 b5 2b 8a f5 66 d7 fe</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce used are defined in Appendix B.2.5.1:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  key = K_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0472"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  nonce = IV_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Using the parameters above, the ciphertext CIPHERTEXT_3 can be</td><td> </td><td class="right">   Using the parameters above, the ciphertext CIPHERTEXT_3 can be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   computed:</td><td> </td><td class="right">   computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0473"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> CIPHERTEXT_3 <span class="delete">(88</span> bytes)</td><td> </td><td class="rblock">   CIPHERTEXT_3 <span class="insert">(8</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">2d 88 ff 86 da 47 48 2c 0d fa 55 9a c8 24 a4 a7 83 d8 70 c9 db a4 78 05</span></td><td> </td><td class="rblock">   <span class="insert">51 29 07 92 61 45 40 04</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e8 aa fb ad 69 74 c4 96 46 58 65 03 fa 9b bf 3e 00 01 2c 03 7e af 56 e4</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 5e 30 19 20 83 9b 81 3a 53 f6 d4 c5 57 48 0f 6c 79 7d 5b 76 f0 e4 62 f5</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> f5 7a 3d b6 d2 b5 0c 32 31 9f 34 0f 4a c5 af 9a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0474"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   From the parameter <span class="delete">above,</span> message_3 is computed, as the CBOR Sequence</td><td> </td><td class="rblock"><span class="insert">B.2.5.3.  message_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   of the following items: (C_R, CIPHERTEXT_3).</td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   From the parameter <span class="insert">computed in Appendix B.2.5 and Appendix B.2.5.2,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   message_3 is computed, as the CBOR Sequence of the following items:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   (C_R, CIPHERTEXT_3).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_3 =</td><td> </td><td class="right">   message_3 =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   (</td><td> </td><td class="right">   (</td><td class="lineno"></td></tr>
      <tr id="diff0475"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     <span class="delete">h'13',</span></td><td> </td><td class="rblock">     <span class="insert">h'c2',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     h''</span></td><td> </td><td class="rblock"><span class="insert">     h'5129079261454004'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which encodes to the following byte string:</td><td> </td><td class="right">   Which encodes to the following byte string:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0476"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> message_3 (CBOR Sequence) <span class="delete">(91</span> bytes)</td><td> </td><td class="rblock">   message_3 (CBOR Sequence) <span class="insert">(11</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">13 58 58 2d 88 ff 86 da 47</span> 48 <span class="delete">2c 0d fa 55 9a c8 24 a4 a7 83 d8 70 c9 db</span></td><td> </td><td class="rblock">   <span class="insert">41 c2</span> 48 <span class="insert">51 29 07 92 61 45 40 04</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a4 78 05 e8 aa fb ad 69 74 c4 96 46 58 65 03 fa 9b bf 3e 00 01 2c 03 7e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> af 56 e4 5e 30 19 20 83 9b 81 3a 53 f6 d4 c5 57 48 0f 6c 79 7d 5b 76 f0</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e4 62 f5 f5 7a 3d b6 d2 b5 0c 32 31 9f 34 0f 4a c5 af 9a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0477"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">B.2.</span>  Test Vectors for EDHOC Authenticated with Static Diffie-Hellman</td><td> </td><td class="rblock"><span class="insert">B.2.5.4.  OSCORE Security Context Derivation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the previous message exchange, the Common Security Context for</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   OSCORE [RFC8613] can be derived, as specified in Section 3.8.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   First af all, TH_4 is computed: TH_4 = H( TH_3, CIPHERTEXT_3 ), where</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the input to the hash function is the CBOR Sequence of TH_3 and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ( TH_3, CIPHERTEXT_3 ) (CBOR Sequence) (43 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 11 98 aa b3 ed db 61 b8 a1 b1 93 a9 e5 60 2b 5d 5f ea 76 bc 28 52</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   89 54 81 b5 2b 8a f5 66 d7 fe 48 51 29 07 92 61 45 40 04</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from there, compute the transcript hash TH_4 = SHA-256( TH_3,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_3 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_4 value (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   df 7c 9b 06 f5 dc 0e e8 86 0b 39 6c 78 c5 be b7 57 41 3f a7 b6 a9 cf 28</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   3d db 4c d4 c1 fd e4 3c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_4 (CBOR-encoded) (34 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 df 7c 9b 06 f5 dc 0e e8 86 0b 39 6c 78 c5 be b7 57 41 3f a7 b6 a9</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   cf 28 3d db 4c d4 c1 fd e4 3c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   To derive the Master Secret and Master Salt the same HKDF-Expand</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (PRK, info, L) is used, with different info and L.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   For Master Secret:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   L for Master Secret = 16</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info for Master Secret =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "OSCORE Master Secret",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'df7c9b06f5dc0ee8860b396c78c5beb757413fa7b6a9cf283ddb4cd4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   c1fde43c']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info (OSCORE Master Secret) (CBOR-encoded) (68 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 74 4f 53 43 4f 52 45 20 4d 61 73 74 65 72 20 53 65 63 72 65 74 83 f6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f6 f6 83 f6 f6 f6 83 18 80 40 58 20 df 7c 9b 06 f5 dc 0e e8 86 0b 39 6c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   78 c5 be b7 57 41 3f a7 b6 a9 cf 28 3d db 4c d4 c1 fd e4 3c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Finally, the Master Secret value computed is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   OSCORE Master Secret (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8d 36 8f 09 26 2d c5 52 7f e7 19 e6 6c 91 63 75</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   For Master Salt:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   L for Master Salt = 8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info for Master Salt =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "OSCORE Master Salt",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 64, h'', h'df7c9b06f5dc0ee8860b396c78c5beb757413fa7b6a9cf283ddb4cd4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                   c1fde43c']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info (OSCORE Master Salt) (CBOR-encoded) (66 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 72 4f 53 43 4f 52 45 20 4d 61 73 74 65 72 20 53 61 6c 74 83 f6 f6 f6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   83 f6 f6 f6 83 18 40 40 58 20 df 7c 9b 06 f5 dc 0e e8 86 0b 39 6c 78 c5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   be b7 57 41 3f a7 b6 a9 cf 28 3d db 4c d4 c1 fd e4 3c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Finally, the Master Salt value computed is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   OSCORE Master Salt (8 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4d b7 06 58 c5 e9 9f b6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Client's Sender ID takes the value of C_R:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Client's OSCORE Sender ID (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Server's Sender ID takes the value of C_I:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Server's OSCORE Sender ID (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The algorithms are those negociated in the cipher suite:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   AEAD Algorithm</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   10</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HMAC Algorithm</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.3.</span>  Test Vectors for EDHOC Authenticated with Static Diffie-Hellman</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">      Keys</td><td> </td><td class="right">      Keys</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0478"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   EDHOC with static Diffie-Hellman keys <span class="delete">is used.</span></td><td> </td><td class="rblock">   EDHOC with static Diffie-Hellman keys <span class="insert">and MAC authentication is used:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0479"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   method (<span class="delete">Static DH Based</span> Authentication)</td><td> </td><td class="rblock">   method (<span class="insert">MAC</span> Authentication)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   3</td><td> </td><td class="right">   3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0480"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Co<span class="delete">A</span>P is used as transport and the Initiator acts as CoAP client:</td><td> </td><td class="rblock">   Co<span class="insert">a</span>P is used as transport and the Initiator acts as CoAP client:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0481"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   corr (<span class="delete">the </span>Initiator can correlate message_1 and message_2)</td><td> </td><td class="rblock">   corr (Initiator can correlate message_1 and message_2)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   1</td><td> </td><td class="right">   1</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0482"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there, METHOD_CORR has the following value:</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   METHOD_CORR (4 * method + corr) (int)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   13</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   No unprotected opaque auxiliary data is sent in the message</td><td> </td><td class="right">   No unprotected opaque auxiliary data is sent in the message</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   exchanges.</td><td> </td><td class="right">   exchanges.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0483"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The <span class="delete">list of supported cipher suites of the Initiator in order of</span></td><td> </td><td class="rblock">   The <span class="insert">pre-defined Cipher Suite 0</span> is <span class="insert">in place both on Initiator and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   preference</span> is <span class="delete">the following:</span></td><td> </td><td class="rblock"><span class="insert">   Responder, see Section 8.3.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0484"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Supported Cipher Suites (4 bytes)</span></td><td> </td><td class="rblock"><span class="insert">B.3.1.  Input for the Initiator</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   00 01 02 03</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0485"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The <span class="delete">cipher suite selected by</span> the Initiator <span class="delete">is</span> the <span class="delete">most preferred:</span></td><td> </td><td class="rblock">   The <span class="insert">following are the parameters that are set in</span> the Initiator <span class="insert">before</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   the <span class="insert">first message exchange.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0486"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Selected Cipher Suite (int)</span></td><td> </td><td class="rblock">   <span class="insert">Initiator's private static DH authentication key (I) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   0</span></td><td> </td><td class="rblock"><span class="insert">   be 55 8a 0e 56 34 23 ff 74 f6 d7 7a 36 8c 35 9d 4c 21 be d2 ef 1d 09 41</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0d 71 6c 0a e2 64 9c 19</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0487"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The mandatory-to-implement cipher suite 0 is supported by both the</span></td><td> </td><td class="rblock">   <span class="insert">Initiator's public static DH authentication key (G_I) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Initiator and the Responder, see Section 7.3.</span></td><td> </td><td class="rblock"><span class="insert">   6e 5d 68 76 a1 78 15 6c a0 b8 1d c8 0f 81 06 0f a1 a5 d1 35 13 d6 14 bc</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c2 85 37 ef 98 90 06 44</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0488"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">B.2.1.  Message_1</span></td><td> </td><td class="rblock">   <span class="insert">kid value to identify the Initiator's public DH authentication key (kid_I) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0489"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">X (Initiator's ephemeral private key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">This test vector uses COSE_Key objects to store the raw</span> public <span class="insert">keys.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ae 11 a0 db 86 3c 02 27 e5 39 92 fe b8 f5 92 4c 50 d0 a7 ba 6e ea b4 ad</span></td><td> </td><td class="rblock"><span class="insert">   Moreover, EC2 keys with curve X25519 are used.  That is in agreement</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1f f2 45 72 f4 f5 7c fa</span></td><td> </td><td class="rblock"><span class="insert">   with the Cipher Suite 0.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> G_X (Initiator's ephemeral</span> public <span class="delete">key) (32 bytes)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 8d 3e f5 6d 1b 75 0a 43 51 d6 8a c2 50 a0 e8 83 79 0e fc 80 a5 38 a4 44</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ee 9e 2b 57 e2 44 1a 7c</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0490"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Initiator chooses a connection identifier C_I:</span></td><td> </td><td class="rblock">   <span class="insert">CRED_I =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     1:  1,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -1:  4,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -2:  h'6e5d6876a178156ca0b81dc80f81060fa1a5d13513d614bcc28537ef98900644</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           '</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   }</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0491"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Connection identifier chosen by Initiator (1</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">CRED_I (COSE_Key) (40</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">16</span></td><td> </td><td class="rblock">   <span class="insert">a3 01 01 20 04 21 58 20 6e 5d 68 76 a1 78 15 6c a0 b8 1d c8 0f 81 06 0f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 a5 d1 35 13 d6 14 bc c2 85 37 ef 98 90 06 44</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0492"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Note that since C_I is a byte strings of length one, it is encoded as</span></td><td> </td><td class="rblock">   <span class="insert">Because COSE_Keys are used, and because kid</span> = <span class="insert">h'a7':</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the corresponding integer - 24 (see bstr_identifier in Section 4.3),</span></td><td> </td><td class="rblock"><span class="insert">   ~~~~~~~~~~~~~~~~~~~~~~~ ID_CRED_I</span> = <span class="insert">{ 4: h'a7' }</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   i.e. 0x16</span> = <span class="delete">22, 22 - 24</span> = <span class="delete">-2, and -2 in CBOR encoding is equal to</span></td><td> </td><td class="rblock"><span class="insert">   ~~~~~~~~~~~~~~~~~~~~~~~</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   0x21.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0493"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">C_I (1 byte)</span></td><td> </td><td class="rblock">   <span class="insert">Note that since the map for ID_CRED_I contains a single 'kid'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   21</span></td><td> </td><td class="rblock"><span class="insert">   parameter, ID_CRED_I is used when transported in the protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of the COSE Object, but only kid_I is used when added to the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   plaintext (see Section 4.3.2 and Section 4.4.2):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0494"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since no unprotected opaque auxiliary data is sent in the message</span></td><td> </td><td class="rblock">   <span class="insert">ID_CRED_I (in protected header) (CBOR-encoded) (5 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   exchanges:</span></td><td> </td><td class="rblock"><span class="insert">   44 a1 04 41 a7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0495"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">AD_1 (0</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">kid_I (in plaintext) (CBOR-encoded) (2</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">41 a7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0496"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since</span> the <span class="delete">list of supported cipher suites needs to contain the</span></td><td> </td><td class="rblock"><span class="insert">B.3.2.  Input for</span> the <span class="insert">Responder</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   selected cipher suite, the initiator truncates the list of supported</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   cipher suites to one cipher suite only, 00.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0497"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Because one single selected cipher suite is conveyed, it is encoded</span></td><td> </td><td class="rblock">   <span class="insert">The following are the parameters that are set in the Responder before</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   as an int instead of an array:</span></td><td> </td><td class="rblock"><span class="insert">   the first message exchange.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0498"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">SUITES_I (int)</span></td><td> </td><td class="rblock">   <span class="insert">Responder's private static DH authentication key (R) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   0</span></td><td> </td><td class="rblock"><span class="insert">   25 d8 0d 45 a1 1b 37 2d 5a 23 57 f9 96 ed 04 8e 26 14 ab 8a 40 66 2b 89</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   91 2a 83 77 9d 58 2c 85</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0499"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">With SUITES_I = 0, message_1 is constructed, as the CBOR Sequence of</span></td><td> </td><td class="rblock">   <span class="insert">Responder's private static DH authentication key (G_R) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the CBOR data items above.</span></td><td> </td><td class="rblock"><span class="insert">   32 82 44 f6 cd f5 f1 27 22 50 d7 cf bb a2 68 34 fb ef 25 e8 46 db 8b af</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   89 0f aa 8d 7e f6 e6 73</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0500"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">message_1 =</span></td><td> </td><td class="rblock">   <span class="insert">kid value to identify the Responder's public authentication key (kid_R) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  (</span></td><td> </td><td class="rblock"><span class="insert">   a8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    13,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    0,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'8D3EF56D1B750A4351D68AC250A0E883790EFC80A538A444EE9E2B57E2441A7C',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    -2</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  )</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0501"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">message_1 (CBOR Sequence) (37 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">This test vector uses COSE_Key objects to store the raw public keys.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0d 00 58 20 8d 3e f5 6d 1b 75 0a 43 51 d6 8a c2 50 a0 e8 83 79 0e fc 80</span></td><td> </td><td class="rblock"><span class="insert">   Moreover, EC2 keys with curve X25519 are used.  That is in agreement</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a5 38 a4 44 ee 9e 2b 57 e2 44 1a 7c 21</span></td><td> </td><td class="rblock"><span class="insert">   with the Cipher Suite 0.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0502"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">B.2.2.  Message_2</span></td><td> </td><td class="rblock">   <span class="insert">CRED_R =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     1:  1,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -1:  4,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    -2:  h'328244f6cdf5f1272250d7cfbba26834fbef25e846db8baf890faa8d7ef6e673</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           '</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   }</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0503"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since METHOD_CORR mod 4 equals 1, C_I is omitted from data_2.</span></td><td> </td><td class="rblock">   <span class="insert">CRED_R (COSE_Key) (40 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a3 01 01 20 04 21 58 20 32 82 44 f6 cd f5 f1 27 22 50 d7 cf bb a2 68 34</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   fb ef 25 e8 46 db 8b af 89 0f aa 8d 7e f6 e6 73</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0504"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Y (Responder's ephemeral private key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Because COSE_Keys are used, and because kid = h'a8':</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> c6 46 cd dc 58 12 6e 18 10 5f 01 ce 35 05 6e 5e bc 35 f4 d4 cc 51 07 49</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a3 a5 e0 69 c1 16 16 9a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0505"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_Y (Responder's ephemeral public key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">ID_CRED_R =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 52 fb a0 bd c8 d9 53 dd 86 ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db fc 33</span></td><td> </td><td class="rblock"><span class="insert">   {</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 01 04 70 69 45 1b af 35</span></td><td> </td><td class="rblock"><span class="insert">     4:  h'a8'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   }</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0506"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From G_X and Y or from G_Y and X</span> the <span class="delete">ECDH shared secret</span> is <span class="delete">computed:</span></td><td> </td><td class="rblock">   <span class="insert">Note that since</span> the <span class="insert">map for ID_CRED_R contains a single 'kid'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   parameter, ID_CRED_R</span> is <span class="insert">used when transported in the protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of the COSE Object, but only the kid_R is used when added to the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   plaintext (see Section 4.4.2):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0507"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_XY (ECDH shared secret) (32</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">ID_CRED_R (in protected header) (CBOR-encoded) (5</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">de fc 2f 35 69 10 9b 3d 1f a4 a7 3d c5 e2 fe b9 e1 15 0d 90 c2 5e e2 f0</span></td><td> </td><td class="rblock">   <span class="insert">44 a1 04 41 a8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 66 c2 d8 85 f4 f8 ac 4e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0508"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The key and nonce for calculating the ciphertext are calculated as</span></td><td> </td><td class="rblock">   <span class="insert">kid_R (in plaintext) (CBOR-encoded) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   follows, as specified in Section 3.8.</span></td><td> </td><td class="rblock"><span class="insert">   41 a8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0509"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td> </td><td class="rblock"><span class="insert">B.3.3.  Message 1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0510"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">PRK_2e = HMAC-SHA-256(salt, G_XY)</span></td><td> </td><td class="rblock">   <span class="insert">From the input parameters (in Appendix B.1.1):</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0511"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Salt is the empty byte string.</span></td><td> </td><td class="rblock">   <span class="insert">METHOD_CORR (4 * method + corr)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   13</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0512"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">salt (0 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">suite</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0513"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there, PRK_2e is computed:</span></td><td> </td><td class="rblock">   <span class="insert">SUITES_I : suite</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0514"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">PRK_2e</span> (32 bytes)</td><td> </td><td class="rblock">   <span class="insert">Initiator's ephemeral private key</span> (32 bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">93</span> 9f <span class="delete">cb 05 6d 2e</span> 41 <span class="delete">4f 1b</span> ec <span class="delete">61 04 61 99 c2 c7 63</span> d2 <span class="delete">7f 0c 3d 15 fa 16</span></td><td> </td><td class="rblock">   <span class="insert">11 34</span> 9f <span class="insert">62 e8 d8 13 ed 79 d2 7d 57 dd</span> 41 <span class="insert">b9 af</span> ec <span class="insert">4d d9 5e c4</span> d2 <span class="insert">88 0e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 71 fa 13 4e</span> 0d <span class="delete">c5 a0 4d</span></td><td> </td><td class="rblock"><span class="insert">   72</span> 0d <span class="insert">50 e6 37 fe c9 19</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0515"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">SK_R (Responders's private authentication key)</span> (32 bytes)</td><td> </td><td class="rblock">   <span class="insert">G_X (X-coordinate of the ephemeral public key of the Initiator)</span> (32 bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">bb</span> 50 <span class="delete">1a ac 67 b9 a9 5f 97 e0 ed ed 6b 82 a6 62 93 4f bb fc 7a d1 b7 4c</span></td><td> </td><td class="rblock">   <span class="insert">65 22 d2 2d</span> 50 <span class="insert">87 46 6e a1</span> 22 <span class="insert">9b fb ee b8 52 9e 56 e1 d9 cb c7 79 cb 36</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1f ca d6 6a 07 94</span> 22 <span class="delete">d0</span></td><td> </td><td class="rblock"><span class="insert">   74 a9 42 91 fd 9b 1a 08</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0516"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since</span> the <span class="delete">Responder authenticates with a static Diffie-Hellman key,</span></td><td> </td><td class="rblock">   <span class="insert">C_I (Connection identifier chosen by</span> the <span class="insert">Initiator) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   PRK_3e2m = HKDF-Extract( PRK_2e, G_RX ), where G_RX is the ECDH</span></td><td> </td><td class="rblock"><span class="insert">   c7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   shared secret calculated from G_R and X, or G_X and R.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0517"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">R (Responder's private authentication key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">No AD_1 is provided, so AD_1 is absent from message_1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> bb 50 1a ac 67 b9 a9 5f 97 e0 ed ed 6b 82 a6 62 93 4f bb fc 7a d1 b7 4c</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1f ca d6 6a 07 94 22 d0</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> G_R (Responder's public authentication key) (32 bytes)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a3 ff 26 35 95 be b3 77 d1 a0 ce 1d 04 da d2 d4 09 66 ac 6b cb 62 20 51</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b8 46 59 18 4d 5d 9a 32</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0518"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From the Responder's authentication key and</span> the <span class="delete">Initiator's ephemeral</span></td><td> </td><td class="rblock">   <span class="insert">Message_1 is constructed, as</span> the <span class="insert">CBOR Sequence of</span> the <span class="insert">CBOR data items</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   key (see Appendix B.2.1),</span> the <span class="delete">ECDH shared secret G_RX is calculated.</span></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0519"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_RX (ECDH shared secret) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">message_1 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 21 c7 ef f4 fb 69 fa 4b 67 97 d0 58 84 31 5d 84 11 a3 fd a5 4f 6d ad a6</span></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1d 4f cd 85 e7 90 66 68</span></td><td> </td><td class="rblock"><span class="insert">     13,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     0,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'6522d22d5087466ea1229bfbeeb8529e56e1d9cbc779cb3674a94291fd9b1a08',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c7'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0520"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">PRK_3e2m (32</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">message_1 (CBOR Sequence) (38</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">75 07 7c 69 1e 35 01</span> 2d <span class="delete">48 bc 24 c8 4f 2b ab 89 f5 2f ac 03 fe dd 81 3e</span></td><td> </td><td class="rblock">   <span class="insert">0d 00 58 20 65 22 d2</span> 2d <span class="insert">50 87 46 6e a1 22 9b fb ee b8 52 9e 56 e1 d9 cb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 43 8c 93 b1 0b 39 93 07</span></td><td> </td><td class="rblock"><span class="insert">   c7 79 cb 36 74 a9 42 91 fd 9b 1a 08 41 c7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0521"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   The Responder chooses a connection identifier C_R.</span></td><td> </td><td class="rblock"><span class="insert">B.3.4.  Message 2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0522"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Connection identifier chosen by Responder (1 byte)</span></td><td> </td><td class="rblock">   <span class="insert">Since corr equals 1, C_I is omitted from data_2.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   20</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0523"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Note that since C_R is a byte strings of length one, it is encoded as</span></td><td> </td><td class="rblock">   <span class="insert">The Responder generates an ephemeral ECDH key pair:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   the corresponding integer - 24 (see bstr_identifier in Section 4.3),</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   i.e. 0x20 = 32, 32 - 24 = 8, and 8 in CBOR encoding is equal to 0x08.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0524"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">C_R (1 byte)</span></td><td> </td><td class="rblock">   <span class="insert">Responder's ephemeral private key (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   08</td><td> </td><td class="rblock"><span class="insert">   25</span> 08 <span class="insert">17 7e 3f 55 3e c0 5f 24 26 f5 0f 21 0c 7a bf 54 2e 53 23 b8 45 9e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   17 52 33 be 6e 67 bb 91</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0525"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Data_2 is constructed, as</span> the <span class="delete">CBOR Sequence</span> of <span class="delete">G_Y and C_R.</span></td><td> </td><td class="rblock">   <span class="insert">G_Y (X-coordinate of</span> the <span class="insert">ephemeral public key</span> of <span class="insert">the Responder) (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4a cd 37 41 73 cc 6f 2b 55 c7 59 ef 6e 78 2c a3 07 e7 98 21 f4 da 89 a6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   78 07 7f 8b 79 6a 3f 65</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0526"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">data_2 =</span></td><td> </td><td class="rblock">   <span class="insert">The Responder also choses a connection identifier:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  (</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'52FBA0BDC8D953DD86CE1AB2FD7C05A4658C7C30AFDBFC3301047069451BAF35',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    08</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  )</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0527"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">data_2 (CBOR Sequence) (35 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">C_R (Connection identifier chosen by the Responder) (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 58 20 52 fb a0 bd</span> c8 <span class="delete">d9 53 dd 86 ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db</span></td><td> </td><td class="rblock">   c8</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> fc 33 01 04 70 69 45 1b af 35 08</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0528"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   From data_2 and <span class="delete">message_1,</span> compute the input to the transcript hash</td><td> </td><td class="rblock">   <span class="insert">Data_2 is constructed, as the CBOR Sequence of the CBOR data items</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   TH_2 = H( message_1, data_2 ), as a CBOR Sequence of these 2 data</td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   items.</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'4acd374173cc6f2b55c759ef6e782ca307e79821f4da89a678077f8b796a3f65',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c8'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   data_2 (CBOR Sequence) (36 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 4a cd 37 41 73 cc 6f 2b 55 c7 59 ef 6e 78 2c a3 07 e7 98 21 f4 da</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   89 a6 78 07 7f 8b 79 6a 3f 65 41 c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   From data_2 and <span class="insert">message_1 (from Appendix B.3.3),</span> compute the input to</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   the transcript hash TH_2 = H( message_1, data_2 ), as a CBOR Sequence</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   of these 2 data items.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">( message_1, data_2 ) (CBOR Sequence) (74 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   0d 00 58 20 65 22 d2 2d 50 87 46 6e a1 22 9b fb ee b8 52 9e 56 e1 d9 cb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c7 79 cb 36 74 a9 42 91 fd 9b 1a 08 41 c7 58 20 4a cd 37 41 73 cc 6f 2b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   55 c7 59 ef 6e 78 2c a3 07 e7 98 21 f4 da 89 a6 78 07 7f 8b 79 6a 3f 65</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0529"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Input to calculate TH_2 (CBOR Sequence) (72 bytes)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0d 00 58 20 8d 3e f5 6d 1b 75 0a 43 51 d6 8a c2 50 a0 e8 83 79 0e fc 80</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a5 38 a4 44 ee 9e 2b 57 e2 44 1a 7c 21 58 20 52 fb a0 bd c8 d9 53 dd 86</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db fc 33 01 04 70 69 45 1b af 35 08</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   And from there, compute the transcript hash TH_2 = SHA-256(</td><td> </td><td class="right">   And from there, compute the transcript hash TH_2 = SHA-256(</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_1, data_2 )</td><td> </td><td class="right">   message_1, data_2 )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0530"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> TH_2 (32 bytes)</td><td> </td><td class="rblock">   TH_2 <span class="insert">value</span> (32 bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">6a 28 78 e8 4b</span> 2c <span class="delete">c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30 0c</span> af <span class="delete">9c 49</span></td><td> </td><td class="rblock">   <span class="insert">4f 92 2e 15 50</span> 2c <span class="insert">ec fb 04 b3</span> af <span class="insert">d8 05 1f ae 4f 98 d5 6b 24 51 c4 65 23</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1a 52 e6 83 6a 25 64 ff</span></td><td> </td><td class="rblock"><span class="insert">   18 e0 ed 18 26 cb 21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0531"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Responder's subject name is the empty string</span>:</td><td> </td><td class="rblock">   <span class="insert">When encoded as a CBOR bstr, that gives</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0532"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Responders's subject name (text string)</span></td><td> </td><td class="rblock">   <span class="insert">TH_2 (CBOR-encoded) (34 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   ""</span></td><td> </td><td class="rblock"><span class="insert">   58 20 4f 92 2e 15 50 2c ec fb 04 b3 af d8 05 1f ae 4f 98 d5 6b 24 51 c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   65 23 18 e0 ed 18 26 cb 21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0533"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   ID_CRED_R is the following:</span></td><td> </td><td class="rblock"><span class="insert">B.3.4.1.  MAC Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0534"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_R =</span></td><td> </td><td class="rblock">   <span class="insert">Since method equals 3, a COSE_Encrypt0 is calculated.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   {</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     4: h'07'</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   }</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0535"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_R (4 bytes)</span></td><td> </td><td class="rblock"><span class="insert">B.3.4.1.1.  Key and Nonce Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   a1 04 41 07</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0536"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">CRED_R is</span> the <span class="delete">following COSE_Key:</span></td><td> </td><td class="rblock">   <span class="insert">The key and nonce for calculating</span> the <span class="insert">MAC are calculated as follows,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   as specified in Section 3.8.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0537"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">{</span></td><td> </td><td class="rblock">   <span class="insert">HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  1: 1,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  -1: 4,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  -2: h'A3FF263595BEB377D1A0CE1D04DAD2D40966AC6BCB622051B84659184D5D9A32',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  "subject name": ""</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0538"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Which encodes to the following byte string:</span></td><td> </td><td class="rblock">   <span class="insert">PRK_2e = HMAC-SHA-256 (salt, G_XY)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0539"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">CRED_R (54 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Since this is the asymmetric case, salt is the empty byte string.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a4 01 01 20 04 21 58 20 a3 ff 26 35 95 be b3 77 d1 a0 ce 1d 04 da d2 d4</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 09 66 ac 6b cb 62 20 51 b8 46 59 18 4d 5d 9a 32 6c 73 75 62 6a 65 63 74</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 20 6e 61 6d 65 60</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0540"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since no unprotected opaque auxiliary data</span> is <span class="delete">sent in</span> the <span class="delete">message</span></td><td> </td><td class="rblock">   <span class="insert">G_XY</span> is the <span class="insert">ECDH shared secret, and since the curve25519 is used, the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   exchanges:</span></td><td> </td><td class="rblock"><span class="insert">   ECDH shared secret is the output of the X25519 function.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0541"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">AD_2  (0</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">G_XY (32</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">12 2d f9 44 2b 2e 81 3c 3a 00 29 04 af 63 99 e0 f3 1c d5 96 7d 49 2a e6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   02 0b c2 d7 7c cb 4f 28</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0542"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Plaintext is defined as the empty string</span>:</td><td> </td><td class="rblock">   <span class="insert">From there, PRK_2e is computed</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0543"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">P_2m (0</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">PRK_2e (32</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Enc_structure is defined as follows: [ "Encrypt0",</span></td><td> </td><td class="rblock">   <span class="insert">f1 8c ca 1d af 06 1a f1 40 94 19 26 19 a4 dd 5e 9e 41 94 fc 42 fe 5e 20</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R &gt;&gt; ]</span></td><td> </td><td class="rblock"><span class="insert">   d0 27 9d 8d d3 1f ad 8f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0544"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">A_2m</span> =</td><td> </td><td class="rblock">   <span class="insert">PRK_3e2m</span> = <span class="insert">HKDF-Extract (PRK_2e, G_RX)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">[</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  "Encrypt0",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  h'A1044107',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  h'58206A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FFA401012004215820A3FF263595BEB377D1A0CE1D04DAD2D40966AC6BCB622051B84659184D5D9A326C7375626A656374206E616D6560'</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0545"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Which encodes to</span> the <span class="delete">following byte string to be used as Additional</span></td><td> </td><td class="rblock">   <span class="insert">G_RX is</span> the <span class="insert">ECDH shared secret calculated from G_X received in</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Authenticated Data:</span></td><td> </td><td class="rblock"><span class="insert">   Appendix B.3.3 and R in Appendix B.3.2, and since the curve25519 is</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   used, the ECDH shared secret is the output of the X25519 function.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0546"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">A_2m (CBOR-encoded) (105</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">G_RX (32</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">83 68 45 6e 63 72 79 70 74 30 44 a1 04 41 07 58 58 58 20 6a 28 78 e8 4b</span></td><td> </td><td class="rblock">   <span class="insert">5f 40 10 ca 84</span> 52 <span class="insert">1e 2d e8 71 7c f4 d9</span> 66 <span class="insert">ab 33 96 86</span> 6c <span class="insert">4c</span> 74 <span class="insert">f3 85 96</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30 0c af 9c 49 1a</span> 52 <span class="delete">e6 83 6a</span></td><td> </td><td class="rblock"><span class="insert">   dd 8f 23 b6 c4 83 99 2e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 25 64 ff a4 01 01 20 04 21 58 20 a3 ff 26 35 95 be b3 77 d1 a0 ce 1d 04</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> da d2 d4 09</span> 66 <span class="delete">ac 6b cb 62 20 51 b8 46 59 18 4d 5d 9a 32</span> 6c <span class="delete">73 75 62 6a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 65 63</span> 74 <span class="delete">20 6e 61 6d 65 60</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0547"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">info for K_2m is defined as follows</span>:</td><td> </td><td class="rblock">   <span class="insert">From there, PRK_3e2m is computed</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0548"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for K_2m =</td><td> </td><td class="rblock">   <span class="insert">PRK_3e2m (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock"><span class="insert">   08 4a 87 01 49 07 ed 85 12 90 42 55 e1 8a df a8 39 53 92 28 29 48 8f f4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    10,</td><td> </td><td class="rblock"><span class="insert">   66 44 87 1e 07 1d 42 80</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">h'6A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FF',</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_2m",</span></td><td> </td><td class="rblock"><span class="insert">   Key K_2m is the output of HKDF-Expand(PRK_3e2m, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    16</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">   info is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   info for K_2m =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     10,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     <span class="insert">[ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'a10441a8', h'4f922e15502cecfb04b3afd8051fae4f98d56b2451c46523</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                           18e0ed1826cb21c3']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0549"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for K_2m</span> (CBOR-encoded) <span class="delete">(42</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(K_2m)</span> (CBOR-encoded) <span class="insert">(52</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 0a 58 20 <span class="delete">6a 28 78 e8 4b</span> 2c <span class="delete">c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30</span></td><td> </td><td class="rblock">   84 0a <span class="insert">83 f6 f6 f6 83 f6 f6 f6 83 18 80 44 a1 04 41 a8</span> 58 20 <span class="insert">4f 92 2e 15</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0c</span> af <span class="delete">9c 49 1a 52 e6 83 6a 25 64 ff 64 4b 5f 32 6d 10</span></td><td> </td><td class="rblock"><span class="insert">   50</span> 2c <span class="insert">ec fb 04 b3</span> af <span class="insert">d8 05 1f ae 4f 98 d5 6b 24 51 c4 65 23 18 e0 ed 18</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   26 cb 21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0550"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, K_2m is computed.  Key K_2m is the output of</span></td><td> </td><td class="rblock">   L is the length of K_2m, so 16 bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   HKDF-Expand(PRK_3e2m, info, L), where</span> L is the length of K_2m, so 16</td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   bytes.</td><td> </td><td class="rblock">   <span class="insert">From these parameters, K_2m is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   K_2m (16 bytes)</td><td> </td><td class="right">   K_2m (16 bytes)</td><td class="lineno"></td></tr>
      <tr id="diff0551"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">81 2a 48 87 d1 90 ff ed 2b 10 0b a7 a5 c2 5e 67</span></td><td> </td><td class="rblock">   <span class="insert">55 9d 43 46 34 44 83 e2 05 6b 18 5d 5a 78 b5 1e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0552"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">info for IV_2m is defined as follows:</span></td><td> </td><td class="rblock">   <span class="insert">Nonce IV_2m is the output of HKDF-Expand(PRK_3e2m, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0553"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for IV_2m =</td><td> </td><td class="rblock">   info <span class="insert">is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">10,</span></td><td> </td><td class="rblock"><span class="insert">   info</span> for IV_2m =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'6A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FF',</span></td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "IV_2m",</span></td><td> </td><td class="rblock">     <span class="insert">"IV-GENERATION",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    13</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 104, h'a10441a8', h'4f922e15502cecfb04b3afd8051fae4f98d56b2451c46523</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                           18e0ed1826cb21c3']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0554"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for IV_2m</span> (CBOR-encoded) <span class="delete">(43</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(IV_2m)</span> (CBOR-encoded) <span class="insert">(65</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 <span class="delete">0a</span> 58 20 <span class="delete">6a 28 78 e8 4b</span> 2c <span class="delete">c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30</span></td><td> </td><td class="rblock">   84 <span class="insert">6d 49 56 2d 47 45 4e 45 52 41 54 49 4f 4e 83 f6 f6 f6 83 f6 f6 f6 83</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0c</span> af <span class="delete">9c 49 1a 52 e6 83 6a 25 64 ff</span> 65 <span class="delete">49 56 5f 32 6d 0d</span></td><td> </td><td class="rblock"><span class="insert">   18 68 44 a1 04 41 a8</span> 58 20 <span class="insert">4f 92 2e 15 50</span> 2c <span class="insert">ec fb 04 b3</span> af <span class="insert">d8 05 1f ae</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4f 98 d5 6b 24 51 c4</span> 65 <span class="insert">23 18 e0 ed 18 26 cb 21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0555"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, IV_2m is computed.  IV_2m is the output of</span></td><td> </td><td class="rblock">   L is the length of IV_2m, so 13 bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   HKDF-Expand(PRK_3e2m, info, L), where</span> L is the length of IV_2m, so 13</td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   bytes.</td><td> </td><td class="rblock">   <span class="insert">From these parameters, IV_2m is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   IV_2m (13 bytes)</td><td> </td><td class="right">   IV_2m (13 bytes)</td><td class="lineno"></td></tr>
      <tr id="diff0556"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">92 3c 0f 94 31 51 5b 69 21 30 49 2b 7f</span></td><td> </td><td class="rblock">   <span class="insert">a2 8b 02 5a 26 89 6e 38 6d 10 e4 fa 55</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0557"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Finally, COSE_Encrypt0 is computed from the parameters above.</span></td><td> </td><td class="rblock"><span class="insert">B.3.4.1.2.  MAC Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0558"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  protected header = CBOR-encoded ID_CRED_R</span></td><td> </td><td class="rblock">   <span class="insert">COSE_Encrypt0 is computed with the following parameters.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0559"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  external_aad = A_2m</span></td><td> </td><td class="rblock">   <span class="insert">*  protected header = CBOR-encoded ID_CRED_R</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0560"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  empty plaintext = P_2m</span></td><td> </td><td class="rblock">   <span class="insert">*  external_aad = CBOR Sequence of CRED_R and TH_2, in this order</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0561"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">MAC_2 (8 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">*  empty plaintext</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   64 21 0d 2e 18 b9 28 cd</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0562"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there Signature_or_MAC_2 is the MAC (since method = 3):</span></td><td> </td><td class="rblock">   <span class="insert">Protected header: ID_CRED_R (CBOR-encoded) (5 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   44 a1 04 41 a8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0563"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Signature_or_MAC_2 (8 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">The external_aad is the following:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   64 21 0d 2e 18 b9 28 cd</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0564"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a</span></td><td> </td><td class="rblock">   <span class="insert">( CRED_R , TH_2 ) (CBOR Sequence) (72 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   plaintext constructed from the following parameters and the key K_2e.</span></td><td> </td><td class="rblock"><span class="insert">   a3 01 01 20 04 21 58 20 32 82 44 f6 cd f5 f1 27 22 50 d7 cf bb a2 68 34</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   fb ef 25 e8 46 db 8b af 89 0f aa 8d 7e f6 e6 73 4f 92 2e 15 50 2c ec fb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   04 b3 af d8 05 1f ae 4f 98 d5 6b 24 51 c4 65 23 18 e0 ed 18 26 cb 21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0565"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">o  plaintext = CBOR Sequence of the items ID_CRED_R and the CBOR</span></td><td> </td><td class="rblock">   <span class="insert">Which encodes to</span> the <span class="insert">following</span> byte <span class="insert">string:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      encoded Signature_or_MAC_2, in this order.  Note that since</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      ID_CRED_R contains a single 'kid' parameter, i.e., ID_CRED_R = { 4</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      : kid_R }, only</span> the byte <span class="delete">string kid_R is conveyed in the plaintext</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      encoded as a bstr_identifier. kid_R is encoded as the</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      corresponding integer - 24 (see bstr_identifier in Section 4.3),</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      i.e. 0x07 = 7, 7 - 24 = -17, and -17 in CBOR encoding is equal to</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">      0x30.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0566"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The plaintext is the following:</span></td><td> </td><td class="rblock">    <span class="insert">CRED_R , TH_2 ) (CBOR Sequence) (CBOR-encoded) (74 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 48 a3 01 01 20 04 21 58 20 32 82 44 f6 cd f5 f1 27 22 50 d7 cf bb a2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   68 34 fb ef 25 e8 46 db 8b af 89 0f aa 8d 7e f6 e6 73 4f 92 2e 15 50 2c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ec fb 04 b3 af d8 05 1f ae 4f 98 d5 6b 24 51 c4 65 23 18 e0 ed 18 26 cb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0567"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">P_2e (CBOR Sequence) (10 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From the parameters above, the Enc_structure A_2 is computed.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   30 48 64 21 0d 2e 18 b9 28 cd</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0568"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">K_2e</span> = <span class="delete">HKDF-Expand( PRK, info, length ), where length is the length</span></td><td> </td><td class="rblock">   <span class="insert">A_2m</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   of the plaintext, so 80.</span></td><td> </td><td class="rblock">   <span class="insert">[</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "Encrypt0",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'a10441a8',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'a301012004215820328244f6cdf5f1272250d7cfbba26834fbef25e846db8baf890f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       aa8d7ef6e6734f922e15502cecfb04b3afd8051fae4f98d56b2451c4652318e0ed18</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       26cb21c3'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0569"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for K_2e =</td><td> </td><td class="rblock">   <span class="insert">Which encodes to the following byte string to be used as Additional</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock"><span class="insert">   Authenticated Data:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">10,</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'6A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FF',</span></td><td> </td><td class="rblock"><span class="insert">   A_2m (CBOR-encoded) (89 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_2e",</span></td><td> </td><td class="rblock"><span class="insert">   83 68 45 6e 63 72 79 70 74 30 44 a1 04 41 a8 58 48 a3 01 01 20 04 21 58</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    10</span></td><td> </td><td class="rblock"><span class="insert">   20 32 82 44 f6 cd f5 f1 27 22 50 d7 cf bb a2 68 34 fb ef 25 e8 46 db 8b</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">   af 89 0f aa 8d 7e f6 e6 73 4f 92 2e 15 50 2c ec fb 04 b3 af d8 05 1f ae</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   4f 98 d5 6b 24 51 c4 65 23 18 e0 ed 18 26 cb 21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce used are defined in Appendix B.3.4.2:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  key = K_2m</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  nonce = IV_2m</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Using the parameters above, the ciphertext MAC_2 can be computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   MAC_2 (9 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   7b cd b0 21 74 bc dc 69 05</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.3.4.2.  Key and Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce for calculating the ciphertext are calculated as</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   follows, as specified in Section 3.8.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK_2e = HMAC-SHA-256(salt, G_XY) as defined in Appendix B.3.4.1.1</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   PRK_2e (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f1 8c ca 1d af 06 1a f1 40 94 19 26 19 a4 dd 5e 9e 41 94 fc 42 fe 5e 20</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   d0 27 9d 8d d3 1f ad 8f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Key K_2e is the output of HKDF-Expand(PRK_2e, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info is defined as follows:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   info for K_2e =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">     <span class="insert">XOR-ENCRYPTION,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'4f922e15502cecfb04b3afd8051fae4f98d56b2451c46523</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                           18e0ed1826cb21c3']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0570"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for K_2e</span> (CBOR-encoded) <span class="delete">(42</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(K_2e)</span> (CBOR-encoded) <span class="insert">(62</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 <span class="delete">0a</span> 58 <span class="delete">20 6a 28 78 e8 4b 2c c0 21 cc 1a eb a2 96</span> 52 <span class="delete">53 ef 42 f7 fa 30</span></td><td> </td><td class="rblock">   84 <span class="insert">6e</span> 58 <span class="insert">4f</span> 52 <span class="insert">2d 45 4e 43</span> 52 <span class="insert">59 50 54 49 4f 4e 83 f6 f6 f6</span> 83 <span class="insert">f6 f6 f6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0c af 9c 49 1a</span> 52 <span class="delete">e6</span> 83 <span class="delete">6a 25 64 ff 64 4b 5f 32</span> 65 <span class="delete">0a</span></td><td> </td><td class="rblock"><span class="insert">   83 18 80 40 58 20 4f 92 2e 15 50 2c ec fb 04 b3 af d8 05 1f ae 4f 98 d5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   6b 24 51 c4</span> 65 <span class="insert">23 18 e0 ed 18 26 cb 21 c3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0571"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From there, K_2e is computed:</span></td><td> </td><td class="rblock">   <span class="insert">L is the length of K_2e, so 12 bytes.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0572"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   K_2e <span class="delete">(10</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">From these parameters,</span> K_2e <span class="insert">is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ec be 9a</span> bd <span class="delete">5f 62 3a fc 65 26</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   K_2e (12</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">7f bd 09</span> bd <span class="insert">68 e9 cc 97 09 48 21 04</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.3.4.3.  Ciphertext Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   plaintext with the following common parameters</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  plaintext = CBOR Sequence of the items kid_R and MAC_2, in this</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      order.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   with kid_R taken from Appendix B.3.2, and MAC_2 as calculated in</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Appendix B.3.4.1.2.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The plaintext is the following:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   P_2  (12 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a8 49 7b cd b0 21 74 bc dc 69 05</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key used is defined in Appendix B.3.4.2:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  key = K_2e</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Using the parameters above, the ciphertext CIPHERTEXT_2 can be</td><td> </td><td class="right">   Using the parameters above, the ciphertext CIPHERTEXT_2 can be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   computed:</td><td> </td><td class="right">   computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0573"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   CIPHERTEXT_2 <span class="delete">(10</span> bytes)</td><td> </td><td class="rblock">   CIPHERTEXT_2 <span class="insert">(12</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">dc f6 fe 9c 52 4c 22 45 4d eb</span></td><td> </td><td class="rblock">   <span class="insert">3e 15 40 c6 a5 59 ed e3 b5 94 48 01</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0574"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   message_2 is the CBOR Sequence of <span class="delete">data_2 and CIPHERTEXT_2, in this</span></td><td> </td><td class="rblock"><span class="insert">B.3.4.4.  message_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   order:</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the parameter computed in Appendix B.3.4 and Appendix B.3.4.3,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   message_2 is <span class="insert">computed, as</span> the CBOR Sequence of <span class="insert">the following items:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (G_Y, C_R, CIPHERTEXT_2).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_2 =</td><td> </td><td class="right">   message_2 =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   (</td><td> </td><td class="right">   (</td><td class="lineno"></td></tr>
      <tr id="diff0575"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">data_2,</span></td><td> </td><td class="rblock">     <span class="insert">h'4acd374173cc6f2b55c759ef6e782ca307e79821f4da89a678077f8b796a3f65',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'DCF6FE9C524C22454DEB'</span></td><td> </td><td class="rblock"><span class="insert">     h'c8',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'3e1540c6a559ede3b5944801'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0576"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Which <span class="delete">as a CBOR encoded data item is</span>:</td><td> </td><td class="rblock">   Which <span class="insert">encodes to the following byte string</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0577"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> message_2 (CBOR Sequence) <span class="delete">(46</span> bytes)</td><td> </td><td class="rblock">   message_2 (CBOR Sequence) <span class="insert">(49</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 58 20 <span class="delete">52 fb a0 bd c8 d9 53 dd 86 ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db</span></td><td> </td><td class="rblock">   58 20 4a <span class="insert">cd 37 41 73 cc 6f 2b 55 c7 59 ef 6e 78 2c a3 07 e7 98 21 f4 da</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> fc 33 01 04 70 69 45 1b af 35 08</span> 4a <span class="delete">dc f6 fe 9c 52</span> 4c <span class="delete">22 45 4d eb</span></td><td> </td><td class="rblock"><span class="insert">   89 a6 78 07 7f 8b 79 6a 3f 65 41 c8</span> 4c <span class="insert">3e 15 40 c6 a5 59 ed e3 b5 94 48</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   01</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0578"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">B.<span class="delete">2.3.  Message_</span>3</td><td> </td><td class="rblock">B.<span class="insert">3.5.  Message </span>3</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Since corr equals 1, C_R is not omitted from data_3.</td><td> </td><td class="right">   Since corr equals 1, C_R is not omitted from data_3.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0579"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">SK_I (Initiator's private authentication key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">C_R (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 2b be a6 55 c2 33 71 c3 29 cf bd 3b 1f 02 c6 c0 62 03 38 37 b8 b5 90 99</span></td><td> </td><td class="rblock"><span class="insert">   c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a4 43 6f 66 60 81 b0 8e</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0580"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_I (Initiator's public authentication key) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Data_3 is constructed, as the CBOR Sequence of the CBOR data item</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 2c 44 0c c1 21 f8 d7 f2 4c 3b 0e 41 ae da fe 9c aa 4f 4e 7a bb 83 5e c3</span></td><td> </td><td class="rblock"><span class="insert">   above.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 0f 1d e8 8a db 96 ff 71</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0581"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td> </td><td class="rblock">   <span class="insert">data_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'c8'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0582"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From the Initiator's authentication key and the Responder's ephemeral</span></td><td> </td><td class="rblock">   <span class="insert">data_3 (CBOR Sequence) (2 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   key (see Appendix B.2.2), the ECDH shared secret G_IY is calculated.</span></td><td> </td><td class="rblock"><span class="insert">   41 c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0583"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">G_IY (ECDH shared secret) (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From data_3, CIPHERTEXT_2 (Appendix B.1.4.3), and TH_2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> cb ff 8c d3 4a 81 df ec 4c b6 5d 9a 57 2e bd 09 64 45 0c 78 56 3d a4 98</span></td><td> </td><td class="rblock"><span class="insert">   (Appendix B.1.4), compute the input to the transcript hash TH_2 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 1d 80 d3 6c 8b 1a 75 2a</span></td><td> </td><td class="rblock"><span class="insert">   H(TH_2 , CIPHERTEXT_2, data_3), as a CBOR Sequence of these 3 data</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   items.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0584"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">PRK_4x3m = HMAC-SHA-256 (PRK_3e2m, G_IY).</span></td><td> </td><td class="rblock">   <span class="insert">( TH_2, CIPHERTEXT_2, data_3 ) (CBOR Sequence) (49 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 4f 92 2e 15 50 2c ec fb 04 b3 af d8 05 1f ae 4f 98 d5 6b 24 51 c4</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   65 23 18 e0 ed 18 26 cb 21 c3 4c 3e 15 40 c6 a5 59 ed e3 b5 94 48 01 41</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0585"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">PRK_4x3m (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">And from there, compute the transcript hash TH_3 = SHA-256(TH_2 ,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> ec 62 92 a0 67 f1 37 fc 7f 59 62 9d 22 6f bf c4 e0 68 89 49 f6 62 a9 7f</span></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_2, data_3)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> d8 2f be b7 99 71 39 4a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0586"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">data 3 is equal to C_R.</span></td><td> </td><td class="rblock">   <span class="insert">TH_3 value (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   b0 06 6f 45 98 29 14 95 82 8f 0a 2e 8c 0b 6f 42 10 f7 37 f3 17 e0 2c bb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f9 8d 4c df 70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0587"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">data_3 (CBOR Sequence) (1</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">TH_3 (CBOR-encoded) (34</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">08</span></td><td> </td><td class="rblock">   <span class="insert">58 20 b0 06 6f 45 98 29 14 95 82 8f 0a 2e 8c 0b 6f 42 10 f7 37 f3 17 e0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   2c bb f9 8d 4c df 70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0588"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From data_3, CIPHERTEXT_2, and TH_2, compute the input to the</span></td><td> </td><td class="rblock"><span class="insert">B.3.5.1.  MAC Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   transcript hash TH_3 = H(TH_2 , CIPHERTEXT_2, data_3), as a CBOR</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Sequence of these 3 data items.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0589"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">Input to calculate TH_3 (CBOR Sequence) (46 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Since method equals 3, a COSE_Encrypt0 is calculated.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 58 20 6a 28 78 e8 4b 2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30 0c af</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 9c 49 1a 52 e6 83 6a 25 64 ff 4a dc f6 fe 9c 52 4c 22 45 4d eb 08</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0590"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">And from there, compute the transcript hash TH_3 = SHA-256(TH_2 ,</span></td><td> </td><td class="rblock"><span class="insert">B.3.5.1.1.  Key and Nonce Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   CIPHERTEXT_2, data_3)</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0591"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">TH_3 (32 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">The key and nonce for calculating the MAC are calculated as follows,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 51 dd 22 43 a6 b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc e4 80 16 07</span></td><td> </td><td class="rblock"><span class="insert">   as specified in Section 3.8.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 03 ee d9 c4 a1 bc b6 11</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0592"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The initiator's subject name is the empty string:</span></td><td> </td><td class="rblock">   <span class="insert">HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0593"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Initiator's subject name (text string)</span></td><td> </td><td class="rblock">   <span class="insert">PRK_4x3m = HMAC-SHA-256 (PRK_3e2m, G_IY)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   ""</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0594"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">And its credential is:</span></td><td> </td><td class="rblock">   <span class="insert">G_IY is the ECDH shared secret, and since the curve25519 is used, the</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ECDH shared secret is the output of the X25519 function.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0595"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_I =</span></td><td> </td><td class="rblock">   <span class="insert">G_IY (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   {</span></td><td> </td><td class="rblock"><span class="insert">   9f 70 4c 69 61 ae 11 4e 0f 06 53 e3 fa 72 0d 98 9d e4 79 63 b5 6f a3 a3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     4: h'24'</span></td><td> </td><td class="rblock"><span class="insert">   c3 c6 5f 0a 5b 6b 7f 20</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   }</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0596"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">ID_CRED_I (4 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From there, PRK_4x3m is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   a1 04 41 24</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0597"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">CRED_I is the following COSE_Key:</span></td><td> </td><td class="rblock">   <span class="insert">PRK_4x3m  (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f1 df af 80 cb 4b b6 a8 1c 83 ad 2e d7 bb ed d5 ac bc 7b b2 b2 a8 a5 ea</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   8d fb 24 b9 45 1f fe 20</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0598"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">{</span></td><td> </td><td class="rblock">   <span class="insert">Key K_3m is the output of HKDF-Expand(PRK_I, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  1: 1,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  -1: 4,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   -2: h'2C440CC121F8D7F24C3B0E41AEDAFE9CAA4F4E7ABB835EC30F1DE88ADB96FF71',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   "subject name": ""</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> }</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0599"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Which encodes to the following byte string</span>:</td><td> </td><td class="rblock">   <span class="insert">info is defined as follows</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0600"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">CRED_I (54 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">info for K_3m =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> a4 01 01 20 04 21 58 20 2c 44 0c c1 21 f8 d7 f2 4c 3b 0e 41 ae da fe 9c</span></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> aa 4f 4e 7a bb 83 5e c3 0f 1d e8 8a db 96 ff 71 6c 73 75 62 6a 65 63 74</span></td><td> </td><td class="rblock"><span class="insert">     10,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 20 6e 61 6d 65 60</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'a10441a7', h'b0066f4598291495828f0a2e8c0b6f4210f737f317e02cbb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                           f98d4cdf705dc1b3']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0601"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since no opaque auxiliary data is exchanged</span>:</td><td> </td><td class="rblock">   <span class="insert">Which as a CBOR encoded data item is</span>:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0602"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">AD_3 (0</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">info (K_3m) (CBOR-encoded) (52</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">84 0a 83 f6 f6 f6 83 f6 f6 f6 83 18 80 44 a1 04 41 a7 58 20 b0 06 6f 45</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   98 29 14 95 82 8f 0a 2e 8c 0b 6f 42 10 f7 37 f3 17 e0 2c bb f9 8d 4c df</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0603"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Plaintext of the COSE_Encrypt is the empty string:</span></td><td> </td><td class="rblock">   <span class="insert">L is the length of K_3m, so 16 bytes.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0604"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">P_3m (0 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From these parameters, K_3m is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0605"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The external_aad is the CBOR Sequence of CRED_I and TH_3, in this</span></td><td> </td><td class="rblock">   <span class="insert">K_3m (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   order:</span></td><td> </td><td class="rblock"><span class="insert">   ed 5e 7f db e6 86 e5 e9 d8 ad c3 d9 95 e4 16 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0606"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">A_3m (CBOR-encoded) (105 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Nonce IV_3m is the output of HKDF-Expand(PRK_4x3m, info, L).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 83 68 45 6e 63 72 79 70 74 30 44 a1 04 41 24 58 58 58 20 51 dd 22 43 a6</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc e4 80 16 07 03 ee d9 c4 a1</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> bc b6 11 a4 01 01 20 04 21 58 20 2c 44 0c c1 21 f8 d7 f2 4c 3b 0e 41 ae</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> da fe 9c aa 4f 4e 7a bb 83 5e c3 0f 1d e8 8a db 96 ff 71 6c 73 75 62 6a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 65 63 74 20 6e 61 6d 65 60</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0607"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Info for K_3m is comput</span>ed as follows:</td><td> </td><td class="rblock">   <span class="insert">info is defin</span>ed as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0608"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for <span class="delete">K_3m</span> =</td><td> </td><td class="rblock">   info for <span class="insert">IV_3m</span> =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">10,</span></td><td> </td><td class="rblock">     <span class="insert">"IV-GENERATION",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_3m",</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    16</span></td><td> </td><td class="rblock"><span class="insert">     [ 104, h'a10441a7', h'b0066f4598291495828f0a2e8c0b6f4210f737f317e02cbb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">                           f98d4cdf705dc1b3']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0609"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for K_3m</span> (CBOR-encoded) <span class="delete">(42</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(IV_3m)</span> (CBOR-encoded) <span class="insert">(65</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 <span class="delete">0a</span> 58 20 <span class="delete">51 dd 22 43 a6 b8 3f 13 16 dc 53</span> 29 <span class="delete">1a e1 91 cd 93 b4 44 cc</span></td><td> </td><td class="rblock">   84 <span class="insert">6d 49 56 2d 47 45 4e 45 52 41 54 49 4f 4e 83 f6 f6 f6 83 f6 f6 f6 83</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e4 80 16 07 03 ee d9 c4 a1 bc b6 11 64 4b 5f 33 6d</span> 10</td><td> </td><td class="rblock"><span class="insert">   18 68 44 a1 04 41 a7</span> 58 20 <span class="insert">b0 06 6f 45 98</span> 29 <span class="insert">14 95 82 8f 0a 2e 8c 0b 6f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   42</span> 10 <span class="insert">f7 37 f3 17 e0 2c bb f9 8d 4c df 70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0610"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, K_3m is computed.  Key K_3m is the output of</span></td><td> </td><td class="rblock">   L is the length of <span class="insert">IV_3m,</span> so <span class="insert">13</span> bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   HKDF-Expand(PRK_4x3m, info, L), where</span> L is the length of <span class="delete">K_2m,</span> so <span class="delete">16</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   bytes.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0611"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">K_3m (16 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From these parameters, IV_3m is computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   84 85 31 8a a3 08 6f d5 86 7a 02 8e 99 e2 40 30</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0612"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Nonce</span> IV_3m <span class="delete">is the output of HKDF-Expand(PRK_4x3m, info, L), where L</span></td><td> </td><td class="rblock">   IV_3m <span class="insert">(13 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   = 13 bytes.</span></td><td> </td><td class="rblock"><span class="insert">   90 3d e5 21 1c 09 e6 79 8c ce 30 4c c2</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0613"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Info for IV_3m is defined as follows:</span></td><td> </td><td class="rblock"><span class="insert">B.3.5.1.2.  MAC Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0614"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  <span class="delete">info for IV_3m =</span></td><td> </td><td class="rblock">   <span class="insert">COSE_Encrypt0 is computed with the following parameters.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  [</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    10,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "IV_3m",</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    13</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">  ]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0615"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Which as a CBOR encoded data item is:</span></td><td> </td><td class="rblock">   <span class="insert">*  protected header = CBOR-encoded ID_CRED_I</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0616"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">info for IV_3m (CBOR-encoded) (43 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">*  external_aad = CBOR Sequence of CRED_I and TH_3, in this order</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 84 0a 58 20 51 dd 22 43 a6 b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e4 80 16 07 03 ee d9 c4 a1 bc b6 11 65 49 56 5f 33 6d 0d</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0617"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">From these parameters, IV_3m is computed:</span></td><td> </td><td class="rblock">   <span class="insert">*  empty plaintext</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Protected header: ID_CRED_I (CBOR-encoded) (5 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   44 a1 04 41 a7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0618"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">IV_3m (13 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">The external_aad is the following:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   1e 10 5b 88 50 0e d5 ae b0 5d 00 6b ea</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0619"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">MAC_3 is the ciphertext of the COSE_Encrypt0:</span></td><td> </td><td class="rblock">   <span class="insert">( CRED_I , TH_3 ) (CBOR Sequence) (72 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a3 01 01 20 04 21 58 20 6e 5d 68 76 a1 78 15 6c a0 b8 1d c8 0f 81 06 0f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a1 a5 d1 35 13 d6 14 bc c2 85 37 ef 98 90 06 44 b0 06 6f 45 98 29 14 95</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   82 8f 0a 2e 8c 0b 6f 42 10 f7 37 f3 17 e0 2c bb f9 8d 4c df 70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0620"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">MAC_3 (8 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">Which encodes to the following byte string:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   1f b7 5a c1 aa d2 34 25</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0621"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Since the method = 3, Signature_or_Mac_3 is the MAC_3:</span></td><td> </td><td class="rblock">   <span class="insert">( CRED_I , TH_3 ) (CBOR Sequence) (CBOR-encoded) (74 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 48 a3 01 01 20 04 21 58 20 6e 5d 68 76 a1 78 15 6c a0 b8 1d c8 0f 81</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   06 0f a1 a5 d1 35 13 d6 14 bc c2 85 37 ef 98 90 06 44 b0 06 6f 45 98 29</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   14 95 82 8f 0a 2e 8c 0b 6f 42 10 f7 37 f3 17 e0 2c bb f9 8d 4c df 70 5d</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0622"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Signature_or_MAC_3 (8 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">From the parameters above, the Enc_structure A_3m is computed.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   1f b7 5a c1 aa d2 34 25</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0623"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">Finally, the outer COSE_Encrypt0 is computed.</span></td><td> </td><td class="rblock">   <span class="insert">A_3m =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "Encrypt0",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'a10441a7',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'a3010120042158206e5d6876a178156ca0b81dc80f81060fa1a5d13513d614bcc285</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       37ef98900644b0066f4598291495828f0a2e8c0b6f4210f737f317e02cbbf98d4cdf</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       705dc1b3'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0624"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">The Plaintext is</span> the following <span class="delete">CBOR Sequence: plaintext = ( ID_CRED_I</span></td><td> </td><td class="rblock">   <span class="insert">Which encodes to</span> the following byte string to <span class="insert">be used as Additional</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   , Signature_or_MAC_3 ).  Note that since ID_CRED_I contains a single</span></td><td> </td><td class="rblock"><span class="insert">   Authenticated Data:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   'kid' parameter, i.e., ID_CRED_I = { 4 : kid_I }, only the</span> byte</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   string <span class="delete">kid_I is conveyed in the plaintext encoded as a</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   bstr_identifier. kid_I is encoded as the corresponding integer - 24</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   (see bstr_identifier in Section 4.3), i.e. 0x24 = 36, 36 - 24 = 12,</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   and 12 in CBOR encoding is equal</span> to <span class="delete">0x0c.</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0625"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">P_3ae (CBOR Sequence) (10</span> bytes)</td><td> </td><td class="rblock">   <span class="insert">A_3m (CBOR-encoded) (89</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">0c</span> 48 <span class="delete">1f b7 5a</span> c1 <span class="delete">aa d2 34 25</span></td><td> </td><td class="rblock">   <span class="insert">83 68 45 6e 63 72 79 70 74 30 44 a1 04 41 a7 58</span> 48 <span class="insert">a3 01 01 20 04 21 58</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   20 6e 5d 68 76 a1 78 15 6c a0 b8 1d c8 0f 81 06 0f a1 a5 d1 35 13 d6 14</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   bc c2 85 37 ef 98 90 06 44 b0 06 6f 45 98 29 14 95 82 8f 0a 2e 8c 0b 6f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   42 10 f7 37 f3 17 e0 2c bb f9 8d 4c df 70 5d</span> c1 <span class="insert">b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0626"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   The <span class="delete">Associated data A is the following: Associated data A = [</span></td><td> </td><td class="rblock">   The <span class="insert">key and nonce used are defined in Appendix B.3.5.2:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   "Encrypt0", h'', TH_3 ]</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0627"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> <span class="delete">A_3ae (CBOR-encoded) (45 bytes)</span></td><td> </td><td class="rblock">   <span class="insert">*  key = K_3m</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 83 68 45 6e 63 72 79 70 74 30 40 58 20 51 dd 22 43 a6 b8 3f 13 16 dc 53</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> 29 1a e1 91 cd 93 b4 44 cc e4 80 16 07 03 ee d9 c4 a1 bc b6 11</span></td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0628"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Key <span class="delete">K_3ae</span> is the output of HKDF-Expand(PRK_3e2m, info, L).</td><td> </td><td class="rblock">   <span class="insert">*  nonce = IV_3m</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Using the parameters above, the ciphertext MAC_3 can be computed:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   MAC_3 (9 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   05 82 46 79 2e f2 17 65 99</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.3.5.2.</span>  Key <span class="insert">and Nonce Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce for calculating the ciphertext are calculated as</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   follows, as specified in Section 3.8.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Key K_3</span> is the output of HKDF-Expand(PRK_3e2m, info, L).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   info is defined as follows:</td><td> </td><td class="right">   info is defined as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0629"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for K_3ae =</td><td> </td><td class="rblock">   info for K_3ae =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    10,</td><td> </td><td class="rblock">     10,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',</span></td><td> </td><td class="rblock">     <span class="insert">[ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "K_3ae",</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    16</span></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'b0066f4598291495828f0a2e8c0b6f4210f737f317e02cbb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">                           f98d4cdf705dc1b3']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0630"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for K_3ae</span> (CBOR-encoded) <span class="delete">(43</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(K_3ae)</span> (CBOR-encoded) <span class="insert">(48</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 0a 58 20 <span class="delete">51 dd 22 43 a6 b8 3f 13 16 dc 53</span> 29 <span class="delete">1a e1 91 cd 93 b4 44 cc</span></td><td> </td><td class="rblock">   84 0a <span class="insert">83 f6 f6 f6 83 f6 f6 f6 83 18 80 40</span> 58 20 <span class="insert">b0 06 6f 45 98</span> 29 <span class="insert">14 95</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e4 80 16 07 03 ee d9 c4 a1 bc b6 11 65 4b 5f 33 61 65</span> 10</td><td> </td><td class="rblock"><span class="insert">   82 8f 0a 2e 8c 0b 6f 42</span> 10 <span class="insert">f7 37 f3 17 e0 2c bb f9 8d 4c df 70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   L is the length of K_3ae, so 16 bytes.</td><td> </td><td class="right">   L is the length of K_3ae, so 16 bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   From these parameters, K_3ae is computed:</td><td> </td><td class="right">   From these parameters, K_3ae is computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   K_3ae (16 bytes)</td><td> </td><td class="right">   K_3ae (16 bytes)</td><td class="lineno"></td></tr>
      <tr id="diff0631"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   b<span class="delete">f 29 0b 7e e0 4b 86 5d e1 01 0a 81 1b 36 00 64</span></td><td> </td><td class="rblock">   b<span class="insert">9 97 30 d0 ca a7 97 25 50 61 50 f1 0c 37 9b 46</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Nonce IV_3ae is the output of HKDF-Expand(PRK_3e2m, info, L).</td><td> </td><td class="right">   Nonce IV_3ae is the output of HKDF-Expand(PRK_3e2m, info, L).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   info is defined as follows:</td><td> </td><td class="right">   info is defined as follows:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0632"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  info for IV_3ae =</td><td> </td><td class="rblock">   info for IV_3ae =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  [</td><td> </td><td class="rblock">   [</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">    <span class="delete">10,</span></td><td> </td><td class="rblock">     <span class="insert">"IV-GENERATION",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    "IV_3ae",</span></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">    13</span></td><td> </td><td class="rblock"><span class="insert">     [ 104, h'', h'b0066f4598291495828f0a2e8c0b6f4210f737f317e02cbb</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">  ]</td><td> </td><td class="rblock"><span class="insert">                           f98d4cdf705dc1b3']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   ]</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which as a CBOR encoded data item is:</td><td> </td><td class="right">   Which as a CBOR encoded data item is:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0633"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> info <span class="delete">for IV_3ae</span> (CBOR-encoded) <span class="delete">(44</span> bytes)</td><td> </td><td class="rblock">   info <span class="insert">(IV_3ae)</span> (CBOR-encoded) <span class="insert">(61</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"> 84 <span class="delete">0a</span> 58 20 <span class="delete">51 dd 22 43 a6 b8 3f 13 16 dc 53</span> 29 <span class="delete">1a e1 91 cd 93 b4 44 cc</span></td><td> </td><td class="rblock">   84 <span class="insert">6d 49 56 2d 47 45 4e 45 52 41 54 49 4f 4e 83 f6 f6 f6 83 f6 f6 f6 83</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete"> e4 80 16 07 03 ee d9 c4 a1 bc b6 11 66 49 56 5f 33 61 65 0d</span></td><td> </td><td class="rblock"><span class="insert">   18 68 40</span> 58 20 <span class="insert">b0 06 6f 45 98</span> 29 <span class="insert">14 95 82 8f 0a 2e 8c 0b 6f 42 10 f7 37</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f3 17 e0 2c bb f9 8d 4c df 70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   L is the length of IV_3ae, so 13 bytes.</td><td> </td><td class="right">   L is the length of IV_3ae, so 13 bytes.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   From these parameters, IV_3ae is computed:</td><td> </td><td class="right">   From these parameters, IV_3ae is computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   IV_3ae (13 bytes)</td><td> </td><td class="right">   IV_3ae (13 bytes)</td><td class="lineno"></td></tr>
      <tr id="diff0634"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">0e</span> 74 45 0a <span class="delete">fc ec e9 73 af 64 e9 4d 46</span></td><td> </td><td class="rblock">   <span class="insert">6a 27 26 3e 34 30 2e df 61 da</span> 74 <span class="insert">82 7f</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.3.5.3.  Ciphertext Computation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   COSE_Encrypt0 is computed with the following parameters.  Note that</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   AD_3 is omitted.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  empty protected header</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  external_aad = TH_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  plaintext = CBOR Sequence of the items kid_R, MAC_3, in this</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      order.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   with kid_R taken from Appendix B.3.2, and MAC_3 as calculated in</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Appendix B.3.4.1.2.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The plaintext is the following:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   P_3  (12 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   41 a7 49 05 82 46 79 2e f2 17 65 99</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the parameters above, the Enc_structure A_3 is computed.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   A_3 =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "Encrypt0",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     h'b0066f4598291495828f0a2e8c0b6f4210f737f317e02cbbf98d4cdf705dc1b3'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Which encodes to the following byte string to be used as Additional</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Authenticated Data:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   A_3 (CBOR-encoded) (45 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   83 68 45 6e 63 72 79 70 74 30 40 58 20 b0 06 6f</span> 45 <span class="insert">98 29 14 95 82 8f</span> 0a</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">2e 8c 0b 6f 42 10 f7 37 f3 17 e0 2c bb f9 8d 4c df 70 5d c1 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The key and nonce used are defined in Appendix B.3.5.2:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  key = K_3ae</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   *  nonce = IV_3ae</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Using the parameters above, the ciphertext CIPHERTEXT_3 can be</td><td> </td><td class="right">   Using the parameters above, the ciphertext CIPHERTEXT_3 can be</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   computed:</td><td> </td><td class="right">   computed:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0635"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   CIPHERTEXT_3 <span class="delete">(18</span> bytes)</td><td> </td><td class="rblock">   CIPHERTEXT_3 <span class="insert">(20</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">53 c3 99 19 99 a5 ff b8 69 21 e9 9b 60 7c 06 77 70</span> e0</td><td> </td><td class="rblock">   <span class="insert">b4 88 c1</span> e0 <span class="insert">b9 ac 2c 93 15 49 fa 60 98 60 26 30 7f 19 15 72</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0636"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   From the parameter <span class="delete">above,</span> message_3 is computed, as the CBOR Sequence</td><td> </td><td class="rblock"><span class="insert">B.3.5.4.  message_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   of the following items: <span class="delete">(C_R,</span> CIPHERTEXT_3).</td><td> </td><td class="rblock">                                                                         </td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   From the parameter <span class="insert">computed in Appendix B.3.5 and Appendix B.3.5.3,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   message_3 is computed, as the CBOR Sequence of the following items:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">(C_I,</span> CIPHERTEXT_3).</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   message_3 =</td><td> </td><td class="right">   message_3 =</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   (</td><td> </td><td class="right">   (</td><td class="lineno"></td></tr>
      <tr id="diff0637"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">     <span class="delete">h'08',</span></td><td> </td><td class="rblock">     <span class="insert">h'c7',</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">     h'53C3991999A5FFB86921E99B607C067770E0'</span></td><td> </td><td class="rblock"><span class="insert">     h'b488c1e0b9ac2c931549fa60986026307f191572'</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   )</td><td> </td><td class="right">   )</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Which encodes to the following byte string:</td><td> </td><td class="right">   Which encodes to the following byte string:</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0638"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   message_3 (CBOR Sequence) <span class="delete">(20</span> bytes)</td><td> </td><td class="rblock">   message_3 (CBOR Sequence) <span class="insert">(23</span> bytes)</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   <span class="delete">08</span> 52 53 <span class="delete">c3 99 19 99 a5 ff b8 69 21</span> e9 9b <span class="delete">60 7c</span> 06 <span class="delete">77 70 e0</span></td><td> </td><td class="rblock">   <span class="insert">41 c8 54 b4 88 c1 e0 b9 ac 2c 93 15 49 fa 60 98 60 26 30 7f 19 15 72</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">B.3.5.5.  OSCORE Security Context Derivation</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   From the previous message exchange, the Common Security Context for</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   OSCORE [RFC8613] can be derived, as specified in Section 3.8.1.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   First af all, TH_4 is computed: TH_4 = H( TH_3, CIPHERTEXT_3 ), where</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the input to the hash function is the CBOR Sequence of TH_3 and</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ( TH_3, CIPHERTEXT_3 ) (CBOR Sequence) (55 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 b0 06 6f 45 98 29 14 95 82 8f 0a 2e 8c 0b 6f 42 10 f7 37 f3 17 e0</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   2c bb f9 8d 4c df 70 5d c1 b3 54 b4 88 c1 e0 b9 ac 2c 93 15 49 fa 60 98</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   60 26 30 7f 19 15 72</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   And from there, compute the transcript hash TH_4 = SHA-256( TH_3,</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   CIPHERTEXT_3 )</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_4 value (32 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a2 a8 a2 13 02 91 cb 91 68 02 ab 78 e6 ef 6b e9 de b7 b6 33 da 2c 28 b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   bf 5f 06 bc 2c d1 12 e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   TH_4 (CBOR-encoded) (34 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   58 20 a2 a8 a2 13 02 91 cb 91 68 02 ab 78 e6 ef 6b e9 de b7 b6 33 da 2c</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   28 b3 bf 5f 06 bc 2c d1 12 e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   To derive the Master Secret and Master Salt the same HKDF-Expand</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   (PRK, info, L) is used, with different info and L.</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   For Master Secret:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   L for Master Secret = 16</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info for Master Secret =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "OSCORE Master Secret",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 128, h'', h'a2a8a2130291cb916802ab78e6ef6be9deb7b633da2c28b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                           bf5f06bc2cd112e5']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info (OSCORE Master Secret) (CBOR-encoded) (68 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 74 4f 53 43 4f</span> 52 <span class="insert">45 20 4d 61 73 74 65 72 20</span> 53 <span class="insert">65 63 72 65 74 83 f6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   f6 f6 83 f6 f6 f6 83 18 80 40 58 20 a2 a8 a2 13 02 91 cb 91 68 02 ab 78</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   e6 ef 6b</span> e9 <span class="insert">de b7 b6 33 da 2c 28 b3 bf 5f 06 bc 2c d1 12 e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Finally, the Master Secret value computed is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   OSCORE Master Secret (16 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   79 a1 02 48 12 94 1b bf d0 73 46</span> 9b <span class="insert">e9 c6 0e c5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   For Master Salt:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   L for Master Salt = 8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info for Master Salt =</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     "OSCORE Master Salt",</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ null, null, null ],</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     [ 64, h'', h'a2a8a2130291cb916802ab78e6ef6be9deb7b633da2c28b3</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                           bf5f06bc2cd112e5']</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ]</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   When encoded as a CBOR bstr, that gives:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   info (OSCORE Master Salt) (CBOR-encoded) (66 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   84 72 4f 53 43 4f 52 45 20 4d 61 73 74 65 72 20 53 61 6c 74 83 f6 f6 f6</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   83 f6 f6 f6 83 18 40 40 58 20 a2 a8 a2 13 02 91 cb 91 68 02 ab 78 e6 ef</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   6b e9 de b7 b6 33 da 2c 28 b3 bf 5f</span> 06 <span class="insert">bc 2c d1 12 e5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Finally, the Master Salt value computed is:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   OSCORE Master Salt (8 bytes)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   a2 98 5a 5d 84 e9 6e 15</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Client's Sender ID takes the value of C_R:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Client's OSCORE Sender ID (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c8</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The Server's Sender ID takes the value of C_I:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Server's OSCORE Sender ID (1 byte)</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   c7</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The algorithms are those negociated in the cipher suite:</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   AEAD Algorithm</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   10</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HMAC Algorithm</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   5</span></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Acknowledgments</td><td> </td><td class="right">Acknowledgments</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   The authors want to thank Alessandro Bruni, Karthikeyan Bhargavan,</td><td> </td><td class="right">   The authors want to thank Alessandro Bruni, Karthikeyan Bhargavan,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Martin Disch, Theis Groenbech Petersen, Dan Harkins, Klaus Hartke,</td><td> </td><td class="right">   Martin Disch, Theis Groenbech Petersen, Dan Harkins, Klaus Hartke,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Russ Housley, Alexandros Krontiris, Ilari Liusvaara, Karl Norrman,</td><td> </td><td class="right">   Russ Housley, Alexandros Krontiris, Ilari Liusvaara, Karl Norrman,</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Salvador Perez, Eric Rescorla, Michael Richardson, Thorvald Sahl</td><td> </td><td class="right">   Salvador Perez, Eric Rescorla, Michael Richardson, Thorvald Sahl</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Joergensen, Jim Schaad, Carsten Schuermann, Ludwig Seitz, Stanislav</td><td> </td><td class="right">   Joergensen, Jim Schaad, Carsten Schuermann, Ludwig Seitz, Stanislav</td><td class="lineno"></td></tr>
      <tr id="diff0639"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Smyshlyaev, Valery Smyslov, Rene Struik, <span class="delete">Vaishnavi Sundararajan, Erik</span></td><td> </td><td class="rblock">   Smyshlyaev, Valery Smyslov, Rene Struik, and <span class="insert">Erik Thormarker</span> for</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock"><span class="delete">   Thormarker,</span> and <span class="delete">Michel Veillette</span> for reviewing and commenting on</td><td> </td><td class="rblock">   reviewing and commenting on intermediate versions of the draft.  We</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   intermediate versions of the draft.  We are especially indebted to</td><td> </td><td class="rblock">   are especially indebted to Jim Schaad for his continuous reviewing</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   Jim Schaad for his continuous reviewing and implementation of</td><td> </td><td class="rblock">   and implementation of different versions of the draft.</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   different versions of the draft.</td><td> </td><td class="rblock"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">Authors' Addresses</td><td> </td><td class="right">Authors' Addresses</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0640"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   G<span class="delete">oe</span>ran Selander</td><td> </td><td class="rblock">   G<span class="insert">ö</span>ran Selander</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Ericsson AB</td><td> </td><td class="right">   Ericsson AB</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Email: goran.selander@ericsson.com</td><td> </td><td class="right">   Email: goran.selander@ericsson.com</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr id="diff0641"><td></td></tr>
      <tr><td class="lineno"></td><td class="lblock">   John Preu<span class="delete">ss</span> Mattsson</td><td> </td><td class="rblock">   John Preu<span class="insert">ß</span> Mattsson</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Ericsson AB</td><td> </td><td class="right">   Ericsson AB</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Email: john.mattsson@ericsson.com</td><td> </td><td class="right">   Email: john.mattsson@ericsson.com</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Francesca Palombini</td><td> </td><td class="right">   Francesca Palombini</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Ericsson AB</td><td> </td><td class="right">   Ericsson AB</td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr><td class="lineno"></td><td class="left">   Email: francesca.palombini@ericsson.com</td><td> </td><td class="right">   Email: francesca.palombini@ericsson.com</td><td class="lineno"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr id="end" bgcolor="gray"><th colspan="5" align="center">&nbsp;End of changes. 641 change blocks.&nbsp;</th></tr>
     <tr class="stats"><td></td><th><i>1558 lines changed or deleted</i></th><th><i> </i></th><th><i>2551 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" class="small" align="center"><br>This html diff was produced by rfcdiff 1.48. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/">http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </tbody></table>
   
   
</body></html>